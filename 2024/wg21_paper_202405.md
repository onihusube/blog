# ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´05æœˆï¼‰

æ–‡æ›¸ã®ä¸€è¦§

- [JTC1/SC22/WG21 - Papers 2024 mailing2024-05](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/#mailing2024-05)

å…¨éƒ¨ã§139æœ¬ã‚ã‚Šã¾ã™ã€‚

ã‚‚ãã˜

[:contents]

### [N4983 WG21 agenda: 24-29 June 2024, St. Louis, MO, USA](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/n4983.html)

2024å¹´6æœˆã«ã‚»ãƒ³ãƒˆãƒ«ã‚¤ã‚¹ã§è¡Œã‚ã‚ŒãŸä¼šè­°ã®ã‚¢ã‚¸ã‚§ãƒ³ãƒ€ã€‚

### [P0260R9 C++ Concurrent Queues](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p0260r9.html)

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¸¦è¡Œã‚­ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã®è¨­è¨ˆã‚’ç·´ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0260R5 C++ Concurrent Queues - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/02/12/210302#P0260R5-C-Concurrent-Queues)
- [P0260R7 C++ Concurrent Queues - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/02/12/210302#P0260R5-C-Concurrent-Queues)
- [P0260R8 C++ Concurrent Queues - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P0260R8-C-Concurrent-Queues)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ææ¡ˆã™ã‚‹æ–‡è¨€ã®æ‹¡å……
- `capacity`ã®ä¿®æ­£
- `push()/pop()`ã®æ–‡è¨€ã«"strongly happens before"ã‚’ä½¿ã†ã‚ˆã†ã«å¤‰æ›´
- discussion pointsã‚’è¿½åŠ 
- ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒåŒã˜ã‚¹ãƒ¬ãƒƒãƒ‰ã«æˆ»ã‚‹ã“ã¨ã«é–¢ã™ã‚‹æ®µè½ã‚’å‰Šé™¤
- `try_*`ã¯ãƒ–ãƒ­ãƒƒã‚¯ã—ãªããªã£ãŸ
- `try_*`ã®spurious failureã«é–¢ã™ã‚‹æ–‡è¨€ã‚’è¿½åŠ 
- ã‚­ãƒ¥ãƒ¼ã‚’äº‹å‰ã«åŸ‹ã‚ã‚‹`bounded_queue`ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‰Šé™¤
- P3282ã¸ã®å‚ç…§ã‚’è¿½åŠ 
- `try_push(T &&, T &)`ã«é–¢ã™ã‚‹è­°è«–ã‚’Historic Contentsã«ç§»å‹•

ãªã©ã§ã™ã€‚

- [P0260 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/99)

### [P0843R12 inplace_vector](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p0843r12.html)

é™çš„ãªæœ€å¤§ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã‚’æŒã¡ãƒ’ãƒ¼ãƒ—é ˜åŸŸã‚’ä½¿ç”¨ã—ãªã„`std::vector`ã§ã‚ã‚‹`inplace_vector`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0843R5 static_vector - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´08æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/09/04/141015#P0843R5-static_vector)
- [P0843R6 static_vector - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P0843R6-static_vector)
- [P0843R8 `inplace_vector` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/09/23/203644#P0843R8-inplace_vector)
- [P0843R9 `inplace_vector` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/29/180915#P0843R9-inplace_vector)
- [P0843R10 `inplace_vector` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P0843R10-inplace_vector)
- [P0843R11 `inplace_vector` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P0843R11-inplace_vector)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ä»¥å‰ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚’å¾©å¸°ã—ã¦ã€æ¡ä»¶ä»˜ã`constexpr`ã‚’æœ‰åŠ¹åŒ–
- R8ã§å‰Šé™¤ã•ã‚ŒãŸ`constexpr`å¯¾å¿œã®è­°è«–ã‚’å†å°å…¥

ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã€2024å¹´6æœˆã®å…¨ä½“ä¼šè­°ã§C++26ã«å‘ã‘ã¦æ¡æŠã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P0843 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/114)

### [P0963R2 Structured binding declaration as a condition](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p0963r2.html)

æ§‹é€ åŒ–æŸç¸›å®£è¨€ã‚’æ¡ä»¶å¼ã‚’æ›¸ãã¨ã“ã‚ã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0963R1 Structured binding declaration as a condition - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´08æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/14/223052#P0963R1-Structured-binding-declaration-as-a-condition)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€åˆ†è§£å‰ã«æ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨ã„ã†è©•ä¾¡é †åºã‚’è¦å®šã—ãã‚Œã«ã¤ã„ã¦ã®è­°è«–ã‚’è¿½åŠ ã—ãŸã“ã¨ã¨ã€ææ¡ˆã™ã‚‹æ–‡è¨€ã®æ”¹å–„ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã€2024å¹´6æœˆã®å…¨ä½“ä¼šè­°ã§C++26ã«å‘ã‘ã¦æ¡æŠã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P0963 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1617)

### [P1000R6 C++ IS schedule](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1000r6.pdf)

C++26ç­–å®šã¾ã§ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãªã©ã‚’èª¬æ˜ã—ãŸæ–‡æ›¸ã€‚

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã¯R5ã®ã‚‚ã®ã¨ã»ã¼åŒã˜ã§ã™ãŒã€æ±ºå®šæ¸ˆã¿ã®ä¼šè­°é–‹å‚¬åœ°ã®åœ°åãŒè¨˜è¼‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

### [P1083R8 Move resource_adaptor from Library TS to the C++ WP](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1083r8.html)

`pmr::resource_adaptor`ã‚’Library Foundermental TSã‹ã‚‰ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‰ãƒ©ãƒ•ãƒˆã¸ç§»å‹•ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1083R4 Move `resource_adaptor` from Library TS to the C++ WP - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/02/19/181101#P1083R4-Move-resource_adaptor-from-Library-TS-to-the-C-WP)
- [P1083R5 Move `resource_adaptor` from Library TS to the C++ WP - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´03æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/04/02/175835#P1083R5-Move-resource_adaptor-from-Library-TS-to-the-C-WP)
- [P1083R6 Move `resource_adaptor` from Library TS to the C++ WP - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/08/11/193828#P1083R6-Move-resource_adaptor-from-Library-TS-to-the-C-WP)
- [P1083R7 Move `resource_adaptor` from Library TS to the C++ WP - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/11/13/233529#P1083R7-Move-resource_adaptor-from-Library-TS-to-the-C-WP)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€`resource-adaptor-imp`ã«å¯å¤‰é•·å¼•æ•°ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ ã—ãŸäº‹ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ç¾åœ¨LWGã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­ã§ã™ã€‚

- [P1083 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/33)

### [P1112R5 Language support for class layout control](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1112r5.pdf)

ã‚¯ãƒ©ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ˜ç¤ºçš„ã«åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®æ§‹æ–‡ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1112R4 Language support for class layout control - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P1112R4-Language-support-for-class-layout-control)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- Cã§ã¯æ§‹é€ ä½“ãƒ¡ãƒ³ãƒã®å®£è¨€é †èª¿æ•´ã§ã“ã®å•é¡Œã‚’è§£æ¶ˆã§ãã‚‹ãŒã€C++ã§ã¯ãã‚Œã¯å®Ÿè¡Œå¯èƒ½ã§ã¯ãªã„ã“ã¨ã«ã¤ã„ã¦ã®èª¬æ˜ã®è¿½åŠ 
- ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã“ã®å•é¡Œã‚’è§£æ±ºã§ããªã„ã“ã¨ã«ã¤ã„ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- Design principlesã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- `eval`ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼ã‚’è¿½åŠ 
- `smallest`ã‚’`small`ã«å¤‰æ›´ã—ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®èª¬æ˜ã‚’è¿½åŠ 
- å¯¾è±¡èª­è€…ã‚’è¿½åŠ 
- æ–‡è¨€ä½œæˆã«é–¢ã™ã‚‹æˆ¦ç•¥ã‚’è¿½è¨˜

ãªã©ã§ã™ã€‚

ä»Šå›ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«é–¢ã™ã‚‹æŒ‡ç¤ºã‚’è¡Œã†æ–¹æ³•ãŒ1ã¤è¿½åŠ ã•ã‚Œã¾ã—ãŸ

- `layout(eval(consteval_func))`
  - å…ƒã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã®é…åˆ—ã¨ã—ã¦å–å¾—ã—ã€ã‚ªãƒ•ã‚»ãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å¤‰æ›´ã§ãã‚‹`consteval`é–¢æ•°ã‚’å‘¼ã³å‡ºã™

`layout(eval(func))`ã«æ¸¡ã™`consteval`é–¢æ•°ã¯ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å¤‰æ›´ã™ã‚‹å ´åˆã«`true`ã‚’è¿”ã—ã€å¤‰æ›´ã—ãªã„ãªã‚‰ã°`false`ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã—ã¦ã€ãã®å¼•æ•°ã«ã¯æ¬¡ã®ã‚ˆã†ãªæ§‹é€ ä½“ã®é…åˆ—ãŒæ¸¡ã•ã‚Œã¾ã™

```cpp
// ã‚¯ãƒ©ã‚¹ã®å…ƒã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ã¤ã„ã¦ã®ã€å„ãƒ¡ãƒ³ãƒæ¯ã®æƒ…å ±ã‚’æŒã¤
struct layout_entry {
  enum type_id { base, member, tech };
  type_id type;
  string_view name; // ãƒ¡ãƒ³ãƒå
  size_t index;     // å®£è¨€é †ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  size_t size;      // sizeof()ã®çµæœã®å€¤
  int alignment;    // alignas()ã®çµæœã®å€¤
  bool noua;        // [[no_unique_address]]ã®æœ‰ç„¡
  bool fixed;       // ãƒ ãƒ¼ãƒ–å¯èƒ½ã‹ã©ã†ã‹
  size_t orig_offset;    // å…ƒã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ãŠã‘ã‚‹ã‚ªãƒ•ã‚»ãƒƒãƒˆ
  mutable size_t offset; // å¤‰æ›´ã™ã‚‹ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆåˆæœŸå€¤ã¯orig_offsetã®å€¤ï¼‰
};

// layout(eval(f))ã«æ¸¡ã™é–¢æ•°ã®ä¾‹
consteval bool my_layout_func(span<const layout_entry> entries);
```

ã“ã‚Œã«ã‚ˆã£ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒã¯ã‹ãªã‚Šè©³ç´°ã«ãã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã“ã‚Œä»¥ä¸Šè¿½æ±‚ã—ãªã„ã“ã¨ãŒEWGã§æ±ºå®šã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

- [P1112 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/38)

### [P1144R11 `std::is_trivially_relocatable`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1144r11.html)

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†é…ç½®ï¼ˆ*relocation*ï¼‰ã¨ã„ã†æ“ä½œã‚’å®šç¾©ã—ã€ãã‚Œã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®åŸºç›¤ã‚’æ•´ãˆã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1144R6 Object relocation in terms of move plus destroy - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´06æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/07/09/160343#P1144R6-Object-relocation-in-terms-of-move-plus-destroy)
- [P1144R7 `std::is_trivially_relocatable` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/04/23/192236#P1144R7-stdis_trivially_relocatable)
- [P1144R8 `std::is_trivially_relocatable` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P1144R8-stdis_trivially_relocatable)
- [P1144R9 `std::is_trivially_relocatable` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P1144R9-stdis_trivially_relocatable)
- [P1144R10 `std::is_trivially_relocatable` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P1144R10-stdis_trivially_relocatable)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ã“ã®ææ¡ˆã«æº–æ‹ æ¸ˆã¿ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¤ã„ã¦ã®å‚ç…§ã®è¿½åŠ 
- `uninitialized_relocate_n`ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãŸã‚ã«`NoThrowInputIterator`è¦ä»¶ã‚’è¿½åŠ 
- P3279ã¸ã®ç›¸äº’å‚ç…§ã‚’è¿½åŠ 

ãªã©ã§ã™ã€‚

- [P1144 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/43)

### [P1255R13 A view of 0 or 1 elements: views::nullable And a concept to constrain maybes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1255r13.pdf)

ä»»æ„ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„`std::optional`ç­‰ã®maybeãƒ¢ãƒŠãƒ‰ãªå¯¾è±¡ã‚’è¦ç´ æ•°0ã‹1ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¤‰æ›ã™ã‚‹Rangeã‚¢ãƒ€ãƒ—ã‚¿`views::maybe`/`views::nullable`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1255R6 : A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/05/01/194425#P1255R6--A-view-of-0-or-1-elements-viewsmaybe)
- [P1255R7 : A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/06/11/191943#P1255R7-A-view-of-0-or-1-elements-viewsmaybe)
- [P1255R8 A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/08/11/193828#P1255R8-A-view-of-0-or-1-elements-viewsmaybe)
- [P1255R9 A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´08æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/09/04/141015#P1255R9-A-view-of-0-or-1-elements-viewsmaybe)
- [P1255R10 A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/29/180915#P1255R10-A-view-of-0-or-1-elements-viewsmaybe)
- [P1255R12 A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/03/10/170322#P1255R12-A-view-of-0-or-1-elements-viewsmaybe)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- `views::maybe`ã‚’å‰Šé™¤ã—ã€`std::optional`ã®`range`åŒ–ã‚’å¥½ã‚€
- `std::maybe`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®è¿½åŠ 
- `std::optional`ã‚„ãƒã‚¤ãƒ³ã‚¿å‹ãªã©`maybee`å‹ã®ãŸã‚ã®ãƒ•ãƒªãƒ¼é–¢æ•°ã‚’è¿½åŠ 

ãªã©ã§ã™ã€‚

`std::maybe`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¯æ¬¡ã®ã‚ˆã†ãªå˜ç´”ãªã‚‚ã®ã§ã™

```cpp
template <class T>
concept maybe = requires(const T t) {
  bool(t);
  *(t);
};
```

ã“ã‚Œã«å¯¾ã—ã¦æ¬¡ã®ãƒ•ãƒªãƒ¼é–¢æ•°ã‚’è¿½åŠ ã—ã¾ã™

```cpp
template <class T, class R = optional<decay_t<T>>>
constexpr auto yield_if(bool b, T&& t) -> R {
  return b ? forward<T>(t) : R{};
}

template <maybe T,
          class U,
          class R = common_reference_t<iter_reference_t<T>, U&&>>
constexpr auto reference_or(T&& m, U&& u) -> R {
  static_assert(!reference_constructs_from_temporary_v<R, U>);
  static_assert(!reference_constructs_from_temporary_v<R, T&>);
  return bool(m) ? static_cast<R>(*m) : static_cast<R>((U&&)u);
}

template <maybe T,
          class U,
          class R = common_type_t<iter_reference_t<T>, U&&>>
constexpr auto value_or(T&& m, U&& u) -> R {
  return bool(m) ? static_cast<R>(*m) : static_cast<R>(forward<U>(u))
}

template <maybe T,
          class I,
          class R = common_type_t<iter_reference_t<T>,
          invoke_result_t<I>>>
constexpr auto or_invoke(T&& m, I&& invocable) -> R {
  return bool(m) ? static_cast<R>(*m) : static_cast<R>(invocable());
}
```

- [P1255 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/60)

### [P1306R2 Expansion statements](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1306r2.pdf)

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ãƒ«ãƒ¼ãƒ—ç”Ÿæˆã™ã‚‹ã“ã¨ã®ã§ãã‚‹ã€å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®ææ¡ˆã€‚

å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¨ã¯ã€é€šå¸¸ã®`range`ï¼ˆé…åˆ—ã‚„`std::vector`ç­‰ã‚³ãƒ³ãƒ†ãƒŠï¼‰ã«åŠ ãˆã¦ã‚¿ãƒ—ãƒ«ã‚„ã‚¯ãƒ©ã‚¹ã€æ³¢ã‹ã£ã“ã®ãƒªã‚¹ãƒˆã‚’åå¾©ã™ã‚‹ã“ã¨ã®ã§ãã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®ãƒ«ãƒ¼ãƒ—æ§‹æ–‡ã§ã‚ã‚Šã€ãƒ«ãƒ¼ãƒ—ã®çµæœã¨ã—ã¦ã¯ãƒ«ãƒ¼ãƒ—æœ¬ä½“ã®ã‚³ãƒ¼ãƒ‰ï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆï¼‰ã‚’ãƒ«ãƒ¼ãƒ—ã®åº¦ã«ãã®å ´ã«å±•é–‹ã—ã¦ã„ãã¾ã™ã€‚

ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªæ‹¡å¼µã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯

```cpp
auto tup = std::make_tuple(0, â€˜aâ€™, 3.14);
template for (auto elem : tup) {
  std::cout << elem << std::endl;
}
```

æ¬¡ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’ã¹ãŸæ›¸ãã—ãŸã®ã¨ç­‰ä¾¡ã«ãªã‚Šã¾ã™

```cpp
auto tup = std::make_tuple(0, â€˜aâ€™, 3.14);
{
  auto elem = std::get<0>(tup);
  std::cout << elem << std::endl;
}
{
  auto elem = std::get<1>(tup);
  std::cout << elem << std::endl;
}
{
  auto elem = std::get<2>(tup);
  std::cout << elem << std::endl;
}
```

ã¾ãŸå±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã§ã¯ã€æ³¢ã‹ã£ã“ãƒªã‚¹ãƒˆãŒç‰¹åˆ¥æ‰±ã„ã•ã‚Œã¦ãŠã‚Šã€ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™

```cpp
template for (auto elem : {0, 'a', 3.14}) {
  std::cout << elem << std::endl;
}
```

ã“ã®æ³¢ã‹ã£ã“ãƒªã‚¹ãƒˆã¯åˆæœŸåŒ–å­ãƒªã‚¹ãƒˆã§ã¯ãªãã€ã“ã®æ³¢ã‹ã£ã“ãƒªã‚¹ãƒˆã¯åˆæœŸåŒ–ã‚’è¡Œã‚ãšã«å„è¦ç´ ã«å¯¾ã—ã¦ç›´æ¥ãƒ«ãƒ¼ãƒ—ãŒå±•é–‹ã•ã‚Œã¾ã™ã€‚

å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯æ¬¡ã®ã‚‚ã®ã«å¯¾ã—ã¦ä½¿ç”¨ã§ãã¾ã™

- æ§‹é€ åŒ–æŸç¸›å¯èƒ½ãªã‚¯ãƒ©ã‚¹å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    - ãƒ—ãƒ¬ãƒ¼ãƒ³ãªæ§‹é€ ä½“ã‚„ã‚¿ãƒ—ãƒ«ãªã©
- `constexpr`ãªç¯„å›²ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    - ä¸»ã«`std::vector`
- æ³¢ã‹ã£ã“ã§åŒºåˆ‡ã‚‰ã‚ŒãŸå¼ã®ãƒªã‚¹ãƒˆï¼ˆå±•é–‹åˆæœŸåŒ–å­ãƒªã‚¹ãƒˆã€"expansion-init-lists"ï¼‰
    - ä¾‹ãˆã°ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ‘ãƒƒã‚¯ã‚‚`{pack...}`ã¨ã™ã‚‹ã“ã¨ã§ãƒ«ãƒ¼ãƒ—å¯¾è±¡ã«ãªã‚‹

å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯ãƒ«ãƒ¼ãƒ—ãªé¢¨ã‚’è£…ã£ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®ã¨ã“ã‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã£ã¦ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ãã®ã§ã¯ãªãã€äºˆã‚ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾è±¡ã®å„è¦ç´ ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®åˆ—ã¨ã—ã¦ã€ç¯„å›²`for`åŒæ§˜ã«è¨€èªçµ„ã¿è¾¼ã¿ã®ãƒã‚¯ãƒ­ã®ã‚ˆã†ãªå½¢ã§ã€ä¸€ç™ºã§ç½®æ›ã•ã‚Œã¾ã™ã€‚ã¨ã¯ã„ãˆã€çµæœã®ã‚³ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–é †åºã‚„å®Ÿè¡Œã•ã‚ŒãŸæ™‚ã®å®Ÿè¡Œé †ã¯ã‚ãŸã‹ã‚‚ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã£ã¦é †ç•ªã«ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆãŒç”Ÿæˆã•ã‚Œã¦ã„ã£ãŸã®ã¨åŒã˜ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

ã“ã®å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯ç‰¹ã«é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã¨éå¸¸ã«ç›¸æ€§ãŒè‰¯ã„æ©Ÿèƒ½ã§ã™ã€‚P2996R5ã‚ˆã‚Šã€åˆ—æŒ™å€¤ã‚’åˆ—æŒ™å€¤åã®æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

```cpp
template <typename E>
  requires std::is_enum_v<E>
constexpr std::string enum_to_string(E value) {
  template for (constexpr auto e : std::meta::enumerators_of(^E)) {
    if (value == [:e:]) {
      return std::string(std::meta::identifier_of(e));
    }
  }

  return "<unnamed>";
}

enum Color { red, green, blue };
static_assert(enum_to_string(Color::red) == "red");
static_assert(enum_to_string(Color(42)) == "<unnamed>");
```

`^E`ã¯åˆ—æŒ™å‹`E`ã‹ã‚‰ãã®ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’å–ã‚Šå‡ºã—ã¦ãŠã‚Šã€ãã‚Œã«å¯¾ã™ã‚‹`std::meta::enumerators_of()`ã¯åˆ—æŒ™å‹ã®å„åˆ—æŒ™å­ã®ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’å–ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾è±¡`e`ã¯`std::meta::info`ã®å€¤ã§ã€`[:e:]`ï¼ˆã‚¹ãƒ—ãƒ©ã‚¤ã‚·ãƒ³ã‚°ï¼‰ã«ã‚ˆã£ã¦å¯¾å¿œã™ã‚‹åˆ—æŒ™å€¤ã®å®šæ•°å€¤ã«å¤‰æ›ã™ã‚‹ã“ã¨ã§ã€å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®å„ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯åˆ—æŒ™å‹`E`ã®åˆ—æŒ™å­1ã¤ã«å¯¾ã—ã¦ãƒãƒƒãƒã™ã‚‹`if`æ–‡ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

`(std::meta::identifier_of()`ã¯ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã‹ã‚‰ãã‚Œã«å¯¾å¿œã™ã‚‹è­˜åˆ¥å­åã‚’æ–‡å­—åˆ—ã§å¾—ã‚‹ã‚‚ã®ã§ã€ã“ã“ã§ã¯`e`ã¯åˆ—æŒ™å­ã‚’æ˜ ã—ãŸã‚‚ã®ãªã®ã§ã€åˆ—æŒ™å­åãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æ–‡å­—åˆ—ã§å¾—ã‚‰ã‚Œã¾ã™ã€‚

ã“ã®`template for`ä»¥å¤–ã®ã‚‚ã®ã¯P2996ã®é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆã§ã™ã¹ã¦ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚

- [P1306 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/156)

### [P1494R3 Partial program correctness](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1494r3.html)

å› æœé–¢ä¿‚ã‚’é€†è»¢ã™ã‚‹ã‚ˆã†ãªéåº¦ãªæœ€é©åŒ–ã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã®ãƒãƒªã‚¢ã§ã‚ã‚‹`std::observable()`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1494R2 Partial program correctness - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/12/11/220126#P1494R2-Partial-program-correctness)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã§ã®ã‚µãƒãƒ¼ãƒˆã‚’è¦æ±‚
- å®Ÿè£…å¯èƒ½æ€§ã‚’æ˜ç¢ºåŒ–
- I/Oé–¢æ•°ã‚’æš—é»™çš„ãªãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æ‰±ã†ã‚ˆã†ã«ã™ã‚‹ä»£æ›¿æ¡ˆã«ã¤ã„ã¦ã®èª¬æ˜ã®è¿½åŠ 

ãªã©ã§ã™ã€‚

- [P1494 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/376)

### [P1928R9 `std::simd` - Merge data-parallel types from the Parallelism TS 2](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1928r9.pdf)

`std::simd<T>`ã‚’Parallelism TS v2ã‹ã‚‰æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ç§»ã™ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1928R1 Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/11/02/221657#P1759R3-Native-handles-and-file-streams)
- [P1928R2 Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/02/12/210302#P1928R2-Merge-data-parallel-types-from-the-Parallelism-TS-2)
- [P1928R3 Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/03/19/184146#P1928R3-Merge-data-parallel-types-from-the-Parallelism-TS-2)
- [P1928R4 `std::simd` - Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P1928R4-stdsimd---Merge-data-parallel-types-from-the-Parallelism-TS-2)
- [P1928R6 `std::simd` - Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/09/23/203644#P1928R6-stdsimd---Merge-data-parallel-types-from-the-Parallelism-TS-2)
- [P1928R7 `std::simd` - Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P1928R7-stdsimd---Merge-data-parallel-types-from-the-Parallelism-TS-2)
- [P1928R8 `std::simd` - Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/02/29/191439#P1928R8-stdsimd---Merge-data-parallel-types-from-the-Parallelism-TS-2)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ãƒ™ã‚¯ãƒˆãƒ«åŒ–å¯èƒ½ãªå‹ã¨ã—ã¦ã€C++23ã®æ‹¡å¼µæµ®å‹•å°æ•°ç‚¹æ•°å‹ã‚’è¿½åŠ 
- "selected indicesâ€ã¨â€œselected elementsâ€ã®å®šç¾©ã‚’æ”¹å–„
- ABIã‚¿ã‚°ã®æ„å›³ã‚’ç´¹ä»‹ã™ã‚‹æ–‡è¨€ã®æ”¹å–„
- `size`ã‚’å‘¼ã³å‡ºã—å¯èƒ½ã¨ã—ã¦ä¸€è²«ã—ã¦ä½¿ç”¨
- ä¸è¶³ã—ã¦ã„ãŸ`reduce`ã®`type_identity_t`ã‚’è¿½åŠ 
- `basic_simd_mask`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¼•æ•°ã‚’`native-abi`ã«ä¿®æ­£
- `simd_mask`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¼•æ•°ã‚’`simd`ã¨ä¸€è²«ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£
- `<simd>`ãƒ˜ãƒƒãƒ€ã‚’è¿½åŠ ã™ã‚‹ã®ã«å¿…è¦ãªå¤‰æ›´ã‚’è¿½åŠ 
- 2ã¤ã®æŠ•ç¥¨çµæœã‚’è¿½åŠ 
- `simd_size(_v)`ã‚’èª¬æ˜å°‚ç”¨ã«ã™ã‚‹
- `reduce_min_index`ã¨`reduce_max_index`äº‹å‰æ¡ä»¶ã‚’å¾©å…ƒ

ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ç¾åœ¨ã€LWGã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­ã§ã™ã€‚

- [P1928 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/670)

### [P2019R6 Thread attributes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2019r6.pdf)

`std::thread/std::jthread`ã«ãŠã„ã¦ã€ãã®ã‚¹ãƒ¬ãƒƒãƒ‰ã®ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã¨ã‚¹ãƒ¬ãƒƒãƒ‰åã‚’å®Ÿè¡Œé–‹å§‹å‰ã«è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

- [P2019R1 Usability improvements for `std::thread` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´08æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/09/04/141015#P2019R1-Usability-improvements-for-stdthread)
- [P2019R2 Usability improvements for `std::thread` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/11/13/233529#P2019R2-Usability-improvements-for-stdthread)
- [P2019R3 Thread attributes - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P2019R3-Thread-attributes)
- [P2019R4 Thread attributes - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P2019R4-Thread-attributes)
- [P2019R5 Thread attributes - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/03/10/170322#P2019R5-Thread-attributes)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€å®‰å…¨æ€§å‘ä¸Šã®ãŸã‚ã«ã‚¹ãƒ¬ãƒƒãƒ‰å±æ€§å¼•æ•°ãŒå·¦è¾ºå€¤å‚ç…§ã«ãªã‚‰ãªã„ã‚ˆã†ã«åˆ¶ç´„ã‚’è¿½åŠ ã—ãŸã“ã¨ã§ã™ã€‚

ç¾åœ¨ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®ä½¿ã„æ–¹ã¯æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™

```cpp
void f(int);

int main() {
  std::jthread thread{
      std::thread::name_hint{"Worker"},       // ã‚¹ãƒ¬ãƒƒãƒ‰åã®æŒ‡å®š
      std::thread::stack_size_hint{512*1024}, // ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã®æŒ‡å®š
      f, 42 // å®Ÿè¡Œã™ã‚‹å‡¦ç†ã¨ãã®å¼•æ•°
  };

  return 0;
}
```

- [P2019 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/817)

### [P2034R4 Partially Mutable Lambda Captures](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2034r4.pdf)

ãƒ©ãƒ ãƒ€å¼ã®å…¨ä½“ã‚’`mutable`ã¨ã™ã‚‹ã®ã§ã¯ãªãã€ä¸€éƒ¨ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã ã‘ã‚’`mutable`æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2034R1 Partially Mutable Lambda Captures - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´4æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/05/01/194425#P2034R1--Partially-Mutable-Lambda-Captures)
- [P2034R2 Partially Mutable Lambda Captures - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´4æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/07/05/003248#P2034R2--Partially-Mutable-Lambda-Captures)
- [P2034R2 Partially Mutable Lambda Captures - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´4æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P2034R3-Partially-Mutable-Lambda-Captures)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€Meta-Motivationã‚’è¿½è¨˜ã—ãŸã“ã¨ã¨ã€ã„ãã¤ã‹ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’æ”¹å–„ã—ãŸã“ã¨ãªã©ã§ã™ã€‚

ãƒ¡ã‚¿ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€`const`ãªå¤‰æ•°ã¯æ­£ã—ãæ‰±ã†ã®ãŒç°¡å˜ã§é–“é•ã£ã¦æ‰±ã†ã®ãŒé›£ã—ã„ã¯ãšã§ã‚ã‚Šã€ãƒ©ãƒ ãƒ€ã‚­ãƒ£ãƒ—ãƒãƒ£ã®æ–‡è„ˆã§`const`ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã‹ã¤æ­£ç¢ºã«æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ãªã™ã‚‹ã“ã¨ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®‰å…¨æ€§ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã‚‹ã‚‚ã®ã§ã‚ã‚‹ã€ã¨ã—ã¦ã„ã¾ã™ã€‚

- [P2034 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/764)

### [P2079R4 System execution context](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2079r4.html)

ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æä¾›ã™ã‚‹ã‚³ã‚¢æ•°ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰æ•°ï¼‰ã«åˆã‚ã›ãŸå›ºå®šã‚µã‚¤ã‚ºã®ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ã‚’æä¾›ã™ã‚‹*Scheduler*ã®ææ¡ˆã€‚

- [P2079R1 Parallel Executor - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´8æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/12/11/220126#P1899R1-stride_view)
- [P2079R2 System execution context - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´1æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/02/19/181101#P2079R2-System-execution-context)
- [P2079R3 System execution context - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/08/11/193828#P2079R3-System-execution-context)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- è¨­è¨ˆä¸Šã®è€ƒæ…®äº‹é …ã¨ç›®æ¨™ã‚’ã•ã‚‰ã«è¿½åŠ 
- ã•ã¾ã–ã¾ãªç½®ãæ›ãˆå¯èƒ½æ€§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ¯”è¼ƒã‚’è¿½åŠ 
- ç½®ãæ›ãˆå¯èƒ½æ€§ABIæ¨™æº–åŒ–ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- ç½®ãæ›ãˆç”¨ABIã®ä¾‹ã‚’è¿½åŠ 
- ç”Ÿå­˜æœŸé–“ä¿è¨¼ã‚’å¼·åŒ–
    - `system_context`ãŒãã®ä¸Šã§èµ·å‹•ã•ã‚ŒãŸã™ã¹ã¦ã®ä½œæ¥­ã‚ˆã‚Šã‚‚é•·ãç”Ÿå­˜ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ãŒæ˜è¨˜ã•ã‚Œã€ç ´æ£„æ™‚ã«æœªå®Œäº†ã®ä½œæ¥­ãŒã‚ã‚‹å ´åˆã¯ `std::terminate`ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸ

ãªã©ã§ã™ã€‚

ç½®ãæ›ãˆå¯èƒ½æ€§ï¼ˆ*replaceabiilty*ï¼‰ã¨ã¯ã€`system_context`ã®å®Ÿè£…ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç½®ãæ›ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹æ©Ÿèƒ½ã®äº‹ã§ã™ã€‚ã“ã‚Œã¯ã€å³å¯†ãªã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã—ã‹åˆ©ç”¨å¯èƒ½ã§ã¯ãªã„çµ„ã¿è¾¼ã¿ç’°å¢ƒã‚„oneTBBã®ã‚ˆã†ãªãƒ™ãƒ³ãƒ€ãƒ¼å›ºæœ‰å®Ÿè£…ã®åˆ©ç”¨ãªã©ã€å¤šæ§˜ãªå®Ÿè¡Œç’°å¢ƒã«å¯¾å¿œã™ã‚‹ãŸã‚ã§ã™ã€‚

ã“ã®æ–¹æ³•ã¨ã—ã¦ã¯3ã¤ã®æ–¹æ³•ãŒè€ƒãˆã‚‰ã‚Œã¾ã™

- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®ç½®ãæ›ãˆ
- ãƒªãƒ³ã‚¯æ™‚ã®ç½®ãæ›ãˆ
- å®Ÿè¡Œæ™‚ã®ç½®ãæ›ãˆ

| æ–¹æ³• | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|---|---|---|
| ãƒªãƒ³ã‚¯æ™‚ | * æ¨™æº–ã®å…ˆè¡Œä¾‹ã‚ã‚Š: `operator new` ã®ç½®æ›ã¨é¡ä¼¼ã—ã¦ã„ã‚‹<br/> * äºˆæ¸¬å¯èƒ½æ€§ãŒé«˜ã„: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã«é©ç”¨ã•ã‚Œã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã‚‹<br/> * ãƒªãƒ³ã‚¯æ™‚æœ€é©åŒ–ã«ã‚ˆã‚Šã€å‹æ¶ˆå»ã‚„é–“æ¥å‚ç…§ã‚’ã‚ã‚‹ç¨‹åº¦å‰Šæ¸›ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ | * ABI ã®å®šç¾©ãŒå¿…è¦ã¨ãªã‚‹ãŸã‚ã€å‹æ¶ˆå»ã‚„éåŠ¹ç‡æ€§ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹<br/> * å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ç•°ãªã‚‹ç½®æ›ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæ··åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€æ­£ã—ãå‹•ä½œã•ã›ã‚‹ã“ã¨ãŒé›£ã—ã„<br/> * ç½®æ›ãŒãƒªãƒ³ã‚¯ã®é †åºã«ä¾å­˜ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ |
| å®Ÿè¡Œæ™‚ | * æ¨™æº–ã®å…ˆè¡Œä¾‹ã‚ã‚Š:  `std::set_terminate()` ã¨é¡ä¼¼ã—ã¦ã„ã‚‹<br/> * å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (ä¾‹: Windows ã® DLL ã«ãŠã‘ã‚‹ C++ æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åŒä¸€ãƒãƒ¼ã‚¸ãƒ§ãƒ³) ã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€ä¸€è²«ã—ãŸå‹•ä½œã‚’å®¹æ˜“ã«å®Ÿç¾ã§ãã‚‹<br/> * 1ã¤ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã« system scheduler ã®è¤‡æ•°ã®å®Ÿè£…ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ | * system scheduler ã®ç½®æ›ã¨ã€ãã‚Œã‚’ç”¨ã„ãŸä½œæ¥­ã®ç”Ÿæˆã¨ã®é–“ã§ç«¶åˆçŠ¶æ…‹ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹<br/> * ABI ã‚’ä»‹ã—ãŸå‡¦ç†ãŒå¿…è¦ã¨ãªã‚‹ãŸã‚ã€ãƒªãƒ³ã‚¯æ™‚æœ€é©åŒ–ãŒã§ããªã„<br/> * ç•°ãªã‚‹å®Ÿè£…ãŒèµ·å‹•æ™‚ã« system scheduler ã®ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰²ã‚Šå½“ã¦ãŸå¾Œã€`main` ã®é–‹å§‹æ™‚ã«å®Ÿè£…ãŒç½®æ›ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ (ä¸»ã« QOI ã®å•é¡Œ) <br/>* å®‰å…¨æ€§ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã€ãŠã‚ˆã³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«æ­£ã—ã„å‡¦ç†ã‚’è¡Œã†ãŸã‚ã«ã€å³å¯†ãªãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã¨æ‰€æœ‰æ¨©ã®åˆ¶å¾¡ãŒå¿…è¦ã¨ãªã‚‹ |
| ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ | * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã‚ã‚‰ã‚†ã‚‹å ´æ‰€ã§åˆ©ç”¨ã§ãã‚‹å‹å®šç¾©ã‚’ä½¿ç”¨ã—ã¦ç½®æ›ã‚’è¡Œã†ã“ã¨ãŒã§ãã€ç°¡å˜ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹<br/> | * ODR é•åãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹<br/> * åŒä¸€ãƒ—ãƒ­ã‚»ã‚¹å†…ã®ç•°ãªã‚‹ãƒã‚¤ãƒŠãƒªé–“ã§å…±æœ‰ã§ããªã„ |

ææ¡ˆã§ã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®ç½®ãæ›ãˆã¯`system_context`ã®é‡è¦ãªè¨­è¨ˆåŸå‰‡ã®ä¸€ã¤ã§ã‚ã‚‹ã€ã‚ªãƒ¼ãƒãƒ¼ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã§å…±é€šãª1ã¤ã®å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒã¤ï¼ˆãŸã‚ã®ã‚‚ã®ï¼‰ã€ã¨ã„ã†ã®ã‚’ç ´ã£ã¦ã—ã¾ã†ãŸã‚æœ‰åŠ¹ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ãªã„ã¨ã—ã¦ãŠã‚Šã€å®Ÿè¡Œæ™‚ã‹ãƒªãƒ³ã‚¯æ™‚ã®ã©ã¡ã‚‰ã‹ãŒã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦æ®‹ã£ã¦ã„ã¾ã™ã€‚

- [P2079 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/806)

### [P2413R1 Remove unsafe conversions of unique_ptr](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2413r1.html)

`std::unique_ptr`ã«ãŠã‘ã‚‹ã€å±é™ºãªæš—é»™å¤‰æ›ã‚’ç¦æ­¢ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2413R0 Remove unsafe conversions of unique_ptr - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/08/14/213339#P2413R0-Remove-unsafe-conversions-of-unique_ptr)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- å¤‰æ›å…ˆã®å‹ã«*destroying operator delete*ãŒã‚ã‚‹å ´åˆã§ã‚‚å¤‰æ›ã‚’è¨±å¯ã™ã‚‹
- `default_delete::operator()`ã‚’åˆ¶ç´„ã™ã‚‹
- ç”Ÿãƒã‚¤ãƒ³ã‚¿ã‚’å–ã‚‹`std::unique_ptr`ã®ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’åˆ¶ç´„ã™ã‚‹
- ä¸å®Œå…¨å‹ã‚’å‡¦ç†ã™ã‚‹
- ç ´å£Šçš„å¤‰æ›´ã‚’æ–‡æ›¸åŒ–

ãªã©ã§ã™ã€‚

- [P2413 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1083)

### [P2434R1 Nondeterministic pointer provenance](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2434r1.html)

ç¾åœ¨ã®C++ã®ãƒã‚¤ãƒ³ã‚¿æ„å‘³è«–ã‚’ãƒã‚¤ãƒ³ã‚¿ã®*provenance*ãƒ¢ãƒ‡ãƒ«ã«å¯¾ã—ã¦æ•´åˆã•ã›ã‚‹ãŸã‚ã®ææ¡ˆã€‚

- [P2434R0 Nondeterministic pointer provenance - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/12/25/175304#P2434R0-Nondeterministic-pointer-provenance)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- P2318R1ã®åˆ†æã¨ææ¡ˆã«é–¢ã™ã‚‹è­°è«–ã‚’æ˜ç¢ºåŒ–
- pointer zapã¸ã®å½±éŸ¿ã«ã¤ã„ã¦ã®èª¿æŸ»ã‚’è¿½åŠ 

ãªã©ã§ã™ã€‚

pointer zapã¸ã®å½±éŸ¿ã«ã¤ã„ã¦ã¯ã€çš†ç„¡ã§ã¯ãªã„ã‚‚ã®ã®å°ã•ãªè¿½åŠ ã®å¤‰æ›´ã ã‘ã§å¯¾å¿œã§ãã‚‹ã¨ã—ã¦ã„ã¾ã™ã€‚

- [P2434 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1364)

### [P2689R3 Atomic Refs Bound to Memory Orderings & Atomic Accessors](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2689r3.html)

`mdspan`ã®è¦ç´ ã«ã‚¢ãƒˆãƒŸãƒƒã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã‚¢ã‚¯ã‚»ã‚µã§ã‚ã‚‹ã€`atomic_accessor`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2689R0 `atomic_accessor` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/11/13/233529#P2689R0-atomic_accessor)
- [P2689R1 `atomic_accessor` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/02/12/210302#P2689R1-atomic_accessor)
- [P2689R2 `atomic_accessor` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/09/23/203644#P2689R2-atomic_accessor)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- `atomic-ref-bound`ã‚’ç®—è¡“å‹ãƒ»ãƒã‚¤ãƒ³ã‚¿å‹ã¨ãã‚Œä»¥å¤–ã®å‹ç”¨ã«åˆ†é›¢
    - ãƒ¡ãƒ³ãƒå‹`deference_type`ã®å®šç¾©ã®æœ‰ç„¡ã®ãŸã‚
- `atomic-ref-bound`ãŒèª¬æ˜å°‚ç”¨ã§ã‚ã‚‹ã‹ã©ã†ã‹ã«ã¤ã„ã¦ã®è­°è«–ã‚’è¿½åŠ 
- ãƒ¡ãƒ¢ãƒªã‚ªãƒ¼ãƒ€ãƒ¼ã®æŒ‡å®šã«é–¢ã™ã‚‹å¤‰æ›ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’æŒãŸãªã„ã“ã¨ã«ã¤ã„ã¦ã®è­°è«–ã‚’è¿½åŠ 
- west `const`ã‚¹ã‚¿ã‚¤ãƒ«ã®ä½¿ç”¨

ãªã©ã§ã™ã€‚

- [P2689 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1354)

### [P2719R0 Type-aware allocation and deallocation functions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2719r0.html)

å‹ã‚’æŒ‡å®šã™ã‚‹å½¢ã®`new/delete`æ¼”ç®—å­ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ–¹æ³•ã®ææ¡ˆã€‚

ã‚ã‚‹å‹ã«ã¤ã„ã¦ã€`new/delete`æ¼”ç®—å­ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹æ–¹æ³•ã¯ã€ã‚¯ãƒ©ã‚¹ã®é™çš„ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦å®šç¾©ã™ã‚‹ã‹ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª`new/delete`æ¼”ç®—å­ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹ã‹ã®2æŠã§ã™ã€‚`new/delete`æ¼”ç®—å­ã‚’å‹ã”ã¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å ´åˆã¯ãã®å‹ã«ã¤ã„ã¦ã®çŸ¥è­˜ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ãŒã€å‰è€…ã®æ–¹æ³•ã ã¨ãã‚ŒãŒå¾—ã‚‰ã‚Œã‚‹ã‚‚ã®ã®å‹ã«å¯¾ã—ã¦ä¾µå…¥çš„ã«ã—ã‹å®šç¾©ã§ãã¾ã›ã‚“ã€‚ä¸€æ–¹å¾Œè€…ã®æ–¹æ³•ã¯éä¾µå…¥çš„ã«å®šç¾©ã§ãã‚‹ã‚‚ã®ã®ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª`new/delete`ã‚’ä¸¸ã”ã¨ç½®ãæ›ãˆã‚‹ã“ã¨ã«ãªã‚‹ï¼ˆå‹æ¯ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰å¯èƒ½ãªã‚‚ã®ã®ã€ç¾å®Ÿã«ã¯`::operator new(void*)`ã‚’ä¸¸ã”ã¨ç½®æ›ã—ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ãŒã»ã¨ã‚“ã©ï¼‰ãŸã‚å½±éŸ¿ç¯„å›²ãŒå¤§ããã€è¤‡æ•°ã®ç¿»è¨³å˜ä½ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ãŒç‹¬è‡ªã«ãã‚Œã‚’è¡Œã£ã¦ã„ã‚‹ã¨ODRé•åã®æœªå®šç¾©å‹•ä½œã§å„ä»‹ãªãƒã‚°ã‚’æŠ±ãˆè¾¼ã‚€ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã‚ã‚‹å‹ã«ã¤ã„ã¦ã®`new/delete`æ¼”ç®—å­ã®éä¾µå…¥çš„ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ–¹æ³•ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã«ã‚ˆã‚‹ã‚«ã‚¹ã‚¿ãƒ æ–¹æ³•ã¯ã€æ—¢å­˜ã®`operator new/delete`ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒã‚¿ã‚°å‹ã‚’å–ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã®å»¶é•·ã§ã€ã‚ã‚‹å‹`T`ã«ã¤ã„ã¦ã®`new/delete`æ¼”ç®—å­ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯ã‚¿ã‚°å‹ã¨ã—ã¦`std::type_identity<T>`ã‚’å–ã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ãã—ã¦ã€`new/delete`å¼ãŒæ¼”ç®—å­ã‚’æ¢ç´¢ã™ã‚‹éç¨‹ã‚’å°‘ã—èª¿æ•´ã—ã¦ã€ã“ã®ã‚ˆã†ãªã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒç™ºè¦‹ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã®å‰å¾Œã§ã‚ã‚‹`new`æ¼”ç®—å­å‘¼ã³å‡ºã—ï¼ˆ`new`å¼ï¼‰ã«å¯¾ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè€ƒæ…®ã™ã‚‹`new`æ¼”ç®—å­ã®ã‚·ã‚°ãƒãƒãƒ£å€™è£œã¨é †ç•ªã¯æ¬¡ã®ã‚ˆã†ã«å¤‰åŒ–ã—ã¾ã™

<table>
<tr>
<th>ç¾åœ¨</th>
<th>ã“ã®ææ¡ˆ</th>
</tr>
<tr>
<td valign="top">

```cpp
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãnewæ¼”ç®—å­
new (args...) T(...)

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè€ƒæ…®ã™ã‚‹æ¼”ç®—å­
T::operator new(sizeof(T), args...)
::operator new(sizeof(T), args...)
```

</td>
<td valign="top">

```cpp
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãnewæ¼”ç®—å­
new (args...) T(...)

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè€ƒæ…®ã™ã‚‹æ¼”ç®—å­
T::operator new(sizeof(T), args...)
operator new(sizeof(T), type_identity<T>{}, argsâ€¦)  // ğŸ‘ˆè¿½åŠ 
::operator new(sizeof(T), args...)
```

</td>
</tr>
</table>


<table>
<tr>
<th>ç¾åœ¨</th>
<th>ã“ã®ææ¡ˆ</th>
</tr>
<tr>
<td valign="top">

```cpp
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãdeleteæ¼”ç®—å­
delete ptr

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè€ƒæ…®ã™ã‚‹æ¼”ç®—å­
T::operator delete(void-ptr)
::operator delete(void-ptr)
```

</td>
<td valign="top">

```cpp
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãdeleteæ¼”ç®—å­
delete ptr

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè€ƒæ…®ã™ã‚‹æ¼”ç®—å­
T::operator delete(void-ptr)
operator delete(void-ptr, type_identity<T>{})  // ğŸ‘ˆè¿½åŠ 
::operator delete(void-ptr)
```

</td>
</tr>
</table>

é…åˆ—ç‰ˆã‚‚åŒæ§˜ã§ã™ã€‚

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã«ã€å‹æ¯ã«ç•°ãªã‚‹ãƒ¡ãƒ¢ãƒªé ˜åŸŸã«é…ç½®ã™ã‚‹ï¼ˆåŒã˜å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åŒã˜ãƒ¡ãƒ¢ãƒªé ˜åŸŸã«é…ç½®ã™ã‚‹ï¼‰ã¨ã„ã†ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒã‚ã‚Šã€ã“ã‚Œã«ã‚ˆã£ã¦Type Confusionæ”»æ’ƒã«å¯¾ã™ã‚‹è€æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã§ã™ã€‚å®Ÿéš›ã«ã€Appleã§ã¯è‡ªç¤¾é–‹ç™ºã®OSã‚«ãƒ¼ãƒãƒ«ã§ã“ã‚Œã‚’å°å…¥ã™ã‚‹ã“ã¨ã§Type Confusionè„†å¼±æ€§ã®è»½æ¸›ã«å¤§ããªåŠ¹æœãŒã‚ã£ãŸã¨ã®ã“ã¨ã§ã™ï¼ˆç­†è€…ã®æ–¹ã¯Appleã®æ–¹ï¼‰ã€‚

ã‚«ãƒ¼ãƒãƒ«ã«é™ã‚‰ãšã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒé‡è¦ãªã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã¯ã“ã®ã‚ˆã†ãªæ‰‹æ³•ã‚’å–ã‚Šå…¥ã‚Œã‚‹ã“ã¨ãŒåˆç†çš„ãªå ´åˆãŒã‚ã‚Šã¾ã™ãŒã€ç¾åœ¨ã®C++ã®`new/delete`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯ã“ã®ã‚ˆã†ãªæ‰‹æ³•ã‚’å¤§è¦æ¨¡ã‹ã¤ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§é”æˆã™ã‚‹ã“ã¨ã‚’ã‚µãƒãƒ¼ãƒˆã§ãã¦ã„ã¾ã›ã‚“ã€‚ã“ã®ææ¡ˆã®å†…å®¹ã¯ãã®ã‚ˆã†ãªæ‰‹æ³•ã‚’é”æˆã™ã‚‹ãŸã‚ã®æ§‹æˆè¦ç´ ã§ã‚ã‚Šã€é–“æ¥çš„ã«C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã«ç¹‹ãŒã‚Šã¾ã™ã€‚

ææ¡ˆæ–‡æ›¸ã‚ˆã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

```cpp
namespace lib {
  struct Foo { };

  void* operator new(std::size_t, std::type_identity<Foo>); // (1)

  struct Foo2 { };
}

struct Bar {
  static void* operator new(std::size_t); // (2)
};

void* operator new(std::size_t); // (3)

void f() {
  new lib::Foo();  // calls (1)
  new Bar();       // calls (2)
  new lib::Foo2(); // (1)ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã«å¤±æ•—ã™ã‚‹ãŸã‚ã€(3)ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹
  new int();       // calls (3)
}
```

ç¾åœ¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯`new`æ¼”ç®—å­ã®æ¢ç´¢ã«ãŠã„ã¦ã€ã¾ãšå¯¾è±¡ã®å‹ï¼ˆ`new T{}`ã®`T`ï¼‰ã®ã‚¯ãƒ©ã‚¹ã‚¹ã‚³ãƒ¼ãƒ—ã§`T::operator new()`ã‚’æ¢ç´¢ã—ã€è¦‹ã¤ã‹ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã—ã¾ã™ã€‚è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€æ¬¡ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®`::operator new()`ã‚’æ¢ç´¢ã—ã€è¦‹ã¤ã‹ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã©ã¡ã‚‰ã‹ãŒè¦‹ã¤ã‹ã‚Œã°ä¾‹ãˆã°ãã‚ŒãŒã‚¨ãƒ©ãƒ¼ã§ã‚‚æ¢ç´¢ã¯ãã‚Œã§çµ‚äº†ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª`::operator new()`ã‚’æ¢ç´¢ã™ã‚‹å‰ã«ã€ãƒ•ãƒªãƒ¼é–¢æ•°ã®`operator new()`ã‚’è€ƒæ…®ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ãã®éš›ã®ã‚·ã‚°ãƒãƒãƒ£ã¯æ¬¡ã®ã‚‚ã®ã§ã™

```cpp
operator new(sizeof(T), std::type_identity<T>{}, placement-args...)
```

å‹`T`ã«å¯¾ã—ã¦ç¬¬äºŒå¼•æ•°ã§`std::type_identity<T>`ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã—ã¦ãŠãã“ã¨ã§ã€ã“ã®æŒ¿å…¥ã•ã‚ŒãŸ2ã‚¹ãƒ†ãƒƒãƒ—ç›®ã®æ¢ç´¢ã§ãã‚Œã‚’ä½¿ã‚ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‚ã‘ã§ã™ã€‚ãã—ã¦ã€ã“ã®æ¢ç´¢ã¯ADLã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã‚‹ãŸã‚ã€åå‰ç©ºé–“å†…ã§`new/delete`æ¼”ç®—å­ã‚’å®šç¾©ã—ã¦ãŠãã“ã¨ã‚‚ã§ãã€ã“ã‚Œã«ã‚ˆã£ã¦ODRé•åã‚’ç·©å’Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- [å‹ã®å–ã‚Šé•ãˆã¨ã¯(Type Confusion) | ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒå¤§è¾å…¸](https://securitychecklist.net/security/cyber-attack/Type-Confusion.html)
- [P2719 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1898)

### [P2758R3 Emitting messages at compile time](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2758r3.html)

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ä»»æ„ã®è¨ºæ–­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2758R0 Emitting messages at compile time - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/02/12/210302#P2758R0-Emitting-messages-at-compile-time)
- [P2758R1 Emitting messages at compile time - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/02/29/191439#P2758R1-Emitting-messages-at-compile-time)
- [P2758R2 Emitting messages at compile time - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´102æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P2758R2-Emitting-messages-at-compile-time)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ä»–ã®ææ¡ˆï¼ˆP2741R3åŠã³P2738R1ï¼‰ãŒæ¡æŠã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ææ¡ˆã‚’æ•´ç†
- ã™ã¹ã¦ã®APIã«è¿½åŠ ã•ã‚Œã‚‹ã‚¿ã‚°ã«ã¤ã„ã¦è­°è«–ã‚’è¿½è¨˜

ãªã©ã§ã™ã€‚

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§å°å…¥ã•ã‚ŒãŸã‚¿ã‚°ã¨ã¯ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¨®åˆ¥ã‚’è¡¨ã™ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã¯ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç™ºè¡Œã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã€å®Ÿè£…å®šç¾©ã®æ–¹æ³•ã§ç‰¹å®šã®ã‚¿ã‚°ã‚’æŒã¤ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡ºåŠ›é–¢æ•°ã®å‡ºåŠ›ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã¨ãˆã°

```cpp
std::constexpr_warning(
  "format-too-many-args", // ğŸ‘ˆã‚¿ã‚°ã®æŒ‡å®š
  "Format string consumed {} arguments but {} were provided.",
  current_arg, total);
```

ï¼ˆfmtãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸­ã§ï¼‰ã“ã®ã‚ˆã†ãªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚å‡ºåŠ›ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€`-Wno-format-too-many-arg`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã“ã®å‡ºåŠ›ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã€ã®ã‚ˆã†ãªä½¿ã„æ–¹ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€ã“ã®åˆ¶å¾¡æ–¹æ³•ã¯å®Ÿè£…å®šç¾©ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã‚¿ã‚°ã«ä½¿ç”¨ã§ãã‚‹ã®ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®æ–‡å­—åˆ—ã‹ã¤ã€‚å¤§æ–‡å­—å°æ–‡å­—ã¨æ•°å­—ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ãã‚‰ã„ã«åˆ¶é™ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ•ãƒ©ã‚°ã¨ã—ã¦ã‚¿ã‚°æ–‡å­—åˆ—ã«å¯¾å¿œã™ã‚‹æ–‡å­—åˆ—ã‚’CLIã‹ã‚‰æŒ‡å®šã—ã¦åˆ¶å¾¡ã‚’è¡Œã†ã“ã¨ã‚’æ„å›³ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã¯ææ¡ˆã™ã‚‹é–¢æ•°ã¯åŸºæœ¬çš„ã«ã“ã®ã‚¿ã‚°ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ

```cpp
namespace std {
  // å®šæ•°å¼ä¸­ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›
  constexpr void constexpr_print_str(string_view) noexcept;
  constexpr void constexpr_print_str(tag-string, string_view) noexcept;

  // å®šæ•°å¼ä¸­ã§è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›
  constexpr void constexpr_warning_str(tag-string, string_view, string_view) noexcept;
  
  // å‘¼ã°ã‚Œã‚‹ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã€æŒ‡å®šã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›
  constexpr void constexpr_error_str(tag-string, string_view) noexcept;
}
```

- [P2758 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1445)

### [P2761R1 Slides: If structured binding (P0963R1 presentation)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2761r1.pdf)

P0963R1ã®ç´¹ä»‹ã‚¹ãƒ©ã‚¤ãƒ‰ã€‚

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯æ˜ç¤ºçš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚¹ãƒ©ã‚¤ãƒ‰ãŒ3ãƒšãƒ¼ã‚¸åˆ†è¶³ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P2786R6 Trivial Relocatability For C++26](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2786r6.pdf)

*trivially relocatable*ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2786R0 Trivial relocatability options - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/03/19/184146#P2786R0-Trivial-relocatability-options)
- [P2786R1 Trivial relocatability options - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P2786R1-Trivial-relocatability-options)
- [P2786R2 Trivial relocatability options - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/09/23/203644#P2786R2-Trivial-relocatability-options)
- [P2786R3 Trivial relocatability options - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P2786R3-Trivial-Relocatability-For-C26)
- [P2786R4 Trivial relocatability options - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P2786R4-Trivial-Relocatability-For-C26)
- [P2786R5 Trivial relocatability options - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P2786R5-Trivial-Relocatability-For-C26)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã‚’è¿½åŠ ã—ãŸã“ã¨ã§ã™ã€‚

- [P2786 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1463)

### [P2822R1 Providing user control of associated entities of class types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2822r1.pdf)

ADLã«ãŠã„ã¦è€ƒæ…®ã•ã‚Œã‚‹é–¢é€£åå‰ç©ºé–“ã‚’åˆ¶å¾¡ã™ã‚‹è¨€èªæ©Ÿèƒ½ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2822R0 Providing user control of associated entities of class types - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P2822R0-Providing-user-control-of-associated-entities-of-class-types)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ã‚¯ãƒ©ã‚¹ã«é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æŒ‡å®šãŒãªã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®ã‚¯ãƒ©ã‚¹ã‚’å›²ã†æœ€ã‚‚å†…å´ã®åå‰ç©ºé–“ã‚’é–¢é€£åå‰ç©ºé–“ã¨ã—ã¦æš—é»™çš„ã«è¿½åŠ ã—ãªã„ã‚ˆã†ã«ã—ãŸ
- `friend`ã¨å®£è¨€ã•ã‚ŒãŸé–¢æ•°ã‚’ç™ºè¦‹ã™ã‚‹ADLã®å‹•ä½œãŒå½±éŸ¿ã‚’å—ã‘ãªã„ã‚ˆã†ã«ã—ãŸ
- é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æŒ‡å®šãŒãªã•ã‚ŒãŸã‚¯ãƒ©ã‚¹å‹ã®å‰æ–¹å®£è¨€ã®æ„å›³ã•ã‚ŒãŸã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¨ã€åŒç­‰ã®å‰æ–¹å®£è¨€ã‚’æ§‹æˆã™ã‚‹æ–¹æ³•ã‚’æ˜ç¢ºåŒ–
- mp_unitsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ãŠã‘ã‚‹ADLã«é–¢ã™ã‚‹å•é¡Œã«ã¤ã„ã¦è¿½è¨˜
- [CWG Issue 2857](https://cplusplus.github.io/CWG/issues/2857.html)ãŒè§£æ±ºã•ã‚ŒãŸã“ã¨ã‚’ç¤ºã™ã‚ˆã†ã«æ›´æ–°
- æ¤œè¨ã•ã‚ŒãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆä»£æ›¿æ¡ˆï¼‰ã®é•·æ‰€ã¨çŸ­æ‰€ã‚’èª¬æ˜ã™ã‚‹ãŸã‚ã«ã€æ§‹æ–‡ã®é¸æŠã«é–¢ã™ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- â€œProposed Designâ€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‹¡å¼µã—ã€äºˆæƒ³ã•ã‚Œã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ã¤ã„ã¦è©³ç´°ã«è§£èª¬ã™ã‚‹
- è¨­è¨ˆã«é–¢ã™ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ 
    - â€œNaming a class template as an associated entityâ€
    - â€œNaming a template template parameter bound to an alias templateâ€
    - â€œClass template instantiationâ€
- é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è¨ˆç®—ä¸­ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã‚’å›é¿ã—ã‚ˆã†ã¨ã™ã‚‹ã®ã‚’ã‚„ã‚ãŸ
- ä»–ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆéã‚¯ãƒ©ã‚¹ï¼Ÿï¼‰ã®é–¢é€£åå‰ç©ºé–“ã¨ã„ã†è¨€è‘‰ã‚’å€‹åˆ¥ã«å®šç¾©ã—ã€ã©ã®åå‰ç©ºé–“ãŒé–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ã‚ã‚Šã€ã—ãŸãŒã£ã¦ADLã§è€ƒæ…®ã•ã‚Œã‚‹ã¹ãã‹ã‚’æ˜ç¤ºã™ã‚‹ã‚ˆã†ã«ææ¡ˆã™ã‚‹æ–‡è¨€ã‚’å¤‰æ›´
- å‚ç…§å‹ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã«[basic.lookup.argdep]ã®æ–‡è¨€ã‚’ä¿®æ­£ã—ã¦ã„ãŸã®ã‚’å–ã‚Šæ¶ˆã—
    - ã“ã®å•é¡Œã¯[CWG Issue 2888](https://cplusplus.github.io/CWG/issues/2888.html)ã§è£œè¶³ã•ã‚Œã¦ã„ã‚‹

ãªã©ã§ã™ã€‚

- [P2822 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1746)

### [P2830R4 Standardized Constexpr Type Ordering](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2830r4.html)

`std::type_info::before()`ã‚’`constexpr`ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2830R0 constexpr type comparison - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/04/23/192236#P2830R0-constexpr-type-comparison)
- [P2830R1 constexpr type comparison - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/02/29/191439#P2830R1-constexpr-type-comparison)
- [P2830R3 constexpr type comparison - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P2830R3-Standardized-Constexpr-Type-Ordering)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- EWGã®è­°è«–ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é©ç”¨
- `__PRETTY_FUNCTION__`ã®ç›¸é•ç‚¹ã®ä¾‹ã‚’è¿½åŠ 
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°ï¼ˆEWGã®æ§‹æ–‡ã‚¢ã‚¯ã‚»ãƒ—ãƒˆã«ã‚ˆã‚Šã€LEWGãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡ï¼‰
- `SORT_KEY(x, y)`ã‚’é©åˆ‡ã«å®šç¾©ã™ã‚‹ãŸã‚ã®æ›´ãªã‚‹æ¤œè¨ã®è¿½åŠ 

ãªã©ã§ã™ã€‚

- [P2830 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1507)

### [P2835R4 Expose `std::atomic_ref`'s object address](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2835r4.html)

`std::atomic_ref`ãŒå‚ç…§ã—ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2835R0 Expose `std::atomic_ref`'s object address - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P2835R0-Expose-stdatomic_refs-object-address)
- [P2835R1 Expose `std::atomic_ref`'s object address - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/09/23/203644#P2835R1-Expose-stdatomic_refs-object-address)
- [P2835R2 Expose `std::atomic_ref`'s object address - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/09/23/203644#P2835R1-Expose-stdatomic_refs-object-address)
- [P2835R3 Expose `std::atomic_ref`'s object address - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P2835R3-Expose-stdatomic_refs-object-address)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- `address()`ã®æˆ»ã‚Šå€¤å‹ã«`uintptr_t`ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ãŸ
  - æˆ»ã‚Šå€¤å‹ã‚’`const void*`ã‹ã‚‰ã€`T`ã®ä¿®é£¾ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹`address_return_t`ã«æˆ»ã—ãŸ
- æˆ»ã‚Šå€¤å‹ã®å¤‰æ›´ã«ä¼´ã£ã¦ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚„godboltã®ä¾‹ã‚’ä¿®æ­£

ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯LWGã«è»¢é€ã•ã‚Œã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡ã‚’ã—ã¦ã„ã¾ã™ã€‚

- [P2835 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1545)

### [P2841R3 Concept and variable-template template-parameters](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2841r3.pdf)

ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’å—ã‘å–ã‚‹ãŸã‚ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ§‹æ–‡ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2841R0 Concept Template Parameters - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P2841R0-Concept-Template-Parameters)
- [P2841R1 Concept Template Parameters - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P2841R1-Concept-Template-Parameters)
- [P2841R2 Concept Template Parameters - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P2841R2-Concept-and-variable-template-template-parameters)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ææ¡ˆã™ã‚‹æ–‡è¨€ã®æ”¹å–„ã®ã¿ã§ã™ã€‚

- [P2841 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1546)

### [P2846R2 `reserve_hint`: Eagerly reserving memory for not-quite-sized lazy ranges](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2846r2.pdf)

é…å»¶è©•ä¾¡ã®ãŸã‚è¦ç´ æ•°ãŒç¢ºå®šã—ãªã„ range ã® `ranges::to` ã‚’è¡Œã†éš›ã«ã€æ¨å®šã®è¦ç´ æ•°ã‚’ãƒ’ãƒ³ãƒˆã¨ã—ã¦çŸ¥ã‚‰ã›ã‚‹ `ranges::size_hint` CPO ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2846R0 `size_hint`: Eagerly reserving memory for not-quite-sized lazy ranges - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P2846R0-size_hint-Eagerly-reserving-memory-for-not-quite-sized-lazy-ranges)
- [P2846R1 `size_hint`: Eagerly reserving memory for not-quite-sized lazy ranges - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/29/180915#P2846R1-size_hint-Eagerly-reserving-memory-for-not-quite-sized-lazy-ranges)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- `size_hint`ã‹ã‚‰`reserve_hint`ãƒ˜ãƒªãƒãƒ¼ãƒ 
- `take_view`ã¯ç„¡æ¡ä»¶ã§`reserve_hint`ã‚’æä¾›ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£

ãªã©ã§ã™ã€‚

- [P2846 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1549)

### [P2849R0 async-object - aka async-RAII objects](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2849r0.pdf)

`sender`ãƒã‚§ãƒ¼ãƒ³ã«RAIIãƒªã‚½ãƒ¼ã‚¹ã‚’æ³¨å…¥ã™ã‚‹ãŸã‚ã®ã€éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ææ¡ˆã€‚

`sender/receiver`è‡ªä½“ã¯éåŒæœŸé–¢æ•°ã®å®Ÿè£…ã®ä¸€éƒ¨ã§ã‚ã‚Šã€P2300ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯éåŒæœŸé–¢æ•°ã¯å€¤ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã®ã„ãšã‚Œã‹ã®çµæœã«ã‚ˆã£ã¦éåŒæœŸçš„ã«å®Œäº†ã—ã¾ã™ã€‚

éåŒæœŸé–¢æ•°ã®å†…éƒ¨ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ï¼ˆéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã¯ã€éé“çš„å‡¦ç†ãŒå˜ä¸€ã®ãƒ­ãƒ¼ã‚«ãƒ«ãªãƒ–ãƒ­ãƒƒã‚¯ã«åã¾ã‚‹ã‚‚ã®ã§ã¯ãªã„ãŸã‚ã€é€šå¸¸æ‰‹å‹•ã§ãƒ¡ãƒ¢ãƒªã‚’ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

`sender`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ãƒã‚§ãƒ¼ãƒ³ã«å¯¾ã—ã¦å€¤ã‚’æ³¨å…¥ã™ã‚‹ã«ã¯ã€`let_value(value, func)`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€`func(value)`ã®çµæœã‚’ï¼ˆ`receiver`ã®å€¤ãƒãƒ£ãƒãƒ«ã§ï¼‰è¿”ã™`sender`ã‚’è¿”ã™ã‚‚ã®ã§ã€ãã“ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹å€¤ï¼ˆ`func(value)`ã®çµæœï¼‰ã¯å®‰å®šã—ãŸã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿æŒã•ã‚Œã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

ã“ã‚Œã¨åŒç¨®ãªã‚‚ã®ã¨ã—ã¦ã€`let_stop_source(sender, sender(inplace_stop_source&))`ã¨ã„ã†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€`sender`ãƒã‚§ãƒ¼ãƒ³ã«å¯¾ã—ã¦`inplace_stop_source`ã‚’æ³¨å…¥ã—ã€ãªãŠã‹ã¤ãã‚Œã«å®‰å®šçš„ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã®å»¶é•·ã§ã€`sender`ãƒã‚§ãƒ¼ãƒ³ã«å¯¾ã—ã¦å¤šæ§˜ãªéåŒæœŸãƒªã‚½ãƒ¼ã‚¹ã‚’æ³¨å…¥ã™ã‚‹ã‚ã®`let_xxx`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒå€‹åˆ¥ã«è€ƒæ¡ˆã•ã‚Œã¤ã¤ã‚ã‚Šã¾ã™ã€‚ã“ã®ã“ã¨ã¯ã€ã“ã®ã‚ˆã†ãªéåŒæœŸãƒªã‚½ãƒ¼ã‚¹ã‚’`sender`ãƒã‚§ãƒ¼ãƒ³ã§æ‰±ã†ãŸã‚ã®æ±ç”¨çš„ãªè¨­è¨ˆãŒæ¬ ã‘ã¦ã„ã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

ãã®ã‚ˆã†ãªéåŒæœŸã‚³ãƒ¼ãƒ‰ã§ã¯å¤šãã®å ´åˆã€`shared_ptr`ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ‰ãƒ›ãƒƒã‚¯ãªã‚¬ãƒ¼ãƒšãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè£…ã•ã‚Œã¾ã™ã€‚ã“ã®ã‚ˆã†ãªã‚¢ãƒ‰ãƒ›ãƒƒã‚¯ãªéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éåŒæœŸçš„ãªæ§‹ç¯‰ã¨ç ´æ£„ã¯ã‚ã‚‹çµ±ä¸€çš„ãªæ±ç”¨è¨­è¨ˆã«å¾“ã£ã¦ã„ãªã„å ´åˆã€æ±ç”¨çš„ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‹ã‚‰ãã®ã‚ˆã†ãªéåŒæœŸãƒªã‚½ãƒ¼ã‚¹ã‚’è¤‡æ•°ã¾ã¨ã‚ã¦æ‰±ã†ã“ã¨ã‚’å›°é›£ã«ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€`sender/receiver`ã‚’ç”¨ã„ãŸéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹ç¯‰ã¨ç ´æ£„ã®ãƒ«ãƒ¼ãƒ«ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å®Ÿè£…ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãŸã‚ã®3ã¤ã®åŸºæœ¬çš„ãªè¦ä»¶ã«ã¤ã„ã¦å®šç¾©ã—ã¦ã„ã¾ã™

- éåŒæœŸæ§‹ç¯‰ï¼ˆ*async constructio*ï¼‰
    - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã«ã¯æ§‹ç¯‰ä¸­ã«å®Ÿè¡Œã•ã‚Œã‚‹éåŒæœŸé–¢æ•°ãŒã‚ã‚‹
        - ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€é€šä¿¡ã‚’ç¢ºç«‹ã™ã‚‹ã€ãªã©
    - ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã“ã¨ãªãã€æ§‹ç¯‰ä¸­ã«éåŒæœŸé–¢æ•°ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
    - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã“ã‚Œã‚’æº€ãŸã™ã“ã¨ãŒã§ããªã„
- éåŒæœŸç ´æ£„ï¼ˆ*async destruction*ï¼‰
    - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã«ã¯ç ´æ£„ä¸­ã«å®Ÿè¡Œã•ã‚Œã‚‹éåŒæœŸé–¢æ•°ãŒã‚ã‚‹
        - ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ã€é€šä¿¡ã‚’ä¸­æ–­ã™ã‚‹ã€ãªã©
    - ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã“ã¨ãªãã€ç ´æ£„ä¸­ã«éåŒæœŸé–¢æ•°ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
    - ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã“ã‚Œã‚’æº€ãŸã™ã“ã¨ãŒã§ããªã„
- æ§‹é€ åŒ–ã•ã‚ŒãŸæ­£ã—ã„æ§‹ç¯‰ï¼ˆ*structured and correct-by-construction*ï¼‰
    - ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒ«ã‹ã‚‰æ´¾ç”Ÿã—ãŸã€ç›´æ„Ÿçš„ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ§‹ç¯‰ã®ãƒ«ãƒ¼ãƒ«
    - structured concurrencyã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿/ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ç‰ˆ

ã“ã‚Œã‚‰ã®è¦ä»¶ã®å…ƒã€ã“ã®ææ¡ˆã§ã¯ã¤ãã®3ã¤ã®ã‚‚ã®ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

- éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    - éåŒæœŸæ§‹ç¯‰ãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹ã¾ã§ä½¿ç”¨ã§ããªã„
    - éåŒæœŸæ§‹ç¯‰ãŒã‚¨ãƒ©ãƒ¼ã§å®Œäº†ã™ã‚‹å ´åˆãŒã‚ã‚‹
    - éåŒæœŸæ§‹ç¯‰ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹
    - éåŒæœŸç ´æ£„ãŒå¤±æ•—ã›ãšã€åœæ­¢ã§ããªã„ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹
- `async_using`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
    - å¸¸ã«ã€å†…éƒ¨ã®éåŒæœŸé–¢æ•°ã‚’å‘¼ã³å‡ºã™å‰ã«éåŒæœŸæ§‹ç¯‰ã‚’å®Œäº†ã™ã‚‹
    - å¸¸ã«ã€å†…éƒ¨ã®éåŒæœŸé–¢æ•°ãŒå®Œäº†ã™ã‚‹å‰ã«éåŒæœŸç ´æ£„ã‚’å®Œäº†ã™ã‚‹
    - å¸¸ã«ã€å†…éƒ¨ã®éåŒæœŸé–¢æ•°ã®å®Œäº†ã«ä¼´ã£ã¦éåŒæœŸç ´æ£„ã‚’å‘¼ã³å‡ºã™
    - å¸¸ã«ã€è¤‡æ•°ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éåŒæœŸç ´æ£„ã‚’ã€ãã®éåŒæœŸæ§‹ç¯‰ã®é€†é †ã§å‘¼ã³å‡ºã™
    - å¸¸ã«ã€éåŒæœŸæ§‹ç¯‰ã«æˆåŠŸã—ãŸéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã ã‘ã€éåŒæœŸç ´æ£„ã‚’å‘¼ã³å‡ºã™
- `async_tuple`
    - å¸¸ã«ã€`async_tuple`ãã®ã‚‚ã®ã®éåŒæœŸæ§‹ç¯‰å®Œäº†ã®å‰ã«ã€å†…åŒ…ã™ã‚‹å…¨ã¦ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éåŒæœŸæ§‹ç¯‰ã‚’å®Œäº†ã™ã‚‹
    - å¸¸ã«ã€å†…åŒ…ã™ã‚‹å…¨ã¦ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éåŒæœŸç ´æ£„ã‚’ã€ãã®éåŒæœŸæ§‹ç¯‰ã®é€†é †ã§å‘¼ã³å‡ºã™
    - å¸¸ã«ã€éåŒæœŸæ§‹ç¯‰ã«æˆåŠŸã—ãŸå†…åŒ…ã™ã‚‹éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã ã‘ã€éåŒæœŸç ´æ£„ã‚’å‘¼ã³å‡ºã™

éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒå£«ã¯çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã€ãã®è¦ä»¶ã¯æ¬¡ã®ã‚‚ã®ã§ã™

- æ§‹æˆï¼ˆ*composition*ï¼‰
    - è¤‡æ•°ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãƒã‚¹ãƒˆã›ãšã«åŒæ™‚ã«ä½¿ç”¨å¯èƒ½ã«ãªã‚‹
    - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®ä¾å­˜é–¢ä¿‚ã¯ãƒã‚¹ãƒˆã«ã‚ˆã£ã¦è¡¨ç¾ã•ã‚Œã‚‹
    - æ§‹æˆã¯ã€è¤‡æ•°ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸¦è¡ŒéåŒæœŸæ§‹ç¯‰ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹
    - æ§‹æˆã¯ã€è¤‡æ•°ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸¦è¡ŒéåŒæœŸç ´æ£„ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹

ã“ã®ææ¡ˆãŒæä¾›ã™ã‚‹ã®ã¯ã€ã“ã‚Œã‚‰ã®è¦ä»¶ã‚’å…·ä½“åŒ–ã—ãŸ`async_object<T>`ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨ã€`async_using`ã¨`async_tuple`ã€ãŠã‚ˆã³`packaged_async_object`ï¼ˆéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãã®éåŒæœŸã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å¼•æ•°ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã™ã‚‹ã‚‚ã®ï¼‰ã§ã™ã€‚

ææ¡ˆã‚ˆã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã€‚

éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ï¼ˆ`Foo`ï¼‰ã®å®Ÿè£…ä¾‹

```cpp
// Fooã¯intå€¤ã‚’æ ¼ç´ã™ã‚‹éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
struct Foo {
  // éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®šç¾©
  // éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒ ãƒ¼ãƒ–ä¸å¯ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
  struct object : __immovable {
    object() = delete;
    int v;
  private:
    // only allow Foo to run the constructor
    friend struct Foo;
    explicit object(int v) noexcept : v(v) {}
  };

  // æ§‹ç¯‰ã•ã‚ŒãŸéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒãƒ³ãƒ‰ãƒ«å‹
  // ã“ã‚Œã¯éåŒæœŸæ§‹ç¯‰ï¼ˆasync_construct()ï¼‰ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹
  using handle = std::reference_wrapper<object>;

  // éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”¨ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’äºˆç´„ã™ã‚‹å‹
  // nothrowãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½ ã‹ã¤ ãƒ ãƒ¼ãƒ–ä¸å¯ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
  using storage = std::optional<object>;
  
  // async_construct()ã¯æ§‹ç¯‰ã•ã‚ŒãŸéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒãƒ³ãƒ‰ãƒ«ã§å®Œäº†ã™ã‚‹senderã‚’è¿”ã™
  auto async_construct(storage& stg, int v) const noexcept {
    return then( just(std::ref(stg), v),
      [](storage& stg, int v) noexcept {
        auto construct = [&]() noexcept { return object{v}; };
        stg.emplace( __conv{construct});
        printf("foo constructed, %d\n", stg.value().v);

        return std::ref(stg.value());
      }
    );
  }

  // async_destruct() ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å†…ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç ´æ£„ã‚’å®Ÿè¡Œã—ã€éåŒæœŸç ´æ£„ãŒå®Œäº†ã—ãŸå¾Œã«å®Œäº†ã™ã‚‹senderã‚’è¿”ã™
  auto async_destruct(storage& stg) const noexcept {
    return then( just(std::ref(stg)),
      [](storage& stg) noexcept {
        printf("foo destructed %d\n", stg.value().v);
        stg.reset();
      }
    );
  }
};

// Fooã¯async_object
static_assert(async_object<Foo>);
// Fooã¯intã‹ã‚‰éåŒæœŸæ§‹ç¯‰å¯èƒ½
static_assert(async_object_constructible_from<Foo, int>);
```

2ã¤ã®`Foo`å‹ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€`sender`å¼ã§çŠ¶æ…‹ã‚’å¤‰æ›´ã™ã‚‹

```cpp
int main() {
  // 2ã¤ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã™ã‚‹sender
  auto inner = [](Foo::handle o0, Foo::handle o1) noexcept {
    return then( just(o0, o1),
      [](Foo::handle o0, Foo::handle o1) noexcept {
        auto& ro0 = o0.get();
        auto& ro1 = o1.get();
        ro0.v = ro0.v + ro0.v;
        ro1.v = ro1.v + ro1.v;
        printf("foo pack usage, %d, %d\n", ro0.v, ro1.v);
        fflush(stdout);
        return ro0.v + ro1.v;
      }
    );
  };

  // éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å¼•æ•°ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°
  packaged_async_object foo7{Foo{}, 7};
  packaged_async_object foo12{Foo{}, 12};

  // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’äºˆç´„ã—ã€2ã¤ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’éåŒæœŸæ§‹ç¯‰ã—
  // ãã‚Œã‚‰ãŒå®Œäº†ã—ã¦ã‹ã‚‰innerã®å‡¦ç†ã«ãã‚Œã‚‰ã®ãƒãƒ³ãƒ‰ãƒ«ã‚’æ¸¡ã—
  // innerã®å‡¦ç†ãŒå®Œäº†ã—ãŸã‚‰éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’éåŒæœŸç ´æ£„ã™ã‚‹
  // ãã—ã¦ã€ãã‚Œã‚‰å…¨ã¦ãŒå®Œäº†ã™ã‚‹ã¨å®Œäº†ã™ã‚‹éåŒæœŸå‡¦ç†ã‚’è¡¨ã™sender
  auto use_s = async_using(inner, foo7, foo12);
  
  // éåŒæœŸå‡¦ç†é–‹å§‹ã¨å¾…æ©Ÿã€çµæœå–å¾—
  auto [v] = sync_wait(use_s).value();
  printf("foo pack result %d\n\n", v);
}
```

ã“ã®ææ¡ˆã®å†…å®¹ã¯ç´”ç²‹ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã§ã‚ã‚Šã€ä»®å®Ÿè£…ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ : https://godbolt.org/z/rrbW6veYd

- [P2849 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1899)

### [P2876R1 Proposal to extend std::simd with more constructors and accessors](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2876r1.html)

`std::simd`ã«å¯¾ã—ã¦ã€åˆ©ä¾¿æ€§å‘ä¸Šã®ãŸã‚ã«æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ä¸¦åˆ—å‹ç­‰ã®ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2876R0 Proposal to extend std::simd with more constructors and accessors - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P2876R0-Proposal-to-extend-stdsimd-with-more-constructors-and-accessors)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- `range`ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ã¤ã„ã¦ã‚’åˆ¥ã®ææ¡ˆï¼ˆP3299ï¼‰ã¸åˆ†é›¢
- `initialiser-list`ã®ã‚ˆã†ãªã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«é–¢ã™ã‚‹èª¬æ˜ã‚’è¿½è¨˜

ãªã©ã§ã™ã€‚

- [P2876 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1531)

### [P2900R7 Contracts for C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2900r7.pdf)

C++ å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2900R1 Contracts for C++ - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P2900R1-Contracts-for-C)
- [P2900R3 Contracts for C++ - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/02/29/191439#P2900R3-Contracts-for-C)
- [P2900R4 Contracts for C++ - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/03/10/170322#P2900R4-Contracts-for-C)
- [P2900R5 Contracts for C++ - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P2900R5-Contracts-for-C)
- [P2900R6 Contracts for C++ - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P2900R6-Contracts-for-C)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- `quick_enforce`ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®è¿½åŠ 
    - P3191R0/P3226R0ã®å†…å®¹
- `enforce`ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®çµ‚äº†æ–¹æ³•ã‚’`std::abort()`å‘¼ã³å‡ºã—ã‹ã‚‰å®Ÿè£…å®šç¾©ã®æ–¹æ³•ã«å¤‰æ›´
    - P3191R0ã®å†…å®¹
- å¥‘ç´„æ¡ä»¶ã®è©•ä¾¡å›æ•°ã«å®Ÿè£…å®šç¾©ã®ä¸Šé™ã‚’è¿½åŠ 
    - é‡è¤‡è©•ä¾¡å›æ•°ã‚’æŒ‡å®šã—ã€é‡è¤‡è©•ä¾¡ãªã—ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨
    - P3119R0ã®å†…å®¹
- `post()`ã®æ¡ä»¶å¼ã§é…åˆ—å¼•æ•°ã‚’ODRä½¿ç”¨ã™ã‚‹ã®ã‚’ç¦æ­¢
    - P3119R0ã®å†…å®¹
- å…¨ã¦ã®å¥‘ç´„æ³¨é‡ˆã«ãŠã„ã¦ã€`va_start`ã®ä½¿ç”¨ã‚’ç¦æ­¢
    - P3119R0ã®å†…å®¹
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ‘ãƒ¼ãƒˆã§ææ¡ˆã—ã¦ã„ã‚‹åˆ—æŒ™å‹ã®åŸºåº•å‹ã‚’æœªè¦å®š
    - P3198R0ã®å†…å®¹
- `contract_kind`åˆ—æŒ™å‹ã®åå‰ã‚’`assertion_kind`ã¸å¤‰æ›´
    - P3198R0ã®å†…å®¹
- `contract_semantic`åˆ—æŒ™å‹ã®åå‰ã‚’`evaluation_semantic`ã¸å¤‰æ›´
    - P3198R0ã®å†…å®¹
- è©•ä¾¡ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ã¤ã„ã¦ã€checked/uncheckedã¨å‘¼ç§°ã—ã¦ã„ãŸã¨ã“ã‚ã‚’checking/non-checkingã«å¤‰æ›´
- æ–°ã—ã„ã‚µãƒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 
    - â€œFunction Type Aliasesâ€
    - â€œConstructors and Destructorsâ€
    - â€œDifferences Between Contract Assertions and the assert Macroâ€
- â€œDesign Principlesâ€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ‹¡å¼µ
- æ§˜ã€…ãªç´°ã‹ã„èª¬æ˜ã¨ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’è¿½åŠ 

ãªã©ã§ã™ã€‚

- [P2900 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1648)

### [P2963R2 Ordering of constraints involving fold expressions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2963r2.pdf)

ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®åˆ¶ç´„å¼ã¨ã—ã¦ç•³ã¿è¾¼ã¿å¼ã‚’ä½¿ç”¨ã—ãŸå ´åˆã«ã€æ„å›³é€šã‚Šã®é †åºä»˜ã‚’è¡Œã†ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2963R0 Ordering of constraints involving fold expressions - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/29/180915#P2963R0-Ordering-of-constraints-involving-fold-expressions)
- [P2963R1 Ordering of constraints involving fold expressions - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/03/10/170322#P2963R1-Ordering-of-constraints-involving-fold-expressions)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- CWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘ã¦ã®æ–‡è¨€ã®æ”¹å–„
    - ç‰¹ã«ã‚³ãƒ³ã‚»ãƒ—ãƒˆãŒã©ã†æº€ãŸã•ã‚Œã‚‹ã‹ã®èª¬æ˜ã‚’è¿½åŠ 
- åŒ…æ‘‚ã®ãƒã‚§ãƒƒã‚¯ãŒçŸ­çµ¡ã•ã‚Œã‚‹ã“ã¨ã‚’æ˜ç¢ºåŒ–
    - è¨­è¨ˆã®èª¬æ˜ã‚’è¿½åŠ 
- ç•³ã¿è¾¼ã¿å¼ã®åˆ¶ç´„ã¯ã€ä¸¡æ–¹ã«åŒã˜ç•³ã¿è¾¼ã¿æ¼”ç®—å­ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã®ã¿åŒ…å«é–¢ä¿‚ãŒæˆç«‹ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´
    - ç©ºã®ãƒ‘ãƒƒã‚¯ãŒã‚ã‚‹å ´åˆã«ã€åŒ…å«é–¢ä¿‚ã®æˆç«‹ã¨ãƒã‚§ãƒƒã‚¯ã®é–“ã«çŸ›ç›¾ãŒç”Ÿã˜ã‚‹ã®ã‚’å›é¿

ãªã©ã§ã™ã€‚

ææ¡ˆã‚ˆã‚Šã€ï¼ˆR1ã§ï¼‰è¿½åŠ ã•ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

```cpp
template <std::ranges::bidirectional_range R>
void f(R&&); // #1

template <std::ranges::random_access_range R>
void f(R&&); // #2


template <std::ranges::bidirectional_range... R>
void g(R&&...); // #3

template <std::ranges::random_access_range... R>
void g(R&&...); // #4


int main() {
  f(std::vector{1, 2, 3}); // okï¼ˆC++23åŠã³ã“ã®ææ¡ˆï¼‰#2ãŒå‘¼ã°ã‚Œã‚‹
  g(std::vector{1, 2, 3}); // ngï¼ˆC++23ï¼‰ã€okï¼ˆã“ã®ææ¡ˆï¼‰#4ãŒå‘¼ã°ã‚Œã‚‹
}
```

ã“ã®ææ¡ˆã¯2024å¹´6æœˆã®å…¨ä½“ä¼šè­°ã§æ¡æŠã•ã‚Œã€C++26WDã«ãƒãƒ¼ã‚¸ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P2963 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1638)

### [P2964R1 Allowing user-defined types in std::simd](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2964r1.html)

`std::simd`ã®ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å‹ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2664R6 Proposal to extend std::simd with permutation API - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P2964R0-Allowing-user-defined-types-in-stdsimd)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- SG1/SG6ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®åæ˜ 
- è¦ç´ å‹ã®åˆ¶é™ï¼ˆã‚µã‚¤ã‚ºç­‰ï¼‰ã‚’è¿½åŠ 
- ã‚¹ã‚«ãƒ©æ¼”ç®—å­ã‹ã‚‰æœ‰åŠ¹ãª`std::simd`æ¼”ç®—å­ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®æ–¹æ³•ã¨ã—ã¦æ¨è«–ï¼ˆ*inferencing*ï¼‰ã‚’è¿½åŠ 
- å‹å¤‰æ›ã‚’è¿½åŠ 
- ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã§ã¯ãªãã‚ªãƒ—ãƒˆã‚¢ã‚¦ãƒˆã«å¤‰æ›´
- æ˜ç¤ºçš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’å‰Šé™¤
- æ¨è«–ã®ä¾‹ã‚’è¿½åŠ 

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§è¿½åŠ ã•ã‚ŒãŸã‚¹ã‚«ãƒ©æ¼”ç®—å­ã‹ã‚‰ã®æ¨è«–ã¨ã¯ã€è¦ç´ å‹ã¨ãªã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å‹ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹æ¼”ç®—å­ï¼ˆ1è¦ç´ ã®æ¼”ç®—ã‚’è¡Œã†ã‚‚ã®ï¼‰ã‚’æ¤œå‡ºã—ã¦ãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã¯ã€`std::simd`ã«ã‚ˆã‚‹è¤‡æ•°è¦ç´ ä¸¦åˆ—è¨ˆç®—ã®çµæœã¯è¦ç´ å˜ä½ã«åŒã˜è¨ˆç®—ã‚’é©ç”¨ã—ãŸæ™‚ã®çµæœã¨ä¸€è‡´ã™ã‚‹ã¯ãšã€ã¨ã„ã†ä»®å®šã«åŸºã¥ãã‚‚ã®ã§ã™ã€‚

ä¾‹ãˆã°ã€`std::simd`ã®äºŒé …åŠ ç®—æ¼”ç®—å­ï¼ˆ`operator+`ï¼‰ã®å®Ÿè£…ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

```cpp
constexpr friend basic_simd operator+(const basic_simd& lhs, const basic_simd& rhs)
  requires (details::simd_has_custom_binary_plus || details::element_has_plus)
{
  if constexpr (details::is_standard_simd_type) {        // int, float, complex, etc.
    return details::plus(lhs, rhs);
  }
  else if constexpr (details::simd_has_custom_binary_plus) {  // user customisation point
    return simd_binary_plus(lhs, rhs);
  }
  else {
    return details::element_wise_plus(lhs, rhs);     // ğŸ‘ˆ Infer from scalar operator
  }
}
```

ã“ã®3ã¤ç›®ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒã‚¹ã‚«ãƒ©æ¼”ç®—å­ã‹ã‚‰ã®æ¨è«–ã§ã™ã€‚ã“ã®å ´åˆã€è¦ç´ å‹ã«å¯¾ã—ã¦å®šç¾©æ¸ˆã¿ã®æ¼”ç®—å­ã‚’ä½¿ç”¨ã—ã¦ãã‚Œã‚’è¦ç´ æ¯ã«é©ç”¨ã—ã¦è¨ˆç®—ã‚’è¡Œã„ã¾ã™ã€‚ãŸã ã—ã€ã“ã‚Œã¯æœ€ä½ãƒ©ã‚¤ãƒ³ã®ã‚µãƒãƒ¼ãƒˆã§ã‚ã‚Šã€å¿…ãšã—ã‚‚æœ€é©ãªSIMDã‚³ãƒ¼ãƒ‰ã«ãªã‚‰ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã¯ã€2ã¤ç›®ã®ã‚ˆã†ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒã‚¤ãƒ³ãƒˆã«ã‚¢ãƒ€ãƒ—ãƒˆã™ã‚‹ã“ã¨ã§ã‚ˆã‚ŠåŠ¹ç‡çš„ãªã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’è£œåŠ©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å‹`U`ã«å¯¾ã™ã‚‹`std::simd<U>`ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹å ´åˆã«å€‹ã€…ã®æ“ä½œã‚’ã‚¢ãƒ€ãƒ—ãƒˆã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ã¨ï¼ˆã‚ªãƒ—ãƒˆã‚¤ãƒ³ã ã¨ï¼‰éåº¦ã«ä¸ä¾¿ã§ã‚ã‚Šãƒ¡ãƒªãƒƒãƒˆãŒè–„ããªã‚‹ã¨ã—ã¦ã€è¦ç´ å‹ã®åˆ¶é™ã‚’æº€ãŸã™ä»»æ„ã®`U`ã«å¯¾ã—ã¦`std::simd<U>`ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨ã¦ã®æ“ä½œãŒæœ‰åŠ¹åŒ–ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãã‚ŒãŒæœ›ã¾ã—ããªã„å ´åˆï¼ˆ`std::atomic<T>`ãªã©ï¼‰ã¯ã‚ªãƒ—ãƒˆã‚¢ã‚¦ãƒˆã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã«ã‚ˆã£ã¦`std::simd<U>`ã‚’ä½¿ç”¨ä¸å¯èƒ½ã«ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

- [P2422 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1748)

### [P2967R1 Relocation Is A Library Interface](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2967r1.pdf)

ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒãƒ¼ãƒˆã®ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2967R0 Relocation Is A Library Interface - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P2967R0-Relocation-Is-A-Library-Interface)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã®å˜ç´”åŒ–
- é–¢æ•°åã‚’`relocate`ã‹ã‚‰`uninitized_relocate`ã«å¤‰æ›´
- ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹
- å¤±æ•—ã—ãªã„é–¢æ•°ã«ã¯`noexcept`ã‚’ä»˜åŠ 
- `contiguous_iterator`ã§ã¯ãªã„å ´åˆã«ç¯„å›²ã®é‡è¤‡ã®ã‚µãƒãƒ¼ãƒˆã‚’å‰Šé™¤
- å®Ÿè£…ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ 
- `std::swap`ã®æœ€é©åŒ–ã‚’P3239ã«å§”ã­ã‚‹

ãªã©ã§ã™ã€‚

- [P2967 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1652)

### [P2971R2 Implication for C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2971r2.pdf)

è¨˜å·è«–ç†ã«ãŠã‘ã‚‹å«æ„è¨˜å·ã®æŒ¯ã‚‹èˆã„ã‚’ã™ã‚‹`=>`æ¼”ç®—å­ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2971R0 Implication for C++ - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/29/180915#P2971R0-Implication-for-C)

R1ã§ã®å¤‰æ›´ã¯

- Â§3 (Intuition): æ‹¡å¼µã—ã€ä¾‹ã‚’è¿½åŠ 
- Â§4 (Properties): è¿½åŠ 
- Â§6 (Why Core?): å†æ§‹æˆã€é¸æŠè‚¢ã‚’å¢—ã‚„ã—ã¦æ‹¡å¼µ
- Â§7 (Design): å†æ§‹æˆã€è¨­è¨ˆé¸æŠã«ã¤ã„ã¦æ›´æ–°ã—ã€ã‚ˆã‚Šæ·±ãè¨˜è¿°ã™ã‚‹
- Â§9 (Implementation): å†æ§‹æˆã€æ§‹æ–‡è§£æã®å•é¡Œã«é–¢ã™ã‚‹æ–°ã—ã„è­°è«–ã‚’è¿½åŠ 
- Â§10 (Core Wording): æ›´æ–°ã•ã‚ŒãŸè¨­è¨ˆæ±ºå®šã‚’åæ˜ ã€Annex Cã‚’è¿½åŠ 

ãªã©ã§ã™ã€‚

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- Â§1 (What Is Implication?): Adaã®æ§‹æ–‡ã«ã¤ã„ã¦ã®ç°¡å˜ãªèª¬æ˜ã¨ã€å¿…è¦ååˆ†ï¼ˆæ¡ä»¶ï¼‰ã®èª¬æ˜ã‚’è¿½åŠ 
- Â§8 (Library Impact): 2023å¹´11æœˆã®LEWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’åæ˜ ã—ã€æŠ•ç¥¨çµæœã‚’è¿½è¨˜
- Â§11 (Library Wording): LEWGãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’åæ˜ 

ãªã©ã§ã™ã€‚

- [P2971 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1641)

### [P2976R1 Freestanding Library: algorithm, numeric, and random](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2976r1.html)

`<algorithm>, <numeric>, <random>`ã«ã‚ã‚‹ä¸€éƒ¨ã®æ©Ÿèƒ½ã‚’ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°æŒ‡å®šã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2976R0 Freestanding Library: algorithm, numeric, and random - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/29/180915#P2976R0-Freestanding-Library-algorithm-numeric-and-random)

R1ã§ã®å¤‰æ›´ã¯

- æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒã‚¯ãƒ­ã‚’è¿½åŠ ã™ã‚‹ä»£ã‚ã‚Šã«`__cpp_lib_freestanding_numeric`ã‚’æ›´æ–°
- `is_execution_policy`ã‚’ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°å¯¾è±¡ã¨ã—ã¦è¿½åŠ 
- ä¸¦åˆ—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’`freestanding-deleted`ã¨ã—ã¦ãƒãƒ¼ã‚¯
- `<random>`ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ æ¼”ç®—å­ã®ä»•æ§˜ã‚’æ”¹å–„ã—ã€æˆ»ã‚Šå€¤ã‚’æ˜ç¢ºåŒ–

ãªã©ã§ã™ã€‚

- [P2978 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1653)

### [P2988R5 `std::optional<T&>`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2988r5.pdf)

`std::optional`ãŒå‚ç…§ã‚’ä¿æŒã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2988R0 `std::optional<T&>` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P2988R0-stdoptionalT)
- [P2988R1 `std::optional<T&>` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/03/10/170322#P2988R1-stdoptionalT)
- [P2988R3 `std::optional<T&>` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P2988R3-stdoptionalT)
- [P2988R4 `std::optional<T&>` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P2988R4-stdoptionalT)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€`value_or()`ã«é–¢ã—ã¦P3091ã®å¤‰æ›´ã‚’å–ã‚Šè¾¼ã‚“ã ã“ã¨ã§ã™ã€‚

```cpp
template<typename T>
class optional<T&> {
  ...

  // P3091ã‹ã‚‰ã®å®£è¨€ã®ä¾‹
  template <class U = remove_cv_t<T>, class... Args>
  U value_or(Args&&...) const;

  template <class U = remove_cv_t<T>, class X, class... Args>
  constexpr U value_or(initializer_list<X>, Args&&...) const;

  ...
}
```

- [P2988 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1661)

### [P2996R3 Reflection for C++26](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2996r3.html)

å€¤ãƒ™ãƒ¼ã‚¹ã®é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2996R0 Reflection for C++26 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P2996R0-Reflection-for-C26)
- [P2996R1 Reflection for C++26 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/02/29/191439#P2996R1-Reflection-for-C26)
- [P2996R2 Reflection for C++26 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P2996R2-Reflection-for-C26)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé¡åƒï¼‰é–“ã®ç­‰ä¾¡æ€§ã¨ã€é¡åƒã«ã‚ˆã£ã¦ç‰¹æ®ŠåŒ–ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒªãƒ³ã‚±ãƒ¼ã‚¸ã«ã¤ã„ã¦è©³ç´°ã«èª¬æ˜
- TSæ™‚ä»£ã®åˆæ„ã‚’å¾©å…ƒã™ã‚‹ãŸã‚ã«`accessible_members_of()`ã‚’è¿½åŠ 
- `value_of()`ã‚’`extract()`ã«ãƒªãƒãƒ¼ãƒ ã—ã€é–¢æ•°ã‚’æ“ä½œã§ãã‚‹ã‚ˆã†ã«æ‹¡å¼µ
- å®šæ•°å¼ã§ã¯ãªãã€å€¤ã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚µãƒãƒ¼ãƒˆã‚’æ˜ç¢ºåŒ–
- clangã®è©¦é¨“å®Ÿè£…ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ 
- `can_substitute, is_value, is_object`åŠã³`value_of`ï¼ˆ`extract`ã¨ã¯åˆ¥ï¼‰ã‚’è¿½åŠ 
- å‹ç‰¹æ€§ã®å‘½åã«é–¢ã™ã‚‹issueã‚’è¿½è¨˜
- åå‰ä»˜ãã‚¿ãƒ—ãƒ«ã®åˆ¥ã®å®Ÿè£…ä¾‹ã‚’è¿½åŠ 
- `meta::info`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ/å€¤/ã‚¼ãƒ­åˆæœŸåŒ–ã¯ã€nullãªé¡åƒã‚’ç”Ÿæˆã™ã‚‹
- å®Ÿè£…ã•ã‚Œã¦ã„ãŸãŒä»¥å‰ã®ææ¡ˆã§ã¯çœç•¥ã•ã‚Œã¦ã„ãŸaddressed splicingï¼ˆã‚¹ãƒ—ãƒ©ã‚¤ã‚·ãƒ³ã‚°çµæœã®ã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ï¼‰ã‚’è¿½åŠ 
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¼•æ•°ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã«ã€`reflect_invoke`ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’è¿½åŠ 
- åå‰ã®è¡çªã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã€å…¨ã¦ã®å‹ç‰¹æ€§ã®åå‰ã‚’`type_`ã§å§‹ã‚ã‚‹
- ã‚ˆã‚Šæ±ç”¨çš„ãª`is_const, is_final, is_volatile`ã‚’è¿½åŠ 
- `is_noexcept`ã‚’è¿½åŠ 
- `is_explicit`ã‚’ãƒ¡ãƒ³ãƒé–¢æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯ãªããƒ¡ãƒ³ãƒé–¢æ•°ã«ã®ã¿ä½œç”¨ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£
- handling textã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- ODRã«é–¢ã™ã‚‹æ‡¸å¿µäº‹é …ã«ã¤ã„ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

ãªã©ã§ã™ã€‚

- [P2996 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1668)

### [P3045R1 Quantities and units library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3045r1.html)

ç‰©ç†é‡ã¨å˜ä½ã‚’æ‰±ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3045R0 Quantities and units library - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3045R0-Quantities-and-units-library)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ä¾å­˜é–¢ä¿‚ï¼ˆææ¡ˆï¼‰ã®è¡¨ã«1ã¤è¿½åŠ 
- Safe unit conversionsã®ç« ã‚’`value_cast()`ã‚’ä½¿ç”¨ã—ã¦æ‹¡å¼µ
- The affine spaceã®ç« ã‚’ã»ã¼æ›¸ãç›´ã—
- Magnitudesç« ã‚’è¿½åŠ 
- `qp.quantity_from_zero()`ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŒ‡å®šã—ãŸåŸç‚¹ã§ã¯å‹•ä½œã—ãªããªã£ãŸ
- `qp.quantity_from()`ã¯ä»–ã®é‡ã®ç‚¹ã«å¯¾ã—ã¦ã‚‚æ©Ÿèƒ½ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸ
- `basic_symbol_text`ã‚’`symbol_text`ãƒ˜ãƒªãƒãƒ¼ãƒ 
- `symbol_text`ã‹ã‚‰`[[nodiscard]]`ã‚’å‰Šé™¤
- æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã‚’å—ã‘å–ã‚‹`symbol_text`ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒ`consteval`ã«ãªã£ãŸ
- `symbol_text`ã¯å¸¸ã«ã‚·ãƒ³ãƒœãƒ«æ–‡å­—åˆ—ã‚’`char8_t`ã¨`char`ã§ä¿æŒã™ã‚‹ã‚ˆã†ã«ãªã£ãŸ
- UTF-8ã‚·ãƒ³ãƒœãƒ«ãŒä½¿ç”¨ã•ã‚Œã‚‹å ´åˆã€`u8`ãƒªãƒ†ãƒ©ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- Symbols of derived dimensionsç¯€ã‚’è¿½åŠ ã—ã€ã‚·ãƒ³ãƒœãƒ«ç”Ÿæˆã«é–¢ã™ã‚‹æ–‡ç« ã‚’Symbols for derived entitiesç« ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- æ•°é‡ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’Victor Zverovichã¨åˆæ„ã—ãŸæ–°ã—ã„æ§‹æ–‡ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- `mag<ratio{N, D}>`ãŒ`mag_ratio<{N, D}>`ã«ç½®ãæ›ãˆã‚‰ã‚Œã€ratioå‹ãŒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã¯ãªãå®Ÿè£…è©³ç´°ã«ãªã£ãŸ
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æœ€æ–°ã®è¨­è¨ˆã‚’åæ˜ ã™ã‚‹ã‚ˆã†ã«Compiler Explorerã®ãƒªãƒ³ã‚¯ã‚’æ›´æ–°

ãªã©ã§ã™ã€‚

- [P3045 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1752)

### [P3051R1 Structured Response Files](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3051r1.html)

ãƒ„ãƒ¼ãƒ«ãŒä»–ã®ãƒ„ãƒ¼ãƒ«ã«ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã§å¼•ãæ¸¡ã™æ–¹æ³•ã«ã¤ã„ã¦ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3051R0 Structured Response Files - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/02/29/191439#P3051R0-Structured-Response-Files)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€SG15ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®é©ç”¨ï¼ˆ`options`ã‚’`arguments`ã«å¤‰æ›´ï¼‰ãªã©ã§ã™ã€‚

- [P3051 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1720)

### [P3059R1 Making user-defined constructors of view iterators/sentinels private](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3059r1.html)

`<ranges>`ã®å†…éƒ¨ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿å‹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’éå…¬é–‹ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3059R0 Making user-defined constructors of view iterators/sentinels private - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/02/29/191439#P3059R0-Making-user-defined-constructors-of-view-iteratorssentinels-private)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€ã“ã®ææ¡ˆã«ã‚ˆã‚‹ç ´å£Šçš„å¤‰æ›´ã«ã¤ã„ã¦ã®è­°è«–ã‚’è¿½åŠ ã—ãŸã“ã¨ã§ã™ã€‚

MSVC STLãŠã‚ˆã³libc++ã®é–‹ç™ºè€…ã¯ã„ãšã‚Œã‚‚ã€ã“ã®å¤‰æ›´ã«ã‚ˆã‚‹å½±éŸ¿ã¯å¤§ãããªã„ã¨è¦‹ç©ã‚‚ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚libstdc++ã®å ´åˆã¯ãã‚‚ãã‚‚å®Ÿè£…ãŒæ¨™æº–ã®ã‚‚ã®ã¨ç•°ãªã£ã¦ã„ã‚‹ãŸã‚å®Ÿè³ªçš„ã«å½±éŸ¿ã¯ãªã„ã¨ã—ã¦ã„ã¾ã™ã€‚

- [P3059 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1726)

### [P3064R1 How to Avoid OOTA Without Really Trying](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3064r1.pdf)

C++ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚ˆã‚‹å®Ÿè£…ã«ãŠã„ã¦ã¯ã€OOTAå•é¡ŒãŒç™ºç”Ÿã—ãªã„ã“ã¨ã‚’è§£èª¬ã™ã‚‹æ–‡æ›¸ã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3064R0 How to Avoid OOTA Without Really Trying - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3064R0-How-to-Avoid-OOTA-Without-Really-Trying)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“ï¼ˆææ¡ˆã§ã¯ãªã„ã®ã§ã€ä½•ã‹ã—ã‚‰ã®ä¿®æ­£ã®ã¿ã®ã¯ãšã§ã™ï¼‰ã€‚

### [P3067R0 Provide predefined simd permute generator functions for common operations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3067r0.html)

P2664ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã€`std::simd`ã®æ±ç”¨permute APIã‚’è¨­è¨ˆã—ç›´ã™ææ¡ˆã€‚

SIMDã«ãŠã‘ã‚‹permuteå‘½ä»¤ã¨ã¯ã€SIMDãƒ¬ã‚¸ã‚¹ã‚¿å†…ã§è¦ç´ ã‚’ä¸¦ã³æ›¿ãˆã‚‹å‘½ä»¤ã®1ã¤ã§ã™ã€‚ã‚ã‚‹è¨ˆç®—ã®éš›ã«åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ã®ä¸¦ã³ã¨ãã®å¾Œã®åˆ¥ã®è¨ˆç®—ã®éš›ã«åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ã®ä¸¦ã³ãŒç•°ãªã‚‹å ´åˆãªã©ã€SIMDãƒ¬ã‚¸ã‚¹ã‚¿å†…ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¼‰ã›ãŸã¾ã¾ä¸¦ã¹æ›¿ãˆãŒå¿…è¦ã«ãªã‚‹ã“ã¨ã¯ã‚ˆãã‚ã‚Šã€ãã®éš›ã«permuteå‘½ä»¤ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

P2664ã§ã¯`std::simd`ã«å¯¾ã—ã¦permuteå‘½ä»¤ã«å¯¾å¿œã™ã‚‹ä¸¦ã¹æ›¿ãˆã‚’è¡Œã†ãŸã‚ã®`std::permute()`ã‚’ææ¡ˆã—ã¦ã„ã¾ã—ãŸãŒã€P2664ã®`std::permute()`APIã¯ã»ã¨ã‚“ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœ€ã‚‚ä¸€èˆ¬çš„ãªè¦æ±‚ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«æ±ç”¨çš„ã«è¨­è¨ˆã•ã‚Œã¦ã„ãŸãŸã‚ã€å¿…è¦ãªã“ã¨ã¯ä½•ã§ã‚‚ã§ãã‚‹ã‚‚ã®ã®ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹ç‰¹å®šã®ä¸¦ã¹æ›¿ãˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ããšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå€‹åˆ¥ã«ãã®æ“ä½œã‚’è¡Œã†é–¢æ•°ã‚’å®šç¾©ã™ã‚‹å¿…è¦æ€§ãŒé »ç™ºã™ã‚‹ã“ã¨ãŒæƒ³å®šã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ãã®ã‚ˆã†ãªä¸¦ã¹æ›¿ãˆæ“ä½œã®ç›®çš„ã‚„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã¾ã¨ã‚ã¦ã€ã“ã®æµ®ã‹ã³ä¸ŠãŒã£ãŸè¦æ±‚ã‚’å…ƒã«ã—ã¦`std::simd`ã®è¦ç´ ä¸¦ã¹æ›¿ãˆã‚’è¡Œã†ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚»ãƒƒãƒˆã‚’ç‰¹å®šã—ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ä»Šã®ã¨ã“ã‚æŒ™ã’ã‚‰ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯æ¬¡ã®ã‚‚ã®ã§ã™

|é–¢æ•°|èª¬æ˜|
|---|---|
|`take<int>(simd)`|`simd`ã®å…ˆé ­ã‹ã‚‰`N`è¦ç´ ã‚’å«ã‚€æ–°ã—ã„`simd`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™|
|`grow<int>(simd, value={})`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã‚ˆã‚Šã‚‚å¤§ãã„ã‚µã‚¤ã‚ºã§ã€æŒ‡å®šã•ã‚ŒãŸ`value`ã§åˆæœŸåŒ–ã•ã‚ŒãŸæ–°ã—ã„è¦ç´ ã‚’å«ã‚“ã `simd`ã‚’è¿”ã™|
|`stride<int N>(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã®`N`ç•ªç›®ã®è¦ç´ ã®ã¿ã‚’å«ã‚€æ–°ã—ã„`simd`ã‚’è¿”ã™|
|`chunk<int>(simd)`|æ—¢å­˜ã®`simd::split`ã‚’åå‰å¤‰æ›´ãŠã‚ˆã³ç§»å‹•ã—ãŸã‚‚ã®|
|`reverse(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã¨åŒã˜ã‚µã‚¤ã‚ºã§ã€è¦ç´ ã‚’é€†é †ã«ã—ãŸæ–°ã—ã„`simd`ã‚’è¿”ã™|
|`repeat_all<int>(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã‚’`N`å›ç¹°ã‚Šè¿”ã—ãŸæ–°ã—ã„`simd`ã‚’è¿”ã™ï¼ˆä¾‹ï¼š `repeat_all<3>([a, b])`ã¯`[a, b, a, b, a, b]`ã«ãªã‚‹ï¼‰|
|`repeat_each<int>(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã®å„è¦ç´ ã‚’`N`å›ç¹°ã‚Šè¿”ã—ãŸæ–°ã—ã„`simd`ã‚’è¿”ã™ã‚‹ï¼ˆä¾‹ï¼š `repeat_each<3>([a, b])`ã¯`[a, a, a, b, b, b ]`ã«ãªã‚‹ï¼‰|
|`transpose<ROWS, COLS>(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã‚’ã€`ROWS`è¡Œã¨`COLS`åˆ—ã®è¡Œå„ªå…ˆã®è¡Œåˆ—ã¨ã—ã¦æ‰±ã„ã€è»¢ç½®ã—ãŸçµæœï¼ˆã¤ã¾ã‚Šåˆ—å„ªå…ˆã«ã—ãŸï¼‰ã‚’è¿”ã™|
|`zip(simd...)`|å…¥åŠ›ã•ã‚ŒãŸè¤‡æ•°ã®`simd`ã®å¯¾å¿œã™ã‚‹è¦ç´ ã‚’äº¤äº’ã«ä¸¦ã¹ã¦æ–°ã—ã„`simd`ã‚’ç”Ÿæˆã™ã‚‹ã€‚ï¼ˆä¾‹ï¼š `zip([a, b, c], [0, 1, 2])`ã¯`[a, 0, b, 1, c, 2]`ã‚’è¿”ã™|
|`unzip<N>(simd...)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã‚’`N`å€‹ã®`simd`ã«åˆ†å‰²ã™ã‚‹ã€‚ï¼ˆä¾‹ï¼š `unzip<2>([a, 0, b, 1, c, 2])`ã¯`make_tuple([a, b, c], [0, 1, 2])`ã‚’è¿”ã™|
|`cat(simd...)`|`simd_cat`ã®åå‰å¤‰æ›´ç‰ˆ|
|`extract<N, M>(simd)`|`[N...M)`ã®ç¯„å›²å†…ã®è¦ç´ ã‚’å«ã‚€æ–°ã—ã„`simd`ã‚’æŠ½å‡ºã™ã‚‹|
|`rotate<MIDDLE>(simd)`|`simd`ã®è¦ç´ ã‚’å·¦ã«å›è»¢ã—ã€`MIDDLE` ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¦ç´ ãŒæœ€åˆã®è¦ç´ ã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹|
|`shift_left<N>(simd)/shift_right<N>(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã¨åŒã˜ã‚µã‚¤ã‚ºã§ã€è¦ç´ ã‚’å·¦ã¾ãŸã¯å³ã«ã‚·ãƒ•ãƒˆã—ã€å€¤åˆæœŸåŒ–ã•ã‚ŒãŸè¦ç´ ã‚’æŒ¿å…¥ã—ãŸæ–°ã—ã„`simd`ã‚’è¿”ã™|
|`align<N>(simd a, simd b)`|2ã¤ã®`simd`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€`cat(a, b)`ã‹ã‚‰`simd`ã‚’æŠ½å‡ºã—ã¾ã™|

ã“ã‚Œã‚‰ã®è‰¯ãä½¿ç”¨ã™ã‚‹ä¸¦ã¹æ›¿ãˆæ“ä½œï¼ˆé †åˆ—ã®ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼é–¢æ•°ï¼‰ã‚’ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠãã“ã¨ã§

- åŒã˜ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼é–¢æ•°ã‚’ç¹°ã‚Šè¿”ã—ä½•åº¦ã‚‚é‡è¤‡å®šç¾©ã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã‚’å›é¿ã™ã‚‹
- ã‚ˆãä½¿ç”¨ã™ã‚‹æ“ä½œã«ã¤ã„ã¦ã€åˆ†ã‹ã‚Šã‚„ã™ã„åå‰ä»˜ãé–¢æ•°ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã‚‹
- ã‚ˆãä½¿ç”¨ã™ã‚‹æ“ä½œã«ã¤ã„ã¦ã€ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠãã“ã¨ã§ãƒã‚°ã®æ··å…¥ã‚’å›é¿ã™ã‚‹

ç­‰ã®åˆ©ç‚¹ãŒã‚ã‚‹ã¨ã—ã¦ã„ã¾ã™ã€‚

- [P2664R6 Proposal to extend std::simd with permutation API - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/03/10/170322#P2664R6-Proposal-to-extend-stdsimd-with-permutation-API)
- [P2638R0 Intel's response to P1915R0 for std::simd parallelism in TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/10/09/021557#P2638R0-Intels-response-to-P1915R0-for-stdsimd-parallelism-in-TS-2)
- [P3067 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1900)

### [P3068R2 Allowing exception throwing in constant-evaluation](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3068r2.html)

å®šæ•°å¼ã«ãŠã„ã¦`throw`å¼ã«ã‚ˆã‚‹ä¾‹å¤–é€å‡ºã‚’è¨±å¯ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3068R0 Allowing exception throwing in constant-evaluation. - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3068R0-Allowing-exception-throwing-in-constant-evaluation)
- [P3068R1 Allowing exception throwing in constant-evaluation - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3068R1-Allowing-exception-throwing-in-constant-evaluation)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ–‡è¨€è¿½åŠ 
- æ–°ã—ã„ä¾‹ã‚’è¿½åŠ 
- å®Ÿè£…ã®èª¬æ˜ã‚’è¿½åŠ 
- å¤‰æ›´ã«å½±éŸ¿ã«ã¤ã„ã¦è¿½è¨˜

ãªã©ã§ã™ã€‚

- [P3068 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1754)

### [P3085R2 `noexcept` policy for SD-9 (throws nothing)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3085r2.html)

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–¢æ•°ã«`noexcept`ã‚’ä»˜åŠ ã™ã‚‹æ¡ä»¶ã«ã¤ã„ã¦ã®ãƒãƒªã‚·ãƒ¼ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3085R0 `noexcept` policy for SD-9 (throws nothing) - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3085R0-noexcept-policy-for-SD-9-throws-nothing)
- [P3085R1 `noexcept` policy for SD-9 (throws nothing) - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3085R1-noexcept-policy-for-SD-9-throws-nothing)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- Â§â€¯12 Appendix: Principled design exerciseã«2024å¹´æ±äº¬ä¼šè­°ã§ä½¿ç”¨ã—ãŸåŸå‰‡çš„ãªè¨­è¨ˆä¾‹ã‚’è¿½åŠ 
- Â§â€¯4.3 Minimal noexceptã«æœ€å°é™ã®`noexcept`ãƒãƒªã‚·ãƒ¼ã«ã¤ã„ã¦è¿½åŠ 
- Â§â€¯8.3.4 Vectorizationã§`noexcept`ãŒãƒ™ã‚¯ãƒˆãƒ«åŒ–ã«ä¸ãˆã‚‹å½±éŸ¿ã«ã¤ã„ã¦èª¬æ˜
- Â§â€¯8.7.7 Donâ€™t discard useful informationã§ã€æœ‰ç”¨ãªæƒ…å ±ã‚’æ¨ã¦ãªã„ã“ã¨ã«ã¤ã„ã¦èª¬æ˜
- Â§â€¯8.3.2 Other implementationsã§P3166R0ã«ã¤ã„ã¦è­°è«–
- Â§â€¯8.4.1.3 Allow contract build modes to change the behavior of noexceptã§ã€P3205R0ã«ã¤ã„ã¦è­°è«–
- Â§â€¯8.4.1.2 Retrieve precondition and post-condition results via reflectionã§ã€Bengt Gustafssonã®Contract testing supportã«ã¤ã„ã¦è­°è«–
- Â§â€¯8.9 noexcept as Quality of Implementationã§ã€`noexcept`ã‚’å®Œå…¨ã«QoIã«ã™ã‚‹ã“ã¨ã«ã¤ã„ã¦èª¬æ˜
- Â§â€¯8.4.8 Death testsã§DejaGnuã«ã¤ã„ã¦è­°è«–ã‚’è¿½åŠ 
- Â§â€¯8.3.3 Bloatã§ã€"Canâ€™t write it better yourself"ã«ã¤ã„ã¦è­°è«–

ãªã©ã§ã™ã€‚

- [P3085 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1756)

### [P3091R2 Better lookups for `map` and `unordered_map`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3091r2.html)

é€£æƒ³ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã‚­ãƒ¼ã«ã‚ˆã£ã¦è¦ç´ ã‚’æ¤œç´¢ã™ã‚‹ã‚ˆã‚Šä¾¿åˆ©ãªé–¢æ•°ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3091R0 Better lookups for `map` and `unordered_map` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3091R0-Better-lookups-for-map-and-unordered_map)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€P2988R4ã®å†…å®¹ï¼ˆ`value_or`ã¯å¸¸ã«prvalueã‚’è¿”ã™ï¼‰ã‚’åæ˜ ã—ãŸäº‹ã§ã™ã€‚

ãªã©ã§ã™ã€‚

- [P3091 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1759)

### [P3094R2 `std::basic_fixed_string`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3094r2.html)

NTTPã¨ã—ã¦ä½¿ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æ–‡å­—åˆ—å‹ã§ã‚ã‚‹`std::basic_fixed_string`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3094R0 `std::basic_fixed_string` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3094R0-stdbasic_fixed_string)
- [P3094R1 `std::basic_fixed_string` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3094R1-stdbasic_fixed_string)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- Design discussionç« ã‚’æ‹¡å¼µ
- Open questionsç« ã‚’æ›´æ–°
- å®Ÿè£…çµŒé¨“ã®ç« ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ã®ãƒªãƒ³ã‚¯è¿½åŠ 
- Synopsisç« ã®åå‰ã‚’Wordingã«å¤‰æ›´ã—ææ¡ˆã™ã‚‹æ–‡è¨€ã¨ã—ã¦ä¿®æ­£
- `traits`ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ 
- `reverse_iterator`ã®ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ 
- æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã‚’å—ã‘å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’`consteval`ã«ã—ãŸ
- `range`ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ 
- `view()`ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’è¿½åŠ 
- ã‚³ãƒ³ãƒ†ãƒŠã¨æ–‡å­—åˆ—ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¿½åŠ 
- æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã¨å˜ä¸€æ–‡å­—ã§å‹•ä½œã™ã‚‹äºŒé …`+`æ¼”ç®—å­ã‚’è¿½åŠ 
- æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã¨ã®æ¯”è¼ƒæ¼”ç®—å­ã‚’è¿½åŠ 
- `array<charT, N>`ã‹ã‚‰ã®æ¨è«–è£œåŠ©ã‚’è¿½åŠ 
- debug-enabled string typeã¨ã—ã¦`basic_fixed_string`ãŒè¿½åŠ ã•ã‚ŒãŸãŸã‚ã€`formatter`ç‰¹æ®ŠåŒ–ã‚’å‰Šé™¤

ãªã©ã§ã™ã€‚

- [P3094 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1762)

### [P3096R1 Function Parameter Reflection in Reflection for C++26](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3096r1.pdf)

C++26ã«å‘ã‘ãŸé™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ã€é–¢æ•°ä»®å¼•æ•°ã«å¯¾ã™ã‚‹ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3096R0 Function Parameter Reflection in Reflection for C++26 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3096R0-Function-Parameter-Reflection-in-Reflection-for-C26)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ææ¡ˆã•ã‚ŒãŸAPIã®Synopsisã‚’è¿½åŠ 
- ææ¡ˆã™ã‚‹æ–‡è¨€ã‚’è¿½åŠ 
- æŠ•ç¥¨çµæœã®è¿½åŠ 
- ææ¡ˆã™ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®æ˜ç¢ºåŒ–
- æ–‡è¨€ã®æ”¹å–„

ãªã©ã§ã™ã€‚

- [P3096 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1764)

### [P3100R0 Undefined and erroneous behaviour are contract violations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3100r0.pdf)

UBï¼ˆåŠã³EBï¼‰ã‚’å¥‘ç´„é•åã¨ã—ã¦æ‰±ã†ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

C++è¨€èªã‚’å®‰å…¨ã§ã¯ãªãã—ã¦ã„ã‚‹è¦å› ã¯å®Ÿè¡Œæ™‚ã®æœªå®šç¾©å‹•ä½œã«ã‚ã‚Šã¾ã™ã€‚æ­£ã—ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸWell-definedãªC++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚‚ã€å®Ÿè¡Œæ™‚ã«ä»»æ„ã®æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€æœªå®šç¾©å‹•ä½œã‚’å›é¿ã§ããªã„å ´åˆãã‚Œã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚°ã¨ã—ã¦å®‰å…¨æ€§/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å•é¡Œã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚ç‰¹ã«ã€ç„¡åŠ¹ãªãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ã«ã‚ˆã‚‹æœªå®šç¾©å‹•ä½œã¯ç‰¹ã«å¤§ããªå•é¡Œã§ã€Googleã‚„Microsoftã®èª¿æŸ»ã«ã‚ˆã‚Œã°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è„†å¼±æ€§ã®7å‰²ãŒç„¡åŠ¹ãªãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ã«ã‚ˆã‚‹æœªå®šç¾©å‹•ä½œã«ã‚ˆã£ã¦ç™ºç”Ÿã—ã¦ã„ã‚‹ã¨ã•ã‚Œã¾ã™ã€‚

è¿‘å¹´ã®å®‰å…¨æ€§ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é‡è¦æ€§ã®é«˜ã¾ã‚Šã‚’å—ã‘ã¦ã€C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæœªå®šç¾©å‹•ä½œã‚’èµ·ã“ã™å¯èƒ½æ€§ã‚’æ¸›ã‚‰ã™ãŸã‚ã®æ§˜ã€…ãªå–ã‚Šçµ„ã¿ãŒãªã•ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°

- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
- ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã®é©ç”¨
- ã‚³ãƒ¼ãƒ‰ã®æ§˜ã€…å ´å´é¢ã‚’å¯¾è±¡ã«ã—ãŸè‡ªå‹•ãƒ†ã‚¹ãƒˆ
- é™çš„è§£æãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨
- å®Ÿè¡Œæ™‚ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã®ä½¿ç”¨

ãªã©ã€ã“ã‚Œã‚‰ã®æ‰‹æ³•ã‚’æ­£ã—ãé©ç”¨ã™ã‚‹ã“ã¨ã§ã€å®Ÿè¡Œæ™‚ã«ç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹æœªå®šç¾©å‹•ä½œã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ã¯ç•°ãªã‚Šã€C++æ¨™æº–åŒ–å§”å“¡ä¼šã¯C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æœªå®šç¾©å‹•ä½œãƒªã‚¹ã‚¯ã‚’ä½æ¸›ã™ã‚‹ãŸã‚ã«ã€è¨€èªãã®ã‚‚ã®ã‚’é€²åŒ–ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹å”¯ä¸€ã®ç«‹å ´ã«ã‚ã‚Šã¾ã™ã€‚C++ã«ãŠã‘ã‚‹æœªå®šç¾©å‹•ä½œã¯åŸºæœ¬çš„ã«å®Ÿè¡Œæ™‚ã®æ€§è³ªã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ä¸»ã«2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå¯èƒ½ã§ã™ã€‚

1. æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ã‚’é™çš„ã«æ¤œå‡ºã§ãã‚‹å ´åˆã€ãã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ill-formedã«ã§ãã‚‹
2. æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ã«å®Ÿè¡Œæ™‚ã«åˆ°é”ã—ãŸå ´åˆã«å–ã‚Šå¾—ã‚‹å‹•ä½œã®ç¯„å›²ã‚’æŒ‡å®šã—ã€å®Ÿè¡Œæ™‚ã«ãã®å‹•ä½œã‚’ç·©å’Œã™ã‚‹

ã“ã®2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯æ’ä»–çš„ãªã‚‚ã®ã§ã¯ãªãã€ç›¸äº’ã«è£œå®Œã—åˆã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¸€æ–¹ã€ç¾åœ¨C++26ã‚’ç›®æŒ‡ã—ã¦å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ææ¡ˆï¼ˆP2900ï¼‰ãŒé€²è¡Œã—ã¦ã„ã¾ã™ã€‚å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯C++è¨€èªã®å®‰å…¨æ€§ã‚’é«˜ã‚ã‚‹æ©Ÿèƒ½ã§ã¯ã‚ã‚‹ã‚‚ã®ã®ã€ä¸‡èƒ½è–¬ã§ã¯ãªãã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯ã™ã¹ã¦ã®æœªå®šç¾©å‹•ä½œã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«é™çš„ã«æ¤œå‡ºå¯èƒ½ã«ã™ã‚‹ã‚ˆã†ãªã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ¤œå‡ºã•ã‚Œãªã‹ã£ãŸã™ã¹ã¦ã®æœªå®šç¾©å‹•ä½œã«å¯¾ã—ã¦å®Ÿè¡Œæ™‚ã«ãã‚Œã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦å‡¦ç†ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯æä¾›ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’æ‹¡å¼µã—ã¦ã€æœªå®šç¾©å‹•ä½œã‚’å¥‘ç´„é•åã¨ã—ã¦ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€æ˜ç¤ºçš„ãªå¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã«å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã®ã§ã¯ãªãã€å®Ÿè¡Œæ™‚ã«æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ã‚³ã‚¢è¨€èªæ§‹æˆè¦ç´ ã«å¯¾ã—ã¦æš—é»™çš„ã«å¥‘ç´„ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹å ´åˆã‚’å¥‘ç´„é•åã¨ã—ã¦æ‰±ãˆã‚‹ã‚ˆã†ã«ã—ã€ãã‚Œã«ã‚ˆã£ã¦å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ä¸­ã§æœªå®šç¾©å‹•ä½œã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã™ã‚‚ã®ã§ã™ã€‚

ä¾‹ãˆã°ç¬¦å·ä»˜æ•´æ•°ã®åŠ ç®—ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚2ã¤ã®`int`å‹ã®å€¤`a, b`ã‚’åŠ ç®—ã™ã‚‹å ´åˆã€çµæœãŒ`int`ã®æœ€å¤§å€¤ã‚’è¶…ãˆã‚‹ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã™ã‚‹ï¼‰å ´åˆã¯ç¾åœ¨æœªå®šç¾©å‹•ä½œã¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚’å†è§£é‡ˆã—ã¦ã€ç¬¦å·ä»˜æ•´æ•°å‹ã®åŠ ç®—ã«ã¯åŠ ç®—çµæœãŒã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ãªã„ã¨ã„ã†æš—é»™ã®äº‹å‰æ¡ä»¶ã‚ã‚‹ã€ã¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ç¬¦å·ä»˜æ•´æ•°å‹ã®åŠ ç®—ãŒçµ„ã¿è¾¼ã¿ã®`operator+(int, int)`ã‚’å‘¼ã³å‡ºã—ã¦è¡Œã‚ã‚Œã‚‹ã¨è€ƒãˆã‚‹ã¨ã€ãã®çµ„ã¿è¾¼ã¿æ¼”ç®—å­ã¯æ¬¡ã®ã‚ˆã†ã«å®£è¨€ã•ã‚Œã¦ã„ã‚‹ã‹ã®ã‚ˆã†ã«æ‰±ã‚ã‚Œã¾ã™

```cpp
int operator+(int a, int b)
  pre ((b >= 0 && a <= INT_MAX - b) // æš—é»™ã®äº‹å‰æ¡ä»¶ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
   || (b < 0 && a >= INT_MIN - b));
```

ã“ã®äº‹å‰æ¡ä»¶ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€Œæš—é»™çš„ã€ã¨ã—ã¦ã„ã‚‹ã®ã¯ã€é€šå¸¸ã®å¥‘ç´„æ³¨é‡ˆãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰‹ã«ã‚ˆã£ã¦æ˜ç¤ºçš„ã«ä»˜åŠ ã•ã‚Œã‚‹ã®ã«å¯¾ã—ã¦ã€ã“ã®äº‹å‰æ¡ä»¶ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæš—é»™çš„ã«ç”Ÿæˆã—ã¦ä»˜åŠ ã™ã‚‹ã‚‚ã®ã ã‹ã‚‰ã§ã™ã€‚

ã“ã®ç¬¦å·ä»˜æ•´æ•°å‹ã®åŠ ç®—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã¨åŒæ§˜ã«ã€ã€Œæ“ä½œXã«ã¤ã„ã¦ã€YãŒå½ï¼ˆ`false`ï¼‰ã®å ´åˆã€å‹•ä½œã¯æœªå®šç¾©ã€ã¨ã„ã†ã‚ˆã†ãªC++æ¨™æº–ã«ãŠã‘ã‚‹æœªå®šç¾©å‹•ä½œã®å‡ºç¾ã‚’ã€ã€Œæ“ä½œXã¯ã€YãŒçœŸï¼ˆ`true`ï¼‰ã§ã‚ã‚‹ã¨ã„ã†äº‹å‰æ¡ä»¶ã‚’æŒã¤ã€ã¨ã„ã†ã‚ˆã†ã«ç½®ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¦ã€æ˜ç¤ºçš„ãªï¼ˆé€šå¸¸ã®ï¼‰å¥‘ç´„æ³¨é‡ˆåŒæ§˜ã«ã“ã®æš—é»™ã®å¥‘ç´„æ³¨é‡ˆã‚‚ã¾ã¨ã‚ã¦å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä¸Šã§æ‰±ã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã†ã—ã¦å®Ÿè¡Œæ™‚ã«ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã†ã‚‹æœªå®šç¾©å‹•ä½œã«ã¯2ã¤ã®ç¨®é¡ãŒã‚ã‚Šã€ãã‚Œã¯ã€å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’å®šç¾©ã§ãã‚‹ã‚‚ã®ã¨ã§ããªã„ã‚‚ã®ã§ã™ã€‚ä¾‹ãˆã°ã€ç¬¦å·ä»˜æ•´æ•°å‹ã®åŠ ç®—ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¯ãã®çµæœã®å€¤ãŒæœ‰åŠ¹ãªæ•°å€¤ã«ãªã‚‹ã“ã¨ã§ã™ã€‚ãã®å…·ä½“çš„ãªæ•°å€¤ã®æ€§è³ªï¼ˆé£½å’Œæ¼”ç®—ã€ãƒ©ãƒƒãƒ—ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ãªã©ï¼‰ã‚’æŒ‡å®šã™ã‚‹ä»£ã‚ã‚Šã«ã€è¦æ ¼ã®ãƒ¬ãƒ™ãƒ«ã§æœªå®šç¾©å‹•ä½œã‚’è§£é™¤ã™ã‚‹ã«ã¯ã€æœ‰åŠ¹ã ãŒæœªè¦å®šãªå€¤ã«ãªã‚‹ã¨è¦å®šã™ã‚‹ã ã‘ã§ååˆ†ã§ã™ã€‚ã“ã®æ•°å€¤ã‚’è¨ˆç®—ã§ä½¿ç”¨ã™ã‚‹ã¨ãŠãã‚‰ãé–“é•ã„ï¼ˆãƒã‚°ï¼‰ã§ã¯ã‚ã‚‹ã‚‚ã®ã®æœªå®šç¾©ã§ã¯ãªããªã‚Šã¾ã™ã€‚æ•´æ•°ã®åŠ ç®—ã‚’ä¸Šè¨˜ã®ã‚ˆã†ã«çµ„ã¿è¾¼ã¿æ¼”ç®—å­ã¨ã¿ãªã™ã¨ã€ã“ã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¯ãã®æœ¬ä½“ãŒå®Ÿè¡Œã™ã‚‹å‹•ä½œãã®ã‚‚ã®ã§ã™ã€‚

åˆ¥ã®ä¾‹ã¨ã—ã¦ã€æœªåˆæœŸåŒ–å¤‰æ•°ã‚’èª­ã¿å–ã‚‹å ´åˆã€æœªå®šç¾©å‹•ä½œã®ä»£ã‚ã‚Šã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¨ã—ã¦ä»£ã‚ã‚Šã«æœªè¦å®šã ãŒæœ‰åŠ¹ãªå€¤ï¼ˆä¾‹ãˆã°ã‚¼ãƒ­ï¼‰ã‚’èª­ã¿å–ã‚‹ã€ã¨ã™ã‚‹ã“ã¨ã§æœªå®šç¾©å‹•ä½œã‚’å®‰å…¨ã«è§£é™¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®è©±ã‚’ã©ã“ã‹ã§èã„ãŸã“ã¨ãŒã‚ã‚‹äººã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€ã“ã‚Œã¯P2795R5ã«ã‚ˆã£ã¦ææ¡ˆã•ã‚ŒC++26ã«æ—¢ã«å°å…¥ã•ã‚Œã¦ã„ã‚‹ã€Erroneous Behaviourï¼ˆEBï¼‰ãã®ã‚‚ã®ã§ã™ã€‚

EBã¯UBæ™‚ã®å‹•ä½œã¨ã—ã¦å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’å®Ÿè£…å®šç¾©ã§æŒ‡å®šã—ã€åŒæ™‚ã«è¨ºæ–­ã‚’æ¨å¥¨ã™ã‚‹ã“ã¨ã§UBã‚’è§£æ¶ˆã—ã‚ˆã†ã¨ã™ã‚‹å–ã‚Šçµ„ã¿ã§ã™ã€‚P2795R5ã§èª¤ã£ãŸã‚³ãƒ¼ãƒ‰ã®çµæœã¨ã—ã¦å‹•ä½œXã‚’å–ã‚‹ã€ã¨ã—ã¦ã„ã‚‹ã¨ã“ã‚ã¯ã€ã“ã®ææ¡ˆã«ãŠã„ã¦ã€æš—é»™ã®äº‹å‰æ¡ä»¶ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒç ´ã‚‰ã‚ŒãŸå ´åˆã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œãŒXã§ã‚ã‚‹ã€ã¨ã„ã†ã®ã¨å…¨ãåŒã˜ã“ã¨ã§ã™ã€‚æš—é»™ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‹ã©ã†ã‹ã¨ã¯é–¢ä¿‚ãªãã€ã©ã¡ã‚‰ã®å ´åˆã‚‚èª¤ã£ãŸçŠ¶æ…‹ã«ã‚ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œã«ã¤ã„ã¦è¿°ã¹ã¦ãŠã‚Šã€ãªãŠã‹ã¤ãã®å‹•ä½œã¯æœªå®šç¾©ã§ã¯ãªãWell-definedã¨ãªã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ã€P2795R5ã®ã€ŒErroneous Behaviourã€ã¨ã“ã®ææ¡ˆã®ã€Œæš—é»™ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³é•åã€ã¨ã„ã†2ã¤ã®è¨€è‘‰ã«ã¯äº’æ›æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ãã—ã¦ã€P2795R5ã«ã‚ˆã‚Œã°Erroneous BehaviourãŒç™ºç”Ÿã—ãŸå ´åˆã€å®Ÿè£…ã¯æ¬¡ã®ã„ãšã‚Œã‹ã‚’è¡Œã†ã“ã¨ãŒè¨±å¯ã•ã‚Œã¾ã™

- å•é¡Œã®å ±å‘Š
- ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®çµ‚äº†
- ä½•ã‚‚ã—ãªã„
    - ãŸã ã—UBã§ã¯ãªã„

EBæ™‚ã®å¯èƒ½ãªå‹•ä½œã®ã“ã®ãƒªã‚¹ãƒˆã¯ã€å¥‘ç´„é•åãŒèµ·ããŸå ´åˆã®4ï¼ˆ+1ï¼‰ã¤ã®å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®ã‚µãƒ–ã‚»ãƒƒãƒˆã§ã™ï¼ˆquick_enforce, enforce, observe, ignore, assumeï¼‰ã€‚

- è¨ºæ–­ã‚’ç™ºè¡Œ -> observe
- ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº† -> quick_enforce/enforce
- ä½•ã‚‚ã—ãªã„ -> ignore
    - å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’å®Ÿè¡Œã™ã‚‹

é€†ã«ã€EBã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¯ã“ã®ã‚ˆã†ãªæ¬ é™¥ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«å½¹ç«‹ã¤æ©Ÿèƒ½ãŒæ¬ ã‘ã¦ã„ã¾ã™ã€‚å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã§ã¯ã€å¥‘ç´„é•åæ™‚ã«é•åãƒãƒ³ãƒ‰ãƒ©ãŒå‘¼ã³ã•ã‚Œã€ãªãŠã‹ã¤ã“ã®é•åãƒãƒ³ãƒ‰ãƒ©ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚EBã§ã¯å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã®ãªã„æœªå®šç¾©å‹•ä½œã‚’å‡¦ç†ã§ãã¾ã›ã‚“ãŒã€å¥‘ç´„ã®å ´åˆã¯å¯èƒ½ã§ã™ã€‚

ãã—ã¦ã€ã“ã®ææ¡ˆã§ã¯C++23ä»¥å‰ï¼ˆå¥‘ç´„ã‚‚EBã‚‚ãªã„æ™‚ä»£ï¼‰ã¨ã®å®Œå…¨ãªä¸‹ä½äº’æ›ã‚’ä¿ã¤ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã€å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«assumeã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯`[[assume]]`å±æ€§åŒæ§˜ã«å¥‘ç´„æ³¨é‡ˆã‚’ã‚³ãƒ¼ãƒ‰ã®ä»®å®šã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒè¨±å¯ã•ã‚Œã¦ãŠã‚Šã€ãªãŠã‹ã¤å¥‘ç´„æ¡ä»¶ã¯ãƒã‚§ãƒƒã‚¯ã•ã‚Œãšé•åãƒãƒ³ãƒ‰ãƒ©ã¯å‘¼ã³å‡ºã•ã‚Œã¾ã›ã‚“ã€‚å¥‘ç´„é•åãŒèµ·ã“ã‚‹ã¨æœªå®šç¾©å‹•ä½œã«ãªã‚Šã¾ã™ã€‚

assumeã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯å¾“æ¥ï¼ˆç¾åœ¨ï¼‰ã®C++ã¨åŒã˜æŒ™å‹•ã§ã‚ã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ã¨ã«ã‹ãé‡è¦–ã™ã‚‹å ´åˆã«é¸æŠã§ãã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã¯å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å–ã‚Šé™¤ãã€å‹•ä½œã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ä¸¡é¢ã§ç¾åœ¨ã®C++23ä»¥å‰ã®å‹•ä½œã¨ã®å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¤ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚EBã®å ´åˆã€éå»ã®å‹•ä½œã«æˆ»ã™ãŸã‚ã«EBå€‹åˆ¥ã«ã‚ªãƒ—ãƒˆã‚¢ã‚¦ãƒˆãƒ¡ã‚«ãƒ‹ã‚ºãƒ ï¼ˆä¾‹ãˆã°`[[indeterminate]]`ï¼‰ãŒå¿…è¦ã¨ãªã‚Šã€è¦æ ¼ã®è¤‡é›‘ã•ã®é¢ã§ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼è² æ‹…ã®é¢ã§ã‚‚ã‚¹ã‚±ãƒ¼ãƒ«ã—ã¾ã›ã‚“ã€‚

ãã®æ¦‚å¿µã«äº’æ›æ€§ãŒã‚ã‚Šã€å‹•ä½œçŠ¶æ…‹ã‚’åŒ…å«ã—ã¦ãŠã‚Šã€C++23ä»¥å‰ã¨ã®å¾Œæ–¹äº’æ›æ€§ã®ä¸€æ‹¬ç¢ºä¿ã‚‚å‚™ãˆã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€ã“ã®ææ¡ˆã¯Erroneous Behaviourã‚’å®Œå…¨ã«åŒ…å«ã—ã¦ã„ã‚‹ã¨ã„ãˆã¾ã™ã€‚ãã®ãŸã‚ã“ã®ææ¡ˆã§ã¯ã€EBã‚‚ã¾ãŸUBåŒæ§˜ã«æš—é»™ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚‚ã¤ã‚‚ã®ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

2ç¨®é¡ã®æœªå®šç¾©å‹•ä½œã®ã‚‚ã†ä¸€ã¤ã€å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’å®šç¾©ã§ããªã„ã‚¿ã‚¤ãƒ—ã®æœªå®šç¾©å‹•ä½œã«å¯¾ã—ã¦æš—é»™çš„ã«ä»˜åŠ ã•ã‚ŒãŸå¥‘ç´„ã®äº‹ã‚’ã“ã®ææ¡ˆã§ã¯ã€ç„¡è¦–ã§ããªã„å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆNon-ignorable implicit contract assertionsï¼‰ã¨å‘¼ã‚“ã§ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã€é…åˆ—ã®æ·»ãˆå­—ã‚¢ã‚¯ã‚»ã‚¹ã‚’å…ˆç¨‹ã¨åŒæ§˜ã«çµ„ã¿è¾¼ã¿æ¼”ç®—å­ã¨ã—ã¦ã¿ã¦ã¿ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

```cpp
template <typename T, size_t N>
T& subscript(T(&array)[N], size_t index)
  pre(index < N) // æš—é»™ã®äº‹å‰æ¡ä»¶ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
{
  return array[index];
}
```

ã“ã®å ´åˆã€ã“ã®æš—é»™ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒç ´ã‚‰ã‚ŒãŸã¨ãã«ãã®æœ¬ä½“ã®å‹•ä½œã‚’å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¨ã—ã¦æ‰±ã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãƒ¡ãƒ¢ãƒªã®å®‰å…¨æ€§ã‚„å‹ã®å®‰å…¨æ€§ã«é•åã™ã‚‹æ“ä½œã¯ã“ã®ã‚«ãƒ†ã‚´ãƒªã«åˆ†é¡ã•ã‚Œã¾ã™ã€‚

ç„¡è¦–ã§ããªã„å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯åˆ¶é™ã•ã‚Œã€ignore/observeã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã§è©•ä¾¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚æŒ‡å®šå¯èƒ½ãªã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯quick_enforce/enforce/assumeã®ã¿ã§ã™ã€‚ã“ã‚Œã‚‰ã®è©•ä¾¡ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ãªå®Ÿè£…æˆ¦ç•¥ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã¾ã™

- quick_enforce : ç¯„å›²å¤–ã‚¢ã‚¯ã‚»ã‚¹ã‚’å®Ÿè¡Œæ™‚ã«ãƒˆãƒ©ãƒƒãƒ—ã™ã‚‹clangã®-fbounds-safety
- enforce : ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã«ã‚ˆã‚‹å®Ÿè¡Œæ™‚ã®æ¤œå‡ºã¨è¨ºæ–­ç™ºè¡Œã€ãŠã‚ˆã³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸­æ–­
- assume : C++23ä»¥å‰ï¼ˆç¾åœ¨ï¼‰ã®å®‰å…¨ã§ã¯ãªã„ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œ

å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’æŒãŸãªã„C++ã®æœªå®šç¾©å‹•ä½œã«å¯¾ã—ã¦ã‚‚ã€åŒæ§˜ã«ç„¡è¦–ã§ããªã„å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒã¤ã‚‚ã®ã¨ã—ã¦å†è§£é‡ˆã™ã‚‹ã“ã¨ã§ã€åŒæ§˜ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒå­˜åœ¨ã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã®1ã¤ã¨ã—ã¦ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã®ã‚ˆã†ãªå¤–éƒ¨ãƒ„ãƒ¼ãƒ«ãŒã‚ã’ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãŸã‚ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã¯ã„ãã¤ã‹ã®å®Ÿè£…ãŒã™ã§ã«æä¾›ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã„ãšã‚Œã®å®Ÿè£…ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨å¯¾è©±ã™ã‚‹ãŸã‚ã®APIï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ãŒéå¸¸ã«è²§å¼±ã§ã‚ã‚Šã€ãã®çµ±ä¸€çš„ãªæŒ‡é‡ã®ã‚ˆã†ãªã‚‚ã®ã‚‚å­˜åœ¨ã—ã¦ã„ã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã‚‚å«ã‚ãŸå¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã®å¯¾è©±APIã¨ã—ã¦ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®é•åãƒãƒ³ãƒ‰ãƒ©ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æŒ™ã’ã¦ã„ã¾ã™ã€‚ç¾æ™‚ç‚¹ã®å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã¯ç¾åœ¨ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ãŒå‚™ãˆã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯APIã‚ˆã‚Šã‚‚å……å®Ÿï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç½®æ›å¯èƒ½ã€å¼•æ•°ã§è©³ç´°ãªæƒ…å ±ã‚’å–å¾—å¯èƒ½ï¼‰ã—ã¦ãŠã‚Šã€ã“ã®åŒ…æ‹¬çš„ãªAPIã«ã‚ˆã£ã¦ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã‚’C++æ¨™æº–ã®ç¯„å›²å†…ã«é…ç½®ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€ã“ã®APIã®ã‚µãƒãƒ¼ãƒˆã¯æ—¢å­˜ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã«å¯¾ã—ã¦å¤‰æ›´ã‚’å¼·ã„ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆãã†ã™ã‚‹ã‹ã¯å®Œå…¨ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ï¼‰ã€‚ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã®å‹•ä½œã¯å®Ÿè£…å®šç¾©ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé•åãƒãƒ³ãƒ‰ãƒ©ã‚’ã‚«ã‚¹ã‚¿ãƒ ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ãªãã¦ã‚‚è‰¯ã„ã¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€æ—¢å­˜ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã¯ã™ã§ã«ãã®ã‚ˆã†ãªAPIã«æº–æ‹ ã—ã¦ã„ã‚‹ã¨è¨€ãˆã¾ã™ã€‚

- [P3100 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1901)

### [P3103R2 More bitset operations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3103r2.html)

`<bit>`ã«ã‚ã‚‹ãƒ“ãƒƒãƒˆæ“ä½œé–¢æ•°ã«å¯¾å¿œã™ã‚‹ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’`std::bitset`ã«ã‚‚è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3103R0 More bitset operations - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3103R0-More-bitset-operations)
- [P3103R1 More bitset operations - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3103R1-More-bitset-operations)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€P3104R2ã¸ã®è¨€åŠã‚’è¿½åŠ ã€Â§4 Design considerationsã‚’æ‹¡å¼µã—ãŸã“ã¨ãªã©ã§ã™ã€‚

- [P3103 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1767)

### [P3111R0 Atomic Reduction Operations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3111r0.html)

`std::atomic`ã«ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã¨ã¯ã€ã‚¢ãƒˆãƒŸãƒƒã‚¯ãªRMWæ“ä½œï¼ˆ`fetch_add()`ã®ã‚ˆã†ãªæ“ä½œï¼‰ã§ã¯ã‚ã‚Šã¾ã™ãŒå¤ã„å€¤ã‚’å®Ÿéš›ã«ã¯ãƒ•ã‚§ãƒƒãƒã›ãšã€ãƒ¡ãƒ¢ãƒªãƒ¢ãƒ‡ãƒ«ã®è¦³ç‚¹ã‹ã‚‰ã‚‚èª­ã¿å–ã‚Šã‚’ç²‰ã‚ãªã„ã‚ˆã†ãªRMWæ“ä½œã®äº‹ã§ã™ã€‚

ãã®ã‚ˆã†ãªã€ãƒ•ã‚§ãƒƒãƒã•ã‚ŒãŸå¤ã„å€¤ã‚’ç ´æ£„ã™ã‚‹ã‚ˆã†ãªã‚¢ãƒˆãƒŸãƒƒã‚¯RMWæ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ä¸¦è¡Œã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯é«˜æ€§èƒ½ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ã¯ä¸€èˆ¬çš„ã§ã‚ã‚Šã€ç¾ä»£ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¯ãã®ã‚ˆã†ãªæ“ä½œã«å¯¾ã—ã¦åŠ¹ç‡çš„ãªå‘½ä»¤ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã¯ä¸¦åˆ—ã«ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’æ±‚ã‚ã‚‹ã‚‚ã®ã§ã™

```cpp
std::span<unsigned> data;

std::array<std::atomic<unsigned>, N> buckets;

constexpr T bucket_sz = std::numeric_limits<T>::max() / (T)N;

unsigned nthreads = std::thread::hardware_concurrency();

std::for_each_n(std::execution::par_unseq, std::views::iota(0).begin(), nthreads, 
 [&](int thread) {
  unsigned data_per_thread = data.size() / nthreads;
  T* data_thread = data.data() + data_per_thread * thread;

  for (auto e : span<T>(data_thread, data_per_thread)) {
    // ã“ã“ã§ã‚¢ãƒˆãƒŸãƒƒã‚¯å€¤ã«å¯¾ã—ã¦è¶³ã—ã“ã¿ï¼ˆfetch_add()ï¼‰ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹
    buckets[e / bucket_sz].fetch_add(1, std::memory_order_relaxed);
  }
});
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã«ã¯æ¬¡ã®2ã¤ã®å•é¡Œç‚¹ãŒã‚ã‚Šã¾ã™

- æ­£ã—ã•ï¼ˆUBï¼‰
  - ã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œãŒæ¬¡ã®ã„ãšã‚Œã‚‚æº€ãŸã—ã¦ã„ãªã„ãŸã‚ã€ã“ã®ä¸¦åˆ—ç‰ˆ`for_each_n`ã§ã¯`execution::par`ã‚’ä½¿ç”¨ã™ã‚‹ã¹ãã ã£ãŸï¼ˆ`par_unseq`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã«UBï¼‰
    - æ½œåœ¨çš„ã«åŒæ™‚å®Ÿè¡Œã•ã‚Œã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹åŒ–ã•ã‚Œã¦ã„ãªã„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ãƒ‡ãƒ¼ã‚¿ç«¶åˆãŒç™ºç”Ÿã™ã‚‹
    - ä»–ã®é–¢æ•°å‘¼ã³å‡ºã—ã¨åŒæœŸã™ã‚‹ãŸã‚ã€ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚»ãƒ¼ãƒ•
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
  - ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã¯ã€é«˜åº¦ãªã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®åˆ†æãŒå¿…è¦

`std::atomic`ã§ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã§ã“ã®2ã¤ã®å•é¡Œã‚’è§£æ±ºã§ãã€ã“ã®ææ¡ˆã¯ãã‚Œã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€æ—¢å­˜ã®`std::atomic`ãŠã‚ˆã³`std::atomic_ref`ã®ãƒ¡ãƒ³ãƒé–¢æ•°ã§ã‚ã‚‹`.fetch_xxx()`ã«å¯¾ã—ã¦`void`æˆ»ã‚Šå€¤å‹ã®`xxx()`ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ææ¡ˆæ–‡æ›¸ã‚ˆã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

<table>
<tr>
<th>ç¾åœ¨</th>
<th>ã“ã®ææ¡ˆ</th>
</tr>
<tr>
<td valign="top">

```cpp
#include <algorithm>
#include <atomic>
#include <execution>
using namespace std;
using execution::par_unseq;

int main() {
  size_t N = 10000;
  vector<int> v(N, 0);
  atomic<int> atom = 0;
  for_each_n(par_unseq, 
     v.begin(), N,
    [&](auto& e) {
      // UB+SLOW:
      atom.fetch_add(e);
  }); 
  return atom.load();
}
```

</td>
<td valign="top">

```cpp
#include <algorithm>
#include <atomic>
#include <execution>
using namespace std;
using execution::par_unseq;

int main() {
  size_t N = 10000;
  vector<int> v(N, 0);
  atomic<int> atom = 0;
  for_each_n(par_unseq, 
     v.begin(), N,
    [&](auto& e) {
      // OK+FAST
      atom.add(e);  // ğŸ‘ˆ
  }); 
  return atom.load();
}
```

</td>
</tr>
</table>

ã¾ãŸã€ã“ã®å»¶é•·ã¨ã—ã¦ã€é †åºä»˜ã‘ã•ã‚Œã¦ã„ãªã„ã¨ãã®ï¼ˆä¸¦åˆ—å®Ÿè¡Œæ™‚ã®ï¼‰èª­ã¿å–ã‚Šã§ãªã„ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒ¡ãƒ¢ãƒªæ“ä½œã‚’è¨±å¯ã—ã€æµ®å‹•å°æ•°ç‚¹æ¼”ç®—ãŒçµåˆçš„ã§ã‚ã‚‹ã¨ä»®å®šã—ã¦æµ®å‹•å°æ•°ç‚¹æ•°å‹ã®ç®—è¡“ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã‚’æ‹¡å¼µã™ã‚‹ã“ã¨ã‚‚è¿½åŠ ã§ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

æµ®å‹•å°æ•°ç‚¹æ•°ã®æ¼”ç®—ã®ã‚ˆã†ã«éçµåˆçš„ãªæ¼”ç®—ã§ã¯ã€ä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚Œã‚‹æ¼”ç®—ã®é †åºãŒçµæœã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã®åŠ¹æœãŒåˆ¶é™ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€`x = a + (b + c)`ã¨ã„ã†è¨ˆç®—ã‚’ä¸¦åˆ—ã«å®Ÿè¡Œã™ã‚‹å ´åˆã€ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã§ã¯`(a + b) + c`ã‚„`a + (c + b)`ãªã©ã®ç•°ãªã‚‹é †åºã§è¨ˆç®—ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€æµ®å‹•å°æ•°ç‚¹æ¼”ç®—ãŒçµåˆçš„ã§ã¯ãªã„ã“ã¨ã‹ã‚‰çµæœãŒä¸€è‡´ã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ææ¡ˆã®ä¸€èˆ¬åŒ–ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã§ã¯ã€æµ®å‹•å°æ•°ç‚¹æ•°å‹ã®ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã«ãŠã„ã¦æµ®å‹•å°æ•°ç‚¹æ¼”ç®—ãŒçµåˆçš„ã§ã‚ã‚‹ã¨ä»®å®šã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ã“ã¨ã§ã€å®Ÿè£…ã¯ã“ã®åˆ¶é™ã‚’å—ã‘ãšã«æœ€é©åŒ–ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ä¸€èˆ¬åŒ–ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã¯æµ®å‹•å°æ•°ç‚¹æ•°å‹ã®ç‰¹æ®ŠåŒ–ã®ã¿ã®ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦ã€ä¸Šè¨˜ã®ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã¨ã¯åˆ¥åã®ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

```cpp
template <floating-point>
class atomic {
  ...

  // ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œ
  void add(floating-point, memory_order);
  // ä¸€èˆ¬åŒ–ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œ
  void add_generalizedg(floating-point, memory_order);

  ...
};
```

- [P3111 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1902)

### [P3119R1 Tokyo Technical Fixes to Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3119r1.pdf)
### [P3125R0 Pointer tagging](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3125r0.pdf)

ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã®ææ¡ˆã€‚

ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã¨ã¯ã€ãƒã‚¤ãƒ³ã‚¿ã®ãƒ“ãƒƒãƒˆã®ã†ã¡ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„éƒ¨åˆ†ã«æƒ…å ±ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã‚“ã§åˆ©ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ä¸»ã«ã€ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ã®å‘ä¸Šã®ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚’åˆ©ç”¨ã—ãŸç‰¹æ®Šãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚‚ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

ç¾ä»£ã®C++ã®ç’°å¢ƒã®å¤šãã¯ãƒã‚¤ãƒ³ã‚¿ã®ã‚µã‚¤ã‚ºã¯64bitã§ã™ãŒã€ç¾çŠ¶ã®ãƒ¡ãƒ¢ãƒªå®¹é‡ã®å ´åˆãã®ãƒ¡ãƒ¢ãƒªç©ºé–“ã‚’ã™ã¹ã¦è¡¨ç¾ã™ã‚‹ã®ã«64bitã‚‚ã®é•·ã•ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚‹ã‚ˆã†ã§ã™ãŒã€48bitç›®ãã‚‰ã„ã¾ã§ã—ã‹ä½¿ã‚ã‚Œã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚ã™ã‚‹ã¨ã€ä½™ã£ãŸä¸Šä½16bitã‚’ç„¡è¦–ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã‚‚ã‚‰ãˆã°ã€ãã®éƒ¨åˆ†ã‚’ä½•ã‹ã—ã‚‰åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚x64/armå…±ã«ã“ã®ãŸã‚ã®CPUæ‹¡å¼µã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚

ã•ã‚‰ã«ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒNãƒã‚¤ãƒˆã«ã‚¢ãƒ©ã‚¤ãƒ³ã•ã‚Œã¦ã„ã‚‹æ™‚ãã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯Nã®å€æ•°ã«ãªã‚‹ãŸã‚ã€ãã®åˆ†ã®ä¸‹ä½æ•°ãƒ“ãƒƒãƒˆï¼ˆ`log2(N)`ãƒ“ãƒƒãƒˆï¼‰ã‚‚åŒæ§˜ã«åˆ©ç”¨ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€`int`å‹ãŒ4ãƒã‚¤ãƒˆã®å ´åˆ`int`å‹å¤‰æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯é€šå¸¸4ã®å€æ•°ã®å€¤ã«ãªã‚‹ãŸã‚ã€ä¸‹ä½2ãƒ“ãƒƒãƒˆã¯ãƒã‚¤ãƒ³ã‚¿å€¤ã«å‚åŠ ã—ã¦ã„ã¾ã›ã‚“ã€‚

ã—ã‹ã—ã€C++ã®è¦æ ¼ã¨ã—ã¦ã¯æœ‰åŠ¹ãªãƒã‚¤ãƒ³ã‚¿ã®ä¸€éƒ¨ã®ãƒ“ãƒƒãƒˆã‚’æ“ä½œã™ã‚‹ã“ã¨ã¯æœªå®šç¾©å‹•ä½œã§ã‚ã‚Šã€ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã®ææ¡ˆã¯ã€ç‰¹æ®Šãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–¢æ•°ã‚’é€šã—ã¦ã®ã¿ãã®ã‚ˆã†ãªæ“ä½œã‚’èªã‚ã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã—ã¦ã„ã‚‹ã®ã¯ã¾ãšã€ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰ã‚¿ã‚°éƒ¨åˆ†ã‚’å–ã‚Šå‡ºã™ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ã‚’è¿”ã™é–¢æ•°ã§ã™ã€‚

```cpp
namespace std {
  template <typename Pointee, size_t Alignment = alignof(Pointee)>
  constexpr auto tag_bit_mask() noexcept -> uintptr_t;
}
```

ã“ã®`tag_bit_mask()`ã¯ãƒã‚¤ãƒ³ã‚¿å‹`Pointee`ã¨ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ`Alignment`ã«å¯¾ã—ã¦ã€ãã®ãƒã‚¤ãƒ³ã‚¿å‹ã®ãƒã‚¤ãƒ³ã‚¿å€¤ã®ã†ã¡ã‚¿ã‚°ã¨ã—ã¦ä½¿ç”¨å¯èƒ½ãªéƒ¨åˆ†ã®ãƒ“ãƒƒãƒˆãŒ1ã«ãªã£ãŸãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ã‚’è¿”ã—ã¾ã™ã€‚ä¸‹ä½ã®ãƒ“ãƒƒãƒˆã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚‰ãšå…±é€šï¼ˆã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã§æ±ºã¾ã‚‹ï¼‰ã§ã™ãŒã€ä¸Šä½ãƒ“ãƒƒãƒˆãŒã©ã“ã¾ã§åˆ©ç”¨å¯èƒ½ã‹ã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŠã‚ˆã³ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã®å­˜åœ¨ã«ã‚ˆã£ã¦å¤‰åŒ–ã—ã¾ã™ã€‚

æ¬¡ã«ã€ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã‚’è¡¨ã™å‹`std::tagged_pointer<T, Alignment>`ã‚’ç”¨æ„ã—ã¦ã€ã“ã‚Œã«å¯¾ã—ã¦ã‚¿ã‚°ä»˜ã‘ã€ã‚¿ã‚°ã®ã‚¯ãƒªã‚¢ã€ã‚¿ã‚°ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å€¤ã®å–ã‚Šå‡ºã—ã‚’è¡Œã†é–¢æ•°ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

```cpp
namespace std {
  // ãƒã‚¤ãƒ³ã‚¿ã«ã‚¿ã‚°ä»˜ã‘ã‚’è¡Œã†
  template <typename T, size_t Alignment = alignof(T)>
  constexpr auto tag_pointer(T* original, uintptr_t value) noexcept -> tagged_pointer<T, Alignment>;

  // ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã‚’å…ƒã®ãƒã‚¤ãƒ³ã‚¿ã«æˆ»ã™
  template <typename T, size_t Alignment = alignof(T)>
  constexpr auto untag_pointer(tagged_pointer<T, Alignment> ptr) noexcept -> T*;

  // ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã‹ã‚‰ã‚¿ã‚°ã®å€¤ã‚’å–ã‚Šå‡ºã™
  template <typename T, size_t Alignment = alignof(T)>
  constexpr auto tag_value(tagged_pointer<T, Alignment> ptr) noexcept -> uintptr_t;
}
```

ã“ã®ææ¡ˆã®ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã‚µãƒãƒ¼ãƒˆã¯ç‰¹æ®Šãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆHash-Array-Mapped-Trie (HAMT)ãªã©ï¼‰ã®ä½œæˆã‚’è¨±å¯ã™ã‚‹ã“ã¨ã«é‡ãã‚’ç½®ã„ã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã‚‰ã®é–¢æ•°ã¯`constexpr`ãŒä»˜åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

`std::tagged_pointer<T, alignment>`ã¯`void*`ã¨åŒã˜ã‚µã‚¤ã‚ºã§`void*`ã«å¤‰æ›ã§ãã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã„ã†è¦ä»¶ã¯å®šã¾ã£ã¦ã„ã‚‹ã‚‚ã®ã®ã€ãã‚Œã‚’ä½•ã«ã™ã‚‹ã‹ï¼ˆ`void*`ã€`T*`ã€ã‚¯ãƒ©ã‚¹å‹ãªã©ï¼‰ã¯ã¾ã æ±ºã¾ã£ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚

- [Memory Tagging Extension: Enhancing memory safety through architecture](https://community.arm.com/arm-community-blogs/b/architectures-and-processors-blog/posts/enhancing-memory-safety)
- [64bitç’°å¢ƒã«ãŠã‘ã‚‹Objective-Cã®ãƒã‚¤ãƒ³ã‚¿ | GREE Engineering](https://labs.gree.jp/blog/2015/01/13437/)
- [HWAddressSanitizer Â |Â  Android Open Source Project](https://source.android.com/docs/security/test/hwasan?hl=ja)
- [57-bits ã®ä»®æƒ³ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã¨æ–°æ©Ÿèƒ½ UAI ãŒå®Ÿè£…ã•ã‚Œã‚‹å°†æ¥ã® AMD ãƒ—ãƒ­ã‚»ãƒƒã‚µ | Coelacanth's Dream](https://www.coelacanth-dream.com/posts/2022/03/12/amd-57bit-addr-uai/)
- [P3125 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1903)

### [P3126R1 Graph Library: Overview](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3126r1.pdf)
### [P3130R1 Graph Library: Graph Container Interface](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3130r1.pdf)
### [P3131R1 Graph Library: Containers](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3131r1.pdf)
### [P3137R1 views::to_input](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3137r1.html)
### [P3138R1 views::cache_last](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3138r1.html)
### [P3139R0 Pointer cast for unique_ptr](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3139r0.html)

`std::const_pointer_cast`ã¨`std::dynamic_pointer_cast`ã«`std::unique_ptr`ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

`std::uniqur_ptr`ã«å¯¾ã—ã¦ãƒã‚¤ãƒ³ã‚¿ã®ã‚­ãƒ£ã‚¹ãƒˆæ“ä½œã‚’è¡Œã†ã“ã¨ã¯ãã®ã¾ã¾ã§ã¯ã§ããšã€ç¾åœ¨ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯ã€ä¸€æ—¦`.release()`ã—ã¦ãƒã‚¤ãƒ³ã‚¿ã‚’å–ã‚Šå‡ºã—ãŸå¾Œã€ãã®ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã—ã¦ãƒã‚¤ãƒ³ã‚¿ã‚­ãƒ£ã‚¹ãƒˆã‚’é©ç”¨ã—ã¦ã‹ã‚‰ã€çµæœã®ãƒã‚¤ãƒ³ã‚¿ã‚’å†ã³`unique_ptr`ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã€ã¨ã„ã†æ‰‹é †ã§ã™ã€‚

ã—ã‹ã—ã€ã“ã®æ‰‹é †ã¯ä¸€æ—¦ãƒªã‚½ãƒ¼ã‚¹ã®æ‰€æœ‰æ¨©ã‚’æ‰‹æ”¾ã™å¿…è¦ãŒã‚ã‚‹ãªã©ã€ãƒªã‚½ãƒ¼ã‚¹å®‰å…¨ãªæ–¹æ³•ã¨ã¯ã„ãˆã¾ã›ã‚“ã€‚

```cpp
auto GetClient() -> std::unique_ptr<const Client>;

// constã‚’å¤–ã—ãŸã„
voif example() {
  std::unique_ptr<Client> client;
  // ç”Ÿãƒã‚¤ãƒ³ã‚¿ãŒéœ²å‡ºã™ã‚‹
  client.reset(const_cast<Client*>(GetClient().release()));

  ..
}

// dynamic_castã‚’é©ç”¨ã—ãŸã„
void UseV2Client(std::unique_ptr<Client>&& client) {
  std::unique_ptr<ClientV2> v2;
  ...
  // dynamic_castãŒå¤±æ•—ã™ã‚‹ã¨ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ã™ã‚‹
  v2.reset(dynamic_cast<ClientV2*>(client.release()));

  ...
}
```

ä¸€æ–¹ã§ã€`std::shared_ptr`ã«ã¯ãã®ã‚­ãƒ£ã‚¹ãƒˆã®ãŸã‚ã®ãƒ•ãƒªãƒ¼é–¢æ•°ã§ã‚ã‚‹`std::const_pointer_cast`ã¨`std::dynamic_pointer_cast`ãŒç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã‚’ç”¨ã„ã‚‹ã¨ã“ã®ã‚ˆã†ãªå±é™ºæ€§ã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€Boostã«ã¯`unique_ptr`ã«å¯¾ã™ã‚‹`std::const_pointer_cast`ã¨`std::dynamic_pointer_cast`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

`std::uniqur_ptr`ã®ãƒã‚¤ãƒ³ã‚¿ã‚­ãƒ£ã‚¹ãƒˆã¨ã„ã†æ“ä½œã‚’ã‚ˆã‚Šå®‰å…¨ã«ã™ã‚‹ãŸã‚ã«ã€`std::uniqur_ptr`ã§ã‚‚`std::const_pointer_cast`ã¨`std::dynamic_pointer_cast`ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã§ã™ã€‚

æ–¹æ³•ã¨ã—ã¦ã¯å˜ç´”ã«ã€`std::const_pointer_cast`ã¨`std::dynamic_pointer_cast`ã«`std::uniqur_ptr`ã‚’å—ã‘å–ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚’è¡ŒãŠã†ã¨ã—ã¦ã„ã¾ã™ãŒã€`std::unique_ptr`ç‰¹æœ‰ã®äº‹æƒ…ã«ã‚ˆã‚Šå°‘ã—è¨­è¨ˆãŒç•°ãªã‚‹éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚

1ã¤ã¯ææ¡ˆã™ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯`std::uniqur_ptr`ã®å³è¾ºå€¤ã«å¯¾ã—ã¦ã®ã¿ä½œç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚‚ã†1ã¤ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒªãƒ¼ã‚¿ã®è€ƒæ…®ã§ã™ã€‚`std::shared_ptr`ã®å ´åˆã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒªãƒ¼ã‚¿ã¯å‹æ¶ˆå»ã•ã‚Œã¦ä¿æŒã•ã‚Œã¦ãŠã‚Šã€ã‚­ãƒ£ã‚¹ãƒˆã®å‰å¾Œã§ã‚‚ä¸€è²«ã—ã¦å…ƒã®ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã—ã¦ä½œç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒªãƒ¼ã‚¿ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ã€`std::unique_ptr`ã®å ´åˆã¯ãƒ‡ãƒªãƒ¼ã‚¿ã¯å‹ã®ä¸€éƒ¨ã§ã‚ã‚Šã€ã‚­ãƒ£ã‚¹ãƒˆã«ã‚ãŸã£ã¦ãƒ‡ãƒªãƒ¼ã‚¿ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

`std::unique_ptr<T, D>`ã‚’`std::unique_ptr<U>`ã«ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹å ´åˆã€`D`ãŒã‚­ãƒ£ã‚¹ãƒˆå¾Œã®ãƒã‚¤ãƒ³ã‚¿ã‚’å‰Šé™¤ã§ãã‚‹ã‹ã©ã†ã‹ã‚’è€ƒãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯å˜ç´”ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‡ãƒªãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã«ã®ã¿ãã®ä»®å®šãŒæˆã‚Šç«‹ã¡ã¾ã™ã€‚ä¸€æ–¹ã€`std::unique_ptr<T, D>`ã¯`D`ã‚’é€šã—ã¦ãƒã‚¤ãƒ³ã‚¿å‹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒã§ãã€ä¿æŒã™ã‚‹ã‚‚ã®ã¯å®Ÿéš›ã«ã¯ãƒã‚¤ãƒ³ã‚¿ã§ã¯ãªã„å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã—ãŸ`D`ã¯ã‚­ãƒ£ã‚¹ãƒˆå¾Œã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æ­£ã—ãé–‹æ”¾ã§ãã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ï¼ˆã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçŸ¥ã£ã¦ã„ã¾ã™ï¼‰ã€‚

ãã®ãŸã‚ã€ã“ã®ææ¡ˆã§ã¯ã“ã®2ã¤ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚ã™ãªã‚ã¡ã€ã‚­ãƒ£ã‚¹ãƒˆã¯æ¬¡ã®2ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¯èƒ½ã§ã™

1. `std::unique_ptr<T>` -> `std::unique_ptr<U>`ã®å¤‰æ›
2. `std::unique_ptr<T, D>` -> `std::unique_ptr<U, D>`ã®å¤‰æ›

ææ¡ˆã•ã‚Œã¦ã„ã‚‹é–¢æ•°

```cpp
namespace std {
  // dynamic_cast
  template<class T, class U>
  constexpr unique_ptr<T> dynamic_pointer_cast(unique_ptr<U>&& r) noexcept;

  template<class T, class D, class U>
  constexpr unique_ptr<T, D> dynamic_pointer_cast(unique_ptr<U, D>&& r) noexcept;

  // const_cast
  template<class T, class U>
  constexpr unique_ptr<T> const_pointer_cast(unique_ptr<U>&& r) noexcept;

  template<class T, class D, class U>
  constexpr unique_ptr<T, D> const_pointer_cast(unique_ptr<U, D>&& r) noexcept;
}
```

ã“ã®ææ¡ˆã®ã‚­ãƒ£ã‚¹ãƒˆè¨­è¨ˆã«ãŠã„ã¦ã¯ã€å®‰å…¨ã§ã‚ã‚‹ã“ã¨ã‚’é‡è¦–ã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã®2ç¨®é¡ä»¥å¤–ã®ãƒã‚¤ãƒ³ã‚¿ã‚­ãƒ£ã‚¹ãƒˆï¼ˆ`static_cast`ã¨`reinterpret_cast`ï¼‰ã«å¯¾å¿œã™ã‚‹é–¢æ•°ã¯å°‚é–€çŸ¥è­˜ãŒå¿…è¦ã§ã‚ã‚Šæ°—è»½ã«ä½¿ç”¨ã§ãã‚‹ã‚‚ã®ã§ã¯ãªã„ã¨ã—ã¦ææ¡ˆã—ã¦ã„ã¾ã›ã‚“ã€‚

ã¾ãŸã€ã‚­ãƒ£ã‚¹ãƒˆã«å½“ãŸã£ã¦ã¯é™çš„ã«ãã®å±é™ºæ€§ã‚’æ¤œå‡ºã§ãã‚‹ã‚‚ã®ã«ã¤ã„ã¦ã¯ãƒã‚§ãƒƒã‚¯ã—ã¦å¼¾ãã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚æ¬¡ã®è¡¨ã¯ã€ã“ã®ææ¡ˆã®APIã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«ã‚’è¡¨ã—ãŸã‚‚ã®ã§ã™

|API|1ã®å¤‰æ›|2ã®å¤‰æ›|
|:--|---|---|
|`const_pointer_cast`|`T* -> U*`ã¸ã®`const_cast`ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨|å¤‰æ›å…ƒã®`::pointer`ã‹ã‚‰å¤‰æ›å…ˆã®`::pointer`ã¸ã®`const_cast`ãŒæœ‰åŠ¹ã§ã‚ã‚Šã€`T, U`ã¯ã©ã¡ã‚‰ã‚‚é…åˆ—å‹ã§ã‚ã‚‹ã‹ã©ã¡ã‚‰ã‚‚ç•°ãªã£ã¦ã„ã‚‹|
|`dynamic_pointer_cast`|`T* -> U*`ã¸ã®`dynamic_cast`ãŒæœ‰åŠ¹ã§ã‚ã‚Šã€`U`ã¯ä»®æƒ³ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’æŒã¤|å¤‰æ›å…ƒã®`::pointer`ã‹ã‚‰å¤‰æ›å…ˆã®`::pointer`ã¸ã®`dynamic_cast`ãŒæœ‰åŠ¹ã§ã‚ã‚Šã€`T, U`ã¯ã©ã¡ã‚‰ã‚‚é…åˆ—å‹ã§ã¯ãªã„|

è¡¨ã®å³åˆ—ã®ã€Œå¤‰æ›å…ƒã®`::pointer`ã€ã¨ã¯`std::unique_ptr<T, D>::pointer`ã®ã“ã¨ã§ã€ã€Œå¤‰æ›å…ˆã®`::pointer`ã€ã¨ã¯`std::unique_ptr<U, D>::pointer`ã®ã“ã¨ã§ã™ã€‚

- [`std::const_pointer_cast` - cpprefjp](https://cpprefjp.github.io/reference/memory/shared_ptr/const_pointer_cast.html)
- [`std::dynamic_pointer_cast` - cpprefjp](https://cpprefjp.github.io/reference/memory/shared_ptr/dynamic_pointer_cast.html)
- [P3139 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1904)

### [P3149R3 async_scope -- Creating scopes for non-sequential concurrency](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3149r3.html)
### [P3154R1 Deprecating signed character types in iostreams](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3154r1.html)
### [P3157R1 Generative Extensions for Reflection](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3157r1.html)
### [P3175R1 Reconsidering the `std::execution::on` algorithm](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3175r1.html)
### [P3175R2 Reconsidering the `std::execution::on` algorithm](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3175r2.html)
### [P3179R1 C++ parallel range algorithms](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3179r1.html)
### [P3183R1 Contract testing support](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3183r1.pdf)
### [P3210R1 A Postcondition *is* a Pattern Match](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3210r1.pdf)
### [P3214R0 2024-04 Library Evolution Poll Outcomes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3214r0.html)

2024å¹´4æœˆã«è¡Œã‚ã‚ŒãŸã€LEWGã«ãŠã‘ã‚‹æŠ•ç¥¨ã®çµæœ

æ¬¡ã®9ã¤ã®ææ¡ˆãŒæŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã€ãƒªã‚¸ã‚§ã‚¯ãƒˆã•ã‚ŒãŸã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“

- [P2985R0 A type trait for detecting virtual base classes](https://wg21.link/P2985R0)
- [P2019R5 Thread Attributes](https://wg21.link/P2019R5)
- [P2855R1 Member customization points for Senders and Receivers](https://wg21.link/P2855R1)
- [P3168R1 Give std::optional range support](https://wg21.link/P3168R1)
- [P2075R5 Philox as an extension of the C++ RNG engines](https://wg21.link/P2075R5)
- [P2927R2 Observing exceptions stored in exception_ptr](https://wg21.link/P2927R2)
- [P2997R1 Removing the common reference requirement from the indirectly invocable concepts](https://wg21.link/P2997R1)
- [P2389R1 dextents Index Type Parameter](https://wg21.link/P2389R1)
- [P3201R1 LEWG nodiscard policy](https://wg21.link/P3201R1)

P3201R1ã¨P3201R1ä»¥å¤–ã¯ã€C++26ã«å‘ã‘ã¦LWGã«è»¢é€ã™ã‚‹ãŸã‚ã®æŠ•ç¥¨ã§ã™ã€‚

ã¾ãŸã€æŠ•ç¥¨ã«å½“ãŸã£ã¦å¯„ã›ã‚‰ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P3228R1 Contracts for C++: Revisiting contract check elision and duplication](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3228r1.pdf)
### [P3234R1 Utility to check if a pointer is in a given range](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3234r1.html)
### [P3235R0 `std::print` more types faster with less memory](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3235r0.html)

`std::print`ã®åŠ¹ç‡çš„ãªå®Ÿè£…ã‚’ã‚ˆã‚Šæ‹¡å¤§ã—ã¦é©ç”¨ã™ã‚‹ææ¡ˆã€‚

P3107ã§ã¯`std::print`ã«å¯¾ã—ã¦ã€`std::format()`ã‚’ä½¿ç”¨ã—ã¦ä¸€æ—¦`std::string`ã‚’å¾—ã¦ã‹ã‚‰å‡ºåŠ›ã™ã‚‹ã®ã§ã¯ãªãã€åŸºåº•ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ã‚’ãƒ­ãƒƒã‚¯ã—ã¦ç›´æ¥æ›¸ãè¾¼ã‚€ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§`std::print`ã®å‡ºåŠ›å‹•ä½œã‚’åŠ¹ç‡åŒ–ã—ã¾ã—ãŸã€‚ãŸã ã—ã€ã“ã‚Œã¯ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿å†…ã§ãƒ­ãƒƒã‚¯ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹å ´åˆã«ãã®å‹ã®å€¤ã«å¯¾ã—ã¦`std::print`ã‚’åŒã˜ãƒ­ãƒƒã‚¯ã®ä¸‹ã§å‘¼ã³å‡ºã™å ´åˆã«ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã£ãŸãŸã‚ã€`std::enable_nonlocking_formatter_optimization`å¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç‰¹æ®ŠåŒ–ã‚’`true`ã§å®šç¾©ã™ã‚‹å ´åˆã«ã®ã¿æœ‰åŠ¹ã«ãªã‚‹ã‚ˆã†ã«ã•ã‚Œã¦ã„ã¾ã™ã€‚

```cpp
// ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ãŸã„å‹
struct foo {};

// fooã®ãŸã‚ã®formatterç‰¹æ®ŠåŒ–
template <>
struct std::formatter<foo> {
  ...
};

// P3107ã®åŠ¹ç‡çš„ãªå®Ÿè£…ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹
template <>
constexpr bool std::enable_nonlocking_formatter_optimization<foo> = true;
```

P3107ã§ã¯ã€ã“ã®ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã‚’åŸºæœ¬å‹ï¼ˆ`int`ç­‰çµ„ã¿è¾¼ã¿ã®å‹ï¼‰ã¨æ–‡å­—åˆ—å‹ï¼ˆ`std::string/std::string_view`ï¼‰ã«å¯¾ã—ã¦ã®ã¿ç”¨æ„ã—ã¦ãŠã‚Šã€ä»–ã®æ¨™æº–å‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã«å¯¾ã—ã¦ã¯æœ‰åŠ¹åŒ–ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã‚Œã‚‰ä»¥å¤–ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿æä¾›æ¸ˆã¿ã®æ¨™æº–å‹ã«å¯¾ã—ã¦ã‚‚ã“ã®ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

è¿½åŠ ã‚’ææ¡ˆã—ã¦ã„ã‚‹ã‚‚ã®ã¯æ¬¡ã®ã‚‚ã®ã§ã™

- `<chrono>`é–¢é€£å‹
    - ãŸã ã—ã€`std::zoned_time`ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`TimeZonePtr`ã«å¯¾ã—ã¦ã®ã¿æä¾›
- `std::thread::id`
- `<stack_trace>`é–¢é€£
- `std::filesystem::path`
- `std::pair/std::tuple`
    - è¦ç´ å‹ã®ã™ã¹ã¦ãŒã‚ªãƒ—ãƒˆã‚¤ãƒ³æ¸ˆã¿ã§ã‚ã‚‹å ´åˆã«æœ‰åŠ¹åŒ–
- `range`é–¢é€£
    - `std::vector<bool>`ã¨ã‚³ãƒ³ãƒ†ãƒŠã‚¢ãƒ€ãƒ—ã‚¿ã‚’å«ã‚€
    - è¦ç´ å‹ã«ã‚ˆã‚‰ãšã«æœ‰åŠ¹åŒ–
        - åå¾©å‡¦ç†ã®å ´åˆã¯ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç™ºç”Ÿã®å¯èƒ½æ€§ãŒä½ã„ã¨è€ƒãˆã‚‰ã‚Œã‚‹ãŸã‚

ã¾ãŸè¿½åŠ ã®ææ¡ˆã¨ã—ã¦ã€ç¾åœ¨ã®`std::vprint_(non)unicode`ã‚’`std::vprint_(non)unicode_buffered`ã«ã€`std::vprint_(non)unicode_locking`ã‚’`std::vprint_(non)unicode`ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€éãƒ­ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ï¼ˆç¾åœ¨ã®`std::vprint_(non)unicode`ï¼‰ãŒæœ€çµ‚çš„ãªæ›¸ãè¾¼ã¿æ™‚ã«`std::vprint_(non)unicode_locking`ã‚’å‘¼ã³å‡ºã™ãŸã‚ã€å‘½åãŒèª¤è§£ã‚’æ‹›ãã¨ã„ã†ã“ã¨ã§ä¿®æ­£ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚ä¿®æ­£å¾Œã®åå‰ã¯ã€ã“ã®2ã¤ã®é–¢æ•°ã®é•ã„ãŒå‡ºåŠ›ã‚’ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ï¼ˆå…¨ä½“ã‚’æ–‡å­—åˆ—åŒ–ã—ã¦ã‹ã‚‰å‡ºåŠ›ã‚’è¡Œã†ï¼‰ã—ã¦è¡Œã†ã‹ã©ã†ã‹ã¨ã„ã†ç‚¹ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆC++23ã¸ã®DRã¨ã—ã¦ã€2024å¹´6æœˆã®å…¨ä½“ä¼šè­°ã§æ¡æŠã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P3107R0 Permit an efficient implementation of `std::print`](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3107R0-Permit-an-efficient-implementation-of-stdprint)
- [P3107R5 Permit an efficient implementation of `std::print`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3107r5.html)
- [P3235 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1906)

### [P3236R1 Please reject P2786 and adopt P1144](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3236r1.html)
### [P3238R0 An alternate proposal for naming contract semantics](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3238r0.html)

é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã•ãšã«çµ‚äº†ã™ã‚‹å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆquick_enforceï¼‰ã‚’ã€Erroneous Behaviorã¨ã—ã¦æ‰±ã†ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ã“ã“ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã®ã¯æ¬¡ã®2ã¤ã®äº‹ã§ã™

1. å¥‘ç´„é•åæ™‚ã«é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã•ãšå³æ™‚çµ‚äº†ã™ã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆquick_enforceï¼‰ã‚’æŒã¤å¥‘ç´„æ³¨é‡ˆã®å¥‘ç´„é•åæ™‚ã®å‹•ä½œã¯ã€Erroneous Behaviorã§ã‚ã‚‹ã¨æŒ‡å®šã™ã‚‹
    - ãã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¨ã—ã¦ã€é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã™
2. å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®åå‰ã‚’å¤‰æ›´ã™ã‚‹
    - ignore -> ignored
    - enforce -> enforced
    - observe -> observed
    - quick_enforce -> erroneous

å¥‘ç´„é•åæ™‚ã«å³æ™‚çµ‚äº†ã™ã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ãŠã„ã¦ã¯å¥‘ç´„é•åã¯è‡´å‘½çš„ãªå¤±æ•—ã§ã‚ã‚Šã€ä»–ã®æ–¹æ³•ã§ã“ã®å‹•ä½œã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ã“ã‚Œã‚’EBã¨ã—ã¦æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ãã®ã¾ã¾å³æ™‚çµ‚äº†ã™ã‚‹ã“ã¨ã¨ã€å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¨ã—ã¦é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã—ã¦ç°¡å˜ãªè¨ºæ–­ã‚’ç™ºè¡Œã—ã¦çµ‚äº†ã™ã‚‹ã“ã¨ã®ä¸¡æ–¹ã‚’å®Ÿè£…ã«å¯¾ã—ã¦è¨±å¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ¬¡ã«ã“ã®ã“ã¨ã‚’è¸ã¾ãˆãŸã†ãˆã§quick_enforceã«å¯¾ã™ã‚‹é©åˆ‡ãªåå‰ã‚’è€ƒãˆã¾ã™ã€‚ä»–ã®3ã¤ã®å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®åå‰ã¯æ¦‚ã­ã€Œï½ the trueness of a predicateã€ï¼ˆã€Œè¿°èªã®çœŸå½ã‚’ï½ã™ã‚‹ã€ï¼‰ã®ï½ã®éƒ¨åˆ†ã«å½“ã¦ã¯ã¾ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ãŒã€quick_enforceã¯ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ææ¡ˆã§ã¯ãã“ã«å½“ã¦ã¯ã¾ã‚‹ã‚ˆã†ãªåå‰ã‚’è€ƒãˆã‚‹ã®ã§ã¯ãªãã€æ„å‘³ä¸Šã®erroneousã¨ã„ã†å˜èªã‚’ä»–ã®åå‰ã«ãªã£ã¦ã„ã‚‹å‹•è©ã®éå»å½¢ã¨åŒã˜æ–‡æ³•çš„ä½ç½®ã«ç½®ãã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã™ãªã‚ã¡ã€ã€ŒA contract violation is treated as ï½ã€ï¼ˆå¥‘ç´„é•åã¯ã€ï½ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ï¼‰ã®ï½ã«å…¥ã‚‹ã‚ˆã†ã«ä»–ã®3ã¤ã®åå‰ã‚’å¤‰æ›´ã—ã€å‹•è©ã®éå»å½¢ã«ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã®å†…å®¹ã¯SG21ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ãŠã„ã¦å¥½ã¾ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚

- [P3238 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1906)

### [P3239R0 A Relocating Swap](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3239r0.pdf)

ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„ãŸ`swap`ã‚’è¡Œã†ã€`swap_representations`ã®ææ¡ˆã€‚

`swap`ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã‚’äº¤æ›ã™ã‚‹ã“ã¨ã§ã™ã€‚ãã®æ“ä½œã¯å®Ÿéš›ã«ã¯ã€ãƒ ãƒ¼ãƒ–ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ãƒ ãƒ¼ãƒ–ä»£å…¥æ¼”ç®—å­ï¼ˆã¨ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼‰ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã®äº¤æ›ã¨ã„ã†éƒ¨åˆ†ã«æ³¨ç›®ã™ã‚‹ã¨`swap`ã®è¡Œã†ã“ã¨ã¯ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¡Œã†ã“ã¨ã¨ã‚ˆãä¼¼ã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ãã¾ã™ã€‚ç‰¹ã«ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ãªå‹ãªã‚‰`swap`ã¯å˜ç´”ãª`memcpy`ã«ã‚ˆã£ã¦å®Ÿè¡Œã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€`swap`ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã—ã‹ã—ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãªãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚ˆã†ãªæ“ä½œã«ã‚ˆã£ã¦2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¡¨ç¾ã‚’å…¥ã‚Œæ›¿ãˆã‚‹ã“ã¨ã¯ã€C++ã®éãƒˆãƒªãƒ“ã‚¢ãƒ«ãªå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ã®ç”Ÿå­˜æœŸé–“ã®ã®ãƒ«ãƒ¼ãƒ«ã«æŠµè§¦ã—ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å°å…¥å¾Œã«ãŠã„ã¦ã‚‚è¨±å¯ã•ã‚Œã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã¯ã€ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹`swap`ã‚’è¡Œã†å°‚ç”¨ã®é–¢æ•°ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«è¿½åŠ ã—ã€ãã‚Œã‚’é€šã—ã¦ã®ã¿ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹`swap`ã‚’åˆæ³•åŒ–ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã®ã¯ã€`std::swap_representations()`ã¨ã„ã†é–¢æ•°ã§ã™ã€‚åŒã˜å‹ã®2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å‚ç…§ã‚’å—ã‘å–ã£ã¦ã€ãã‚Œã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å€¤è¡¨ç¾ã‚’äº¤æ›ã—ã¾ã™ãŒã€ã©ã¡ã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿå­˜æœŸé–“ã‚‚çµ‚äº†ã—ã¾ã›ã‚“ã€‚ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ“ä½œã‚’ç”¨ã„ã‚‹ã¨ã‚½ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯æ¶ˆãˆã¦ã—ã¾ã†ãŸã‚é€šå¸¸ãã‚Œã¯ä¸å¯èƒ½ã§ã™ã€‚ãã®ãŸã‚ã€ã“ã®é–¢æ•°ã¯ä¸€ç¨®ã®é­”æ³•ã®ã‚ˆã†ã«å‹•ä½œã™ã‚‹ç‰¹åˆ¥ãªé–¢æ•°ã§ã™ã€‚ãŸã ã—ã€å®‰å…¨ã®ãŸã‚ã€å…¥åŠ›ã®å‹`T`ã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ï¼ˆ`is_trivially_relocatable_v<T>`ãŒ`true`ï¼‰ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

```cpp
namespace std {
  // ææ¡ˆã™ã‚‹swap_representationsã®å®£è¨€
  template <bool force, class T>
  void swap_representations(T& a, T& b); 
}
```

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®`force`ã¯`T`ãŒãƒãƒªãƒ¢ãƒ«ãƒ•ã‚£ãƒƒã‚¯ãªå‹ã®å ´åˆã«ã®ã¿æ„å‘³ã‚’æŒã¡ã¾ã™ã€‚ã“ã“ã§ã®å¼•æ•°ã¯å‚ç…§ã§ã‚ã‚‹ãŸã‚ã€`T`ã‚’åŸºåº•ã‚¯ãƒ©ã‚¹ã¨ã—ãŸæ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å‚ç…§ãŒå…¥åŠ›ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚‚ã—ã€`a`ã¨`b`ãŒåŒã˜åŸºåº•ã‚¯ãƒ©ã‚¹`T`ã‹ã‚‰æ´¾ç”Ÿã™ã‚‹åˆ¥ã®æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®å‚ç…§ã§ã‚ã‚‹å ´åˆã€ã“ã‚Œã¯æœªå®šç¾©å‹•ä½œã«ãªã‚Šã¾ã™ï¼ˆ`a`ã¨`b`ã®ä»®æƒ³é–¢æ•°ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç•°ãªã£ã¦ã„ã‚‹ãŸã‚ï¼‰ã€‚

ã“ã®é–¢æ•°å†…ã‹ã‚‰ã¯å‚ç…§ã§æ¸¡ã•ã‚ŒãŸã‚‚ã®ã—ã‹è¦‹ãˆãªã„ãŸã‚ãã‚Œã‚’é™çš„ã«æ¤œå‡ºã§ãã¾ã›ã‚“ãŒã€`swap_representations`åˆ©ç”¨è€…ãŒäºˆã‚ã“ã®å±é™ºæ€§ãŒãªã„å‚ç…§ã‚’æ¸¡ã™ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã‚‹å ´åˆï¼ˆä¾‹ãˆã°ã€`std::vector`å†…éƒ¨ã§è¦ç´ å‹ãŒ`T`ãã®ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆãªã©ï¼‰ã«ã€`force`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’`true`ã«ã—ã¦å‘¼ã³å‡ºã™ã“ã¨ã§ãƒãƒªãƒ¢ãƒ«ãƒ•ã‚£ãƒƒã‚¯ãªå‹ã®å€¤è¡¨ç¾ã‚’äº¤æ›ã§ãã¾ã™ã€‚é€†ã«ã€`is_polymorphic_v<T>`ãŒ`true`ã®å ´åˆã«`force`ãŒ`false`ã¨æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã¨ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€`std::swap`ãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®è¦³æ¸¬å¯èƒ½ãªå‹•ä½œã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãªãã“ã‚Œã‚’ç”¨ã„ã¦å®Ÿè£…å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™å‹ç‰¹æ€§`std::swap_uses_value_representations_v`ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã‚‚ææ¡ˆã—ã¦ã„ã¾ã™ã€‚å‹`T`ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ã®`std::swap`ã¯`std::swap_uses_value_representations_v<T>`ãŒ`true`ã¨ãªã‚‹å ´åˆã«`swap_representations`ã‚’ç”¨ã„ã¦æœ€é©åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ææ¡ˆã®å†…å®¹ã¯ã‚³ã‚¢è¨€èªã®å¤‰æ›´ã‚’ä¼´ã‚ãªã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ‹¡å¼µã®ã¿ã§ã‚ã‚Šã€ãªãŠã‹ã¤ä»–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã«å½±éŸ¿ã‚’åŠã¼ã•ãªã„ã‚‚ã®ã§ã™ã€‚ã—ã‹ã—ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨å…±ã«å°å…¥ã•ã‚Œã‚Œã°ã€ãã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä¸Šã®æ©æµã‚’æœ€å¤§åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- [P2786R0 Trivial relocatability options - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/03/19/184146#P2786R0-Trivial-relocatability-options)
- [P3239 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1908)

### [P3247R1 Deprecate the notion of trivial types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3247r1.html)
### [P3248R0 Require [u]intptr_t](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3248r0.html)

`(u)intptr_t`ã‚’å¿…é ˆã«ã™ã‚‹ææ¡ˆã€‚

`(u)intptr_t`ã¯ãƒã‚¤ãƒ³ã‚¿å€¤ã‚’æ•´æ•°ã¨ã—ã¦ä¿æŒã—ãŸã„å ´åˆã«ä½¿ç”¨ã§ãã€å¤‰æ›å‰å¾Œã§ãƒã‚¤ãƒ³ã‚¿å€¤ãŒå¤‰åŒ–ã—ãªã„ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹æ•´æ•°å‹ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§ã™ã€‚ã—ã‹ã—ã€ã“ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€å®Ÿè£…ã¯å¿…ãšã—ã‚‚å®šç¾©ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

`(u)intptr_t`ãŒå­˜åœ¨ã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã„ã†äº‹å®Ÿã«ã‚ˆã£ã¦ã€ç§»æ¤æ€§ã‚’é‡è¦–ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã¯ã“ã®ä½¿ç”¨ã‚’å›é¿ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãã®ãŸã‚ã«ä½™è¨ˆãªä½œæ¥­ã¨æ½œåœ¨çš„ãªãƒã‚°ã‚’åŸ‹ã‚è¾¼ã‚€å¯èƒ½æ€§ãŒç™ºç”Ÿã—ã¾ã™ã€‚

ã“ã®ã“ã¨ã¯æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚‚å•é¡Œã«ãªã‚Šã€P2835ï¼ˆ`std::atomic_ref`ã«ãƒã‚¤ãƒ³ã‚¿å€¤ã‚’å–å¾—å¯èƒ½ãªé–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ï¼‰ã‚„P3125ï¼ˆãƒã‚¤ãƒ³ã‚¿ã®æœªä½¿ç”¨ãƒ“ãƒƒãƒˆä½¿ç”¨ã®ãŸã‚ã®é–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ï¼‰ãªã©ã§ã¯ãƒã‚¤ãƒ³ã‚¿å€¤ã®ã‚„ã‚Šå–ã‚Šã®ãŸã‚ã«`(u)intptr_t`ã‚’ä½¿ç”¨ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã‚‚ã®ã®ã€ãã‚ŒãŒã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã§ã‚ã‚‹ã“ã¨ãŒå•é¡Œã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€`(u)intptr_t`ã‚’å¿…é ˆã®å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã§ã‚ã‚‹ã¨ã¯ã„ãˆå®Ÿéš›ã«ã¯ä¸»è¦3ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯å…¨ã¦ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå‘ã‘ã«ã“ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’æä¾›ã—ã¦ãŠã‚Šã€ãã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®Ÿè£…ã‚‚`(u)intptr_t`ã®å­˜åœ¨ã‚’ä»®å®šã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ã¾ãŸã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ABIã§ã‚‚`(u)intptr_t`ç›¸å½“ã®æ•´æ•°å‹ã®å­˜åœ¨ãŒãƒã‚¤ãƒ³ã‚¿å‹ã®æŒ‡å®šã¨å…±ã«ä»„ã‚ã‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

å¾“ã£ã¦ã€`(u)intptr_t`ã‚’å¿…é ˆã«ã—ãŸã¨ã—ã¦ã‚‚C++ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚µãƒãƒ¼ãƒˆã¯ä½ä¸‹ã—ãªã„ã€ã¨ã“ã®ææ¡ˆã§ã¯çµè«–ä»˜ã‘ã¦ã„ã¾ã™ã€‚

ææ¡ˆã—ã¦ã„ã‚‹è¦æ ¼ã®å¤‰æ›´ã¯ã€`(u)intptr_t`ã‹ã‚‰optionalã§ã‚ã‚‹ã¨ã„ã†æŒ‡å®šã‚’å–ã‚Šé™¤ãã ã‘ã§ã™ã€‚

- [`std::intptr_t` - cpprefjp](https://cpprefjp.github.io/reference/cstdint/intptr_t.html)
- [P3248 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1909)

### [P3249R0 A unified syntax for Pattern Matching and Contracts when introducing a new name](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3249r0.pdf)

ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã¨å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®é–“ã§çµ±ä¸€çš„ãªæ§‹æ–‡ã®ææ¡ˆã€‚

ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°æ§‹æ–‡ã«ãŠã„ã¦ã¯ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¨˜è¿°å†…ã§ï¼ˆãƒãƒƒãƒã—ãŸã‚‚ã®ã‚’è¡¨ã™ï¼‰æ–°ã—ã„åå‰ã‚’å°å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€P2688ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ææ¡ˆã«ãŠã„ã¦ã¯`let x => expr;`ã®æ§˜ã«è¨˜è¿°ã—ã¾ã™ã€‚ã¾ãŸã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®äº‹å¾Œæ¡ä»¶ã«ãŠã„ã¦ã¯ã€æˆ»ã‚Šå€¤ã‚’å‚ç…§ã™ã‚‹åå‰ã‚’å°å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€`post(r : expr)`ã®æ§˜ã«è¨˜è¿°ã—ã¾ã™ã€‚

```cpp
int f();

// ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã®ä¾‹
void g() {
  int i = f();

  i match {
    42 let val => print(val); // valã‚’å°å…¥ï¼ˆval == 42ï¼‰
    let x => print(x); // xã‚’å°å…¥ï¼ˆx != 42ï¼‰
  }
}

// å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä¾‹
int foo()
  post(ret : ret > 0) // retã‚’å°å…¥
```

ãã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§å¿…è¦ãªå¤‰æ•°åã‚’å°å…¥ã™ã‚‹ã¨ã„ã†å´é¢ã‹ã‚‰ã¯ã“ã®2ã¤ã¯åŒã˜ã“ã¨ã‚’ã—ã¦ã„ã‚‹ã¨è¦‹ã‚‹ã“ã¨ãŒã§ãã€åŒã˜ã“ã¨ã‚’ã™ã‚‹ã®ã«ç•°ãªã‚‹æ§‹æ–‡ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã¯ä¸€è²«æ€§ãŒç„¡ãåˆå­¦è€…ãŒè¦šãˆã¥ã‚‰ãã€è¨€èªã‚’è¤‡é›‘ã«ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã®2ã¤ã®åå‰å°å…¥ã®æ§‹æ–‡ã‚’çµ±ä¸€ã™ã‚‹ã“ã¨ã§ã€ç¿’å¾—ã®ã—ã‚„ã™ã•ã®å‘ä¸Šã¨è¨€èªã®è¤‡é›‘ã•ã®ä½æ¸›ã‚’å›³ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã§ã¯ã€ã“ã‚Œã‚‰ã®æ§‹æ–‡ã‚’ä¸€è²«ã—ã¦`let name => expr`ã®ã‚ˆã†ã«çµ±ä¸€ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

```cpp
int foo()
  post( let r => r > 0) // rã‚’å°å…¥
```

ã™ãªã‚ã¡ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®æ§‹æ–‡ã‚’ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã«åˆã‚ã›ã‚‹ã‚‚ã®ã§ã™ã€‚

ãŸã ã—ã€äº‹å¾Œæ¡ä»¶ï¼ˆ`post()`ï¼‰å†…ã§ã®`let ~`ã¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã§ã¯ãªã„ãŸã‚ã€ãã“ã§ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã‚’æ›¸ããŸã„å ´åˆã¯å³è¾ºã®å¼å†…ã«è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

äº‹å¾Œæ¡ä»¶ã¨ã—ã¦`(ret == 1 or ret == 2 or ret > 100)`ã¨ã„ã†æ¡ä»¶ã‚’æŒ‡å®šã—ãŸã„å ´åˆã®ä¾‹

```cpp
// P3210ã®ææ¡ˆ
int foo()
  post (
    1 => true;
    2 => true;
    let ret => ret > 100
  );

// ã“ã®ææ¡ˆã®å ´åˆ
int foo()
  post ( let ret =>
    ret match {
      1 => true;
      2 => true;
    } or
    ret > 100
  );
```

ã“ã‚ŒãŒã€å…ˆè¡Œã™ã‚‹åŒç¨®ã®ææ¡ˆP3210ã¨ã®é•ã„ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã®å•é¡Œç‚¹ã¯ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒC++26ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ã®ã«å¯¾ã—ã¦ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°æ©Ÿèƒ½ã¯ã¾ã ãã®æ®µéšã«ãªã„ã“ã¨ã§ã™ã€‚ãŠãã‚‰ãã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®æ–¹ãŒå…ˆã«å®Œæˆã—æ¨™æº–ã«å–ã‚Šè¾¼ã¾ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚ã¤ã¾ã‚Šã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã®æ§‹æ–‡ã¯ã¾ã æµå‹•çš„ã§ã€æœ€æ‚ªã®å ´åˆã“ã®ææ¡ˆãŒæ¡æŠã•ã‚ŒãŸã†ãˆã§ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã ã‘ç•°ãªã‚‹æ§‹æ–‡ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ãŸã ã€ã“ã®ææ¡ˆã‚’æ¡æŠã—ãªã‘ã‚Œã°åŒã˜ã“ã¨ã‚’è¡Œã†ã®ã«ç•°ãªã‚‹2ã¤ã®æ§‹æ–‡ãŒç¢ºå®Ÿã«å°å…¥ã•ã‚Œã‚‹ã®ã«å¯¾ã—ã¦ã€ã“ã®ææ¡ˆã‚’æ¡æŠã—ãŸãŠã‘ã°ãã‚Œã‚’ç•°ãªã‚‹2ã¤ã®æ§‹æ–‡ãŒå°å…¥ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€ã¾ã§ç·©å’Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒå…ˆã«æ¡æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã“ã®ææ¡ˆãŒæ¡æŠã•ã‚Œã¦ã„ã‚‹ã¨ã™ã‚‹ã¨ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã®æ§‹æ–‡ã¨ã—ã¦åˆ¥ã®ã‚‚ã®ãŒææ¡ˆã•ã‚Œã‚‹å ´åˆã«ãã‚Œã«å¯¾ã—ã¦ä½™åˆ†ãªåˆ¶ç´„ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ãã®å ´åˆã“ã®ææ¡ˆã§ã¯ã€çµ±ä¸€æ§‹æ–‡ã‹ã‚‰é€¸è„±ã™ã‚‹ã«ã›ã‚ˆæ•´åˆæ€§ã‚’é‡è¦–ã™ã‚‹ã«ã›ã‚ˆã€ãã‚Œã¯å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¨ã¯ç„¡é–¢ä¿‚ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ãŒï¼ˆã‚’è­°è«–ã™ã‚‹EWGãŒï¼‰æ±ºå®šã™ã‚‹ã¹ãã€ã¨ã—ã¦ã„ã¾ã™ã€‚

- [P3210R0 A Postcondition is a Pattern Match - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3210r0.pdf)
- [P3249 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1910)

### [P3250R0 C++ contracts with regards to function pointers](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3250r0.html)

å¥‘ç´„æ³¨é‡ˆã‚’æŒã¤é–¢æ•°ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸ã®æš—é»™å¤‰æ›ã‚’ç¦æ­¢ã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ï¼ˆP2900ï¼‰ã§ã¯ã€ç¾æ™‚ç‚¹ã§å¥‘ç´„ãƒã‚§ãƒƒã‚¯ãŒé–¢æ•°ã®å‘¼ã³å‡ºã—å´ã§ãªã•ã‚Œã‚‹ã®ã‹ã€å‘¼ã³å‡ºã—å…ˆã§ãªã•ã‚Œã‚‹ã®ã‹ãŒæœªè§£æ±ºã®ã¾ã¾ã§ã™ã€‚ã¨ã¯ã„ãˆã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®å ´åˆã‚’é™¤ã„ã¦ã“ã‚Œã¯ã»ã¼å•é¡Œã«ãªã‚‰ãªã„ã‚ˆã†ã§ã™ã€‚

ã¾ãŸç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ä»•æ§˜ã§ã¯ã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã™ã‚‹å¥‘ç´„ã®æŒ‡å®šã¯è¡Œãˆã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ãŒãã®ã‚·ã‚°ãƒãƒãƒ£ã ã‘ä¼šã£ã¦å±…ã‚Œã°å¤‰æ›ã§ãã¦ã—ã¾ã†ãŸã‚ã§ã€ç•°ãªã‚‹å¥‘ç´„æ¡ä»¶ã®å¤‰æ›ã‚’ã©ã†ã™ã‚‹ã‹ã¨ã„ã†å„ä»‹ãªå•é¡Œã®è­°è«–ã‚’å…ˆé€ã‚Šã«ã™ã‚‹ãŸã‚ã®åˆ¶é™ã§ã™ã€‚ãŸã ã—ã€å°†æ¥çš„ã«ãã‚Œã‚’æœ‰åŠ¹åŒ–ã—ãŸå ´åˆã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’é€šã—ã¦é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚ŒãŸå ´åˆã«å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’æ­£ã—ãè¡Œã†ã«ã¯å¿…ãšå‘¼ã³å‡ºã—å…ˆã§ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ã‚’æ„å‘³ã—ã¦
ã„ã¾ã™ã€‚

ãŸã ã—ã€ç¾åœ¨ã®ä»•æ§˜ï¼ˆP2900ï¼‰ã§ã¯ã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã‚’ç¦æ­¢ã—ã¦ã„ã‚‹ã‚‚ã®ã®ã€å¥‘ç´„æ³¨é‡ˆã‚’æŒã¤é–¢æ•°ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸ã®å¤‰æ›ã¯ç¦æ­¢ã—ã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€å°†æ¥çš„ã«é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã¸ã®æ‹¡å¼µãŒè¡Œã‚ã‚ŒãŸå ´åˆã«å•é¡ŒãŒèµ·ã“ã‚Šã¾ã™ã€‚

```cpp
// å¥‘ç´„ã‚’æŒã¤é–¢æ•°
void fun(A& a) pre (a.ok());

// é–¢æ•°å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹
using F = void(A& a);
using G = void(A& a) pre(a.ok()); // å°†æ¥å¯èƒ½ã«ãªã£ãŸã¨ã—ã¦

// é–¢æ•°ãƒã‚¤ãƒ³ã‚¿å¤‰æ•°ã®å®£è¨€
F* f = fun; // okã€å±é™ºã€ç¾åœ¨ã‹ã‚‰å¯èƒ½
G* g = fun; // okã€å®‰å…¨
```

ã“ã®ã‚ˆã†ã«åŒã˜é–¢æ•°ã«å¯¾ã™ã‚‹é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã§ã‚‚ã€å¥‘ç´„æ³¨é‡ˆã®æƒ…å ±ã‚’ä¿æŒã—ãŸã‚‚ã®ã¨ã™ã¹ã¦å‰Šé™¤ã•ã‚ŒãŸã‚‚ã®ã®2ç¨®é¡ãŒå…±å­˜ã—ã¦ã—ã¾ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€å°†æ¥ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã®æŒ‡å®šã‚’å¯èƒ½ã«ã—ã¦ãŠããŸã‚ã«ã€å¥‘ç´„ã‚’æŒã¤é–¢æ•°ã‹ã‚‰ã‚·ã‚°ãƒãƒãƒ£ãŒãƒãƒƒãƒã™ã‚‹é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ãƒ˜ã®æš—é»™å¤‰æ›ã‚’ç¦æ­¢ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¥‘ç´„æ³¨é‡ˆã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ã™ã‚‹å ´åˆ

- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯å‘¼ã³å‡ºã—å…ˆã§ã®ãƒã‚§ãƒƒã‚¯ã‚’çœç•¥ã—ã¦ã€å‘¼ã³å‡ºã—å´ã®ï¼ˆå ´åˆã«ã‚ˆã£ã¦ã¯çœç•¥å¯èƒ½ãªï¼‰å¥‘ç´„æ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯ã‚’æŠ±ã‘ã‚’è¡Œãˆã‚‹
    - ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®è¨¼æ˜ã«ã‚ˆã£ã¦ã€å¥‘ç´„æ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯ãŒçœç•¥å¯èƒ½ãªæ©Ÿä¼šãŒå¢—ãˆã‚‹
- ç•°ãªã‚‹å¥‘ç´„æ³¨é‡ˆã‚»ãƒƒãƒˆé–“ã§ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®å¤‰æ›
    - ã‚ˆã‚Šå¼·ã„å¥‘ç´„ã‹ã‚‰ã‚ˆã‚Šå¼±ã„å¥‘ç´„ã¸ã€ã¾ãŸã¯ãã®é€†ã€ã®å¤‰æ›ãªã©

ç­‰ã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

å°†æ¥ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®ãŸã‚ã«è¨­è¨ˆã‚’äºˆç´„ã—ã¦ãŠãå ´åˆã€ã“ã‚Œã‚‰ã®ãƒ¡ãƒªãƒƒãƒˆã‚’å°†æ¥çš„ã«å°å…¥ã™ã‚‹æ™‚ã®ãŸã‚ã«è¨­è¨ˆã‚’é–‹ã„ã¦ãŠãã€ãªãŠã‹ã¤ã€ç¾åœ¨ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®ä½¿ç”¨æ–¹æ³•ã‚’å°†æ¥ã®å¤‰æ›´ã‹ã‚‰ä¿è­·ã™ã‚‹äº‹ã«ã‚‚ã¤ãªãŒã‚Šã¾ã™ã€‚

ä¸€æ–¹ã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®å¥‘ç´„æ³¨é‡ˆã®ãŸã‚ã«è¨­è¨ˆç©ºé–“ã‚’äºˆç´„ã—ã¦ãŠãå ´åˆ

- é–¢æ•°åã«å¯¾ã—ã¦ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–ã‚‹æ“ä½œã¯ã€æ˜ç¤ºçš„ãªå¤‰æ›ã®ã¿ãŒè¨±å¯ã•ã‚Œã‚‹
- å‹æ¨è«–ã•ã‚Œã‚‹å ´æ‰€ã§é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’ä½¿ç”¨ã§ããªã„
  - `auto*`ã‚„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- P2900ã¯å¥‘ç´„æ³¨é‡ˆã¯ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ä¸å¯è¦–ã§ã‚ã‚‹ã“ã¨ã‚’æ±ºå®šã—ãŸãŒã€ã“ã‚Œã«ã‚ˆã£ã¦ãã‚Œã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ¤œå‡ºå‡ºæ¥ã†ã‚‹

ç­‰ã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

ææ¡ˆã‚ˆã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

```cpp
int f(int x) post (r: r != 0);

using function_type = int(*)(int);
auto *fp2 = f; // ERROR
auto *fp3 = (function_type)f; // OK

template <typename FT>
void g(FT func);
g(f); // ERROR
g((function_type)f); // OK
```

å¥‘ç´„ã‚’æŒãŸãªã„é–¢æ•°ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸ã®å¤‰æ›ã€ãŠã‚ˆã³ï¼ˆå¥‘ç´„æœ‰ç„¡ã«é–¢ã‚ã‚‰ãšï¼‰é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸ã®æ˜ç¤ºçš„å¤‰æ›ã¯ã€ã“ã‚Œã¾ã§é€šã‚Šã«è¨±å¯ã•ã‚Œã¾ã™ã€‚

ã“ã®ææ¡ˆã¯SG21ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å¥½ã¾ã‚Œãšã€å¦æ±ºã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P3221R0 Disable pointers to contracted functions - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3221R0-Disable-pointers-to-contracted-functions)
- [P3250 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1911)

### [P3251R0 C++ contracts and coroutines](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3251r0.html)

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã‚’è¨±å¯ã™ã‚‹ææ¡ˆã€‚

C++26ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«ãŠã„ã¦ã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹å¥‘ç´„ã¯`contract_assert`ã®ã¿ãŒè¨±å¯ã•ã‚Œã¦ãŠã‚Šã€äº‹å‰ãƒ»äº‹å¾Œæ¡ä»¶ã®æŒ‡å®šã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒä¸­æ–­å¯èƒ½ãªé–¢æ•°ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€ãã‚Œã‚‰ã®å¥‘ç´„ãŒã©ã®ã‚ˆã†ã«æŒ¯èˆã†ã¹ãã‹ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’ç¢ºç«‹ã§ãã¦ã„ãªã„ãŸã‚ã€ãã®è­°è«–ã¨æ±ºå®šã‚’æ€¥ãŒãªã„ãŸã‚ã®æªç½®ã§ã™ã€‚

é€šå¸¸ã®é–¢æ•°ã«å¯¾ã™ã‚‹äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã¯ã€é–¢æ•°ã«å…¥ã‚‹æ™‚ã¨é–¢æ•°ã‹ã‚‰æˆ»ã‚‹æ™‚ã®ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿/æˆ»ã‚Šå€¤ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®çŠ¶æ…‹ã«ã¤ã„ã¦ã®æ¡ä»¶ã‚’æŒ‡å®šã—ã¾ã™ã€‚

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ãã®å‘¼ã³å‡ºã—ã®ä»»æ„ã®æ™‚ç‚¹ã§ä¸­æ–­ã—ã¦å‘¼ã³å‡ºã—å…ƒã«ãƒªã‚¿ãƒ¼ãƒ³ã™ã‚‹ã“ã¨ãŒã§ãã€ã¾ãŸãã®å¾Œã®ä»»æ„ã®æ™‚ç‚¹ã§å†é–‹ã—å†ã³é–¢æ•°å†…ã«å…¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚C++ã«ãŠã‘ã‚‹ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯é–¢æ•°å®£è¨€ã§åŒºåˆ¥ã•ã‚Œã¦ãŠã‚‰ãšã€ãã®å®šç¾©ã‚’è¦‹ã«è¡Œã‹ãªã„ã¨ãã®é–¢æ•°ãŒã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã‚ã‚‹ã‹ã©ã†ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚å¾“ã£ã¦ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã§å¥‘ç´„å¯èƒ½ãªã®ã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®é–‹å§‹æ™‚ç‚¹ã®çŠ¶æ…‹ã¨ã€ä¸­æ–­æ™‚ç‚¹ã®çŠ¶æ…‹ã«ã¤ã„ã¦ã®ã‚‚ã®ã ã‘ã§ã™ã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å‰ãƒ»äº‹å¾Œæ¡ä»¶æŒ‡å®šãŒç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ã¨ã¯ã„ã£ã¦ã‚‚ã€ãã‚Œã¯å®Ÿéš›ã«ã¯ç°¡å˜ã«å›é¿ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã‚³ãƒ«ãƒ¼ãƒãƒ³`f()`ãŒã‚ã‚‹ã¨ãã€`auto g() { return f(); }`ã®ã‚ˆã†ã«ã™ã‚Œã°ã“ã®`g()`ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã¯ãªããªã‚Šã€`g()`ã«ã¯é€šå¸¸ã®é–¢æ•°åŒæ§˜ã®å¥‘ç´„æ³¨é‡ˆã‚’æŒ‡å®šã§ãã¾ã™ã€‚ã“ã®ã‚ˆã†ã«ã—ãŸæ™‚ã®`g()`ã«ãªã•ã‚Œã‚‹äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã¨ã¯ã€ã¡ã‚‡ã†ã©ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®é–‹å§‹æ™‚ç‚¹ã®çŠ¶æ…‹ã¨ä¸­æ–­æ™‚ç‚¹ã®çŠ¶æ…‹ã«å¯¾ã™ã‚‹å¥‘ç´„ã¨ã—ã¦æ©Ÿèƒ½ã—ã€ãã‚Œã¯ã“ã®ã‚ˆã†ãªãƒ©ãƒƒãƒ”ãƒ³ã‚°ã‚’è¡Œã†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã™ã‚‹ã¨ã“ã‚ã¨ä¸€è‡´ã™ã‚‹ã¯ãšã§ã™ã€‚

ãŸã ã—é€šå¸¸ã®é–¢æ•°ã¨ç•°ãªã‚‹ã¨ã“ã‚ãŒä¸€ç‚¹ã ã‘ã‚ã‚Šã€ãã‚Œã¯äº‹å¾Œæ¡ä»¶ã‹ã‚‰ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³å¼•æ•°ã‚’ä¸€åˆ‡å‚ç…§ã§ããªã„ã¨ã„ã†ã“ã¨ã§ã™ï¼ˆãƒ ãƒ¼ãƒ–ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼‰ã€‚ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã®ã“ã®ã‚³ãƒ¼ãƒŠãƒ¼ã‚±ãƒ¼ã‚¹ã‚’é™¤å¤–ï¼ˆã‚³ãƒ«ãƒ¼ãƒãƒ³äº‹å¾Œæ¡ä»¶ã«ãŠã‘ã‚‹å¼•æ•°å‚ç…§ã®ç¦æ­¢ï¼‰ã—ã¦ã¾ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ï¼ˆã®ç›´æ¥ã®æˆ»ã‚Šå€¤ã§ã‚ã‚‹`awaitable`å‹ï¼‰ã«å¯¾ã—ã¦äº‹å¾Œæ¡ä»¶ã‚’æŒ‡å®šå¯èƒ½ã«ã™ã‚‹ã“ã¨ãŒã€äº‹å¾Œæ¡ä»¶ã®ä¸€è²«æ€§ã‚’æãªã†ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’ä¸Šå›ã‚‹ã‹ã©ã†ã‹ã¯è¦æ¤œè¨ã§ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒŠãƒ¼ã‚±ãƒ¼ã‚¹ã‚’å›é¿ã—ã¦ä¸€è²«æ€§ã®ãŸã‚ã«ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã‚’ç¦æ­¢ã—ãŸã¨ã—ã¦ã‚‚å¤§ããªå•é¡Œã¯ãªã„ã¨æ€ã‚ã‚Œã¾ã™ã€‚

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã—ã¦äº‹å¾Œæ¡ä»¶ã®æŒ‡å®šã‚’è¨±å¯ã™ã‚‹å ´åˆã®äº‹ã‚’è€ƒãˆã¾ã™ã€‚å‰è¿°ã®ã‚ˆã†ã«ã€ãã®å ´åˆã®äº‹å¾Œæ¡ä»¶ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒä¸­æ–­ã—ãŸæ™‚ç‚¹ã§ã®çŠ¶æ…‹ã«å¯¾ã™ã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚ã—ã‹ã—ã“ã®å ´åˆã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ã¾ã å®Ÿè¡Œã‚’é–‹å§‹ã—ã¦ã•ãˆã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã®ã‚ˆã†ãªçŠ¶æ…‹ã«ã¤ã„ã¦ã‚¢ã‚µãƒ¼ãƒˆã§ãã‚‹ã“ã¨ã¯ã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ã€‚

ã—ã‹ã—ã€ãã®ã‚ˆã†ãªç‰©ç†çš„ãªã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã¯ãªãã€è«–ç†çš„ãªã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¦‹ãŸæ™‚ã«ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã¨ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒç”Ÿæˆãƒ»ã¾ãŸã¯è¿”ã™å€¤ï¼ˆã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ç›´æ¥ã®æˆ»ã‚Šå€¤ã§ã¯ãªã„ï¼‰ã«å¯¾ã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ã®ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœŸå¾…ã¨åˆã£ã¦ãŠã‚Šæœ›ã¾ã—ã„ã§ã—ã‚‡ã†ã€‚ãŸã ã—ã“ã‚Œã¯ã€å¥‘ç´„æ³¨é‡ˆãŒã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã‚ã‚‹ã“ã¨ã‚’ã»ã®ã‚ã‹ã™ã“ã¨ãªãã€é–¢æ•°ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã‚ˆã£ã¦è‡ªç„¶ã«ä¼æ’­ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã®æŒ‡å®šã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒç›´æ¥è¿”ã™å€¤ã«å¯¾ã—ã¦é©ç”¨ã™ã‚‹ã®ã§ã¯ãªãã€ãã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®`awaitable`å‹ã¨`promise`å‹ã«å¯¾ã—ã¦é©ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®`promise`å‹ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆä¸Šã«å­˜åœ¨ã—ã¦å‘¼ã³å‡ºã—å´ã¨ã‚³ãƒ«ãƒ¼ãƒãƒ³å´ã‚’ã¤ãªãå½¹å‰²ã‚’æŒã£ã¦ã„ã¾ã™ã€‚`promise`å‹ã®`yield_value()`ï¼ˆ`co_yield`ã«å¯¾ã—ã¦å‘¼ã°ã‚Œã‚‹ï¼‰ã¨`return_value()`ï¼ˆ`co_return`ã«å¯¾ã—ã¦å‘¼ã°ã‚Œã‚‹ï¼‰ã¯ã€ç”Ÿæˆ/è¿”ã•ã‚Œã‚‹å€¤ã‚’å—ã‘å–ã£ã¦ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã‚’äº‹å‰æ¡ä»¶ã¨ã—ã¦ãã®å€¤ã«å¯¾ã—ã¦é©ç”¨ã™ã‚‹ã“ã¨ã®ã§ãã‚‹ç†æƒ³çš„ãªå ´æ‰€ã«ä½ç½®ã—ã¦ã„ã¾ã™ã€‚ä¸€æ–¹ã€`awaitable`ãªå‹ã®`await_resume`ãªã©ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã‚’ãã®ã¾ã¾è‡ªèº«ã®äº‹å¾Œæ¡ä»¶ã¨ã—ã¦æŒãŸã•ã‚‰ã‚Œã‚‹å ´æ‰€ã«ä½ç½®ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã“ã‚Œã‚‰ã®é–¢æ•°ã«ã¯ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ã«ãŠã„ã¦ã‚‚å¥‘ç´„æ³¨é‡ˆã‚’åˆ¶é™ãªãè¡Œãˆã‚‹ãŸã‚ã€ã“ã®ãŸã‚ã«ç‰¹åˆ¥ãªè¦å®šã‚’å¢—ã‚„ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ç”Ÿæˆ/è¿”ã™å€¤ã«å¯¾ã™ã‚‹æ¡ä»¶ã¨æŒ‡å®šã•ã‚ŒãŸï¼ˆã¨åˆ†ã‹ã£ã¦ã„ã‚‹ï¼‰ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã®æ³¨é‡ˆã‚’ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®è¿”ã™ç›´æ¥ã®æˆ»ã‚Šå€¤å‹ï¼ˆ`awaitable`ï¼‰ã®ä¸€éƒ¨ï¼ˆãã®ãƒ¡ãƒ³ãƒé–¢æ•°ã«å¯¾ã™ã‚‹ã‚‚ã®ï¼‰ã¨ã—ã¦æ‰±ã†äº‹ã§ã™ã€‚ä¾‹ãˆã°ä½•ã‹ã—ãƒ©ãƒƒãƒ—ã‚’è¡Œã†å‹ã‚’ç”¨æ„ã™ã‚‹ãªã©ã®æ–¹æ³•ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ãŒã€ã“ã‚Œã‚’è¨±å¯ã™ã‚‹ãŸã‚ã«ç¾åœ¨ã®è¦å®šã‚’å¼„ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆãã“ã¯å®Ÿè£…è©³ç´°ãªã®ã§ï¼‰ã€‚

ç¾åœ¨ã®ï¼ˆãã—ã¦ãŠãã‚‰ãC++26ã®ï¼‰å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ã«å¯¾ã—ã¦å¤‰æ›´ãŒå¿…è¦ãªã®ã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã‚ã‚‹é–¢æ•°ã«å¯¾ã™ã‚‹äº‹å‰ãƒ»äº‹å¾Œæ¡ä»¶ã®å¥‘ç´„æ³¨é‡ˆã‚’ç¦æ­¢ã—ã¦ã„ã‚‹æ–‡è¨€ã«å¯¾ã—ã¦ã ã‘ã§ã™ã€‚ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã¯ä¸Šè¨˜ã®ã‚ˆã†ã«è¤‡é›‘ã«ãªã‚Šä»–ã®é–¢æ•°ã¨å°‘ã—ç•°ãªã£ã¦ã—ã¾ã†ãŸã‚æœ‰ç”¨ã‹ã©ã†ã‹ã¯ä¸æ˜ã§ã™ãŒã€äº‹å‰æ¡ä»¶æŒ‡å®šã«é–¢ã—ã¦ã¯é–“é•ã„ãªãå½¹ã«ç«‹ã¤ã¯ãšã€ã¨ä¸»å¼µã—ã¦ã„ã¾ã™ã€‚

çµå±€ã“ã®ææ¡ˆã§ã¯

- ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å‰æ¡ä»¶ï¼ˆã¨äº‹å¾Œæ¡ä»¶ï¼‰ã®å¥‘ç´„æ³¨é‡ˆã‚’è¨±å¯ã™ã‚‹
- ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å‰æ¡ä»¶ï¼ˆã¨äº‹å¾Œæ¡ä»¶ï¼‰ã¯ã€`promise`å‹ï¼ˆãŠã‚ˆã³`awaitable`å‹ï¼‰ã®  äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã¨ã—ã¦æ‰±ã†ã‚ˆã†ã«ã™ã‚‹

ã®2ã¤ã®äº‹ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

- [P2957R0 Contracts and coroutines - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´08æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/14/223052#P2957R0-Contracts-and-coroutines)
- [P3251 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1912)

### [P3253R0 Distinguishing between member and free coroutines](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3253r0.html)

åŒã˜ã‚·ã‚°ãƒãƒãƒ£ã‚’æŒã¤ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’åŒºåˆ¥ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ãƒ—ãƒ­ãƒŸã‚¹å‹ã¯`std::coroutine_traits<>`ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®æˆ»ã‚Šå€¤å‹åŠã³å‘¼ã³å‡ºã—æ™‚ã®å¼•æ•°å‹ã‚’å…¥ã‚Œã¦ç‰¹æ®ŠåŒ–ã—ãŸã‚‚ã®ï¼ˆ`std::coroutine_traits<R, Args...>`ï¼‰ãŒä½¿ç”¨ã•ã‚Œã€ãã‚Œã«å¯¾å¿œã™ã‚‹ã‚‚ã®ã‚’ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠãã¨ï¼ˆã™ãªã‚ã¡ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³æˆ»ã‚Šå€¤å‹ã«å¯¾ã—ã¦ç‰¹æ®ŠåŒ–ã—ã¦ãŠã‘ã°ï¼‰ã€ãã®ãƒ¡ãƒ³ãƒå‹ï¼ˆ`std::coroutine_traits<R, Args...>::promise_type`ï¼‰ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒŸã‚¹å‹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚

ã¨ã“ã‚ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦ã‚‚å®šç¾©ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚Šã€ãƒ¡ãƒ³ãƒé–¢æ•°ã¯æœ€åˆã®å¼•æ•°ã«æš—é»™ã«`this`å¼•æ•°ã‚’å—ã‘ã¦ãŠã‚Šã€ãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³ã®å ´åˆ`std::coroutine_traits<R, Args...>`ã®`Args`ã®æœ€åˆã«ã¯æš—é»™ã®`this`å¼•æ•°ã«å¯¾å¿œã™ã‚‹å‹ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚

ã“ã®ãŸã‚ã€åŒã˜æˆ»ã‚Šå€¤å‹ã‚’å…±æœ‰ã™ã‚‹ãƒ¡ãƒ³ãƒé–¢æ•°ã¨éãƒ¡ãƒ³ãƒé–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã€éãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³ã®æ–¹ãŒãƒ¡ãƒ³ãƒé–¢æ•°ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®å±ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’æœ€åˆã®å¼•æ•°ã«å–ã‚‹å ´åˆã€`coroutine_traits`ã‹ã‚‰ãã®åŒºåˆ¥ãŒã¤ã‹ãªããªã‚Šã¾ã™ã€‚

```cpp
struct S {
  // ãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³
  R member_coro1(int x, std::string y) const;
  R member_coro2(const S&, int x, std::string y) const;
};

// ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³
R free_coro(const S&, int x, std::string y);
```

ã“ã®`member_coro1()`ã¨`free_coro()`ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ã€ãƒ—ãƒ­ãƒŸã‚¹å‹ã®å°å‡ºã®ãŸã‚ã«`std::coroutine_traits`ã®ç‰¹æ®ŠåŒ–ã‚’ã€`std::coroutine_traits<R, const S&, int, std::string>`ã¨ã—ã¦ã‚¯ã‚¨ãƒªã—ã¾ã™ã€‚ã“ã‚Œã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³æˆ»ã‚Šå€¤å‹`R`ã‹ã‚‰è¦‹ã‚‹ã¨`member_coro1()`ã¨`free_coro()`ã‚’åŒºåˆ¥ã™ã‚‹ã“ã¨ãŒã§ããšã€ã“ã®2ã¤ã®é–¢æ•°ã¯åŒã˜ãƒ—ãƒ­ãƒŸã‚¹å‹ã‚’å–å¾—ã—ã¾ã™ã€‚

ã“ã®ã‚ˆã†ãª`R`ã«ã¯ä¾‹ãˆã°`std::generator`ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ã“ã¨ãŒå•é¡Œã¨ãªã‚‹ã®ã¯ã€`std::generator`ã®ã‚ˆã†ã«ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ã«ã—ã‚ˆã†ã¨ã™ã‚‹å ´åˆã§ã™ã€‚

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ã®ç¢ºä¿ã®ãŸã‚ã«å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿ã‚’è¡Œã„ã¾ã™ãŒã€ã“ã‚Œã¯ã¾ãšãƒ—ãƒ­ãƒŸã‚¹å‹ã®ã‚¹ã‚³ãƒ¼ãƒ—ã§`operator new()`ãŒæ¢ç´¢ã•ã‚Œã¾ã™ã€‚ã™ãªã‚ã¡ã€ãƒ—ãƒ­ãƒŸã‚¹å‹ã§`operator new()`ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿æ–¹æ³•ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã€`std::generator`ã§ã¯3ç•ªç›®ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨åˆã‚ã›ã¦ä»»æ„ã®ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®`operator new()`ã®æ¢ç´¢ã¯ã€`promise_type::operator new(std::size_t, Args...)`ã®æ§˜ãªã‚·ã‚°ãƒãƒãƒ£ã§è¡Œã‚ã‚Œã€å¾ŒåŠã®å¼•æ•°ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³å¼•æ•°ãŒãã®é †ç•ªã®ã¾ã¾æ¸¡ã•ã‚Œã¾ã™ã€‚

`std::generator<T, V, Alloc>`ã®å ´åˆã€æœ€ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¨ã—ã¦3ç•ªç›®ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿å‹ã‚’æŒ‡å®šã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã€ã“ã®å ´åˆã«ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã™ã‚‹ãŸã‚ã«ã¯`std::allocator_arg_t`ã®ã‚¿ã‚°å€¤ã®å¾Œã«ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã€ã“ã‚Œã‚’ã‚³ãƒ«ãƒ¼ãƒãƒ³å¼•æ•°åˆ—ã®å…ˆé ­ã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```cpp
using Generator = std::generator<int, void, std::pmr::polymorphic_allocator<>>;

struct S {
  // ãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚ã†ã¨ã—ã¦ã„ã‚‹
  Generator member_coro1(std::allocator_arg_t,
                         std::pmr::polymorphic_allocator<> alloc,
                         int x) const;
};

// ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³1ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
Generator free_coro1(std::allocator_arg_t,
                     std::pmr::polymorphic_allocator<> alloc,
                     int x);

// ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³2ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚ã†ã¨ã—ã¦ã„ã‚‹
Generator free_coro2(const S&,
                     std::allocator_arg_t,
                     std::pmr::polymorphic_allocator<> alloc,
                     int x);
                     
// ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³3ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚ã†ã¨ã—ã¦ã„ã‚‹
Generator free_coro3(const S&,
                     const std::vector<int>&,
                     std::allocator_arg_t,
                     std::pmr::polymorphic_allocator<> alloc,
                     int x);
```

ã±ã£ã¨è¦‹ã‚‹ã¨ã€`member_coro1()`ã¨`free_coro1()`ã¯æ­£ã—ãã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’è¡Œãˆã¦ãŠã‚Šã€æ¸¡ã—ãŸã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ãŒä½¿ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚ä¸€æ–¹ã§ã€`free_coro2()`ã¨`free_coro3()`ã¯æ¸¡ã™å¼•æ•°é †ãŒé–“é•ã£ã¦ã„ã‚‹ï¼ˆ`std::allocator_arg_t`ãŒ2ç•ªç›®ä»¥é™ã®å¼•æ•°ã§æ¸¡ã•ã‚Œã¦ã„ã‚‹ï¼‰ãŸã‚ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¯ä¸Šæ‰‹ãã„ã‹ãªã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

å®Ÿéš›ã«ã¯ã€`member_coro1()`ã¨`free_coro1()`ã€ãã—ã¦`free_coro2()`ã¯æ¸¡ã•ã‚ŒãŸã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™ãŒã€`free_coro3()`ã§ã¯ä½¿ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã€`member_coro1()`ã®æ¸¡ã—æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®å‰¯ä½œç”¨ã§ã™ã€‚

å‰è¿°ã®ã‚ˆã†ã«ã€`member_coro1()`ã¨`free_coro2()`ã§ã¯åŒã˜ãƒ—ãƒ­ãƒŸã‚¹å‹ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã™ãªã‚ã¡ã€ã“ã®2ã¤ã®é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã¯ãƒ—ãƒ­ãƒŸã‚¹å‹ã‹ã‚‰è¦‹ã‚‹ã¨åŒã˜ã§ã™ï¼ˆ`std::coroutine_traits<Generator, const S&, std::allocator_arg_t, std::pmr::polymorphic_allocator<>, int>::promise_type`ï¼‰ã€‚ã—ãŸãŒã£ã¦ã€æ¢ç´¢ã•ã‚Œã‚‹`new`æ¼”ç®—å­ã®ã‚·ã‚°ãƒãƒãƒ£ã¯`promise_type::operator new(std::size_t, const S&, std::allocator_arg_t, std::pmr::polymorphic_allocator<>, int)`ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯`std::allocator_arg_t`ãŒç¬¬ä¸€å¼•æ•°ã«ã‚ãŸã£ã¦ã„ãªã„ãŸã‚æœ¬æ¥ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯¾è±¡ã§ã¯ãªã„ï¼ˆæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ã«ãŠã‘ã‚‹uses-allocator constructionã¨ä¸€è²«ã—ã¦ã„ãªã„ï¼‰ã®ã§ã™ãŒã€`std::generator`ãŒã“ã®å•é¡Œã‚’è€ƒæ…®ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã‚’ç‰¹åˆ¥æ‰±ã„ã—ã¦ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã«ã“ã®ã‚·ã‚°ãƒãƒãƒ£ã§ã‚‚`operator new()`ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’ç”¨æ„ã—ã¦ãŠã‚Šã€ãã‚Œã«ã‚ˆã£ã¦ã‚«ã‚¹ã‚¿ãƒ ã®`new`æ¼”ç®—å­ãŒå‘¼ã°ã‚Œã¦ãã®ä¸­ã§æ¸¡ã•ã‚ŒãŸã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ã“ã®ç‰¹åˆ¥æ‰±ã„ã¯`member_coro1()`ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ãŒã€`member_coro1()`ã¨`free_coro2()`ã§ã¯åŒã˜ãƒ—ãƒ­ãƒŸã‚¹å‹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€`free_coro2()`ã«å¯¾ã—ã¦ã‚‚ä½¿ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€æ„å›³ã›ãšã«`free_coro2()`ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚å°å‡ºã•ã‚Œã‚‹ãƒ—ãƒ­ãƒŸã‚¹å‹ãŒåŒä¸€ã«ãªã‚‹ãŸã‚ã€`member_coro1()`ã ã‘ã‚’å—ã‘å…¥ã‚Œã¦`free_coro2()`ã‚’å¼¾ãã¨ã„ã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

ã“ã®å•é¡Œã®ãŸã‚ã«ã€`std::generator`ã®ã‚ˆã†ãªã‚³ãƒ«ãƒ¼ãƒãƒ³æˆ»ã‚Šå€¤å‹ã®åˆ¶ä½œè€…ã¯ã€`free_coro1()`ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ï¼ˆã“ã‚Œã¯å…¨ãæ­£å½“ãªã‚‚ã®ï¼‰ãŸã‚ã«`std::size_t, std::allocator_arg_t, Alloc`ã®ã‚ˆã†ã«3ç•ªç›®ã®å¼•æ•°ã§ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹`operator new`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¨ã€`member_coro1()`ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã«`std::size_t, const S&, std::allocator_arg_t, Alloc`ã®ã‚ˆã†ã«4ç•ªç›®ã®å¼•æ•°ã§ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹`operator new`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã®2ç¨®é¡ã‚’ç”¨æ„ã—ãªã‘ã‚Œã°ãªã‚‰ãªããªã‚Šã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã£ã¦ã€ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿å¼•æ•°ã«é–¢ã—ã¦ãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³ã¨ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®é–“ã€ã¾ãŸ`std::generator`ï¼ˆåŠã³åŒç¨®ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³æˆ»ã‚Šå€¤å‹ï¼‰ã¨ä»–ã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã®é–“ã§ã€ä¸å¿…è¦ãªçŸ›ç›¾ãŒç”Ÿã˜ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã“ã®å•é¡Œã®è§£æ±ºã®ãŸã‚ã«ã€æœ€åˆã®ãƒ—ãƒ­ãƒŸã‚¹å‹ã®æ¢ç´¢éç¨‹ã‚’ä¿®æ­£ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ãƒ¡ãƒ³ãƒé–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒ`std::coroutine_traits`ã‹ã‚‰ãƒ¡ãƒ³ãƒå‹ã¨ã—ã¦ãƒ—ãƒ­ãƒŸã‚¹å‹ã‚’å–å¾—ã™ã‚‹å ´åˆã€ã¾ãšæœ€åˆã«`std::coroutine_traits<R, Args...>::promise_type_for_nonstatic_member`ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãªã‚‰ã“ã‚Œã‚’ãƒ—ãƒ­ãƒŸã‚¹å‹ã¨ã—ã¦ä½¿ç”¨ã—ã€å®šç¾©ã•ã‚Œã¦ã„ãªã„å ´åˆã¯å¾“æ¥é€šã‚Š`std::coroutine_traits<R, Args...>::promise_type`ã‚’ä½¿ç”¨ã™ã‚‹ã€ã¨ã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

ãƒ—ãƒ­ãƒŸã‚¹å‹ã®å®šç¾©æ–¹æ³•åŠã³ãã®å¾Œã®çµŒè·¯ã«é–¢ã—ã¦ã¯ä¸€åˆ‡å¤‰æ›´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®å…¥ã‚Œå¾Œã®`promise_type_for_nonstatic_member`å‹ã¨ã—ã¦æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ãƒŸã‚¹å‹ã‹ã‚‰ã¯ã€ãã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ãŸã‚ã€ã“ã“ã ã‘ã§4ç•ªç›®ã®å¼•æ•°ã§ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹`operator new`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’ç”¨æ„ã™ã‚Œã°ãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã—ã¦ã‚‚ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’æä¾›ã§ãã¾ã™ã€‚ãªãŠã‹ã¤ã€`promise_type_for_nonstatic_member`ãŒãƒ—ãƒ­ãƒŸã‚¹å‹ã¨ã—ã¦å–å¾—ã•ã‚Œã‚‹ã®ã¯éé™çš„ãƒ¡ãƒ³ãƒã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‹ã‚‰ã ã‘ãªã®ã§ã€ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒå­ã®ãƒ—ãƒ­ãƒŸã‚¹å‹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€å…ˆç¨‹ã®ä¾‹ã®`member_coro1()`ã¨`free_coro1()`ã®æ¸¡ã—æ–¹ã ã‘ãŒæœ‰åŠ¹ã§ï¼ˆã‚µãƒãƒ¼ãƒˆã•ã‚Œï¼‰ã€`free_coro2()`ï¼ˆåŠã³`free_coro3()`ï¼‰ã®æ¸¡ã—æ–¹ã¯æœ‰åŠ¹ã§ã¯ãªã„ï¼ˆã‚µãƒãƒ¼ãƒˆå¤–ï¼‰ã¨ã„ã†å¼åˆ¥ãŒå¯èƒ½ã«ãªã‚Šã€å•é¡Œã«ãªã£ã¦ã„ãŸéä¸€è²«æ€§ãŒè§£æ¶ˆã•ã‚Œã¾ã™ã€‚

ã“ã®æ–¹æ³•ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«`std::coroutine_traits`ã®ç‰¹æ®ŠåŒ–ã«`promise_type_for_nonstatic_member`ã‚’å®šç¾©ã—ãªã„é™ã‚Šã€ç¾åœ¨ã®å‹•ä½œãŒæãªã‚ã‚Œã‚‹ã“ã¨ã¯ãªãã€ä¸‹ä½äº’æ›æ€§ã‚’æ‹…ä¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€EWGã®åˆæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å¥½ã¾ã‚Œãªã‹ã£ãŸã‚ˆã†ã§ã€å¦æ±ºã•ã‚Œã¦ã„ã¾ã™ã€‚

- [C++20 ã‚³ãƒ«ãƒ¼ãƒãƒ³ - cpprefjp](https://cpprefjp.github.io/lang/cpp20/coroutines.html)
- [P3253 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1912)

### [P3254R0 Reserve identifiers preceded by @ for non-ignorable annotation tokens](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3254r0.html)

`@`ã‹ã‚‰å§‹ã¾ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³åˆ—ã‚’äºˆç´„ã—ã¦ãŠãææ¡ˆã€‚

C++23ã§ã¯P2558ã®æ¡æŠã«ã‚ˆã£ã¦`@`ãŒåŸºæœ¬ã‚½ãƒ¼ã‚¹æ–‡å­—é›†åˆï¼ˆè¨€èªã®æ§‹æ–‡ã‚’è¨˜è¿°ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹æ–‡å­—ã®é›†åˆï¼‰ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€å°†æ¥ã®C++ã§ã¯`@`ã‚’ä½•ã‹ã—ã‚‰ã®è¨€èªæ©Ÿèƒ½ã®ãŸã‚ã®æ§‹æ–‡ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãã®ã‚ˆã†ãªè¨€èªæ©Ÿèƒ½ã¯ç¾åœ¨å­˜åœ¨ã—ã¦ã„ã¾ã›ã‚“ãŒã€ã“ã®ææ¡ˆã¯ã€`@`ã‹ã‚‰å§‹ã¾ã‚‹æ–‡å­—åˆ—ã‚’å°†æ¥çš„ã«ç„¡è¦–ã§ããªã„æ³¨é‡ˆã«ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã€å®Ÿè³ªçš„ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½¿ç”¨ã§ããªã„ã‚ˆã†ã«ã—ã¦ãŠãææ¡ˆã§ã™ã€‚

ç¾åœ¨ã®C++ã®å±æ€§ã¯ç„¡è¦–ã§ãã‚‹ã¨ã„ã†æ€§è³ªã‚’æŒã¤ãŸã‚ã€ä½•ã‹æ³¨é‡ˆã‚’è¡Œã†ã®ã«å¿…ãšã—ã‚‚æœ€é©ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å±æ€§ã¯ç‹¬ç«‹ã—ãŸæ§‹æ–‡ç©ºé–“ã‚’æŒã¤ãŸã‚ãã®ä¸­ã§ä½¿ç”¨ã™ã‚‹åå‰ã¯æ—¢ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ç”¨ã—ã¦ã„ã‚‹ã‚‚ã®ã¨è¡çªã™ã‚‹å¿ƒé…ãŒãªã„ã¨ã„ã†åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ãŒã€ä½•ã‹æ–°ã—ã„è¨€èªæ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹å ´åˆã«ç„¡è¦–å¯èƒ½ã¨ã„ã†æ€§è³ªãŒæœ›ã¾ã—ããªãã€å¿…ãšã—ã‚‚æ–°ã—ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®è¿½åŠ ã‚„æ—¢å­˜ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä½¿ã„ã¾ã‚ã—ã‚’å›é¿ã§ãã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

`@`ã‚’ä½¿ç”¨ã—ãŸã‚‚ã®ã¨ã—ã¦æœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒªãƒ†ãƒ©ãƒ«ä»¥å¤–ã«ãªãã€`@~`ã®ã‚ˆã†ã«`@`ã‹ã‚‰å§‹ã¾ã‚‹æ–‡å­—åˆ—ã‚’ä½•ã‹ã—ã‚‰ã®æ³¨é‡ˆã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ä»–ã®è¨€èªã§ã‚‚å‰ä¾‹ãŒã‚ã‚Šã¾ã™ã€‚ãã®å…·ä½“çš„ãªææ¡ˆã®æ¤œè¨ã¯ã“ã“ã§ã¯ã—ã¦ã„ã¾ã›ã‚“ãŒã€å°†æ¥ã®ãã†ã—ãŸæ©Ÿèƒ½ã®ãŸã‚ã«ã“ã®æ§‹æ–‡ç©ºé–“ã‚’äºˆç´„ã—ã¦ãŠãã“ã¨ãŒã“ã®ææ¡ˆã®ç›®çš„ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ãã®ã‚ˆã†ãªæ³¨é‡ˆã®æƒ³å®šã•ã‚Œã‚‹ä¾‹ã¨ã—ã¦ã„ãã¤ã‹ã®ã‚‚ã®ã‚’ã‚ã’ã¦ã„ã¾ã™

- å¥‘ç´„æ³¨é‡ˆ
    - `@pre(x > 0)`ã‚„`@assert(x > 0)`ã®æ§˜ãªæ³¨é‡ˆ
- ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
    - ã‚¯ãƒ©ã‚¹ã«å¯¾ã™ã‚‹`@trivially_relocatable`ã®ã‚ˆã†ãªæ³¨é‡ˆã«ã‚ˆã£ã¦ã€ã‚¯ãƒ©ã‚¹å‹ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’è¡¨æ˜ã™ã‚‹
- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ³¨é‡ˆ
    - P2816ã§è¿°ã¹ã‚‰ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šã‚’`@enable(ranges)`ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
- `[[no_unique_address]]`ã®ç½®ãæ›ãˆ
    - `[[no_unique_address]]`ã¯å®Ÿéš›ã«ã¯ç„¡è¦–ã§ãã‚‹å±æ€§ã§ã¯ãªã‹ã£ãŸãŸã‚ã€éæ¨å¥¨ã«ã—ã¦`@no_unique_address`ã«ç½®ãæ›ãˆã‚‹

ã“ã®ææ¡ˆã§ã¯ã€`@~`ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å˜ã«äºˆç´„ã™ã‚‹ã¨ã„ã†æ–‡ç« ã«ã‚ˆã£ã¦æŒ‡å®šã™ã‚‹ã ã‘ã§ã¯ãªãã€1ã¤ã®ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚·ãƒ³ã‚°ãƒˆãƒ¼ã‚¯ãƒ³ã«ã—ã¦ãŠãã“ã¨ã‚‚ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€`@~`ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒç¾åœ¨2ã¤ã®ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚·ãƒ³ã‚°ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã§ã™ã€‚ã“ã‚ŒãŒç„¡ã„ã¨ã€ä¾‹ãˆã°`@assert(expr)`ã®ã‚ˆã†ãªæ³¨é‡ˆã‚’å°å…¥ã—ã¦ã‚‚ã€`assert(expr)`ãƒã‚¯ãƒ­ã®å±•é–‹ã‚’å¦¨ã’ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚åŒæ§˜ã«ã€ä»–ã®`@~`ãƒˆãƒ¼ã‚¯ãƒ³ã§ã‚‚å…ˆé ­ã®`@`ã‚’é™¤ã„ãŸéƒ¨åˆ†ã®æ–‡å­—åˆ—ãŒã™ã§ã«ãƒã‚¯ãƒ­ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã«ãã®ãƒã‚¯ãƒ­ã®å±•é–‹ã‚’é˜²æ­¢ã™ã‚‹ã“ã¨ãŒã§ããšã€ã“ã‚Œã ã¨äºˆç´„ã—ã¦ãŠãæ„å‘³ãŒã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ã€‚

ãã®ãŸã‚ã€`@~`ã‚’1ã¤ã®ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚·ãƒ³ã‚°ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦ãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹æ™‚ã«æ‰±ã£ã¦ãŠãã“ã¨ã§ã€å°†æ¥çš„ã«`@~`ã‚’ä½¿ã£ãŸæ³¨é‡ˆã‚’å°å…¥ã™ã‚‹æ™‚ã®å•é¡Œã‚’ã‚ã‚‰ã‹ã˜ã‚å–ã‚Šé™¤ã„ã¦ãŠãã“ã¨ãŒã§ãã¾ã™ã€‚

- [P2558R2 Add @, $, and ` to the basic character set - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/03/19/184146#P2558R2-Add---and--to-the-basic-character-set)
- [P3254 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1914)

### [P3255R0 Expose whether atomic notifying operations are lock-free](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3255r0.html)

`std::atomic`ã®é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ãŒãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã¨ã¯é™ã‚‰ãªã„å ´åˆãŒã‚ã‚‹å•é¡Œã«ã¤ã„ã¦ä¿®æ­£ã™ã‚‹ææ¡ˆã€‚

`std::atomic`ï¼ˆä»¥ä¸‹`std::atomic_flag`ãŠã‚ˆã³`std::atomic_ref`ã‚’å«ã‚€ï¼‰ã«å¯¾ã—ã¦C++20ã§è¿½åŠ ã•ã‚ŒãŸé€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ï¼ˆ`.wait()`ã€`.notify_~()`ï¼‰ã«å¯¾ã—ã¦ã¯ã€ãã®å‹ãã®ã‚‚ã®ã«å¯¾ã—ã¦ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã§ã‚ã‚‹ã¨æŒ‡å®šã•ã‚Œã‚‹å ´åˆã«ï¼ˆ`std::atomic_flag`ã®å ´åˆã«å¸¸ã«ï¼‰å½“ç„¶ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã§ã‚ã‚Šã€ã‚·ã‚°ãƒŠãƒ«ã‚»ãƒ¼ãƒ•ã§ã‚ã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚

ã—ã‹ã—å®Ÿéš›ã«ã¯ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã§ã¯ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šãã®å ´åˆã‚·ã‚°ãƒŠãƒ«ã‚»ãƒ¼ãƒ•ã§ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚`.wait()`é–¢æ•°ã¯ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ãŸã‚æ˜ã‚‰ã‹ã§ã™ãŒã€é€šçŸ¥é–¢æ•°ã«ã¤ã„ã¦ã‚‚ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ãªå®Ÿè£…ã‚’å–ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã®ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚ºã‚„ç’°å¢ƒã«ã‚ˆã£ã¦ã¯ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã¨ãªã‚‰ãªã„å ´åˆãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

ã“ã‚Œã‚‰ã®å•é¡Œã®è§£æ±ºã®ãŸã‚ã€ã“ã®ææ¡ˆã§ã¯æ¬¡ã®äº‹ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

- `std::atomic_flag`ã®é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ã¯ã€ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã§ã‚ã‚‹å¿…è¦ãŒç„¡ã„ã“ã¨ãŒæ˜ç¢ºã«ãªã‚‹ã‚ˆã†ã«è¦å®šã‚’ä¿®æ­£
- `std::atomic`ã®`is_lock_free`ã€`is_always_lock_free`ã€`std::atomic_is_lock_free`ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã‚¢ãƒˆãƒŸãƒƒã‚¯ã®é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ã«é–¢ã—ã¦ã®ã‚‚ã®ã§ã¯ãªã„ã“ã¨ã‚’æ˜ç¢ºã«ãªã‚‹ã‚ˆã†ã«è¦å®šã‚’ä¿®æ­£
    - ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ç¯„å›²ã‹ã‚‰ã€é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ã‚’é™¤å¤–ã™ã‚‹
- `std::atomic_flag`ã€`std::atomic`ã€`std::atomic_ref`ã«ãƒ¡ãƒ³ãƒé–¢æ•°`.notify_is_lock_free()`ã¨ãƒ•ãƒªãƒ¼é–¢æ•°ã®`std::atomic_notify_is_lock_free`ã€ãŠã‚ˆã³ãƒ¡ãƒ³ãƒå®šæ•°ã®`notify_is_always_lock_free`ã‚’è¿½åŠ ã—ã€ã‚¢ãƒˆãƒŸãƒƒã‚¯ã®é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ãŒãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã‹ã©ã†ã‹ã¯ãã‚Œã‚‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒè¡¨æ˜ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹

ã“ã‚Œã«ã‚ˆã£ã¦ã€é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ãŒãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ï¼ˆã§ã‚ã‚Šã‚·ã‚°ãƒŠãƒ«ã‚»ãƒ¼ãƒ•ï¼‰ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’æ­£ã—ãåˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

- [P3251 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1912)

### [P3257R0 Make the predicate of `contract_assert` more regular](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3257r0.html)

å¥‘ç´„æ³¨é‡ˆã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹å¤‰æ•°ã®æš—é»™`const`åŒ–ã‚’ã€`contract_assert`ã§ã¯ç·©å’Œã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ã§ã¯P3071ã®æ¡æŠã«ã‚ˆã£ã¦ã€å¥‘ç´„æ³¨é‡ˆå†…ã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ãƒ»é–¢æ•°å¼•æ•°ã‚’å‚ç…§ã™ã‚‹ã¨ã€ãã‚Œã¯æš—é»™çš„ã«`const`ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚ã“ã‚Œã¯`const`ãƒ¡ãƒ³ãƒé–¢æ•°ã®ãƒ¡ãƒ³ãƒå¤‰æ•°ã«å¯¾ã™ã‚‹å‹•ä½œã«ä¼¼ã¦ãŠã‚Šã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã®çµæœãŒå¤‰åŒ–ã—ãŸã‚Šã€`map[key]`ã®ã‚ˆã†ã«ä¸€éƒ¨ã®å¼ãŒã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸã‚Šã™ã‚‹ã“ã¨ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€`contract_assert()`ã®å†…å¤–ã§åŒã˜å¼ã«å¯¾ã™ã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«çµæœãŒæ˜ç¢ºã«å¤‰åŒ–ã—ã¾ã™

```cpp
void f() {
  int i = 0;
  if (++i < 5) { ... }        // OK
  contract_assert(++i < 5);   // P2900R6: ill-formedã€ã“ã®ææ¡ˆ: well-formed
}
```

ã“ã®ã‚ˆã†ã«ã€åŒã˜ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒè¿‘å‚ã«å‡ºç¾ã—ã¦ã„ã¦ã‚‚åŒã˜ã‚ˆã†ã«å‹•ä½œã›ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœŸå¾…ã«åã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãŸã ã—ã€ã“ã®ã“ã¨ã¯äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã«ã¯å½“ã¦ã¯ã¾ã‚Šã¾ã›ã‚“ï¼ˆå®£è¨€ã§å‡ºç¾ã—ã€å®šç¾©ã‹ã‚‰é›¢ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ãŸã‚ï¼‰ã€‚

```cpp
void h(int x, int y)
  pre(x > 0)       // ok
  pre(y < 0)       // ok
  pre(++x < 42);   // ill-formed
```

åˆ¥ã®å•é¡Œã¨ã—ã¦ã€å¥‘ç´„æ¡ä»¶ã®è©•ä¾¡ç•°æ•°ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ç¾åœ¨ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹`assert`ãƒã‚¯ãƒ­ã«ã‚ˆã‚‹æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã¯ã€å˜ç´”ã«ã¯`contract_assert()`ã§ç½®ãæ›ãˆã‚‰ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```cpp
  void f() {
#ifndef NDEBUG
    int iter = 0;
#endif
    while (/* something */) {
      assert(++iter < 6);   // 6å›ä»¥ä¸Šç¹°ã‚Šè¿”ã•ã‚ŒãŸã‚‰ãƒã‚°
      // ...		  
    }
  }
```

ã“ã®`iter`å¤‰æ•°ã®å®£è¨€ã‚’åŒæ§˜ã«ã‚¬ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•ãŒç„¡ã„ã®ã‚‚ãã†ã§ã™ãŒã€ä¸€ç•ªã®å•é¡Œã¯`contract_assert`ã«æŒ‡å®šã•ã‚ŒãŸè¿°èªãŒç„¡åˆ¶é™ã«è©•ä¾¡ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚

`assert`ãƒã‚¯ãƒ­ã‹ã‚‰ã®ç§»è¡Œã®å•é¡Œã§ã‚ã‚‹ãŸã‚ã€ã“ã‚Œã«ã¤ã„ã¦ã‚‚`contract_assert`ã ã‘ãŒå¯¾è±¡ã§ã™ã€‚

ã“ã‚Œã‚‰ã®å•é¡Œã®è§£æ±ºã®ãŸã‚ã«ã€ã“ã®ææ¡ˆã¯æ¬¡ã®äº‹ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

- `contract_assert`ã§ã¯P3071ã®å¤‰æ›´ã‚’å…ƒã«æˆ»ã™
    - `contract_assert`ã®è¿°èªå†…ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹å¤‰æ•°ã®`const`æ€§ã¯å¤‰åŒ–ã—ãªã„
- ãã®å¥‘ç´„æ³¨é‡ˆãŒignoreã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒãŸãªã„å ´åˆã€`contract_assert()`ã®è¿°èªï¼ˆæ¡ä»¶å¼ï¼‰ã¯ä¸€å›ã ã‘è©•ä¾¡ã•ã‚Œã‚‹ã“ã¨ã‚’è¦å®š

ã“ã‚Œã«ã‚ˆã£ã¦ã€`assert`ãƒã‚¯ãƒ­ã‹ã‚‰`contract_assert`ã¸ã®ç§»è¡ŒãŒã‚ˆã‚Šç°¡å˜ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã®å†…å®¹ã¯ã©ã¡ã‚‰ã‚‚å¥½ã¾ã‚Œãªã‹ã£ãŸã‚ˆã†ã§ã€SG21ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

- [P3071R1 Protection against modifications in contracts](https://onihusube.hatenablog.com/entry/2024/02/29/191439#P3071R1-Protection-against-modifications-in-contracts)
- [P3257 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1916)

### [P3258R0 Formatting `charN_t`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3258r0.pdf)

`charN_t`æ–‡å­—ãƒ»æ–‡å­—åˆ—ã‚’`std::fomart`å¯èƒ½ã«ã™ã‚‹ææ¡ˆã€‚

`charN_t`ã¨ã¯ã€`char8_t, char16_t, char32_t`å‹ã®äº‹ã§ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—å‹ã¯è¨€èªã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚µãƒãƒ¼ãƒˆã«ä¹ã—ãã€å¾®å¦™ã«ä½¿ã„ã«ãã„éƒ¨åˆ†ãŒã‚ã‚Šã¾ã—ãŸã€‚

ã“ã®ææ¡ˆã¯ãã®æ”¹å–„ã®ç¬¬ä¸€æ­©ã¨ã—ã¦ã€ã“ã‚Œã‚‰ã®ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—å‹ã«ã‚ˆã‚‹æ–‡å­—ã¨æ–‡å­—åˆ—ã‚’`std::fomrat()/std::print()`ã§ã‚µãƒãƒ¼ãƒˆã™ã‚‹ææ¡ˆã§ã™ã€‚

ææ¡ˆã§ã¯ã€`char8_t, char16_t, char32_t`ã®æ–‡å­—ã¨æ–‡å­—åˆ—ã€ãŠã‚ˆã³ã“ã‚Œã‚‰ã®æ–‡å­—ã‚’ä½¿ã£ãŸ`std::string/std::string_view`åŠã³`range`ã‚’`std::format()`ã«ã‚ˆã‚‹æ–‡å­—åˆ—åŒ–å¯¾è±¡ã«ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã¨ã—ã¦ã“ã‚Œã‚‰ã®ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—å‹ã‚’ä½¿ç”¨å¯èƒ½ã«ã™ã‚‹ã“ã¨ã¯ææ¡ˆã—ã¦ã„ã¾ã›ã‚“ã€‚å‡ºåŠ›ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯ã€ç¾åœ¨åŒæ§˜ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã®æ–‡å­—å‹ã‹ã‚‰é™çš„ã«æ±ºå®šã•ã‚Œã¾ã™ã€‚

`char`ã¨`wchar_t`ãŒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾è±¡ã§æ··åœ¨ã™ã‚‹ã®ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€ã“ã®2ã¤ã®æ–‡å­—å‹ãŒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã«`charN_t`ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹ã“ã¨ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

ç­†è€…ã®æ–¹ã¯ã€libc++ã®`std::format()`å®Ÿè£…ã§ã“ã‚Œã‚’å®Ÿè£…ã—ã¦ã‚‚å®Ÿè£…ä¸Šã®å•é¡Œã¯ã»ã¨ã‚“ã©ç™ºç”Ÿã—ãªã‹ã£ãŸã¨å ±å‘Šã—ã¦ã„ã¾ã™ã€‚

- [P3258 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1917)

### [P3259R0 const by default](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3259r0.html)

ã‚¯ãƒ©ã‚¹å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå®£è¨€æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’`const`ã«ã™ã‚‹ææ¡ˆã€‚

ã“ã®ææ¡ˆã¯ã€ä»¥å‰ã®P3218R0ã§ææ¡ˆã•ã‚Œã¦ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®ä¸€éƒ¨ï¼ˆå‚ç…§ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒã¤å‹ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`const`ãŒä»˜ãã‚ˆã†ã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ä½œã‚‹ï¼‰ã‚’è¨€èªæ©Ÿèƒ½ã«ã‚ˆã£ã¦å®Ÿç¾ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚P3218R0ã«ã¤ã„ã¦ã¯ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3207R0 More & like - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3207R0-More--like)

ã“ã®ææ¡ˆã§ã¯ã€ã‚¯ãƒ©ã‚¹å®£è¨€ã¸ã®æŒ‡å®šã¨ã—ã¦`const`ã‚’ä»˜åŠ ã—ã¦å®£è¨€ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

```cpp
// function_refã®å®£è¨€ä¾‹

template<class... S>
class function_ref;    // not defined

template<class R, class... ArgTypes>
class function_ref<R(ArgTypes...) cv noexcept(noex)> const  // ğŸ‘ˆ const by default
{
  // ...
};
```

ã“ã®ã‚ˆã†ã«å®£è¨€ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹å‹ã®å¤‰æ•°ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å®£è¨€ãŒæš—é»™çš„ã«`const`ã§ã‚ã‚‹ã‚ˆã†ã«æ‰±ã‚ã‚Œã¾ã™ã€‚`const`æŒ‡å®šã•ã‚ŒãŸã‚¯ãƒ©ã‚¹å‹ã‹ã‚‰`const`ã‚’å–ã‚Šé™¤ãã“ã‚Œã¾ã§é€šã‚Šã®å‹•ä½œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéconstï¼‰ã‚’ã™ã‚‹å‹ã‚’å¾—ã‚‹ã«ã¯ã€å‹åã«`mutable`ã‚’ä»˜åŠ ã—ã¾ã™ã€‚

```cpp
void action() {}

void some_other_action() {
  function_ref<void ()> fr1{ action };          // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å®£è¨€ãŒconstå®£è¨€ã«ãªã‚‹
  mutable function_ref<void ()> fr2{ action };  // éconstå¤‰æ•°ã®å®£è¨€

  fr1 = function_ref<void ()>{ action };  // ng
  fr2 = function_ref<void ()>{ action };  // ok
  
  std::vector<function_ref<void ()>> v1{ fr1, fr2 };          // ng
  std::vector<mutable function_ref<void ()>> v2{ fr1, fr2 };  // ok
}
```

ã‚¯ãƒ©ã‚¹ã®`const`æŒ‡å®šã®é€†ã®æŒ‡å®šï¼ˆã¤ã¾ã‚Šä»Šã¾ã§é€šã‚Šï¼‰ã¨ã—ã¦`mutable`ã‚‚è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ãŠã‚Šã€ã•ã‚‰ã«ã©ã¡ã‚‰ã«ã‚‚å¼•æ•°ã¨ã—ã¦`bool`å€¤ã‚’å–ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```cpp
class a const {};     // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆconstå®£è¨€
class b mutable {};   // `class b {};`ã¨åŒã˜
class c const(true) {};   // `class c const {};`ã¨åŒã˜
class d const(false) {};  // `class c mutable {};`ã¨åŒã˜
class e mutable(true) {};   // `class c mutable {};`ã¨åŒã˜
class f mutable(false) {};  // `class c const {};`ã¨åŒã˜
```

`function_ref`ã‚„`optional<T&>`ãªã©ã®æµ…ã„`const`ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒã¤å‚ç…§ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹å‹ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`const`ã«ã—ã¦ãŠãã“ã¨ã§ã€è¨€èªçµ„ã¿è¾¼ã¿ã®å·¦è¾ºå€¤å‚ç…§ã¨ã®ä¸€è²«æ€§ãŒé«˜ã¾ã‚Šã€å®‰å…¨ã«ä½¿ç”¨ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

- [P3259 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1918)

### [P3263R0 Encoded annotated char](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3263r0.html)

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã—ãŸã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«ã‚ˆã‚‹æ–‡å­—ã‚’è¡¨ç¾å¯èƒ½ãªæ–‡å­—å‹ã®ææ¡ˆã€‚

ãƒ†ã‚­ã‚¹ãƒˆã®å‡¦ç†ã¨è§£é‡ˆã«ã¯ãã®æ–‡å­—ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒé‡è¦ã¨ãªã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¯„å›²ã‚’è€ƒãˆã‚‹ã¨ã€ç¾çŠ¶ã®C++ã«ã¯ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®å˜ä¸€ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

å‹ã¨æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¯¾å¿œã•ã›ã‚‹ã“ã¨ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ§˜ã€…ãªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’è­˜åˆ¥ã—ã¦ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ã¯æœ›ã¾ã—ã„æ–¹å‘æ€§ã§ã‚ã‚Šã€C++ã§ã‚‚ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰ã«å¯¾å¿œã™ã‚‹ä¸‰ç¨®é¡ã®æ–‡å­—å‹ï¼ˆ`char8_t, char16_t, char32_t`ï¼‰ãŒã‚³ã‚¢è¨€èªã«å¯¾ã—ã¦è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã“ã®æ–¹æ³•ã¯ã‚¹ã‚±ãƒ¼ãƒ«ã—ã¾ã›ï½ã€‚å­˜åœ¨ã™ã‚‹å…¨ã¦ã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«å¯¾ã—ã¦å¯¾å¿œã™ã‚‹æ–‡å­—å‹ã‚’æ¨™æº–ã«å°å…¥ã™ã‚‹ã®ã¯ç¾å®Ÿçš„ã§ã¯ãªãã€è¿½åŠ ã«å½“ãŸã£ã¦ã¯æ–‡å­—å‹ãã®ã‚‚ã®ã ã‘ã§ã¯ãªãä»–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆ`std::integral, std::string, std::string_view`ãªã©ï¼‰ã«å¯¾ã™ã‚‹å¯¾å¿œã‚‚æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€æ¨™æº–åŒ–å§”å“¡ä¼šã®é–¢ä¸ã‚’å¿…è¦ã¨ã™ã‚‹ã“ã¨ãªããƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬è‡ªã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

æ–‡å­—å‹ã®è¦ä»¶ã¨ã—ã¦ã¯

- æ—¢å­˜ã®å‹ã®å˜ãªã‚‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¨ã—ã¦æ‰±ã‚ã‚Œãªã„ä¸€æ„ã®å‹ã§ã‚ã‚‹
    - `using char_iso2022_t = char8_t;`ã®ã‚ˆã†ãªã‚‚ã®ã§ã¯ãªã„
- æ–‡å­—ã¨ã—ã¦å®Ÿè¡Œã§ãã‚‹ã¨æœŸå¾…ã•ã‚Œã‚‹ä¸€èˆ¬çš„ãªæ“ä½œã‚’é©ç”¨å¯èƒ½ã§ã‚ã‚‹
    - æ–‡å­—ã®ã‚³ãƒ¼ãƒ‰å˜ä½ãŒã‚ã‚‹å€¤ã§ã‚ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ï¼ˆ`==`ï¼‰ã‚„ã€æ–‡å­—ãŒã‚ã‚‹ã‚³ãƒ¼ãƒ‰å˜ä½ã®ç¯„å›²å†…ã«ã‚ã‚‹åŒ–ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ï¼ˆ`> >=`ãªã©ï¼‰ãªã©
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬è‡ªã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã€ãã‚Œã«æœŸå¾…ã•ã‚Œã‚‹ã™ã¹ã¦ã®é–¢é€£æ©Ÿèƒ½ã¨å…±ã«ã€ç°¡å˜ã«å®šç¾©ã§ãã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ–‡å­—ã‚³ãƒ¼ãƒ‰å˜ä½ã®å¹…ï¼ˆæ–‡å­—ã‚µã‚¤ã‚ºï¼‰ã‚’æŒ‡å®šã§ãã‚‹
- å¤‰æ›ã™ã‚‹ã®ãŒååˆ†ã«å®¹æ˜“ã§ã‚ã‚‹

ã“ã“ã§ã¯ã€ã“ã‚Œã‚‰ã®è¦ä»¶ã‚’é”æˆã™ã‚‹ãŸã‚ã«ã€ã‚³ã‚¢è¨€èªæ©Ÿèƒ½ã§ã®å¯¾å¿œã‚’å¿…è¦ã¨ã›ãš`enum class`ã‚’åˆ©ç”¨ã™ã‚‹ã‚‚ã®ã§ã‚‚ãªã„ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã‚’å°å…¥ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚ãã®æ–‡å­—å‹ã¯ã€æ¬¡ã®2ã¤ã®ã‚‚ã®ã‹ã‚‰æ§‹æˆã•ã‚Œã¾ã™

- ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ³¨é‡ˆå‹
  - ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä¸€æ„ã«è­˜åˆ¥ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç”¨æ„ã™ã‚‹å‹
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã•ã‚ŒãŸæ–‡å­—ã‚¯ãƒ©ã‚¹å‹
  - ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ³¨é‡ˆã‚’å—ã‘å–ã‚Šæ–‡å­—æ“ä½œã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã‚ã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå‹

EBCDICã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä¾‹

```cpp
// EBCDICã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ãŸã‚ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ³¨é‡ˆå‹ã®å®šç¾©
struct text_encoding_EBCDIC: public std::text_encoding // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ³¨é‡ˆå‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ãŸã‚ã®åŸºåº•ã‚¯ãƒ©ã‚¹å‹
{
	using char_t = char8_t;

	// static constexpr std::string_view id{"EBCDIC"}; //optional, not required
};

// EBCDICæ–‡å­—å‹ã®å®šç¾©
using char_EBCDIC_t = std::char_enc_t<text_encoding_EBCDIC>;


// EBCDICæ–‡å­—åˆ—å‹ã®å®šç¾©
using string_EBCDIC = std::basic_string<char_EBCDIC_t>;
using string_view_EBCDIC = std::basic_string_view<char_EBCDIC_t>;
```

ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ³¨é‡ˆå‹ã¯`std::text_encoding`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹å‹ã¨ã—ã¦å®šç¾©ã—ã€ãƒ¡ãƒ³ãƒå‹`::char_t`ã«ãã®è¡¨ç¾å‹ã‚’æŒ‡å®šã—ã¾ã™ã€‚ææ¡ˆã§ã¯ã€è¡¨ç¾å‹ã¨ã—ã¦ã¯`bool`ã§ã¯ãªã„ç¬¦å·ãªã—æ•´æ•°å‹ã§ã‚ã‚‹ã“ã¨ã‚’è¦æ±‚ã—ã¦ã„ã¾ã™ãŒã€ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—å‹ã®ã¿ã«åˆ¶é™ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ã‚ã’ã¦ã„ã¾ã™ã€‚

ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ³¨é‡ˆå‹ã«å¿…è¦ãªã“ã¨ã¯ã“ã‚Œã ã‘ã§ã€ã‚ã¨ã¯ãã‚Œã‚’`std::char_enc_t<>`ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æ¸¡ã™ã“ã¨ã§ãã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®æ–‡å­—å‹ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`std::char_enc_t<E>`ã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°`E`ã«ã‚ˆã‚‹æ–‡å­—å‹ã¨ã—ã¦åˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ãŸã‚ã«ã€`E::char_t`ã®è–„ã„ãƒ©ãƒƒãƒ‘ã¨ãªã‚‹å‹ã§ã™ã€‚`std::char_enc_t<E>`ã§ã¯`E::char_t`ã®ã‚‚ã®ã‚’åˆ©ç”¨ã™ã‚‹å½¢ã§æ–‡å­—æ¼”ç®—ï¼ˆã»ã¼æ•´æ•°æ¼”ç®—ï¼‰ã®æ¼”ç®—å­ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã«ã‚ˆã£ã¦æ–‡å­—è¡¨ç¾å‹ã§åˆ©ç”¨å¯èƒ½ãªæ“ä½œã‚’ãã®ã¾ã¾å†åˆ©ç”¨ã—ãªãŒã‚‰ã€ãªãŠã‹ã¤ãã®å‹ã¨ã¯å®Œå…¨ã«åˆ¥ã®å‹ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã€ã¨ã„ã†æ€§è³ªã‚’é”æˆã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€`std::char_enc_t<E>`ã¯è¡¨ç¾å‹ã¸ã®æ˜ç¤ºçš„å¤‰æ›ã®ã»ã‹ã€æ–‡å­—ã®è¡¨ç¾å‹ã§ã®å€¤ã‚’å–å¾—ã™ã‚‹`.value()`ç­‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã€å¤‰æ›ã‚‚å®¹æ˜“ã«è¡Œãˆã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã¯ã€å…ˆã«æŒ™ã’ãŸ5ã¤ã®è¦ä»¶ã«åŠ ãˆã¦ã€æ¨™æº–åŒ–å§”å“¡ä¼šã®é–¢ä¸ã‚’å¿…è¦ã¨ã›ãšã«æ–°ã—ã„æ–‡å­—å‹ã‚’å®šç¾©ã§ãã‚‹ã¨ã„ã†è¦ä»¶ã‚’ã™ã¹ã¦æº€ãŸã™ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

ãŸã ã—ä¸€ã¤æ‡¸å¿µç‚¹ãŒã‚ã‚Šã€æ–‡å­—ãƒ»æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ï¼ˆ`'c'ã‚„"string"`ï¼‰ãŒã‚³ã‚¢è¨€èªã‚µãƒãƒ¼ãƒˆã§ã‚ã‚‹ãŸã‚ã«ã“ã®å‹ã®ãã‚Œã‚’è‡ªå‹•ã§è¿½åŠ ã§ããšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ãƒªãƒ†ãƒ©ãƒ«ã‚„å¤‰æ›é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€ãã‚Œã ã¨è¨€èªã®ãƒªãƒ†ãƒ©ãƒ«ã«ã‚ã‚‹æ°¸ç¶šçš„ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«é…ç½®ã•ã‚Œã‚‹ã¨ã„ã†æ€§è³ªãŒé”æˆã§ãã¾ã›ã‚“ã€‚ã“ã®ææ¡ˆã§ã¯ã“ã‚Œã«å¯¾ã™ã‚‹è§£æ±ºç­–ã‚’è¦‹å‡ºã—ã¦ãŠã‚‰ãšã€æœªè§£æ±ºã®å•é¡Œã¨ã—ã¦ã„ã¾ã™ã€‚

- [P3263 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1919)

### [P3264R0 Double-evaluation of preconditions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3264r0.html)

â†“

### [P3264R1 Double-evaluation of preconditions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3264r1.html)

äº‹å‰æ¡ä»¶ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹å ´åˆã«ã€ãã‚ŒãŒ2å›ä»¥ä¸Šãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã„ã†ç¾åœ¨ã®ä»•æ§˜ã‚’ç¶­æŒã™ã¹ãã¨ã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ã§ã¯ã€å¥‘ç´„æ³¨é‡ˆã®ç¨®é¡ã‚’å•ã‚ãšå¥‘ç´„æ¡ä»¶ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹å ´åˆã¯2å›ä»¥ä¸Šãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã¯ç•°è«–ã‚‚ã‚ã‚Šã€æ­£ç¢ºã«1å›ãƒ»å°‘ãªãã¨ã‚‚ä¸Šé™ã‚’è¨­ã‘ã‚‹ãƒ»æ­£ç¢ºã«å›æ•°ã‚’æŒ‡å®šã™ã‚‹ã€ãªã©ã®åˆ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æœ›ã‚€å£°ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€äº‹å‰æ¡ä»¶ã«çš„ã‚’çµã£ã¦ãã®åˆ©ç‚¹ã‚’èª¬æ˜ã—ã€å°‘ãªãã¨ã‚‚äº‹å‰æ¡ä»¶ã«ã¤ã„ã¦ã¯ç¾åœ¨ã®ä»•æ§˜ã‚’ç¶­æŒã™ã¹ãã¨ã™ã‚‹ææ¡ˆã§ã™ã€‚

ã“ã“ã§ã¯ã€äº‹å‰æ¡ä»¶ã®æ¡ä»¶å¼ãŒ2å›ä»¥ä¸Šãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãŠãåˆ©ç‚¹ã¨ã—ã¦æ¬¡ã®äº‹ã‚’æŒ™ã’ã¦ã„ã¾ã™

- å‘¼ã³å‡ºã—å´ã¨å‘¼ã³å‡ºã•ã‚Œã‚‹å´ã®ä¸¡æ–¹ã«å¯¾ã—ã¦å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†æ©Ÿä¼šã‚’æä¾›ã§ãã‚‹
    - ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ãƒã‚§ãƒƒã‚¯ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã§ã‚‚ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’å¿…è¦ã¨ã›ãšã«å‘¼ã³å‡ºã—å´ã§ãƒã‚§ãƒƒã‚¯ã‚’æœ‰åŠ¹åŒ–ã§ãã‚‹
    - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å¥‘ç´„ãƒã‚§ãƒƒã‚¯ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã§ã‚‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’å¿…è¦ã¨ã›ãšã«å‘¼ã³å‡ºã—å…ˆã§ãƒã‚§ãƒƒã‚¯ã‚’æœ‰åŠ¹åŒ–ã§ãã‚‹
    - ä¸¡å´ã§å¥‘ç´„ãƒã‚§ãƒƒã‚¯ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚Œã°ã€2å›ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹
- ç¿»è¨³å˜ä½ã®ç‰‡å´/ä¸¡å´ã§å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’æœ‰åŠ¹ãƒ»ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã‚‚ã€ABIã«å½±éŸ¿ã‚’ä¸ãˆãªã„
- ä¸Šè¨˜ã®åˆ©ç‚¹ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚°ãƒ©ãƒ•ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã«æ‹¡å¤§ã—ã¦ã‚‚ã€åŒã˜åˆ©ç‚¹ãŒå¾—ã‚‰ã‚Œã‚‹
- ãƒã‚§ãƒƒã‚¯ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹å ´åˆã§ã‚‚åŠ¹ç‡çš„
    - å˜ä¸€è©•ä¾¡ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã®å®Ÿè¡Œæ™‚æ©Ÿæ§‹ã®å‘¼ã³å‡ºã—ãŒç¾©å‹™ä»˜ã‘ã‚‰ã‚Œãªã„
- ã“ã‚Œã‚‰ã®åˆ©ç‚¹ã«ã¯èª¬å¾—åŠ›ãŒã‚ã‚‹ãŸã‚ã€æ¨™æº–ãŒæ­£ç¢ºã«ä¸€å›ã ã‘è©•ä¾¡ã•ã‚Œã‚‹ã¨ã„ã†æ–¹å‘æ€§ã‚’æ¡ç”¨ã—ãŸå ´åˆã§ã‚‚ã€2å›ä»¥ä¸Šè©•ä¾¡ã•ã‚Œã‚‹ã¨ã„ã†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ï¼ˆéæ¨™æº–ã®æ‹¡å¼µã¨ã—ã¦ï¼‰æä¾›ã•ã‚Œã‚‹ã¨æ€ã‚ã‚Œã‚‹

ãã—ã¦ã€2å›ä»¥ä¸Šãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã—ã¦ãŠãã“ã¨ã«ã‚ˆã£ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒã¯å¥‘ç´„æ¡ä»¶å¼å†…ã§ã®å‰¯ä½œç”¨ã«é ¼ã£ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãã®ã‚’å›é¿ã™ã‚‹ã‚ˆã†ã«ãªã‚‹ã€ã¨ã„ã†å‰¯æ¬¡çš„åŠ¹æœã‚‚å¾—ã‚‰ã‚Œã‚‹ã¯ãšã§ã™ã€‚å¥‘ç´„æ¡ä»¶å¼ã®å‰¯ä½œç”¨ã«é ¼ã£ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ãã‚Œã‚’æ›¸ã„ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒä»¥å¤–ãŒã‚³ãƒ¼ãƒ‰ã‚’ç†è§£ã™ã‚‹ã“ã¨ã‚’é›£ã—ãã™ã‚‹ã¨ã¨ã‚‚ã«ã€å¥‘ç´„æ³¨é‡ˆã‚’æ´»ç”¨ã™ã‚‹å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ï¼ˆé™çš„è§£æãªã©ï¼‰ã®è§£æã‚‚å›°é›£ã«ã—ã¾ã™ã€‚

ä»–ã®2ç¨®é¡ã®æ³¨é‡ˆã€äº‹å¾Œæ¡ä»¶ã¨`contract_assert`ã®å ´åˆã€åŒã˜ã‚ˆã†ã«è¦å®šã—ã¦ã‚‚äº‹å‰æ¡ä»¶ç¨‹ã®åˆ©ç‚¹ãŒå¾—ã‚‰ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã‚‚ã®ã®ã€å°‘ãªãã¨ã‚‚äº‹å¾Œæ¡ä»¶ã«é–¢ã—ã¦ã¯äº‹å‰æ¡ä»¶ã®å ´åˆã¨åŒã˜åˆ©ç‚¹ãŒã‚ã‚‹ã€ã¨ã—ã¦ã„ã¾ã™ã€‚

- [P3264 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1920)

### [ã¨ã„ã†R0 Ship Contracts in a TS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/ã¨ã„ã†r0.html)

â†“

### [ã¨ã„ã†R1 Ship Contracts in a TS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/ã¨ã„ã†r1.html)

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’ã¾ãšTSã¨ã—ã¦å‡ºè·ã™ã¹ãã€ã¨ã™ã‚‹ææ¡ˆã€‚

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯ä»Šã®ã¨ã“ã‚C++26ã‚’ç›®æŒ‡ã—ã¦é€²è¡Œã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€EWGã«è»¢é€ã•ã‚ŒãŸå¾Œã§ã€EWGã®ãƒ¡ãƒ³ãƒãŒè€ƒãˆã‚‹å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¨ç¾åœ¨ã®ãã‚ŒãŒå°‘ã—ç•°ãªã‚‹ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ãŒè¡¨é¢åŒ–ã—ã€ãã‚Œã«ã‚ˆã£ã¦å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«å¯¾ã—ã¦æ©Ÿèƒ½ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå™´å‡ºã—ã¤ã¤ã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ææ¡ˆï¼ˆP2900ï¼‰ã‹ã‚‰æœŸé™ã‚’å–ã‚Šé™¤ã„ã¦ã€ã¾ãšTSã¨ã„ã†å½¢ã§å‡ºè·ã—ã¦ã‚‚ã†å°‘ã—æ™‚é–“ã‚’ã‹ã‘ã‚‹ã“ã¨ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã§ã¯ãã®å‹•æ©Ÿã¨ã—ã¦æ¬¡ã®ã‚‚ã®ã‚’æŒ™ã’ã¦ã„ã¾ã™

- å®Ÿè£…çµŒé¨“ã‚’å¾—ã‚‹
- ç¾å ´ã§ã®ä½¿ç”¨çµŒé¨“ã‚’å¾—ã‚‹
- P2900ã®è¤‡æ•°ã®ç‚¹ï¼ˆã¨ãã«äº‰ç‚¹ã¨ãªã£ã¦ã„ã‚‹ï¼‰ã«å¯¾ã™ã‚‹WG21å…¨ä½“ã®ã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ã‚’å¾—ã‚‹
- ä»®æƒ³é–¢æ•°ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã™ã‚‹å¥‘ç´„ã«ã¤ã„ã¦ã®ã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ãŒç„¡ã„
- å®‰å…¨æ€§ã®å‘ä¸Š
    - å¥‘ç´„æ³¨é‡ˆã¯è¨€èªã®ä»–ã®éƒ¨åˆ†åŒæ§˜ã«æœªå®šç¾©å‹•ä½œã®å½±éŸ¿ã‚’å—ã‘ã‚„ã™ãã€ã“ã®ã“ã¨ã¯å¥‘ç´„æ³¨é‡ˆã®å®Ÿè¡Œæ™‚ãƒã‚§ãƒƒã‚¯ã«ã¨ã£ã¦ã‚‚é™çš„è§£æãƒ„ãƒ¼ãƒ«ã®å¥‘ç´„æ³¨é‡ˆåˆ©ç”¨æ™‚ã«ãŠã„ã¦ã‚‚å•é¡Œã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

ã¾ãŸã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«å¯¾ã™ã‚‹æ©Ÿèƒ½è¦æ±‚ã¯ç¾åœ¨ã§ã‚‚ã„ãã¤ã‚‚å‡ºã¦ãã¦ãŠã‚Šã€ãã‚Œã‚‰ã«ã¯ä»¥å‰ã«ã¯ãªã‹ã£ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚æœŸé™ã‚’é‡è¦–ã—ã¦æœ€å°ã®æ©Ÿèƒ½ã‚’C++26ã«å…¥ã‚Œã‚‹MVPã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã¯ã€ã“ã‚Œã‚‰ã®ææ¡ˆãŒé–“ã«åˆã‚ãªã„ã“ã¨ã§ãã®ã‚ˆã†ãªåˆ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¸ã®é“ã‚’é–‰ã–ã—ã¦ã—ã¾ã†å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã¯SG21ã§ç¢ºèªã•ã‚ŒãŸå¾ŒEWGã§ã‚‚ç¢ºèªã•ã‚Œã¦ã„ã¾ã™ãŒã€ã¾ã ä½•ã‹ã—ã‚‰ã®æ±ºå®šã¯ä¸‹ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã©ã†ã‚„ã‚‰ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®æœŸé™ã‚’æ±ºã‚ã‚‹è²¬ä»»ã¯EWGã«ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

- [ã¨ã„ã† é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1921)

### [P3266R0 non referenceable types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3266r0.html)

å‹ã®å‚ç…§å‹ã‚’å–å¾—ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ã‚¯ãƒ©ã‚¹ã®æŒ‡å®šã®ææ¡ˆã€‚

ã“ã®ææ¡ˆã¯ã€ä»¥å‰ã®P3218R0ã§ææ¡ˆã•ã‚Œã¦ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®ä¸€éƒ¨ï¼ˆå‚ç…§ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒã¤å‹ã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã§ããªã„ï¼‰ã‚’ç™ºå±•ã•ã›ãŸã‚‚ã®ã‚’è¨€èªæ©Ÿèƒ½ã«ã‚ˆã£ã¦å®Ÿç¾ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚P3218R0ã«ã¤ã„ã¦ã¯ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3207R0 More & like - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3207R0-More--like)

ã“ã®ææ¡ˆã§ã¯ã€`referenceable(bool)`ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¹å®£è¨€ã«å¯¾ã™ã‚‹æŒ‡å®šã«ã‚ˆã£ã¦ãã‚Œã‚’è¡ŒãŠã†ã¨ã—ã¦ã„ã¾ã™

```cpp
template<class... S>
class function_ref;    // not defined

template<class R, class... ArgTypes>
class function_ref<R(ArgTypes...) cv noexcept(noex)> referenceable(false) // å‚ç…§ã§ããšã€ã‚³ãƒ”ãƒ¼ã®ã¿ãŒå¯èƒ½ã¨ãªã‚‹
{
  // ...
};

template <class T>
class optional<T&> referenceable(false) // åŒä¸Š
{
  // ...
};
```

ã“ã®ã‚ˆã†ã«æŒ‡å®šã—ã¦å®£è¨€ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã¯å‚ç…§ã§ä¿æŒã™ã‚‹ã“ã¨ãŒç¦æ­¢ã•ã‚Œã€ã‚³ãƒ”ãƒ¼ã®ã¿ã—ã‹ã§ããªããªã‚Šã¾ã™

```cpp
// å‚ç…§ä¸å¯èƒ½ãªå‹ã¸ã®å‚ç…§ã¯è¨±å¯ã•ã‚Œãªã„
function_ref<void ()>& f(function_ref<void ()>&); // ill-formed
optional<int&>& f(optional<int&>&); // ill-formed

void action() {}

int main()
{
  function_ref<void ()> fr1{ action };

  // å‚ç…§ä¸å¯èƒ½ãªå‹ã¸ã®å‚ç…§ã¯è¨±å¯ã•ã‚Œãªã„
  function_ref<void ()>& fr2 = fr1; // ill-formed

  int i = 42;
  optional<int&> oi1{ i };  // const by default

  // å‚ç…§ä¸å¯èƒ½ãªå‹ã¸ã®å‚ç…§ã¯è¨±å¯ã•ã‚Œãªã„
  optional<int&>& oi2 = oi1;  // ill-formed

  return 0;
}
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯`referenceable(true)`ã§ã‚ã‚Šã€ã“ã‚Œã¯ç¾åœ¨ã®ã‚¯ãƒ©ã‚¹å‹ã®æŒ¯ã‚‹èˆã„ã§ã™ã€‚

```cpp
class a referenceable(false) {}; // å‚ç…§ä¸å¯èƒ½ãªå‹
class b referenceable(true) {};  // class b {};ã¨åŒã˜
```

ã“ã‚Œã¯å‚ç…§ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒã¤å‹ã®æ‰±ã„ã‚’ã‚ˆã‚Šè¨€èªå‚ç…§ã¸è¿‘ã¥ã‘ã‚‹ã‚‚ã®ï¼ˆå‚ç…§ã®å‚ç…§ã‚’ä½œæˆã§ããªã„ï¼‰ã§ã‚ã‚Šã€ã“ã‚Œã«ã‚ˆã£ã¦ãƒ€ãƒ³ã‚°ãƒªãƒ³ã‚°å‚ç…§ã®ç™ºç”Ÿã‚’æŠ‘åˆ¶ã§ãã‚‹ã¨ã—ã¦ã„ã¾ã™ã€‚

- [P3266 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1922)

### [P3267R0 C++ contracts implementation strategies](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3267r0.html)

â†“

### [P3267R1 Approaches to C++ Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3267r1.html)

C++å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®å®Ÿè£…æˆ¦ç•¥ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦æ¯”è¼ƒã—ãŸæ–‡æ›¸ã€‚

ã“ã“ã§ã¯ä¸»ã«äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã®å¥‘ç´„æ³¨é‡ˆã®ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã¤ã„ã¦ã®å®Ÿè£…æˆ¦ç•¥ã®ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã¨æ¯”è¼ƒã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

èª¬æ˜ã«å½“ãŸã£ã¦ã¯ã€æ¬¡ã®ã‚ˆã†ãªå¥‘ç´„ã•ã‚Œã¦ã„ã‚‹é–¢æ•°ã¨ã€ãã‚Œã‚’å‘¼ã³å‡ºã™é–¢æ•°ãŠã‚ˆã³é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’ä½¿ã£ã¦ãã‚Œã‚’å‘¼ã³å‡ºã™é–¢æ•°ã®3ã¤ã§ä¾‹ç¤ºã—ã¦ã„ã¾ã™ã€‚

```cpp
// äº‹å‰ãƒ»äº‹å¾Œæ¡ä»¶ã‚’æŒã¤é–¢æ•°f()
int f(int arg)
  pre(arg > 5)
  pre(arg < 2000)
  post(rv: rv % 2 == 0)
{ 
  return arg * 2; 
}

// f()ã‚’å‘¼ã³å‡ºã™ã ã‘ã®é–¢æ•°g()
int g() {
  return f(25);
}

using function_pointer = int(*)(int);
function_pointer fp = &f;

// f()ã‚’é–¢æ•°ãƒã‚¤ãƒ³ã‚¿çµŒç”±ã§å‘¼ã³å‡ºã™é–¢æ•°h()
int h() {
  return fp(40);
}
```

ã¾ãŸã€ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ä¾‹ç¤ºã®ãŸã‚ã«å¥‘ç´„æ¡ä»¶ãƒã‚§ãƒƒã‚¯ã‚’`check()`ã¨ã„ã†é–¢æ•°ã§è¡¨ã—ã€æ¡ä»¶ã‚’æœ€é©åŒ–ã«åˆ©ç”¨ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆï¼ˆæ¡ä»¶å¼ã‚’ä»®å®šã¨ã—ã¦æ‰±ã†ãƒã‚¤ãƒ³ãƒˆã€ã‚ã‚‹ã„ã¯å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’çœç•¥å¯èƒ½ãªãƒã‚¤ãƒ³ãƒˆï¼‰ã‚’`imply()`ã¨ã„ã†é–¢æ•°ã§è¡¨ã‚ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã‚¢ã‚µãƒ¼ãƒˆã®æŒã¤å½¹å‰²ã‚’åˆ†é›¢ã—ã¦ã€ã©ã®æ€§è³ªãŒè¨±å¯ã•ã‚Œã‚‹ã®ã‹ã‚’æ˜ç¢ºã«ã™ã‚‹ãŸã‚ã§ã™ã€‚

ãã—ã¦ã€ã“ã“ã§ã¯å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«é–¢ã—ã¦ã¯ã“ã®å®Ÿè£…æˆ¦ç•¥ã«å½±éŸ¿ã—ãªã„ã¨ã—ã¦åŒç­‰ã«æ‰±ã£ã¦ãŠã‚Šã€å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯ç¿»è¨³å˜ä½é–“ã§ä¸€è‡´ã—ã¦ã„ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚

#### 1. å…¨ã¦å‘¼ã³å‡ºã—å…ˆã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹

äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã«é–¢ã™ã‚‹å…¨ã¦ã®äº‹ã‚’é–¢æ•°ã®å®šç¾©å†…ã§è¡Œã†æ–¹æ³•ã§ã€ã“ã‚Œã¯ã‚‚ã£ã¨ã‚‚ç°¡å˜ãªC++å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®å®Ÿè£…æ–¹æ³•ã§ã™ã€‚

```cpp
int f(int arg)
{ 
  check(arg > 5);
  imply(arg > 5);
  check(arg < 2000);
  imply(arg < 2000);

  int rv = arg * 2;
  
  check(rv % 2 == 0);
  imply(rv % 2 == 0);
  
  return rv;
}

int g() {
  return f(25);
}

int h() {
  return fp(40);
}
```

#### 2. å‘¼ã³å‡ºã—å´ã§ãƒã‚§ãƒƒã‚¯ã—ã€å‘¼ã³å‡ºã—å…ˆã§ã¯æ¡ä»¶ã‚’ä»®å®šã€äº‹å¾Œæ¡ä»¶ã‚’å…ƒã®ABIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã§ãƒã‚§ãƒƒã‚¯

ã“ã®æ–‡æ›¸ã«ãŠã‘ã‚‹å…ƒã®ABIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã¯ã€ABIã«ãŠã‘ã‚‹`f()`ã®å‘¼ã³å‡ºã—ã‚’è¡¨ã™ã‚‚ã®ã®äº‹ã§ã™ã€‚å¾Œã§å‡ºã¦ãã¾ã™ãŒã€ã“ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã§å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã®ç•°ãªã‚‹å®Ÿè£…ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€ãƒã‚§ãƒƒã‚¯ã‚’ãã‚Œã‚‰ã‚’åŒ…å«ã™ã‚‹å½±éŸ¿ãŒã‚ã‚‹å ´æ‰€ï¼ˆäº‹å‰æ¡ä»¶ãŒçœŸ => äº‹å¾Œæ¡ä»¶ãŒçœŸã¨ã„ã†å«æ„ã‚’ä½¿ç”¨ã™ã‚‹å ´æ‰€ï¼‰ã«é…ç½®ã™ã‚‹ã‹ã€ãƒã‚§ãƒƒã‚¯ã‚’çœç•¥å¯èƒ½ãªä»–ã®æƒ…å ±ãŒåˆ©ç”¨ã§ãã‚‹å ´æ‰€ã«é…ç½®ã™ã‚‹ãŸã‚ã€å‘¼ã³å‡ºã—å´ã§ã®æœ€é©åŒ–ã«é©ã—ã¦ã„ã‚‹å®Ÿè£…ã§ã™ã€‚

```cpp
int f(int arg)
{ 
  imply(arg > 5);
  imply(arg < 2000);

  int rv = arg * 2;
  
  check(rv % 2 == 0);
  return rv;
}

int g() {
  check(25 > 5);
  check(25 < 2000);

  int rv = f(25);
  
  imply(rv % 2 == 0);
  return rv;
}

int h() {
  return fp(40);
}
```

#### 3. å‘¼ã³å‡ºã—å´ã§ãƒã‚§ãƒƒã‚¯ã—ã€å‘¼ã³å‡ºã—å…ˆã§ã¯æ¡ä»¶ã‚’ä»®å®šã€äº‹å‰æ¡ä»¶ã‚’å…ƒã®ABIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã§ãƒã‚§ãƒƒã‚¯

2ã¨åŒæ§˜ã«å‘¼ã³å‡ºã—å´ã§ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã¾ã™ãŒã€`f()`ã®ABIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’åˆ†å‰²ã—ã€äº‹å‰æ¡ä»¶ã‚’ä»®å®šã—äº‹å¾Œæ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹åˆ¥ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’æŒ¿å…¥ã—ã¾ã™ã€‚

```cpp
int f(int arg) 
{
  check(arg > 5);
  check(arg < 2000);

  int rv = f@post-check(arg);
  
  imply(rv % 2 == 0);
  return rv;
}

int f@post-check(int arg)
{ 
  imply(arg > 5);
  imply(arg < 2000);

  int rv = arg * 2;
  
  check(rv % 2 == 0);
  return rv;
}

int g() {
  check(25 > 5);
  check(25 < 2000);

  int rv = f@post-check(25);
  
  imply(rv % 2 == 0);
  return rv;
}

int h() {
  return fp(40);
}
```

#### 4. ä¸¡å´ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹

ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1ã¨åŒæ§˜ã«å…ƒã®ABIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’ä¿æŒã—ã€ãªãŠã‹ã¤é–¢æ•°ã®å‘¼ã³å‡ºã—å´ã¨å‘¼ã³å‡ºã—å…ˆã®ä¸¡æ–¹ã§ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã¾ã™ã€‚ã“ã®æ–¹æ³•ã¯ä¸€è¦‹å†—é•·ã«è¦‹ãˆã¾ã™ãŒã€é–¢æ•°ã®ä¸¡ã‚µã‚¤ãƒ‰ã«æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚

```cpp
int f(int arg)
{ 
  check(arg > 5);
  imply(arg > 5);
  check(arg < 2000);
  imply(arg < 2000);

  int rv = arg * 2;
  
  check(rv % 2 == 0);
  imply(rv % 2 == 0);
  
  return rv;
}

int g() {
  check(arg > 5);
  check(arg < 2000);

  int rv = f(25);
  
  check(rv % 2 == 0);
  imply(rv % 2 == 0);
  
  return rv;
}

int h() {
  return fp(40);
}
```

#### 5. é…å»¶ãƒã‚§ãƒƒã‚¯

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ç•°ãªã‚Šã€ã“ã®æ–¹æ³•ã§ã¯å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã¯é€šå¸¸è¡Œã‚ã‚Œã¾ã›ã‚“ã€‚å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œã¯å¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ã‚„ãƒ‡ãƒãƒƒã‚¬ãªã©ï¼‰ãŒæŒ‡å®šã™ã‚‹å ´åˆã«å®Ÿè¡Œæ™‚ã®ä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡Œã‚ã‚Œã¾ã™ã€‚

```cpp
template <typename T>
struct contract_raii_handle {
  contract_raii_handle(T&& lambda)
  : _check(std::move(lambda))
  , result(2);
  {}
  bool operator()() {
    if (result == 2) {
      result = _check();
    }
    return (bool)result;
  }
};
auto add_pending_contract_check(auto lambda) { return contract_raii_handle<decltype(lambda)>(std::move(lambda)); }

int f(int arg)
{
  auto pre_handle_1 = add_pending_contract_check([=]{ return arg > 5; });
  auto pre_handle_2 = add_pending_contract_check([=]{ return arg < 2000; });
  return arg * 2;
}

int g() {
  check(arg > 5);
  check(arg < 2000);

  int rv = f(25);
  
  auto post_handle_1 = add_pending_contract_check([=]{ return rv % 2 == 0; });
  
  return rv;
}

int h() {
  return fp(40);
}
```

ã“ã®å®Ÿè£…ã¯C++ã«ã‚ˆã‚‹è¿‘ä¼¼å®Ÿè£…ã§ã‚ã‚Šã€ã‚ˆã‚ŠåŠ¹ç‡çš„ãªå®Ÿè£…ã‚’è¡Œã†ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

#### 6. å®Ÿè¡Œæ™‚ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹é¸æŠ

```cpp
int f(int arg)
{ 
  bool __run_checks = should_check(__func__);
  if (__run_checks) {
    check(arg > 5);
    check(arg < 2000);
  }

  int rv = arg * 2;
  
  if (__run_checks) {
    check(rv % 2 == 0);
  }
  
  return rv;
}

int g() {
  return f(25);
}

int h() {
  return fp(40);
}
```

#### 7. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ­ãƒ¼ãƒ‰æ™‚ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹é¸æŠ

6ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ãŠã„ã¦ã€é–¢æ•°å‘¼ã³å‡ºã—æ™‚ã§ã¯ãªããƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ­ãƒ¼ãƒ‰æ™‚ã«å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã‹ã‚’æŒ‡å®šã—ã¦ã‚·ãƒ³ãƒœãƒ«è§£æ±ºã‚’è¡Œã†ã“ã¨ã§ã€ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†å®Ÿè£…ã®é¸æŠã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ­ãƒ¼ãƒ‰æ™‚ã«è§£æ±ºã™ã‚‹ã‚‚ã®ã§ã™ã€‚

```cpp
static int f__check(int arg)
{ 
  check(arg > 5);
  check(arg < 2000);

  int rv = arg * 2;
  
  check(rv % 2 == 0);
  
  return rv;
}

static int f__nocheck(int arg)
{ 
  int rv = arg * 2;
  return rv;
}

static void *f__resolver() {
  // As an example of a condition to select on
  // This will be checked on the first invocation of f().
  return getenv("mustgofaster") == nullptr ? &f__check : &f__nocheck;
}

int f(int arg) __attribute__((ifunc("f__resolver")));

int g() {
  return f(25);
}

int h() {
  return fp(40);
}
```

C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®é–‹å§‹å¾Œ`main()`ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¾ã§ã®é–“ã«ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒå¤§ãã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ãƒªãƒ³ã‚«/ãƒ­ãƒ¼ãƒ€ãƒ¼ã®æ©Ÿèƒ½ï¼ˆGNU ifuncãªã©ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ é–‹å§‹å‰ã®ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚·ãƒ³ãƒœãƒ«è§£æ±ºã‚’è¡Œã£ã¦ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å‰Šæ¸›ã§ãã¾ã™ã€‚

#### æ¯”è¼ƒ

å„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®ç‰¹å¾´ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

1. å…¨ã¦å‘¼ã³å‡ºã—å…ˆã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹
    - ç‰¹å¾´: é–¢æ•°ã®å®Ÿè£…å†…ã§å…¨ã¦ã®å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã€‚ABIã®å¤‰æ›´ã¯ç™ºç”Ÿã—ãªã„
    - åˆ©ç‚¹: å®Ÿè£…ãŒã‚·ãƒ³ãƒ—ãƒ«
    - æ¬ ç‚¹: å‘¼ã³å‡ºã—å´ã§ã®æœ€é©åŒ–ã®ä½™åœ°ãŒã»ã¨ã‚“ã©ãªã„
2. å‘¼ã³å‡ºã—å´ã§ãƒã‚§ãƒƒã‚¯ã—ã€å‘¼ã³å‡ºã—å…ˆã§ã¯æ¡ä»¶ã‚’ä»®å®šã€äº‹å¾Œæ¡ä»¶ã‚’å…ƒã®ABIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã§ãƒã‚§ãƒƒã‚¯
    - ç‰¹å¾´: å‘¼ã³å‡ºã—å´ã§å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã€å‘¼ã³å‡ºã—å…ˆå´ã¯æ¡ä»¶ã‚’ä»®å®šã™ã‚‹ã€‚äº‹å¾Œãƒã‚§ãƒƒã‚¯ãŒå…ƒã®ABIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹ãŸã‚ã€ABIã®å¤‰æ›´ã¯ç™ºç”Ÿã—ãªã„
    - åˆ©ç‚¹: å‘¼ã³å‡ºã—å´ã§ã®æœ€é©åŒ–ãŒå¯èƒ½ã«ãªã‚‹
    - æ¬ ç‚¹: é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã«å¥‘ç´„ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œãªã„ã€‚å‘¼ã³å‡ºã—å´ã¨å‘¼ã³å‡ºã—å…ˆã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ•ãƒ©ã‚°ãŒç•°ãªã£ã¦ã„ã‚‹ã¨ãƒã‚§ãƒƒã‚¯ã•ã‚Œãªã„å ´åˆãŒã‚ã‚‹
3. å‘¼ã³å‡ºã—å´ã§ãƒã‚§ãƒƒã‚¯ã—ã€å‘¼ã³å‡ºã—å…ˆã§ã¯æ¡ä»¶ã‚’ä»®å®šã€äº‹å‰æ¡ä»¶ã‚’å…ƒã®ABIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã§ãƒã‚§ãƒƒã‚¯
    - ç‰¹å¾´: å‘¼ã³å‡ºã—å´ã§å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã€å‘¼ã³å‡ºã—å…ˆå´ã¯æ¡ä»¶ã‚’ä»®å®šã™ã‚‹ã€‚äº‹å‰ãƒã‚§ãƒƒã‚¯ã‚’å…ƒã®ABIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã—ã€ABIã‚’å¤‰æ›´ã—ãŸåå‰ã®åˆ¥ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹
    - åˆ©ç‚¹: å‘¼ã³å‡ºã—å´ã§ã®æœ€é©åŒ–ãŒå¯èƒ½ã§ã‚ã‚Šã€ABIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®å ´åˆã§ã‚‚å¥‘ç´„ãƒã‚§ãƒƒã‚¯ãŒå¯èƒ½ã«ãªã‚‹ã€‚ç¿»è¨³å˜ä½ãŒåˆ†ã‹ã‚Œã¦ã„ã¦ã‚‚ãƒã‚§ãƒƒã‚¯ãŒæ¬ è½ã™ã‚‹ã“ã¨ã¯ãªã„
    - æ¬ ç‚¹: é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰ã®å‘¼ã³å‡ºã—ã§ãƒã‚§ãƒƒã‚¯ã‚’çœç•¥ã§ããªã„
4. ä¸¡å´ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹
    - ç‰¹å¾´: å…ƒã®ABIã‚’ç¶­æŒã—ãªãŒã‚‰ã€å‘¼ã³å‡ºã—å´ã¨å‘¼ã³å‡ºã—å…ˆå´ã®ä¸¡æ–¹ã§ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†
    - åˆ©ç‚¹: å‘¼ã³å‡ºã—å´ã§ã‚‚äº‹å¾Œæ¡ä»¶ã«é–¢ã™ã‚‹æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆãŒå¾—ã‚‰ã‚Œã‚‹ã€‚ç¿»è¨³å˜ä½ãŒåˆ†ã‹ã‚Œã¦ã„ã¦ã‚‚ãã‚Œãã‚Œã®å´ã§ã‚ªãƒ³ã‚ªãƒ•ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã€ã©ã¡ã‚‰ã‹ã®å´ã§ãƒã‚§ãƒƒã‚¯ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚Œã°ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹
    - æ¬ ç‚¹: å¥‘ç´„ãƒã‚§ãƒƒã‚¯ãŒé‡è¤‡ã™ã‚‹ãŸã‚ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
5. é…å»¶ãƒã‚§ãƒƒã‚¯
    - ç‰¹å¾´: å®Ÿéš›ã®ãƒã‚§ãƒƒã‚¯ã¯è¡Œã‚ãšã€å¥‘ç´„ã‚’ä¿ç•™ã«ã—ã¦ãŠãã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ã‚„ãƒ‡ãƒãƒƒã‚¬ãªã©ã®å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã‹ã‚‰ã®è¦æ±‚ã«å¿œã˜ã¦è©•ä¾¡ã™ã‚‹
    - åˆ©ç‚¹: é«˜ã‚³ã‚¹ãƒˆãªå¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’å¿…è¦ãªå ´åˆã«ã®ã¿å®Ÿè¡Œã§ãã‚‹ãŸã‚ã€å®Ÿè¡Œæ™‚ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å‰Šæ¸›ã§ãã‚‹
    - æ¬ ç‚¹: å¥‘ç´„é•åã®æ¤œå‡ºãŒé…ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚ã“ã®æ©Ÿæ§‹ãã®ã‚‚ã®ã«é¿ã‘é›£ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒã‚ã‚‹
6. å®Ÿè¡Œæ™‚ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹é¸æŠ
    - ç‰¹å¾´: ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªã‚¯ã‚¨ãƒªé–¢æ•°ã«ã‚ˆã£ã¦å®Ÿè¡Œæ™‚ã«å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã®æœ‰åŠ¹ç„¡åŠ¹ã‚’å–å¾—ã—ã€æœ‰åŠ¹ãªå ´åˆã«ã®ã¿ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†
    - åˆ©ç‚¹: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ç­‰ã®ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é…å¸ƒã™ã‚‹å­˜åœ¨ãŒã€å¥‘ç´„ã®æœ‰åŠ¹ç„¡åŠ¹ã§é…å¸ƒã™ã‚‹ãƒã‚¤ãƒŠãƒªã‚’åˆ†ã‘ã‚‹å¿…è¦ãŒç„¡ã„
    - æ¬ ç‚¹: å®Ÿè¡Œæ™‚ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒè¿½åŠ ã•ã‚Œã‚‹
7. ãƒ­ãƒ¼ãƒ‰æ™‚ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹é¸æŠ
    - ç‰¹å¾´: ç’°å¢ƒå¤‰æ•°ãªã©ã‚’ä»‹ã—ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ­ãƒ¼ãƒ‰æ™‚ã«å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã‹ã©ã†ã‹ã‚’æ±ºå®šã™ã‚‹
    - åˆ©ç‚¹: 6ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨åŒã˜ãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã€å®Ÿè¡Œæ™‚ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å›é¿ã§ãã‚‹
    - æ¬ ç‚¹: é–¢æ•°ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–ã‚’é˜»å®³ã™ã‚‹

ã“ã®ã‚ˆã†ãªå®Ÿè£…ã‚’è€ƒæ…®ã™ã‚‹ã“ã¨ã§ã€å„å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚‹å¥‘ç´„æ¡ä»¶è©•ä¾¡å›æ•°ã‚’æ±‚ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

|ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ|è©•ä¾¡å›æ•°ã®æœ€å°å€¤|è©•ä¾¡å›æ•°ã®æœ€å¤§å€¤|
|---|---|---|
|å…¨ã¦å‘¼ã³å‡ºã—å…ˆã§ãƒã‚§ãƒƒã‚¯|1|1|
|å‘¼ã³å‡ºã—å´ãƒã‚§ãƒƒã‚¯ï¼ˆ3ï¼‰|0|1|
|å‘¼ã³å‡ºã—å´ãƒã‚§ãƒƒã‚¯ï¼ˆ4ï¼‰|1|1|
|ä¸¡å´ãƒã‚§ãƒƒã‚¯|2|2|
|é…å»¶ãƒã‚§ãƒƒã‚¯|0|1(âˆ)|
|å®Ÿè¡Œæ™‚ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹é¸æŠ|0|1|
|ãƒ­ãƒ¼ãƒ‰æ™‚ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹é¸æŠ|0|1|

ã“ã®æ–‡æ›¸ã¯ã©ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒè‰¯ã„ã‹ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€å¯èƒ½ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’åˆ—æŒ™å­æ¯”è¼ƒã™ã‚‹å˜ä¸€ã®æ–‡æ›¸ã‚’æä¾›ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

### [P3268R0 C++ Contracts Constification Challenges Concerning Current Code](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3268r0.html)

å¥‘ç´„æ³¨é‡ˆå†…ã§ã®æš—é»™`const`åŒ–ã®å½±éŸ¿ã‚’è¦‹ç©ã‚‚ã‚‹æ–‡æ›¸ã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ã§ã¯ã€å¥‘ç´„æ³¨é‡ˆå†…ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹å¤–éƒ¨ã®ã‚‚ã®ï¼ˆé–¢æ•°å¼•æ•°ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ï¼‰ã¯æš—é»™ã«`const`ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ãŒã€ã“ã‚Œã«å¯¾ã—ã¦ã‚³ãƒ¼ãƒ‰ã®ä»–ã®éƒ¨åˆ†ã¨ã®ä¸ä¸€è‡´ç­‰ã®æ‡¸å¿µãŒæèµ·ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®æ–‡æ›¸ã¯ã€ç­†è€…ã®æ–¹ã®æ‰€å±ã™ã‚‹ä¼æ¥­ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®èª¿æŸ»ã«ã‚ˆã£ã¦ã€ãã‚ŒãŒã©ã®ç¨‹åº¦å½±éŸ¿ã™ã‚‹ã‹ã‚’è¦‹ç©ã‚‚ã£ãŸã‚‚ã®ã§ã™ã€‚

çµæœã¨ã—ã¦ã¯ã€ï¼ˆã“ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã¯ï¼‰300å€‹ã«1å€‹ã®ã‚¢ã‚µãƒ¼ãƒˆã«ã¤ã„ã¦æ³¨æ„ãŒå¿…è¦ï¼ˆ`const`åŒ–ã®å½±éŸ¿ã‚’å—ã‘ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼‰ã§ã€ãã®ã‚ˆã†ãªè¡Œã¯100000è¡Œã«1è¡Œç¨‹åº¦ç™ºç”Ÿã™ã‚‹ã¨å ±å‘Šã—ã¦ã„ã¾ã™ã€‚

ãã—ã¦ã€çµè«–ã¨ã—ã¦ã¯æš—é»™`const`åŒ–ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãƒ˜ã®å½±éŸ¿ã¯å°ã•ãã€ãã®ä»•æ§˜ã‚’å‰Šé™¤ã™ã‚‹å¿…è¦ã¯ç„¡ã„ã¨ã—ã¦ã„ã¾ã™ã€‚

### [P3269R0 Do Not Ship Contracts as a TS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3269r0.pdf)

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’TSã¨ã—ã¦å‡ºè·ã™ã‚‹ã“ã¨ã«åå¯¾ã™ã‚‹ææ¡ˆã€‚

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ææ¡ˆï¼ˆP2900R6ï¼‰ãŒEWGã«è»¢é€ã•ã‚Œã¦ä»¥é™ã€ã‚ã‚‹ãƒ™ãƒ³ãƒ€ãŒå¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ã‚ã‚‹å´é¢ã«ã¤ã„ã¦ç¶™ç¶šçš„ã«åå¯¾ã—ã¦ã„ã‚‹ä»–ã€ã„ãã¤ã‹ã®å´é¢ã§EWGã§åˆæ„ãŒå–ã‚Œã¦ã„ãªã„ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚ãã‚Œã‚’å—ã‘ã¦ã¨ã„ã†R0ã§ã¯å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’TSã¨ã—ã¦å‡ºè·ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ãã‚Œã¨ã¯é€†ã«å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯TSã‚’ç›®æŒ‡ã•ãšã«C++26ã«å°å…¥ã™ã¹ãã€ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã§ã¯TSã§ã¯ãªãç›´æ¥ISã‚’ç›®æŒ‡ã™ã¹ãç†ç”±ã¨ã—ã¦æ¬¡ã®äº‹ã‚’æŒ™ã’ã¦ã„ã¾ã™

- å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯C++ã®å®‰å…¨æ€§å‘ä¸Šã«å½¹ç«‹ã¤
    - å®‰å…¨æ€§ã®å‘ä¸Šã¯æ€¥å‹™
- å°†æ¥ã®æ‹¡å¼µã®ãŸã‚ã®åŸºç¤
    - ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯å®Œå…¨ãªã‚‚ã®ã‚’ç›®æŒ‡ã—ã¦ãŠã‚‰ãšã€å°†æ¥æ‹¡å¼µå¯èƒ½ãªç¾åœ¨åˆæ„ã§ãã‚‹æœ€å°ã®ã‚‚ã®
    - TSã§é”æˆã§ãã‚‹ã“ã¨ã¯ã€C++26ã«å…¥ã‚Œã¦ã‚‚é”æˆã§ãã‚‹
- Contracts MVPã¯å“è³ªã®å¦¥å”ã§ã¯ãªã„
    - MVPã¯æ©Ÿèƒ½ã‚»ãƒƒãƒˆã®å¦¥å”ã§ã‚ã‚Šã€ã“ã‚Œã¯WG21ãŒåˆæ„å¯èƒ½ãªæœ€å°ã®ã‚‚ã®ã§ã‚ã£ã¦ã€å“è³ªã®å¦¥å”ã§ã¯ãªã„
    - C++26ã«é–“ã«åˆã‚ãªã„å ´åˆã¯TSã§ã¯ãªãC++29ã‚’ç›®æŒ‡ã™ã¹ã

ã¾ãŸã€TSãŒæœ‰ç”¨ã§ã¯ãªã„ç†ç”±ã¨ã—ã¦æ¬¡ã®äº‹ã‚’æŒ™ã’ã¦ã„ã¾ã™

- æ™‚é–“ã¨ãƒªã‚½ãƒ¼ã‚¹ã®éåŠ¹ç‡ãªä½¿ç”¨
    - TSãƒ—ãƒ­ã‚»ã‚¹ã¯æ™‚é–“ã¨æ‰‹é–“ãŒã‹ã‹ã‚‹
        - å…¬é–‹ã ã‘ã§1å¹´ã‹ã‹ã‚‹
    - ãã®ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ã€ç¾åœ¨ã®P2900R6ã«å¯¾ã™ã‚‹æ„è¦‹ã®ç›¸é•ç‚¹ã‚„å•é¡Œã®è§£æ¶ˆã«è²»ã‚„ã™ã¹ã
    - ãã‚‚ãã‚‚ã€TSã«è¡Œãã¹ãã‹ã‚’æ¤œè¨ã™ã‚‹ã“ã®æ™‚é–“ã‚‚ã‚‚ã£ãŸã„ãªã„
- å®Ÿè£…çµŒé¨“ã‚’å¾—ã‚‹ãŸã‚ã«TSã¯ä¸è¦
    - å¦¥å½“ãªå“è³ªã®ä»•æ§˜æ›¸ã¨ãã‚Œã‚’å®Ÿè£…ã™ã‚‹æ™‚é–“ã¨è³‡é‡‘ãŒã‚ã‚Œã°ã€å®Ÿè£…çµŒé¨“ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã‚‹
    - ä»•æ§˜æ›¸ãŒTSã¨ã—ã¦å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‹ã¯é‡è¦ã§ã¯ãªã„
- TSã¯æœªè§£æ±ºã®å•é¡Œã®è§£æ±ºã«å½¹ç«‹ãŸãªã„
    - TSã‚’å…¬é–‹ã™ã‚‹å‰ã«ã€TSãŒå›ç­”ã™ã¹ãè³ªå•ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹
    - P2900R6ã«å¯¾ã™ã‚‹ãã®ã‚ˆã†ãªãƒªã‚¹ãƒˆã¯ã™ã§ã«å¾—ã‚‰ã‚Œã¦ãŠã‚Šã€C++26ã‚µã‚¤ã‚¯ãƒ«ã®æ®‹ã‚Šã®æ™‚é–“ã§è§£æ±ºå¯èƒ½ã§ã‚ã‚‹ã¨è¦‹ç©ã‚‚ã‚‰ã‚Œã¦ã„ã‚‹

æœ€å¾Œã«ã€ç¾åœ¨ã®Contracts MVPï¼ˆP2900R6ï¼‰ã«å¯¾ã™ã‚‹æœªè§£æ±ºã®å•é¡Œã‚’ã“ã“ã§ã‚‚ã¾ã¨ã‚ã¦ã„ã¾ã™

- ä»®æƒ³é–¢æ•°ã«å¯¾ã™ã‚‹å¥‘ç´„
    - ã¾ã MVPã«ãƒãƒ¼ã‚¸å‰ã ãŒæˆç†Ÿã—ãŸææ¡ˆãŒã™ã§ã«ã‚ã‚‹ãŸã‚ã€C++26ã«é–“ã«åˆã†ã¨è€ƒãˆã‚‰ã‚Œã‚‹
- é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¨å¥‘ç´„
    - MVPã¯æ—¢ã«ã€é–¢æ•°ãŒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰å‘¼ã°ã‚Œã‚‹å ´åˆã§ã‚‚å¥‘ç´„æ¡ä»¶ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ã“ã¨ã‚’æ±‚ã‚ã¦ã„ã‚‹
    - é–¢æ•°ãƒã‚¤ãƒ³ã‚¿è‡ªä½“ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã¯ã€ç¾åœ¨ã®C++ã®ãƒ¢ãƒ‡ãƒ«ã«é©åˆã—ãªã„ãŸã‚MVPã®ç¯„å›²å¤–
- ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹å¥‘ç´„
    - ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã¯äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„
    - SG21ãŠã‚ˆã³EWGã®ã»ã¨ã‚“ã©ã®äººã¯ã“ã‚Œã¯MVPã®ç¯„å›²å¤–ã ã¨è€ƒãˆã¦ã„ã‚‹
- è©•ä¾¡å›æ•°ã¨æš—é»™`const`ã«ã¤ã„ã¦
    - æœ€è¿‘ç‰¹ã«è­°è«–ã•ã‚Œã¦ã„ã‚‹åˆ†é‡ã§ã‚ã‚Šã€ææ¡ˆã‚‚ã„ãã¤ã‚‚å‡ºæƒã£ã¦ã„ã‚‹
    - è§£æ±ºç­–ã¯ã©ã‚Œã‚‚ã€ã©ã‚ŒãŒé–“é•ã£ã¦ã„ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã¯ãªãã€ä½•ã‚’å„ªå…ˆã™ã¹ãã‹ãŒç•°ãªã‚‹ã ã‘
    - ã“ã®å„ªå…ˆã™ã¹ãã‚‚ã®ã‚’æ±ºã‚ã‚‹ã ã‘ã§ã‚ã‚Šã€ã“ã®ä½œæ¥­ã¯æ—¢ã«å§‹ã¾ã£ã¦ã„ã‚‹
- é•åãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰ã®ä¾‹å¤–é€å‡º
    - é•åãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰ã®ä¾‹å¤–é€å‡ºã‚’è¨±å¯ã™ã‚‹ãƒ»ã—ãªã„ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«ã¤ã„ã¦ã¯ã€è­°è«–ã—åˆæ„ã‚’å¾—ã‚‹å¿…è¦ãŒã‚ã‚‹
    - ä¸å¯èƒ½ãªä½œæ¥­ã§ã¯ãªãã€TSã¯å½¹ã«ç«‹ãŸãªã„
- æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã®å¥‘ç´„ã®ä½¿ç”¨
    - TSã‚’å‡ºè·ã—ã¦ã‚‚ã€ã“ã®å•é¡Œã®è§£æ±ºã«ã¯å½¹ã«ç«‹ãŸãªã„
    - ç¾åœ¨ã®ã¨ã“ã‚ã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä»•æ§˜ã«å¥‘ç´„æ³¨é‡ˆã‚’è¦å®šã™ã‚‹ã“ã¨ã¯æ™‚æœŸå°šæ—©ã§ã‚ã‚Šã€å®Ÿè£…ã‚’è¨±å¯ã™ã‚‹ã‚‚ã®ã®å¿…é ˆã¨ã¯ã—ãªã„ã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ãŒã‚ã‚‹
- å¥‘ç´„ã¨æœªå®šç¾©å‹•ä½œ
    - å¥‘ç´„æ³¨é‡ˆã¯ã€ãã‚ŒãŒå­˜åœ¨ã™ã‚‹å ´æ‰€ã‚ˆã‚Šã‚‚å¾Œã®æœªå®šç¾©å‹•ä½œï¼ˆã®ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒ™ãƒ«æœ€é©åŒ–ï¼‰ã«ã‚ˆã‚‹å½±éŸ¿ã¨ã€å¥‘ç´„æ¡ä»¶å¼å†…ã§ã®æœªå®šç¾©å‹•ä½œã«ã‚ˆã‚‹å½±éŸ¿ã®2ç¨®é¡ã®å½±éŸ¿ã‚’å—ã‘ã‚‹
    - ã„ãšã‚Œã®å•é¡Œã‚‚ã€ä¸€å®šã®è§£æ±ºã‚’åˆæ„æ¸ˆã¿
    - æœªå®šç¾©å‹•ä½œã‚’åˆ¶é™ã™ã‚‹ã‚µãƒ–ã‚»ãƒƒãƒˆã®åˆ©ç‚¹ã¯ä¸æ˜ã§ã‚ã‚Šã€TSã«ã—ãŸã¨ã—ã¦ã‚‚ã“ã®è§£æ±ºã«å½¹ç«‹ãŸãªã„
    - å¥‘ç´„æ³¨é‡ˆã®å•é¡Œã¯ã€å®‰å…¨ã§ã¯ãªã„ã“ã¨ã§ã¯ãªãå­˜åœ¨ã—ãªã„ã“ã¨

SG21ã§ã¯å¥‘ç´„ã‚’TSã¨ã—ãªã„ã“ã¨ã«åˆæ„ãŒå–ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ãŒã€æœ€çµ‚çš„ã«æ±ºå®šã™ã‚‹ã®ã¯EWGã®ã‚ˆã†ã§ã™ã€‚

- [ã¨ã„ã† é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1921)

### [P3270R0 Repetition, Elision, and Constification w.r.t. contract_assert](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3270r0.pdf)

`contract_assert`ã®ç¾åœ¨ã®å•é¡Œç‚¹ã«ã¤ã„ã¦ã€åŸå‰‡ã«ç…§ã‚‰ã—ã¦æ¤œè¨ã™ã‚‹ææ¡ˆã€‚

ã“ã®ææ¡ˆã§ã¯ã¾ãšã€å¥‘ç´„æ³¨é‡ˆã®ç¾åœ¨ã®ä»•æ§˜ã«é–¢ã™ã‚‹æ¬¡ã®2ã¤ã®å•é¡Œç‚¹

1. å¥‘ç´„æ¡ä»¶å¼å†…ã§ã®å¤‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ`const`åŒ–
2. å®Ÿè¡Œæ™‚ã®å¥‘ç´„æ¡ä»¶å¼ã®è©•ä¾¡å›æ•°
    - 2å›ä»¥ä¸Šè©•ä¾¡ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€çœç•¥å¯èƒ½ã§ã‚‚ã‚ã‚‹ã“ã¨

ã«ã¤ã„ã¦ã€ç‰¹ã«`contract_assert`ãŒã“ã®æ‡¸å¿µç‚¹ã‚’è§£æ¶ˆå¯èƒ½ã§ã‚ã‚‹ã‹ã€ä»–ã®å¥‘ç´„æ³¨é‡ˆã¨ã©ã®ç¨‹åº¦ç•°ãªã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ãªã©ã«ã¤ã„ã¦æ¤œè¨ã—ã¦ã„ã¾ã™ã€‚

æç¤ºã•ã‚Œã¦ã„ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ã¯ã€æ¬¡ã®æ©Ÿèƒ½å˜ä½æ¯ã«å–ã‚Šé™¤ãã¨ã©ã†ãªã‚‹ã‹ã«ã¤ã„ã¦æ¤œè¨ã—ã¦ã„ã¾ã™

- **EL** (Elision Clause): ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«è¿°èªãŒå¸¸ã«å½ã¨åˆ¤æ–­ã§ãã‚‹å ´åˆã«ã€ãã®è©•ä¾¡ã‚’çœç•¥ã§ãã‚‹è¦å®š
- **RE** (Repetition): è¿°èªã‚’è¤‡æ•°å›è©•ä¾¡ã™ã‚‹ã“ã¨ã‚’å·¨kã™ã‚‹è¦å®š
- **IM** (Implementation Latitude): ä¸€ã¤ã®ç¿»è¨³å˜ä½å†…ã§ã€å…¨ã¦åŒã˜å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‹ã—ãªã„ã‹ï¼‰ã‚’é©ç”¨ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹
    - Cã‚¢ã‚µãƒ¼ãƒˆã®ã‚ˆã†ã«ã€1ã¤ã®ãƒ•ãƒ©ã‚°ã§å…¨ã¦ã®å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’ä¸€æ‹¬åˆ¶å¾¡ã™ã‚‹

æç¤ºã•ã‚Œã¦ã„ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ¬¡ã®6ã¤ã§ã™

- **ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ A: C++26ã§ã¯ä½•ã‚‚ã›ãšã€C++29ã‚’å¾…ã¤**
    - åˆ©ç‚¹:  C++29ã«å‘ã‘ã¦ã€ã‚ã‚‰ã‚†ã‚‹é¸æŠè‚¢ã‚’æ®‹ã›ã‚‹
    - æ¬ ç‚¹:  C++26ã§ã¯ç¾çŠ¶ã®å•é¡ŒãŒè§£æ±ºã•ã‚Œãªã„
- **ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ B: P2900ã‚’ç¾çŠ¶(P2900R7)ã®ã¾ã¾ç¶­æŒ**
    - åˆ©ç‚¹:
        - `contract_assert`ã®ä»•æ§˜ãŒã€`pre`ã‚„`post`ã¨ä¸€è²«æ€§ã‚’ä¿ã¦ã‚‹
        - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå´ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ç‹¬ç«‹ã—ãŸãƒã‚§ãƒƒã‚¯ãŒå¯èƒ½ã«ãªã‚‹
        - æ•™ãˆã‚‹å†…å®¹ãŒå°‘ãªãã€å‰¯ä½œç”¨ã«ã¤ã„ã¦ã‚‚æ·±ãæ•™ãˆãªãã¦æ¸ˆã‚€
        - `const` åŒ–ã¨ã®æ•´åˆæ€§ãŒå–ã‚Œã‚‹
        - ç ´å£Šçš„ãªå‰¯ä½œç”¨ã‚’å«ã‚€å˜ä½“ãƒ†ã‚¹ãƒˆã‚„ãƒ™ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ã«ãªã‚‹
        - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‰¯ä½œç”¨ã®ä½¿ç”¨ã‚’æŠ‘æ­¢ã§ãã‚‹
        - å®Ÿè£…ã®é¸æŠè‚¢ãŒæœ€ã‚‚åºƒç¯„å›²ã«æ¸¡ã‚‹
        - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’ã€å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¡ãªãŒã‚‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ Cã€Dã€Eã€ã¾ãŸã¯ F ã«ç§»è¡Œã§ãã‚‹
    - æ¬ ç‚¹:  ç¾çŠ¶ã®å•é¡ŒãŒè§£æ±ºã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚‹
- **ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ C: çœç•¥æ¡é … (EL) ã‚’å‰Šé™¤ã—ãŸ P2900 (P2900 - EL)**
    - åˆ©ç‚¹:
        - è¿°èªã‚’è¤‡æ•°å›ç¹°ã‚Šè¿”ã™ã“ã¨ã§ã€ç ´å£Šçš„ãªå‰¯ä½œç”¨ã®ãƒ†ã‚¹ãƒˆãŒå¯èƒ½ã«ãªã‚‹
        - é™çš„ã«0ã§ã‚ã‚‹ã¨è¨¼æ˜ã§ããªã„å†ªç­‰ãªå‰¯ä½œç”¨ã¸ã®ä¾å­˜ãŒå¯èƒ½ã«ãªã‚‹
        - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’ã€å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¡ãªãŒã‚‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ E ã¾ãŸã¯ F ã«ç§»è¡Œã§ãã‚‹
    - æ¬ ç‚¹:  å‰¯ä½œç”¨ã®æ‰±ã„ã«é–¢ã™ã‚‹å•é¡ŒãŒæ®‹ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- **ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ D: ç¹°ã‚Šè¿”ã— (RE) ã‚’å‰Šé™¤ã—ãŸ P2900 (P2900 - RE)**
    - åˆ©ç‚¹:
        - è¡¨æ˜è¿°èªã®è©•ä¾¡ã‚³ã‚¹ãƒˆãŒå¢—åŠ ã™ã‚‹ã“ã¨ãŒãªã„
        - æ—¢å­˜ã®é–‹ç™ºè€…ã«ã¨ã£ã¦é¦´æŸ“ã¿ã‚„ã™ã„æ–¹æ³•ã§æ•™ãˆã‚‰ã‚Œã‚‹
        - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’ã€å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¡ãªãŒã‚‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ E ã¾ãŸã¯ F ã«ç§»è¡Œã§ãã‚‹
    - æ¬ ç‚¹:  æŸ”è»Ÿæ€§ãŒä½ãã€ã„ãã¤ã‹ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã§ããªã„å¯èƒ½æ€§ãŒã‚ã‚‹
- **ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ E: çœç•¥ (EL) ã¨ç¹°ã‚Šè¿”ã— (RE) ã‚’å‰Šé™¤ã—ãŸ P2900 (P2900 - EL - RE)**
    - åˆ©ç‚¹:
        - ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³Cã¨Dã®åˆ©ç‚¹ã‚’ä½µã›æŒã¤
        - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’ã€å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¡ãªãŒã‚‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ F ã«ç§»è¡Œã§ãã‚‹
    - æ¬ ç‚¹:  æŸ”è»Ÿæ€§ãŒã•ã‚‰ã«ä½ããªã‚Šã€é©ç”¨ç¯„å›²ãŒé™å®šã•ã‚Œã‚‹
- **ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ F: çœç•¥ (EL)ã€ç¹°ã‚Šè¿”ã— (RE) ã‚’å‰Šé™¤ã—ã€ç¿»è¨³å˜ä½ã”ã¨ã«1ç¨®é¡ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã¾ãŸã¯ãƒã‚§ãƒƒã‚¯ãªã—ï¼‰ã®ã¿ã‚’æŒã¤ P2900 (P2900 - EL - RE - IM)**
    - åˆ©ç‚¹:
        - ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³C, D, Eã®åˆ©ç‚¹ã‚’ä½µã›æŒã¤
        - C ã® `assert` ã¨åŒæ§˜ã«å‹•ä½œã—ã€ç¿»è¨³å˜ä½ã”ã¨ã«å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒã™ã¹ã¦ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ã‹ã€ã™ã¹ã¦ãƒã‚§ãƒƒã‚¯ã•ã‚Œãªã„ã‹ã®ã„ãšã‚Œã‹ã«ãªã‚‹
    - æ¬ ç‚¹:
        - å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¤ç§»è¡Œãƒ‘ã‚¹ãŒãªã„
        - æŸ”è»Ÿæ€§ãŒæœ€ã‚‚ä½ãã€`pre`ã‚„`post`ã¨ã®æ•´åˆæ€§ãŒä½ã„

ãã—ã¦ã€ã“ã®ä½œæ¥­ã®éç¨‹ã§ç¾åœ¨ã®`assert`ãƒã‚¯ãƒ­ã‚’å®Œå…¨ã«ä»£æ›¿ã™ã‚‹ã“ã¨ã®ã§ãã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãŒç„¡ã„ã¨ã„ã†æ–°ãŸãªå•é¡ŒãŒèªè­˜ã•ã‚ŒãŸãŸã‚ã€ãã®å¯¾ç­–ã¨ã—ã¦P3290ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¾åœ¨ã®Contracts MVPã«ãƒãƒ¼ã‚¸ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

P3290ã®è©³ç´°ã¯å¾Œã®æ–¹ã§è©³ã—ãèª¬æ˜ã—ã¾ã™ãŒã€æ¦‚ã­æ¬¡ã®3ã¤ã®ã‚‚ã®ã‹ã‚‰ãªã‚Šã¾ã™

1. å¾“æ¥ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ãŒå¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®APIã®æä¾›
2. C++ã«ãŠã‘ã‚‹`assert`ãƒã‚¯ãƒ­ã®å®šç¾©ã‚’å¤‰æ›´ã—ã¦ã€`cerr`ã«è¨ºæ–­ã‚’å‡ºåŠ›ã™ã‚‹ä»£ã‚ã‚Šã«å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã‚’ï¼ˆæ¡ä»¶ä»˜ãã§ï¼‰å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹
    - ã“ã‚Œã«ã‚ˆã‚Šã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ãªã—ã§ï¼ˆå ´åˆã«ã‚ˆã£ã¦ã¯å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãªã—ã§ï¼‰æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã¯å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã‚’åˆ©ç”¨ã§ãã‚‹
3. `contract_assert`ã‚’ãƒŸãƒ©ãƒ¼ã™ã‚‹æ–°ã—ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æä¾›ã™ã‚‹
    - ã“ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§C++æ¨™æº–ã®`assert`ãƒã‚¯ãƒ­ã¨ãƒ•ãƒ©ã‚°äº’æ›ã®å‹•ä½œã‚’ã™ã‚‹
    - æ—¢å­˜ã®C`assert`ã‹ã‚‰ã®ç§»è¡Œã‚’å®¹æ˜“ã«ãƒã‚§ãƒƒã‚¯ã§ãã‚‹

çµè«–ã¨ã—ã¦ã¯ã€å…ˆã«æŒ™ã’ãŸ6ã¤ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®ã„ãšã‚Œã‚ˆã‚Šã‚‚ã€ç¾åœ¨ã®Contracts MVPã«P3290R0ã‚’ãƒãƒ¼ã‚¸ã—ãŸã‚‚ã®ï¼ˆP2900R7 + P3290R0ï¼‰ãŒé©ã—ã¦ã„ã‚‹ã¨ã—ã¦ã€ã“ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¨ã—ã¦ã„ã¾ã™ã€‚

- [P3004R0 Principled Design for WG21 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3004R0-Principled-Design-for-WG21)
- [P3270 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1926)

### [P3271R0 Function Usage Types (Contracts for Function Pointers)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3271r0.pdf)

å¥‘ç´„æ³¨é‡ˆã‚’æŒ‡å®šå¯èƒ½ãªæ–°ã—ã„é–¢æ•°å‹ã®ææ¡ˆã€‚

å†…éƒ¨ã§å‘¼ã³å‡ºã™æ“ä½œã‚’å¼•æ•°ã§å—ã‘å–ã‚‹é–¢æ•°`fancy_calculation()`ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚ã“ã®`fancy_calculation()`ã¯æ¸¡ã•ã‚Œã‚‹é–¢æ•°ã«å¯¾ã—ã¦æ¬¡ã®äº‹ã‚’æœŸå¾…ã—ã¦ã„ã¾ã™

- é–¢æ•°ã¯`int`å‹ã®å¼•æ•°ã‚’1ã¤ã ã‘å–ã‚‹
- é–¢æ•°ã¯`int`å‹ã®çµæœã‚’è¿”ã™
- é–¢æ•°ã«æ¸¡ã™å¼•æ•°ã¯æ­£ã®å€¤
- é–¢æ•°ã®çµæœã¯æ­£ã®å€¤ã§ã‚ã‚Šã€æ¸¡ã—ãŸæ•°ã‚ˆã‚Šå¤§ããã¯ãªã‚‰ãªã„

ä¾‹ãˆã°æ¬¡ã®é–¢æ•°ã¯ã“ã®è¦ä»¶ã‚’æº€ãŸã™ã‚‚ã®ã§ã™

```cpp
int identity( const int x ) { return x; }
int halve ( const int x ) { return x/2; }
```

ä¸€æ–¹ã§ã€æº€ãŸã•ãªã„ã‚‚ã®ã‚‚å®¹æ˜“ã«è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™

```cpp
int twice ( const int x ) { return 2*x; }
```

`fancy_calculation()`ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚„é–¢æ•°å‚ç…§ã‚’ä½¿ç”¨ã—ã¦`fancy_calculation()`ã«é–¢æ•°ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```cpp
int fancy_calculation(int(&f)(int));
```

`fancy_calculation()`ã¯å†…éƒ¨ã§æ¸¡ã•ã‚ŒãŸé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã¾ãŸã€æ¸¡ã™é–¢æ•°ï¼ˆã®å€™è£œï¼‰ã«å¯¾ã—ã¦å¥‘ç´„æ³¨é‡ˆã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

```cpp
int identity( const int x ) post( r: r == x );
int halve ( const int x ) post( r: r == x/2 );
int twice ( const int x ) pre( can_multiply(2,x) ) post( r: r == 2*x );
```

`fancy_calculation()`ã®æä¾›è€…ã¯å¥‘ç´„æ³¨é‡ˆã‚’ä½¿ç”¨ã—ã¦ã“ã®é–¢æ•°ã®å¥‘ç´„ã‚’æ˜æ–‡åŒ–ã—ã¦ãƒã‚§ãƒƒã‚¯ã‚’è¡ŒãŠã†ã¨ã—ã¾ã™

```cpp
int fancy_calculation( int(&op)(int), const int start )
  pre( start >= 0 )
  post( r: r >= 0 )
  post( r: r <= start )
  post( r: r == op(r) );
```

ã—ã‹ã—ã€ã“ã‚Œã‚‰ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¯`fancy_calculation()`ã®å‹•ä½œã«ã¤ã„ã¦ã®ã‚‚ã®ã§ã€`fancy_calculation()`ãŒå—ã‘å–ã£ã¦å†…éƒ¨ã§å‘¼ã³å‡ºã™æ“ä½œï¼ˆ`op`ï¼‰ã«ã¤ã„ã¦ã®ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãã®ã‚ˆã†ãªã‚‚ã®ã‚’æ›¸ãæ–¹æ³•ã§ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹æ–¹æ³•ã¨ã—ã¦ã€`contract_assert()`ã«ã‚ˆã£ã¦å®Ÿéš›ã®å‘¼ã³å‡ºã—å‰å¾Œã§ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã€ã¨ã„ã†æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

```cpp
int fancy_calculation( int(&op)(int), int start ) {
  int current = start;

  while( true )
  {
    contract_assert( current >= 0 ); // our responsibility
    
    int next = op( current );
    
    contract_assert( next >= 0 ); // Not our responsibility: these
    contract_assert( next <= current ); // fail if op was poorly chosen.
    
    if ( current == next )
      break;

    current = next;
  }
  
  return current;
}
```

ã“ã®æ–¹æ³•ã¯ã‚ã¾ã‚Šè‰¯ã„æ–¹æ³•ã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚å‘¼ã³å‡ºã—ãŒè¤‡æ•°å›ã«åŠã¶å ´åˆå†—é•·ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã‚„ã™ããªã‚Šã€ã“ã‚Œã‚‰ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®è¿½åŠ ã‚³ãƒ¼ãƒ‰ãŒå¿…è¦ã«ãªã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ãã—ã¦ã€ã“ã‚Œã‚‰ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¯æœ¬æ¥`op`ã‚’æ¸¡ã™ãƒ¦ãƒ¼ã‚¶ãƒ¼å´ã«å¯¾ã—ã¦ãã®è¦ä»¶ã‚’é€šçŸ¥ã™ã‚‹ã‚‚ã®ã§ã™ãŒã€é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã¯è¦‹ãˆãªããªã£ã¦ã„ã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªç”¨é€”ã«é©ã—ãŸã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã§ã‚ã‚Šã€ã“ã®ææ¡ˆã¯ãã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã„ãã¤ã‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¸ã‚“ã§ãã®ã‚ˆã†ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã—ã¦ã„ã¾ã™ã€‚

#### 1. `fancy_calculation()`ãŒæ¸¡ã•ã‚Œã‚‹é–¢æ•°ã«èª²ã™è¦ä»¶ã‚’åå‰ã®ä¸‹ã«ã¾ã¨ã‚ã‚‹

ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ãªé–¢æ•°å‹likeãªè¨˜è¿°ã«ã‚ˆã£ã¦ãã®è¦ä»¶ã‚’è¡¨ç¾ã—ã¾ã™

```cpp
int fancy_op( const int x ) usage
  pre( x >= 0 )
  post( r: r >= 0 )
  post( r: r <= x );
```

ã“ã‚Œã¯ã“ã®ææ¡ˆã§é–¢æ•°åˆ©ç”¨å‹ï¼ˆ*function usage type*ï¼‰ã¨å‘¼ã°ã‚Œã¦ã„ã‚‹ã€æ–°ã—ã„é–¢æ•°å‹ã§ã™ã€‚ã“ã®å‹ã¯`int(int)`ãªé–¢æ•°ãŒç‰¹å®šã®å‘¼ã³å‡ºã—å…ƒã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹æ–¹æ³•ã«ã¤ã„ã¦è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚

#### 2. `fancy_calculation()`ã§ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã‚ã‚‹é–¢æ•°ã‚’é¸ã‚“ã æ™‚ç‚¹ã§ã€ãã®é–¢æ•°ãŒ`fancy_op`ã§ã®ä½¿ç”¨ã‚’æ„å›³ã—ã¦ã„ã‚‹ã“ã¨ã‚’æ˜ç¤ºã™ã‚‹æ§‹æ–‡ã‚’ä½¿ç”¨ã™ã‚‹

```cpp
void print_fancy_results( int start ) {
  const std::array ops = {
    &fancy_op{identity},  // good choice
    &fancy_op{halve},     // good choice
    &fancy_op{twice}      // bad choice!
  };

}
```

`fancy_op{identity}`ã¯`identity()`é–¢æ•°ã‚’å‚ç…§ã™ã‚‹`fancy_op`å‹ã®å·¦è¾ºå€¤å¼ã§ã‚ã‚Šã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®æ™‚ç‚¹ã§ã€`fancy_calculation()`ã«æ¸¡ã™æ“ä½œã®åˆ©ç”¨å¥‘ç´„ã¨é¸ã°ã‚ŒãŸé–¢æ•°ã®å¥‘ç´„æ³¨é‡ˆã®ä¸¡æ–¹ãŒã€ãã‚Œã‚’æ¤œè¨¼ã—ã‚ˆã†ã¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§åˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ãŸã ã—ã€ã“ã®ææ¡ˆã§ã¯ã“ã®ã‚ˆã†ãªæ¤œè¨¼ã¾ã§ã‚‚ææ¡ˆã¯ã—ã¦ã„ã¾ã›ã‚“ã€‚

#### 3. å‹ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã£ã¦ã€ä½¿ç”¨ã™ã‚‹é–¢æ•°ãŒé¸ã°ã‚ŒãŸæ™‚ç‚¹ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹æ™‚ç‚¹ã¾ã§ã®ä¿ç®¡ãƒã‚§ãƒ¼ãƒ³ã‚’ä½œæˆã—ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã§ä¿ç®¡ã•ã‚Œã¦ã„ã‚‹é–¢æ•°ãŒä½¿ç”¨æ–¹æ³•ã«é©åˆã—ã¦ã„ã‚‹ã“ã¨ã‚’è¡¨æ˜ã™ã‚‹

```cpp
int fancy_calculation( fancy_op& op, int start );
  // halve/twiceã¯fancy_op&å¼•æ•°ã«æŸç¸›ã§ããªã„ãŒã€fancy_op{halve}/fancy_op{twice}ã¯æŸç¸›ã§ãã‚‹
```

`fancy_op`ã®ãƒã‚¤ãƒ³ã‚¿/å‚ç…§ã¯ã€å˜ãªã‚‹`int(int)`ã®ãƒã‚¤ãƒ³ã‚¿/å‚ç…§ã‚ã‚‹ã„ã¯ã»ã‹ã®é–¢æ•°åˆ©ç”¨å‹ã®ãƒã‚¤ãƒ³ã‚¿/å‚ç…§ã¨ã¯å‹ãƒ¬ãƒ™ãƒ«ã§ç•°ãªã‚Šã¾ã™ã€‚æƒ³å®šã™ã‚‹å®Ÿè£…ã§ã¯ã€`fancy_op`ã®ãƒã‚¤ãƒ³ã‚¿/å‚ç…§ã¯`int(int)`ã¸ã®ãƒã‚¤ãƒ³ã‚¿/å‚ç…§ã¨åŒã˜å®Ÿè¡Œæ™‚è¡¨ç¾ã‚’æŒã¡ã€å‹ã®åŒºåˆ¥ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã¨ãƒªãƒ³ã‚¯æ™‚ã®å‡¦ç†ã®ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

#### 4. `fancy_op`ã®ãƒã‚¤ãƒ³ã‚¿/å‚ç…§ã‚’ä»‹ã—ã¦é–“æ¥å‘¼ã³å‡ºã—ãŒè¡Œã‚ã‚Œã‚‹å ´åˆã€`fancy_op`ã§è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹è¦ä»¶ãŒãã®å‘¼ã³å‡ºã—æ™‚ã«æº€ãŸã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹

ã“ã“ã§ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹æ¡ä»¶ã¯å‚ç…§å…ˆã«ã‚ã‚‹é–¢æ•°ã®å¥‘ç´„æ³¨é‡ˆã¨ã¯ç„¡é–¢ä¿‚ã«ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ã‚‚ã®ã§ã€`fancy_op`ã®åˆ©ç”¨å´ãŒèª²ã™è¿½åŠ æ¡ä»¶ã¨ãªã‚‹ã€‚

```cpp
int fancy_calculation( fancy_op& op, int start ) {
  
  ...
  
  int next = op( current );
  // å®Ÿè¡Œã¯æ¬¡ã®é †åºã§è¡Œã‚ã‚Œã‚‹:
  // fancy_opã®äº‹å‰æ¡ä»¶ãƒã‚§ãƒƒã‚¯
  // å‚ç…§å…ˆé–¢æ•°ã®äº‹å‰æ¡ä»¶ãƒã‚§ãƒƒã‚¯
  // å‚ç…§å…ˆé–¢æ•°ã®æœ¬ä½“å®Ÿè¡Œ
  // å‚ç…§å…ˆé–¢æ•°ã®äº‹å¾Œæ¡ä»¶ãƒã‚§ãƒƒã‚¯
  // fancy_opã®äº‹å¾Œæ¡ä»¶ãƒã‚§ãƒƒã‚¯
  
  ...
}
```

ä¾‹ãˆã°opã«`twice`ãŒä½¿ç”¨ã•ã‚Œã¦ã€`twice()`ã®äº‹å‰æ¡ä»¶é•åã¨`fancy_op`ã®äº‹å¾Œæ¡ä»¶é•åãŒèµ·ã“ã‚‹ã¨ã€`twice()`ã‚’é¸æŠã—ãŸèª¤ã‚ŠãŒã“ã“ã§æ¤œå‡ºã•ã‚Œã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã“ã®ã‚ˆã†ã«ã€å¥‘ç´„æ³¨é‡ˆã‚’æŒ‡å®šå¯èƒ½ãªæ–°ãŸãªé–¢æ•°å‹ã‚’å°å…¥ã—ã¦ã€ãã‚Œã«å¯¾ã™ã‚‹é–¢æ•°å‚ç…§/ãƒã‚¤ãƒ³ã‚¿ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã€å‚ç…§ã•ã‚Œã‚‹é–¢æ•°ã®å¥‘ç´„ã¨ã¯åˆ¥ã«ã€å€‹åˆ¥ã®é–¢æ•°å‚ç…§/ãƒã‚¤ãƒ³ã‚¿ã®ç”¨é€”ã”ã¨ã«ç‰¹åŒ–ã—ãŸå¥‘ç´„ã‚’æŒã¤é–¢æ•°å‚ç…§/ãƒã‚¤ãƒ³ã‚¿ã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€å¥‘ç´„ãŒé–¢æ•°ã®å‹ã‚’å¤‰æ›´ã™ã¹ãã§ã¯ãªãã€å‹ã‚·ã‚¹ãƒ†ãƒ ã«è¤‡é›‘ã•ã‚’æŒã¡è¾¼ã‚€ã¹ãã§ã¯ãªãã€æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã¸ã®çµ±åˆã«éåº¦ã®å¤‰æ›´ã‚’è¦æ±‚ã™ã¹ãã§ã¯ãªã„ã¨ã„ã†è¨­è¨ˆåŸå‰‡ã‚’é‡è¦–ã—ã¦ãŠã‚Šã€ã“ã‚Œã‚‰ã‚’é”æˆã™ã‚‹ã“ã¨ã§ã“ã®ææ¡ˆã®å¤‰æ›´ã¯ã€C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ãŠã‘ã‚‹å¥‘ç´„ã¨é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®ã‚ˆã‚Šå …ç‰¢ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªç›¸äº’ä½œç”¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã²ã¨ã¾ãšã€MVPå¾Œã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®æ‹¡å¼µæ¡ˆã¨ã—ã¦æ¤œè¨ã—ã¦ã„ãã“ã¨ãŒSG21ã§ç¢ºèªã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P3271 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1927)

### [P3273R0 Introspection of Closure Types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3273r0.html)

é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã§ã€ãƒ©ãƒ ãƒ€å¼ã®ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã‹ã‚‰ã®æƒ…å ±å–å¾—ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ææ¡ˆã€‚

ãƒ©ãƒ ãƒ€å¼ã®ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã¯ã‚ã¾ã‚Šè©³ç´°ã«ãã®å‹ã®æ€§è³ªã«ã¤ã„ã¦æŒ‡å®šã•ã‚Œã¦ãŠã‚‰ãšã€ç‰¹ã«å‚ç…§ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸå ´åˆã«ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã®éé™çš„ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒ³ãƒã«å¯¾å¿œã™ã‚‹ä½•ã‹ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã¯æœªè¦å®šã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ãƒ©ãƒ ãƒ€å¼ã®å®Ÿè£…ã«ãŠã„ã¦æœ€é©åŒ–ã‚’è¡Œã†ã“ã¨ã‚’æ„å›³ã—ãŸã‚‚ã®ã®ã‚ˆã†ã§ã™ã€‚

ã—ã‹ã—ã€C++26ã¸å‘ã‘ã¦é€²è¡Œä¸­ã®é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ï¼ˆP2996ï¼‰ã§ã¯ã“ã®ãŸã‚ã«ã€ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«é–¢ã™ã‚‹ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®é©ç”¨ã‚’ã©ã†ã™ã‚‹ã‹ãŒå•é¡Œã¨ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã¯è¨ˆç®—ã¨ãã‚Œã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã²ã¨ã¾ã¨ã‚ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã—ã¦æ‰±ã†ãŸã‚ã®ç°¡å˜ãªæ–¹æ³•ã§ã‚ã‚Šã€æ¨™æº–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ã¯ã˜ã‚ã¨ã—ã¦C++ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æ§˜ã€…ãªéƒ¨åˆ†ã§åºƒãä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹ã«ã€CUDAã«ãŠã„ã¦ã¯ã€GPUã§ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’é‡è¦–ã—ã¦ãŠã‚Šï¼ˆæ¨™æº–ä¸¦åˆ—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚„Thrustï¼‰ã€ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã‚’ç‰¹åˆ¥ã«æ‰±ã£ã¦ãƒ›ã‚¹ãƒˆã¨ãƒ‡ãƒã‚¤ã‚¹ã®ä¸¡å´ã§é€éçš„ã«ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã‚’é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§æ”¯éšœãªãæ‰±ãˆã‚‹ã“ã¨ã¯ã€GPUä»¥å¤–ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’è·¨ã„ã§ãƒ‡ãƒ¼ã‚¿ã‚„è¨ˆç®—ã‚’ãƒãƒ¼ã‚·ãƒ£ãƒªãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚³ãƒ¼ãƒ‰ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€ãƒ—ãƒ­ã‚»ã‚¹é–“é€šä¿¡ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãªã©ï¼‰ã«ãŠã„ã¦ã‚‚æœ‰ç”¨ã¨ãªã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªæ©Ÿä¼šã‚’é–‰ã–ã•ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€ã“ã®ææ¡ˆã¯ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ãŒå‚ç…§ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸå ´åˆã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’äºˆæ¸¬å¯èƒ½ã«ã™ã‚‹ã“ã¨ã§ã€ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹é©ç”¨å¯èƒ½æ€§ã®å•é¡Œã‚’è§£æ¶ˆã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€å‚ç…§ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸãƒ©ãƒ ãƒ€å¼ã®ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã«é–¢ã™ã‚‹ç¾åœ¨ã®è¦å®šï¼ˆå‚ç…§ã‚­ãƒ£ãƒ—ãƒãƒ£ã«å¯¾å¿œã™ã‚‹éé™çš„ãƒ¡ãƒ³ãƒå¤‰æ•°ãŒå­˜åœ¨ã™ã‚‹ã‹ã¯æœªè¦å®šï¼‰ã‚’å¤‰æ›´ã—ã¦ã€å‚ç…§ã‚­ãƒ£ãƒ—ãƒãƒ£ã®å ´åˆã§ã‚‚å‚ç…§ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸç‰©ã”ã¨ã«å‚ç…§ãƒ¡ãƒ³ãƒãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’è¦å®šï¼ˆç„¡åã‹ã¤å®£è¨€æº–ã¯ä¸å®šï¼‰ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€æ—¢å­˜ã®å®Ÿè£…ã¯å…¨ã¦å‚ç…§ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’å‚ç…§ã¾ãŸã¯ãƒã‚¤ãƒ³ã‚¿ã‚’ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã®ãƒ¡ãƒ³ãƒã¨ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦å®Ÿç¾ã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã®å¤‰æ›´ã«ã‚ˆã£ã¦æŒ¯ã‚‹èˆã„ã®ä¿®æ­£ãŒå¿…è¦ã¨ãªã‚‹å®Ÿè£…ã¯å­˜åœ¨ã—ãªã„ã‹ã€å­˜åœ¨ã—ãŸã¨ã—ã¦ã‚‚å¤§ããªå½±éŸ¿ã¯ãªã„ã¨ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã®æœ€é©åŒ–ã«ã¤ã„ã¦ã‚‚ã€ã“ã®å¤‰æ›´ã¨é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®å°å…¥å¾Œã«ã€é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã®æƒ…å ±ã‚’å–å¾—ã•ã‚Œã¦ã„ãŸã¨ã—ã¦ã‚‚ãã®ãƒ©ãƒ ãƒ€å¼ã‚’æœ€é©åŒ–ã™ã‚‹ã“ã¨ã‚’å¦¨ã’ã‚‹ã“ã¨ã¯ãªã„ã¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯SG7ã‚’å…¨ä¼šä¸€è‡´ã§ãƒ‘ã‚¹ã—ã¦EWGã«è»¢é€ã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

- [P2996R0 Reflection for C++26 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P2996R0-Reflection-for-C26)
- [P3273 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1928)

### [P3274R0 A framework for Profiles development](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3274r0.pdf)

å®‰å…¨æ€§å‘ä¸Šã®ãŸã‚ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’C++ã«å°å…¥ã™ã‚‹ãŸã‚ã®é–‹ç™ºãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¤ã„ã¦è§£èª¬ã™ã‚‹æ–‡æ›¸ã€‚

ã“ã‚Œã¯ä»¥å‰ã«P2687R0ç­‰ã§ç¤ºã•ã‚Œã¦ã„ãŸã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ãªã©ã«å¯¾ã™ã‚‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã«ã‚ˆã£ã¦éƒ¨åˆ†çš„ã«å®‰å…¨æ€§ã®ä¿è¨¼ã‚’å¼·åŒ–ã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã®ã‚ˆã‚Šå…·ä½“çš„ãªã‚‚ã®ã§ã™ã€‚é–¢é€£ã™ã‚‹ã‚‚ã®ã«ã¤ã„ã¦ã¯ä»¥å‰ã®è¨˜äº‹ç­‰ã‚’å‚ç…§

- [P2687R0 Design Alternatives for Type-and-Resource Safe C++ - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/11/13/233529#P2687R0-Design-Alternatives-for-Type-and-Resource-Safe-C)
- [P2816R0 Safety Profiles:Type-and-resource Safe programming in ISO Standard C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2816r0.pdf)

ã“ã®æ–‡æ›¸ã¯ã€ä»¥å‰ã®ã“ã‚Œã‚‰ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å…·ä½“çš„ãªæ©Ÿèƒ½ææ¡ˆã¨ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã®æœ€åˆã®ã‚‚ã®ã§ã€ãã®è¨­è¨ˆæ€æƒ³ã‚„å¤§æ ã«ã¤ã„ã¦è§£èª¬ã—ãŸã‚‚ã®ã§ã™ã€‚

ã¾ãšã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹æ–¹æ³•ã¯`[[Profiles::enable(ranges)]]`ã®ã‚ˆã†ãªå±æ€§æ§‹æ–‡ã¨ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§æ˜ç¤ºçš„ã«è¦æ±‚ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚‚ã®ã§ã‚ã‚ŠãªãŒã‚‰ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šã«å¯¾ã—ã¦å˜ä¸€ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ç¶­æŒã™ã‚‹ã“ã¨ãŒã§ãã‚‹æ§‹æ–‡ã¨ã—ã¦å±æ€§æ§‹æ–‡ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€ã‚ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ãŸæ™‚ã§ã‚‚ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¨ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ä¸¡æ–¹ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦å®Ÿè¡Œå¯èƒ½ãªçŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãã—ã¦ã€ã“ã®ã‚ˆã†ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒæŒ‡å®šã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§ã¯ã€ãã®å­˜åœ¨ãã®ã‚‚ã®ã‚„ä»–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦æ¤œè¨¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã€é™çš„è§£æã¨å®Ÿè¡Œæ™‚æ¤œæŸ»ã‚’çµ„ã¿åˆã‚ã›ãŸä¸€å®šã®å®‰å…¨æ€§ã®ä¿è¨¼ã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€ãã®ã‚ˆã†ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆæœŸã®ã‚‚ã®ã¨ã—ã¦ç°¡å˜ã«é”æˆã§ãã‚‹ã‚‚ã®ãŒãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã¾ã™ã€‚ãŸã ã—ã€ãã‚Œã‚‰ã¯ã‚ãã¾ã§åˆæœŸã®ã‚‚ã®ã§ã‚ã‚Šã€ã“ã‚ŒãŒå®Œå…¨ãªã‚‚ã®ã¨ã„ã†ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®æ–‡æ›¸ã®ç›®çš„ã¯ã€å§”å“¡ä¼šã®äººã€…ãŒè‡ªåˆ†ã®å°‚é–€åˆ†é‡ã«æ³¨åŠ›ã—ãªãŒã‚‰ã‚‚å”åŠ›ã§ãã‚‹éƒ¨åˆ†ã§ã¯å”åŠ›ã—ã¦ã€æ®µéšçš„ã«ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚ãŸæ©Ÿèƒ½ã‚’æˆé•·ã•ã›ã¦ã„ãã“ã¨ã«ã‚ã‚Šã¾ã™ã€‚ã“ã®æ–‡æ›¸ã®ã„ã†ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã¯ã€ãã®ã‚ˆã†ãªç‹¬ç«‹ã—ãŸä½œæ¥­ã‚’å–ã‚Šã¾ã¨ã‚ã‚‹ä¸€ã¤ã®åœŸå°ã¨ã—ã¦ä½œç”¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ãã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ä¸€éƒ¨ã¨ã—ã¦ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä»•æ§˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒæç¤ºã•ã‚Œã¦ã„ã¾ã™

- åå‰
    - ï¼ˆå¸Œæœ›ã™ã‚‹ï¼‰ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å
- å®šç¾©
    - æä¾›ã•ã‚Œã‚‹ä¿è¨¼ã®ä»•æ§˜
- å½±éŸ¿
    - ä¿è¨¼ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ä½•ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹
- åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³
    - ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã§æ¯”è¼ƒçš„ç°¡å˜ã«å®Ÿè£…ã§ãã‚‹åˆæœŸ/é™å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ææ¡ˆ
- å‚™è€ƒ
    - å¿…è¦ãªå ´åˆã®è¿½åŠ ã‚³ãƒ¡ãƒ³ãƒˆ
- è³ªå•
    - è¨­è¨ˆã«é–¢ã™ã‚‹ç–‘å•
- è©³ç´°ãªä»•æ§˜
    - ä¿è¨¼ã®è©³ç´°ãªä»•æ§˜ã¨ã€ä¿è¨¼ã‚’å®Ÿæ–½ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ†ã‚¹ãƒˆãŒã©ã“ã«ã‚ã‚‹ã‹

ã“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¾“ã£ã¦ã€ã“ã“ã§ã‚ã’ã‚‰ã‚Œã¦ã„ã‚‹åˆæœŸãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ¬¡ã®ã‚‚ã®ã§ã™

- Type
    - å®šç¾©: ã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ãã®å®šç¾©ã«å¾“ã£ã¦ã®ã¿ä½¿ç”¨ã•ã‚Œã‚‹
    - å½±éŸ¿
      - é™çš„ãƒã‚§ãƒƒã‚¯ã¨å®Ÿè¡Œæ™‚ãƒã‚§ãƒƒã‚¯ã‚’çµ„ã¿åˆã‚ã›ã‚’å¿…è¦ã¨ã™ã‚‹å¼·åŠ›ãªä¿è¨¼
      - Rangesã€Invalidationã€Algorithmsã€Castingã€RAIIã€Unionãªã©ã®ã‚ˆã‚Šå˜ç´”ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®çµåˆã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
    - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³: Initializationã€Pointersã€Rangesã‹ã‚‰é–‹å§‹ã—ã€ä»–ã®åˆæœŸãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸã‚‰è¿½åŠ 
    - å‚™è€ƒ
        - å®Œå…¨ãªå‹å®‰å…¨æ€§ã‚’é”æˆã™ã‚‹ãŸã‚ã«ã¯ã€`span`ãªã©ã®æŠ½è±¡åŒ–ã®å®Ÿè£…å¤–éƒ¨ã§ã®ç”Ÿãƒã‚¤ãƒ³ã‚¿ã®æ·»å­—ã‚¢ã‚¯ã‚»ã‚¹ã€`null`ãƒã‚¤ãƒ³ã‚¿ã®é€†å‚ç…§ã€ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒã‚¤ãƒ³ã‚¿ã®ä½¿ç”¨ã€ãƒ€ãƒ³ã‚°ãƒªãƒ³ã‚°ãƒã‚¤ãƒ³ã‚¿ã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ï¼ˆãƒªã‚½ãƒ¼ã‚¹ã®æ¯æ¸‡ã«ã¤ãªãŒã‚‹ï¼‰ã‚’æ’é™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
          - ã“ã‚Œã«ã‚ˆã£ã¦ã€å¾“æ¥ã®Cã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã¯æ’é™¤ã•ã‚Œã‚‹ãŒã€C++11ä»¥é™ã®æ¨å¥¨äº‹é …ã«å¾“ã£ãŸå¤šãã®ã‚³ãƒ¼ãƒ‰ã¯æ’é™¤ã•ã‚Œãªã„
        - å®Œå…¨ãªå¾“æ¥ã®C++ ã¨ å®Œå…¨ãªå‹ã¨ãƒªã‚½ãƒ¼ã‚¹ã®å®‰å…¨æ€§ ã®ä¸¡æ–¹ã‚’åŒæ™‚ã«å®Ÿç¾ã™ã‚‹ã“ã¨ã¯ã§ããªã„
    - è³ªå•
      - ãƒ’ãƒ¼ãƒ—ã®æ¯æ¸‡ã¯å‹ã‚¨ãƒ©ãƒ¼ã‹ï¼Ÿ
        - çµ‚äº†ãŒé¸æŠè‚¢ã«ãªã„ä¸€éƒ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒ’ãƒ¼ãƒ—ã®æ¯æ¸‡ã‚’å‡¦ç†ã§ãã‚‹ãŸã‚ã€å‡¦ç†ã•ã‚Œã‚‹å ´åˆã¯å‹ã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„
      - ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ã¯å‹ã‚¨ãƒ©ãƒ¼ã‹ï¼Ÿ
        - ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ã¯å›å¾©ä¸èƒ½ãªã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã®å¤±æ•—ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚å‹ã‚¨ãƒ©ãƒ¼
- Arithmetic
    - å®šç¾©: ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã¨ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ•ãƒ­ãƒ¼ã¯ã‚¨ãƒ©ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã€ç¸®å°å¤‰æ›ã¯ã‚¨ãƒ©ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹
    - å½±éŸ¿: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼ãŒãƒã‚§ãƒƒã‚¯æ¸ˆã¿ç®—è¡“æ¼”ç®—ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
    - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³: ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ç®—è¡“æ¼”ç®—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã§ãã‚‹ã€‚Arithmeticãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒãã®ã‚ˆã†ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
    - å‚™è€ƒ
      - `round()`ã¨`truncate()`ãŒå¿…è¦ã€‚ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ç®—è¡“æ¼”ç®—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯å­˜åœ¨ã™ã‚‹ãŒæ¨™æº–ã§ã¯ãªã„
      - å¼å†…ã§ç¬¦å·ä»˜ãã¨ç¬¦å·ãªã—ã‚’æ··åœ¨ã•ã›ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã®é‡å¤§ãªåŸå› ã¨ãªã‚‹ã€‚ç‰¹ã«ã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚µã‚¤ã‚ºã«ç¬¦å·ãªã—æ•´æ•°å‹ã‚’ä½¿ç”¨ã™ã‚‹ã¨å›°é›£ãªå•é¡ŒãŒç™ºç”Ÿã™ã‚‹
    - è³ªå•
      - ã€ŒArithmeticã€ã¯ã€ŒCastã€ã‚’æš—ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ï¼Ÿ
        - æ¨å¥¨ã•ã‚Œã‚‹å›ç­”ï¼šã¯ã„
- Concurrency
    - å®šç¾©: ãƒ‡ãƒ¼ã‚¿ç«¶åˆãŒãªã„ã€‚ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ãŒãªã„ã€‚å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãªã©ï¼‰ã®ç«¶åˆã‚‚ãªã„
    - è³ªå•
      - ãƒ­ãƒƒã‚¯ã®ç«¶åˆãŒåŸå› ã§ç™ºç”Ÿã™ã‚‹å„ªå…ˆé †ä½ã®é€†è»¢ã‚„é…å»¶ã‚‚å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ï¼Ÿ
        - æ¨å¥¨ã•ã‚Œã‚‹åˆæœŸå›ç­”ï¼šã„ã„ãˆã€‚
    - å‚™è€ƒ: 
      - ã“ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¯ææ¡ˆã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã§ç¾åœ¨æœ€ã‚‚æˆç†Ÿã—ã¦ã„ãªã„ã€‚ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢é€£ã™ã‚‹ä½œæ¥­ã¯ç‰¹ã«è¡Œã‚ã‚Œã¦ã„ãªã„ãŒã€ä¸¦è¡Œå‡¦ç†ã®å•é¡Œã¯ä»–ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚³ã‚¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚„MISRAC++ãªã©ï¼‰ã§é›†ä¸­çš„ã«èª¿æŸ»ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€åˆæœŸä½œæ¥­ã«ã¤ã„ã¦ã„ãã¤ã‹ã®ææ¡ˆã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹
          - ã‚¹ãƒ¬ãƒƒãƒ‰ï¼šã‚¹ã‚³ãƒ¼ãƒ—é–¢é€£ã®å•é¡Œã‚’æ¸›ã‚‰ã™ãŸã‚ã«ã€`thread`ã‚ˆã‚Šã‚‚`jthread`ã‚’å„ªå…ˆã™ã‚‹
          - ãƒ€ãƒ³ã‚°ãƒªãƒ³ã‚°ãƒã‚¤ãƒ³ã‚¿ï¼š`jthread`ã‚’ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã¨ã¿ãªã—ã€ãƒªã‚½ãƒ¼ã‚¹ã®æœ‰åŠ¹æœŸé–“ï¼ˆRAIIï¼‰ã¨ç„¡åŠ¹åŒ–ã«é–¢ã™ã‚‹é€šå¸¸ã®ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã™ã‚‹
          - ã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°
            - ãƒã‚¤ãƒ³ã‚¿ãŒåˆ¥ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«æ¸¡ã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’é™çš„ã«æ¤œå‡ºã™ã‚‹
            - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯éè‡ªæ˜ãªåˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã«ãŠã‘ã‚‹ãƒã‚¤ãƒ³ã‚¿æ“ä½œã«åˆ¶é™ãŒå¿…è¦ã«ãªã‚‹
            - ä¸€èˆ¬ã«ã€ã™ã¹ã¦ã®ã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°ã‚’é™çš„ã«æ¤œå‡ºã§ãã‚‹ã‚ã‘ã§ã¯ãªã„ãŸã‚è¤‡é›‘ã™ãã‚‹ã‚³ãƒ¼ãƒ‰ã¯æ‹’å¦ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã€Œè¤‡é›‘ã™ãã‚‹ã€ã®å®šç¾©ãŒä¸å¯æ¬ ã¨ãªã‚‹
              - ãã†ã—ãªã„ã¨ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼ã®éäº’æ›æ€§ã®ãŸã‚ã«ç§»æ¤æ€§ã®å•é¡ŒãŒç™ºç”Ÿã™ã‚‹
          - ç„¡åŠ¹åŒ–ï¼š`unique_ptr`ã¨ã€ç„¡åŠ¹åŒ–æ“ä½œã‚’è¡Œã‚ãªã„ã‚³ãƒ³ãƒ†ãƒŠï¼ˆ`gsl::dyn_array`ãªã©ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒ¬ãƒƒãƒ‰é–“ã§æƒ…å ±ã‚’ã‚„ã‚Šå–ã‚Šã™ã‚‹
          - å¯å¤‰æ€§ï¼š`const`ãƒã‚¤ãƒ³ã‚¿ã‚’æ¸¡ã™ï¼ˆãŠã‚ˆã³ä¿æŒã™ã‚‹ï¼‰ã“ã¨ã‚’å„ªå…ˆ
          - åŒæœŸ
            - `scoped_lock`ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã®å¯èƒ½æ€§ã‚’æ¸›ã‚‰ã™
            - å¯å¤‰ãƒ‡ãƒ¼ã‚¿ã®è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«ãŠã‘ã‚‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’é™çš„ã«æ¤œå‡ºã—ã€ãã‚Œã‚‰ã‚’ä»‹ã—ãŸã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«åŒæœŸã®ä½¿ç”¨ã‚’å¼·åˆ¶ã™ã‚‹å¯èƒ½æ€§ã‚’æ¤œè¨ã™ã‚‹
            - ã‚¹ãƒ¬ãƒƒãƒ‰é–“ã§ã®ã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°ã‚’é˜²ããŸã‚ã«ã€`unique_ptr`ã‚’ä½¿ç”¨ã™ã‚‹
      - ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’æ¤œè¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
- Ranges
    - å®šç¾©: `[]`ã‚’ä½¿ç”¨ã—ãŸç¯„å›²å¤–æ·»å­—ã‚¢ã‚¯ã‚»ã‚¹ã¯ã‚¨ãƒ©ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹
    - å½±éŸ¿
      - ç”Ÿãƒã‚¤ãƒ³ã‚¿ã®æ·»å­—ã‚¢ã‚¯ã‚»ã‚¹ã¯è¨±å¯ã•ã‚Œãªã„
      - å®Ÿè¡Œæ™‚ãƒã‚§ãƒƒã‚¯ãŒå¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã€UBã«åŸºã¥ãã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒ™ãƒ«æœ€é©åŒ–ã‚’æ’é™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
    - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³: ç”Ÿãƒã‚¤ãƒ³ã‚¿ã®æ·»å­—ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¦æ­¢ã—ã€`vectorã€spanã€viewã€string`ã®æ·»ãˆå­—ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
    - è³ªå•
        - `std::array`ã¯ã©ã†ã™ã‚‹ï¼Ÿ
        - ã€ŒAlgorithmsã€ã¯ã€ŒRangesã€ã®ä¸€éƒ¨ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼Ÿ
          - æ¨å¥¨ã•ã‚Œã‚‹å›ç­”ï¼šã¯ã„ã€‚
        - Pointersï¼ˆÂ§3.5ï¼‰ã¯ Rangesï¼ˆÂ§3.4ï¼‰ã®ä¸€éƒ¨ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼Ÿ
          - æ¨å¥¨ã•ã‚Œã‚‹å›ç­”ï¼šã„ã„ãˆã€ã¾ãŸã¯éƒ¨åˆ†çš„ã«
    - å‚™è€ƒ: ã™ã¹ã¦ã®æ·»å­—ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã ã‘ã§ã¯ã€å¤šãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¨ã£ã¦å®Ÿè¡Œæ™‚ã‚³ã‚¹ãƒˆãŒè¨±å®¹ã§ããªã„ã‚‚ã®ã«ãªã‚‹ã€‚ã—ãŸãŒã£ã¦ã€å€‹ã€…ã®ãƒã‚§ãƒƒã‚¯ã¯æ“ä½œãŒç¯„å›²å†…ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãƒã‚§ãƒƒã‚¯ï¼ˆå˜ä¸€ã®ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹ï¼‰ã§ã‚µãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã“ã‚Œã¯ã€ç¯„å›²ãƒ™ãƒ¼ã‚¹`for`ãƒ«ãƒ¼ãƒ—ã¨`range`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å¼·ãæ¨å¥¨ã™ã‚‹ã“ã¨ã‚’æ„å‘³ã™ã‚‹
- Pointers
    - å®šç¾©
      - ã™ã¹ã¦ã®ãƒã‚¤ãƒ³ã‚¿ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã—ã¦ã„ã‚‹ã‹`nullptr`ã®ã©ã¡ã‚‰ã‹
      - ã™ã¹ã¦ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯è¦ç´ ã¾ãŸã¯ç¯„å›²ã®çµ‚ã‚ã‚Šã‚’æŒ‡ã—ã¦ã„ã‚‹
      - ãƒã‚¤ãƒ³ã‚¿ã¾ãŸã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’ä»‹ã—ãŸã™ã¹ã¦ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã€`nullptr`ã‚„ç¯„å›²ã®çµ‚ã‚ã‚Šã‚’æŒ‡ã™ãƒã‚¤ãƒ³ã‚¿ã‚’ä»‹ã—ãŸã‚‚ã®ã§ã¯ãªã„
    - å½±éŸ¿: ä¿¡é ¼ã§ãã‚‹é ˜åŸŸã®å¤–ï¼ˆ`span`ã®å¤–å´ãªã©ï¼‰ã§ã®ãƒã‚¤ãƒ³ã‚¿æ¼”ç®—ã‚’æ’é™¤
    - å½±éŸ¿: ãƒ€ãƒ³ã‚°ãƒªãƒ³ã‚°ãƒã‚¤ãƒ³ã‚¿ã‚’æ’é™¤ã—ã¾ã™
    - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³
      - `not_null`ã‚’å¿…é ˆã«ã™ã‚‹
      - ç¯„å›²ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä½¿ç”¨ã‚’å¿…é ˆã«ã™ã‚‹
      - ç¯„å›²ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ç¯„å›²ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸ`span`ã€ç¯„å›²ãƒ™ãƒ¼ã‚¹forã€ã¾ãŸã¯ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å¿…é ˆã«ã™ã‚‹
    - å‚™è€ƒ
      - ãƒã‚¤ãƒ³ã‚¿ã«æä¾›ã•ã‚Œã‚‹ä¿è¨¼ã¯ã™ã¹ã¦ã€çµ„ã¿è¾¼ã¿ãƒã‚¤ãƒ³ã‚¿ã§ã¯ãªã„ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è­˜åˆ¥ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚åŒæ§˜ã«é©ç”¨ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹
        - ãŸã¨ãˆã°ã€ãƒ©ãƒ ãƒ€ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚„`unique_ptr`ãªã©
      - ã™ã¹ã¦ã®é–“æ¥å‚ç…§æ“ä½œã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã ã‘ã§ã¯å¤šãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¨ã£ã¦å®Ÿè¡Œæ™‚ã‚³ã‚¹ãƒˆãŒè¨±å®¹ã§ããªã„ã‚‚ã®ã«ãªã‚‹ã€‚ã—ãŸãŒã£ã¦ã€å¤šãã®ç”¨é€”ã§ãƒã‚¤ãƒ³ã‚¿ã‚’1å›ã ã‘ãƒã‚§ãƒƒã‚¯ã™ã‚‹æ‰‹æ³•ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹
        - `not_null` ã¯ãã®æ–¹æ³•ã®1ã¤ã§ã‚ã‚Šã€ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯åˆ¥ã®æ–¹æ³•
- Algorithms
    - å®šç¾©
        - èª¤ã£ã¦æŒ‡å®šã•ã‚ŒãŸç¯„å›²ï¼ˆã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®ãƒšã‚¢ã‚„ãƒã‚¤ãƒ³ã‚¿ã¨ã‚µã‚¤ã‚ºãªã©ï¼‰ã«ã‚ˆã‚‹ç¯„å›²ã‚¨ãƒ©ãƒ¼ã¯ãªã„
        - ç„¡åŠ¹ãªã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®é€†å‚ç…§ã¯ãªã„
        - ç¯„å›²ã®çµ‚ç«¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®é€†å‚ç…§ã¯ãªã„
    - å½±éŸ¿
      - ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã«ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®ãƒšã‚¢ã§ã¯ãªãç¯„å›²ã‚’ä¸€è²«ã—ã¦ä½¿ç”¨ã—ã€å‡ºåŠ›ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ç¤ºã™ãŸã‚ã«å˜ä¸€ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹
      - ç¯„å›²ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ç¯„å›²ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹
    - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³
      - ã™ã¹ã¦ã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ç¯„å›²ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æä¾›ã™ã‚‹
      - ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ï¼ˆ`c`ï¼‰ã«ã¤ã„ã¦ã€`p`ãŒ`c`ã®çµ‚ã‚ã‚Šã‚’1ã¤éããŸã‚‚ã®ã§ã‚ã‚‹ã‹ã©ã†ã‹ï¼ˆã¤ã¾ã‚Šã€`p != end(c)` ã§ã‚ã‚‹ã‹ã©ã†ã‹ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹`not_end(c,p)`ãƒã‚§ãƒƒã‚¯ã‚’æä¾›ã—ã¦ã€é™çš„è§£æãŒæˆ»ã‚Šå€¤ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒé€†å‚ç…§ã•ã‚Œã‚‹å‰ã«ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
    - å‚™è€ƒ: ç„¡é™ã®ç¯„å›²ï¼ˆä¸€éƒ¨ã®`ostream`ãªã©ï¼‰ã¨è‡ªå‹•çš„ã«æ‹¡å¼µã•ã‚Œã‚‹ç¯„å›²ï¼ˆ`back_inserter`ã¸ã®æ›¸ãè¾¼ã¿ãªã©ï¼‰ã§ã¯ã€ï¼ˆã“ã®æŠ½è±¡åŒ–ãƒ¬ãƒ™ãƒ«ã§ã¯ï¼‰ç¯„å›²ãƒã‚§ãƒƒã‚¯ã¯å¿…è¦ãªã„
    - è©³ç´°ãªä»•æ§˜: ã“ã®ã‚ˆã†ãªä»•æ§˜ã®åˆæœŸæ®µéšã«ã¤ã„ã¦ã¯ã€ä»˜éŒ²ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
- Initialization
    - å®šç¾©: ã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯æ˜ç¤ºçš„ã«åˆæœŸåŒ–ã•ã‚Œã‚‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚‚å«ã‚ã¦ï¼‰
    - å½±éŸ¿: ã™ã¹ã¦ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒï¼ˆä¸€åº¦ã ã‘ï¼‰åˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ï¼ˆå†å¸°çš„ã«ï¼‰ãƒã‚§ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
    - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³: 
      - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ãŒã™ã¹ã¦ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’é©åˆ‡ã«åˆæœŸåŒ–ã™ã‚‹ã¨å˜ç´”ã«ä¿¡é ¼ã™ã‚‹
      - æœ€çµ‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ã€é™çš„è§£æã‚’ä½¿ç”¨ã—ã¦ã€ã™ã¹ã¦ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
    - å‚™è€ƒ
      - ã“ã®ä¿è¨¼ã¯ã€ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸å¯æ¬ 
      - ä¿è¨¼ã•ã‚ŒãŸåˆæœŸåŒ–ã«ã‚ˆã‚Šã€UBãŒå¤§å¹…ã«å‰Šæ¸›ã•ã‚Œã‚‹
      - åˆæœŸåŒ–ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã®ã€ã‚ˆã‚Šå·§å¦™ã§åˆ¶é™ã®å°‘ãªã„ã‚¹ã‚­ãƒ¼ãƒ ã¯å¯èƒ½ã ãŒã€å®Ÿè£…ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒã«ã‚ˆã‚‹ç®¡ç†ãŒé›£ã—ããªã‚‹
      - æš—é»™çš„ãªåˆæœŸåŒ–ã«ã‚ˆã‚‹æ˜ç¤ºçš„ãªåˆæœŸåŒ–ã®å›é¿ã¯ãã‚Œè‡ªä½“ãŒã‚¨ãƒ©ãƒ¼ã®åŸå› ã¨ãªã‚‹ã€‚ã“ã‚Œã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒæœ‰åŠ¹ã§ã‚ã£ã¦ã‚‚é–“é•ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å‹ã«é©åˆ‡ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒã‚ã‚‹ã¨ã¯é™ã‚‰ãªã„ãŸã‚
      - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒé‡è¦ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯åˆæœŸåŒ–ã®å¼·åˆ¶ãŒæœ›ã¾ã—ããªã„å ´åˆãŒã‚ã‚‹
        - ãƒã‚§ãƒƒã‚¯ã®æŠ‘åˆ¶ã‚„æ³¨é‡ˆã€ã¾ãŸã¯ç‰¹å®šã®åˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å‹ç­‰ã®æ–¹æ³•ã«ã‚ˆã£ã¦å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- Casting
    - å®šç¾©: ã‚­ãƒ£ã‚¹ãƒˆã¯ã€ãã®å®šç¾©ã«åã™ã‚‹æ–¹æ³•ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ãªã„ã€‚ã‚­ãƒ£ã‚¹ãƒˆã¯ãã®ã‚½ãƒ¼ã‚¹ã¨ç­‰ã—ããªã„å€¤ã‚’æŒã¤çµæœã‚’ã‚‚ãŸã‚‰ã•ãªã„ï¼ˆç¸®å°å¤‰æ›ã®ç¦æ­¢ï¼‰
    - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³: ã™ã¹ã¦ã®ã‚­ãƒ£ã‚¹ãƒˆã‚’ç¦æ­¢ã™ã‚‹ã€‚å®Ÿè¡Œæ™‚ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚­ãƒ£ã‚¹ãƒˆï¼ˆ`gsl::narrow<T>(x)` ãªã©ï¼‰ã‚’æä¾›ã—ã¦ã€ç¸®å°å¤‰æ›ã¨ç¬¦å·ã®å•é¡Œã®ç™ºç”Ÿã«å¯¾å‡¦ã™ã‚‹ã€‚
    - å‚™è€ƒ: 
      - `dynamic_cast`ã¯å®‰å…¨ã ãŒã€ãƒã‚¤ãƒ³ã‚¿ã®çµæœã®ãƒã‚§ãƒƒã‚¯ã‚’å¼·åˆ¶ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
      - ãƒã‚§ãƒƒã‚¯ã•ã‚Œãªã„ç„¡æ¡ä»¶ã®ã‚­ãƒ£ã‚¹ãƒˆãŒå¿…è¦ãªå ´åˆã¯ã€ã“ã®ä¿è¨¼ã‚’æŠ‘åˆ¶ã™ã‚‹
      - å‹æŒ‡å®šã•ã‚Œã¦ã„ãªã„ç”Ÿã®ãƒ¡ãƒ¢ãƒªã‹ã‚‰å‹æŒ‡å®šã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ã«ã¯ã€ã‚­ãƒ£ã‚¹ãƒˆãŒå¿…è¦
- Invalidationï¼ˆç„¡åŠ¹åŒ–ï¼‰
    - å®šç¾©: ç„¡åŠ¹åŒ–ã•ã‚ŒãŸå‚ç…§ã¾ãŸã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’ä»‹ã—ãŸã‚¢ã‚¯ã‚»ã‚¹ã¯ãªã„
    - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³
        - ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã®è¦ç´ ã¸ã®å‚ç…§ãŒå–å¾—ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã™ã‚‹é`const`é–¢æ•°ã®å‘¼ã³å‡ºã—ã‚’ç¦æ­¢ã™ã‚‹
        - å¤§é‡ã®èª¤æ¤œå‡ºã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€`[[non-validating]]`å±æ€§ãŒå¿…è¦
        - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠè¦ç´ ã®1ã¤ã ã‘ã¸ã®å‚ç…§ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹å˜ç´”ã§ç›´ç·šçš„ãªã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’è¨±å¯ã™ã‚‹
    - å‚™è€ƒ: 
        - å‹è§£æã¨ãƒ•ãƒ­ãƒ¼è§£æã®ä¸¡æ–¹ã‚’å«ã‚€æœ¬æ ¼çš„ãªé™çš„è§£æãŒå¿…è¦
        - ã“ã“ã§ã®å‚ç…§ã¨ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã™ã‚‹ã™ã¹ã¦ã®ã‚‚ã®ã‚’æŒ‡ã—ã€ã‚³ãƒ³ãƒ†ãƒŠã¨ã¯å€¤ã‚’ä¿æŒã§ãã‚‹ã™ã¹ã¦ã®ã‚‚ã®ã‚’æŒ‡ã™
          - ã“ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã¯`jthread`ã¯ã‚³ãƒ³ãƒ†ãƒŠã¨ã¿ãªã•ã‚Œã‚‹
- RAII
    - å®šç¾©: ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ãŒãªã„
    - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³: å–å¾—ã—ã¦å¾Œã§è§£æ”¾ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã¯ã€ã‚¹ã‚³ãƒ¼ãƒ—ä»˜ãã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦è¡¨ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹
    - å‚™è€ƒ: é™çš„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ‰€æœ‰ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã¯æ˜ç¤ºçš„ã«è§£æ”¾ã•ã‚Œãªã„é™ã‚Šæ°¸ä¹…ã«å­˜åœ¨ã™ã‚‹
        - ãƒªã‚½ãƒ¼ã‚¹ã®ä¾‹ï¼šãƒ¡ãƒ¢ãƒªã€ãƒ­ãƒƒã‚¯ã€ã‚·ã‚§ãƒ¼ãƒ€
- Union
    - å®šç¾©: å…±ç”¨ä½“ã®ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯åˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã®ã¿ä½¿ç”¨å¯èƒ½
    - åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³: å®Ÿè¡Œæ™‚ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸå…±ç”¨ä½“ï¼ˆ`std::variant` ãªã©ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹
    - å‚™è€ƒ
      - ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ãŒå¿…è¦
        - ãã®å ´åˆã€ãƒ«ãƒ¼ãƒ«ã¯ã€Œå…±ç”¨ä½“ã‚’ä½¿ç”¨ã›ãš`match` ã‚’ä½¿ç”¨ã™ã‚‹ã€ã¨ãªã‚‹
      - ã‚¿ã‚°ã‚’ä¼´ã‚ãªã„å…±ç”¨ä½“ã®é‡è¦ãªä½¿ç”¨ä¾‹ãŒã‚ã‚‹ã€‚ãŸã¨ãˆã°ã€æ–‡å­—åˆ—ã®é•·ã•ã«ã‚ˆã£ã¦å®Ÿè£…ã‚’é¸æŠã™ã‚‹SSOãªã©

ã“ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ã‚ˆã‚Šä¿¡é ¼ã«è¶³ã‚‹ã‚‚ã®ã«ã™ã‚‹ãŸã‚ã«ã¯ã€ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ã†ã¡ã„ãã¤ã‹ã‚’æ­£ç¢ºã«æŒ‡å®šã—ã€å®Ÿè£…ã—ãƒ†ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã“ã®æ–‡æ›¸ã§ã¯æ¬¡ã®ä½œæ¥­ã¨ã—ã¦ä»¥ä¸‹ã®äº‹ã‚’é€²ã‚ã¦ã„ãã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™

- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ã‚’æ±ºå®šã™ã‚‹
- å®Ÿè¡Œæ™‚é•åã‚’ç¤ºã™æ§‹æ–‡ã‚’æ±ºå®šã™ã‚‹
- Initializationãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã€çŸ­æœŸçš„ã«å®Ÿè¡Œå¯èƒ½ãªã‚‚ã®ã‚’æ±ºå®šã™ã‚‹
- Rangesãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã€çŸ­æœŸçš„ã«å®Ÿè¡Œå¯èƒ½ãªã‚‚ã®ã‚’æ±ºå®šã™ã‚‹
- Castãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã€çŸ­æœŸçš„ã«å®Ÿè¡Œå¯èƒ½ãªã‚‚ã®ã‚’æ±ºå®šã™ã‚‹
- çŸ­æœŸçš„ã«å®Ÿè¡Œå¯èƒ½ãªPointerãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚µãƒ–ã‚»ãƒƒãƒˆã‚’è€ƒæ¡ˆã™ã‚‹

æ§‹æ–‡ã•ãˆæ±ºã¾ã‚Œã°æ®‹ã‚Šã®ä½œæ¥­ã‚„ã“ã“ã«ä¸ŠãŒã£ã¦ã„ãªã„ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢ã™ã‚‹ä½œæ¥­ã‚’ä¸¦è¡Œã—ã¦è¡Œã†ã“ã¨ãŒã§ãã‚‹ã¨ã—ã¦ã„ã¾ã™ã€‚ã“ã®ææ¡ˆã¯ç·Šæ€¥æ€§ã‚’é‡è¦–ã—ã¦ãŠã‚Šã€ã™ãã«æ¨™æº–ã«å°å…¥ã™ã‚‹ã“ã¨ãŒã§ãã¦ã€ã™ãã«ä½¿ã„å§‹ã‚ã‚‰ã‚Œã‚‹ã“ã¨ã«é‡ç‚¹ã‚’ç½®ã„ã¦ã„ã¾ã™ã€‚

- [ãƒ¡ãƒ¢ãƒªå®‰å…¨ã‚’ã‚ãã‚‹ C++ ã®ä»•æ§˜ç­–å®šã«å¤–éƒ¨è¦å› ãŒå½±éŸ¿ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã¨ã®è©± | ã‚ã¾ã­å·¥ç ”](https://amanelab.net/ja/topic/2023/02/14/cpp-change-for-meory-safty/)
- [P3274 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1929)

### [P3275R0 Replace simd `operator[]` with getter and setter functions - or not](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3275r0.pdf)

`std::simd`ã®æ·»ãˆå­—æ¼”ç®—å­ã®å•é¡Œç‚¹ã¨ä»£æ›¿æ¡ˆã«ã¤ã„ã¦æ¤œè¨ã™ã‚‹æ–‡æ›¸ã€‚

`std::simd`ï¼ˆ`basic_simd`ã¨`basic_simd_mask`ï¼‰ã«ã¯æ·»ãˆå­—æ¼”ç®—å­ï¼ˆ`[]`ï¼‰ãŒç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã¯é…åˆ—ã‚„ã‚³ãƒ³ãƒ†ãƒŠåŒæ§˜ã«å€‹ã€…ã®è¦ç´ ã®èª­ã¿æ›¸ãã‚’è¡Œã†ã‚‚ã®ã§ã™ã€‚

```cpp
std::simd<int> x = 0;
x[0] = 1;       // OK
int y = x[0];   // OK
x[0] = y;       // OK
auto z = x[0];  // OK, but :  #1
z = 2;          // ill-formed #2
```

`basic_simd`ã¨`basic_simd_mask`å‹ãã‚Œãã‚Œã®`value_type`ã®å€¤ã¯ä¿æŒã—ã¦ã„ã‚‹ã‚‚ã®ã®é€šå¸¸ã¯ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿æŒã—ã¦ãŠã‚‰ãšã€ãã®ãŸã‚ã«`[]`ã¯å·¦è¾ºå€¤å‚ç…§ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€`const`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯prvalueã‚’è¿”ã—ã€é`const`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯ãƒ—ãƒ­ã‚¯ã‚·å‚ç…§ã‚’è¿”ã—ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚¯ã‚·å‚ç…§ã¯æŒ‡å®šã•ã‚ŒãŸè¦ç´ ã®å€¤ã‚’æ›¸ãæ›ãˆã‚‹ãŸã‚ã®ä»£å…¥æ¼”ç®—å­ã‚„è¤‡åˆä»£å…¥æ¼”ç®—å­ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ãŠã‚Šã€ãã‚Œã«ã‚ˆã£ã¦ä»£å…¥ã‚„æ¼”ç®—ãŒå¯èƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚

ä¸Šè¨˜ä¾‹ã®`#1`ã§ã¯å€¤ã§ã¯ãªããƒ—ãƒ­ã‚¯ã‚·å‚ç…§ã‚’å–å¾—ã—ã¦ã„ã¾ã™ãŒã€`z`ã®å®£è¨€ã¯å‚ç…§ã«ã¯è¦‹ãˆãªã„ãŸã‚ã€ã“ã‚Œã¸ã®ä»£å…¥ã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã«`#2`ã®ã‚ˆã†ãªæ“ä½œã¯ill-formedã¨ãªã‚‹ã‚ˆã†ã«ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªã“ã¨ãŒç„¡ãã¨ã‚‚ã€å·¦è¾ºå€¤å‚ç…§ã®ä»£ã‚ã‚Šã«ãƒ—ãƒ­ã‚¯ã‚·å‚ç…§ã‚’ä½¿ç”¨ã—ã¦ã—ã¾ã†ã¨ã€`[]`ä»•æ§˜ã«ä¼´ã£ã¦æ„å›³ã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã‚„ã™ããªã‚Šã¾ã™ï¼ˆ`[]`ã®çµæœã‚’ç›´æ¥é–¢æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§æ¨è«–ã—ãŸå ´åˆãªã©ï¼‰ã€‚

`std::simd`ã®å®Ÿè£…ã§ã¯æŒ‡å®šã•ã‚ŒãŸå‹ã«ã‚ˆã‚‹é…åˆ—ã‚’ä¿æŒã™ã‚‹ã“ã¨ã‚’è¦æ±‚ã—ã¦ãŠã‚‰ãšã€å®Ÿè£…å®šç¾©ã®çµ„ã¿è¾¼ã¿å‹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ä»–ã€SIMDãƒ¬ã‚¸ã‚¹ã‚¿ã«ç›´æ¥çš„ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ã“ã¨ã•ãˆã‚‚ç¦æ­¢ã—ã¦ã„ã¾ã›ã‚“ã€‚`basic_simd_mask`ã®å ´åˆã€ç¾åœ¨ã®SIMDå‘½ä»¤ã®å®Ÿè£…ã«ãŠã‘ã‚‹ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ãƒã‚¹ã‚¯ã®å®Ÿè£…ãŒåŸºæœ¬çš„ã«ã¯ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ï¼ˆ1è¦ç´ =1ãƒ“ãƒƒãƒˆã‚„ã€1ãƒã‚¤ãƒˆ=1ãƒ“ãƒƒãƒˆãªã©ï¼‰ã“ã¨ã‹ã‚‰ã€ã»ã¼ç¢ºå®Ÿã«`bool`ã®é…åˆ—ã‚’ãƒ¡ãƒ³ãƒã¨ã—ã¦æŒã¤å®Ÿè£…ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã¯ã¾ãšã€`basic_simd`ã¨`basic_simd_mask`ã§ã¯æ·»ãˆå­—æ¼”ç®—å­ã‚’å‰Šé™¤ã—ãŸæ–¹ãŒè‰¯ã„ã®ã§ã¯ãªã„ã‹ï¼Ÿã¨æè¨€ã—ã¦ã„ã¾ã™ã€‚ãã—ã¦ã€ãƒ—ãƒ­ã‚¯ã‚·å‚ç…§ã‚’å‰Šé™¤ã—ãŸã„ãŒæ·»ãˆå­—æ¼”ç®—å­ã‚’æ®‹ã—ãŸã„å ´åˆã®ãŸã‚ã«ä»£æ›¿æ¡ˆã«ã¤ã„ã¦æ¤œè¨ã—ã¦ã„ã¾ã™ã€‚

1. `[]`ã‚’èª­ã¿å–ã‚Šå°‚ç”¨ã«ã™ã‚‹
2. `begin()/end()`ã«ã‚ˆã‚‹ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ç¯„å›²ã¨ã—ã¦ã®æ·»ãˆå­—ã‚¢ã‚¯ã‚»ã‚¹
3. 2ã¨ä¼¼ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ã—ã¦ã€é…åˆ—ã¸å¤‰æ›å¯èƒ½ã«ã™ã‚‹
4. ã‚»ãƒƒã‚¿ãƒ¼/ã‚²ãƒƒã‚¿ãƒ¼é–¢æ•°ã‚’è¿½åŠ ã™ã‚‹
5. element_referenceå‹ã«ã‚ˆã‚‹å€¤ã¸ã®å‚ç…§ã‚’è¿”ã™ã‚ˆã†ã«ã™ã‚‹

ç­†è€…ã®æ–¹ã®çµŒé¨“ã§ã¯ã€`basic_simd`ã¨`basic_simd_mask`å‹ã§ã®æ·»ãˆå­—æ¼”ç®—å­ã®ä»•æ§˜ã¯ç›´æ„Ÿçš„ã‹ã¤è‡ªç„¶ã§ã‚ã‚Šã€å…¸å‹çš„ãªæ·»ãˆå­—æ¼”ç®—å­ã®ä½¿ç”¨ã®9å‰²ã¯èª­ã¿å–ã‚Šå°‚ç”¨ã§ã‚ã‚‹ã¨å ±å‘Šã—ã¦ãŠã‚Šã€ã“ã‚Œã‚’ã‚‚ã¨ã«ã€é`const`ã®æ·»ãˆå­—æ¼”ç®—å­ã®ã¿ã‚’å‰Šé™¤ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚ãã—ã¦ã€ãã‚ŒãŒå—ã‘å…¥ã‚Œã‚‰ã‚Œãªã„å ´åˆã¯element_referenceå‹ã‚’è¿½åŠ ã—ã¦ãã‚Œã‚’è¿”ã™ã‚ˆã†ã«ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æŠ¼ã—ã¦ã„ã¾ã™ã€‚

ã¨ã¯ã„ãˆã€ã“ã®ææ¡ˆã¯å•é¡Œç‚¹ã®å…±æœ‰ã¨ä»£æ›¿æ¡ˆã®æ¤œè¨ã‚’è¡Œã£ãŸã ã‘ã§ã€ã¾ã ã©ã‚Œã‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

LEWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã¯ã€`[]`ã‚’èª­ã¿å–ã‚Šå°‚ç”¨ã«ã—ã¦é`const`ã®æ·»ãˆå­—æ¼”ç®—å­ã®ã¿ã‚’å‰Šé™¤ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå¥½ã¾ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

- [P3275 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1930)

### [P3276R0 P2900 Is Superior to a Contracts TS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3276r0.pdf)

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’TSã‚’çµŒç”±ã™ã‚‹ã®ã§ã¯ãªãã€ç›´æ¥æ¨™æº–ã¸å°å…¥ã™ã¹ãã¨ã„ã†ææ¡ˆã€‚

ã¨ã„ã†ï¼ˆä¸Šã®æ–¹ã«ã‚ã‚‹ææ¡ˆï¼‰ã«ã¦ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯C++26ã‚’ç›®æŒ‡ã™ã®ã§ã¯ãªãTSã‚’ä¸€æ—¦ç›®æŒ‡ã™ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒææ¡ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ææ¡ˆã¯ã€TSã«ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆã¨ã‚³ã‚¹ãƒˆã‚’è€ƒå¯Ÿã—ãŸã†ãˆã§ã€ï¼ˆC++26ã‹ã¯ã¨ã‚‚ã‹ãï¼‰ç›´æ¥æ¨™æº–ã¸ã®å°å…¥ã‚’ç›®æŒ‡ã™ã“ã¨ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

TSã‚’ä¸€æ—¦çµŒç”±ã™ã‚‹ã“ã¨ã§å¾—ã‚‰ã‚Œã‚‹ãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦ã¯æ¬¡ã®ã‚‚ã®ãŒã‚ˆãæŒ™ã’ã‚‰ã‚Œã¾ã™

1. å®Ÿè£…çµŒé¨“ãŒå¾—ã‚‰ã‚Œã‚‹
2. ä½¿ç”¨çµŒé¨“ãŒå¾—ã‚‰ã‚Œã‚‹
3. è¨­è¨ˆã«ã¤ã„ã¦ã®WG21å…¨ä½“ã®åˆæ„ãŒå¾—ã‚‰ã‚Œã‚‹
4. æ—¢å­˜ã®æ©Ÿèƒ½ã¨ã®ä¸€è²«æ€§ã¨é©ç”¨æ€§ã®å‘ä¸Š
5. å®‰å…¨æ€§ã®å‘ä¸Š

ã“ã®ææ¡ˆã§ã¯ã€ã“ã‚Œã‚‰ã®ãƒ¡ãƒªãƒƒãƒˆã¯TSã‚’çµŒç”±ã—ãªã„å½¢ã§ã‚‚å¾—ã‚‹ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€TSã‚’ã‚’ç›®æŒ‡ã™ç†ç”±ã«ã¯ãªã‚‰ãªã„ã¨ã—ã¦ã„ã¾ã™ã€‚

ã‚€ã—ã‚TSã¨ã—ã¦ç™ºè¡Œã™ã‚‹ã“ã¨ã§ã€æ¬¡ã®ã‚ˆã†ãªã‚³ã‚¹ãƒˆãŒä½™åˆ†ã«ã‹ã‹ã£ã¦ãã¾ã™

- ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹æ¨™æº–ã®ãƒªãƒ™ãƒ¼ã‚¹ä½œæ¥­
    - TSã¨ã—ã¦ç™ºè¡Œã™ã‚‹ã«ã¯ãã®æ™‚ç‚¹ã§å…¬é–‹æ¸ˆã¿ã®æ¨™æº–ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ãŒã€ç¾æ™‚ç‚¹ã§ã¯ãã‚Œã¯C++20ã§ã‚ã‚‹
    - ãã®ãŸã‚ã€ã¾ãšç¾åœ¨ã®ï¼ˆC++26ãƒ‰ãƒ©ãƒ•ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ã„ã‚‹ï¼‰P2900ã‚’C++20ãƒ™ãƒ¼ã‚¹ã«ãªã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆãªã‘ã‚Œã°ãªã‚‰ãªã„
    - ãŠãã‚‰ãã€ãã®ã™ãå¾Œã§C++23ãƒ™ãƒ¼ã‚¹ã«ãªã‚‹ã‚ˆã†ã«ãƒªãƒ™ãƒ¼ã‚¹ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„
      - C++23ã¯æœªç™ºè¡Œã§ã‚ã‚Šã„ã¤ç™ºè¡Œã•ã‚Œã‚‹ã‹ä¸é€æ˜
    - C++23~26ã¨ã®ä¸€è²«æ€§ã‚„é©ç”¨æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã«ã¯C++26æ¨™æº–ã‚’å¾…ãŸãªã‘ã‚Œã°ãªã‚‰ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã€ãã‚Œã¯2027å¹´ä»¥é™ã«ãªã‚‹
- æ–‡æ›¸ã®äºŒé‡ç®¡ç†
    - TSãŒæ¡æŠã•ã‚ŒãŸå ´åˆã«æ¨™æº–ã«ãƒãƒ¼ã‚¸ã§ãã‚‹çŠ¶æ…‹ã‚’ä¿ã¤ã«ã¯ã€ãƒ™ãƒ¼ã‚¹ã¨ãªã£ã¦ã„ã‚‹æ¨™æº–è¦æ ¼ï¼ˆC++20 or C++23ï¼‰ã¨ã€æœ€æ–°ã®è¦æ ¼ãƒ‰ãƒ©ãƒ•ãƒˆã®å·®åˆ†ã‚’è€ƒæ…®ã—ã¦ãƒãƒ¼ã‚¸ã«æ”¯éšœãŒå‡ºãªã„ã“ã¨ã‚’ç¢ºèªã—ç¶šã‘ã‚‹å¿…è¦ãŒã‚ã‚‹
    - ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹æ¨™æº–è¦æ ¼ãŒå¤ã„ã»ã©ã“ã®ä½œæ¥­ã¯ç…©é›‘ã«ãªã‚‹
- è­°è«–ã®å„ªå…ˆé †ä½
    - EWGã«ãŠã‘ã‚‹TSã®è­°è«–æ™‚é–“ã¯ã€å¿…ç„¶çš„ã«æ¨™æº–ãã®ã‚‚ã®ã¸ã®å¤‰æ›´ã«é–¢ã™ã‚‹ã‚‚ã®ã‚ˆã‚Šã‚‚å„ªå…ˆé †ä½ãŒä½ããªã‚‹
    - TSã‚’å…¬é–‹ã™ã‚‹ãŸã‚ã«ã¯é™ã‚‰ã‚ŒãŸå¯¾é¢ä¼šè­°ã®æ™‚é–“æ ã®æ¥µã€…ä¸€éƒ¨ã®æ™‚é–“ã ã‘ã—ã‹ä½¿ãˆãªã„ãŸã‚ã€ã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ã‚’å¾—ã‚‹ã«ã¯ä½™åˆ†ãªåŠ´åŠ›ãŒã‹ã‹ã‚‹

ã“ã‚Œã‚‰ã®ã“ã¨ã‹ã‚‰ã€TSã‚’å‡ºè·ã™ã‚‹ã“ã¨ã§å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’æ¨™æº–ã«å°å…¥ã™ã‚‹ãŸã‚ã®å•é¡ŒãŒè§£æ±ºã§ãã‚‹ã¨ã„ã†ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã¯ç„¡ãã€TSã‚’çµŒç”±ã™ã‚‹ã“ã¨ã§å…¨ä¸–ç•Œã®C++ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦åˆ©ç›Šã®ã‚ã‚‹C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®‰å…¨æ€§ãƒ»æ­£ç¢ºæ€§ã‚’å‘ä¸Šã•ã›ã‚‹æ©Ÿèƒ½ã®æä¾›ãŒé…ã‚Œã‚‹ã ã‘ã§ã‚ã‚Šã€ç¾åœ¨ã®C++ã‚’å–ã‚Šå·»ãç’°å¢ƒã‚’è€ƒæ…®ã™ã‚‹ã¨ã“ã®é…ã‚Œã¯C++ã®å®‰å…¨æ€§å‘ä¸Šã¸ã®å–ã‚Šçµ„ã¿ãŒçœŸå‰£ã§ã¯ãªã„ã¨å—ã‘æ­¢ã‚ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã—ã¦ã€ç¾åœ¨ã®è¨ˆç”»é€šã‚Šã«TSã‚’çµŒç”±ã›ãšã«ç›´æ¥æ¨™æº–ã¸å°å…¥ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã™ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚

ææ¡ˆã§ã¯ã€TSã‚’ç›®æŒ‡ã™ç†ç”±ã¨ã—ã¦å°‘ãªãã¨ã‚‚æ¬¡ã®ç–‘å•ã«å¿œãˆã‚‹ã¹ãã¨ã—ã¦ã„ã¾ã™

- TSã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã“ã¨ã§è§£æ±ºã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ç–‘å•ç‚¹
- TSã«ã‚ˆã£ã¦ãã®ã‚ˆã†ãªç–‘å•ç‚¹ã«å›ç­”ã™ã‚‹æ–¹æ³•
- P2900ã‚’ã“ã®ã¾ã¾ï¼ˆæ¨™æº–ã¸ï¼‰é€²ã‚ã¦ã‚‚ãã‚Œã«å›ç­”ã§ããªã„ç†ç”±
- TSã‚’ç™ºè¡Œã—ãŸçµæœã¨ã—ã¦C++ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒæ¡æŠã•ã‚ŒãŸå ´åˆã€ãã®æ™‚ã®å‡ºå£æˆ¦ç•¥ã¯ã©ã†ãªã‚‹ã‹

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®TSåŒ–ã®ææ¡ˆã«ã¯ã“ã‚Œã‚‰ã®ç‚¹ãŒè¿°ã¹ã‚‰ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ã¾ã ç„¡ã„ã‚ˆã†ã§ã™ã€‚

- [P3276 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1931)

### [P3278R0 Analysis of interaction between relocation, assignment, and swap](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3278r0.pdf)

ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä»£å…¥ã‚„ã‚¹ãƒ¯ãƒƒãƒ—ã¨ã®é–¢ä¿‚æ€§ã‚’è€ƒå¯Ÿã™ã‚‹æ–‡æ›¸ã€‚

ç¾åœ¨ã®ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é–¢ã™ã‚‹ææ¡ˆã¯ã€æœ€é©åŒ–ã‚’ç›®çš„ã¨ã—ã¦æ¨™æº–ã§ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒˆãƒªãƒ“ã‚¢ãƒ«ãªãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã„ã†æ“ä½œã‚’å®šç¾©ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å«ã‚ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å®Ÿè£…ã§ä»£å…¥ã®è¦³ç‚¹ã‹ã‚‰å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ä¸€éƒ¨ã®æ“ä½œã‚’ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ç½®ãæ›ãˆã‚‹ã“ã¨ã§æœ€é©åŒ–ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®æ–‡æ›¸ã¯ã€ä¸»ã«ç”Ÿå­˜æœŸé–“ã®è¦³ç‚¹ã‹ã‚‰ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ä»£å…¥ãƒ»ã‚¹ãƒ¯ãƒƒãƒ—ã®é•ã„ã‚’è€ƒå¯Ÿã™ã‚‹ã‚‚ã®ã§ã™ã€‚

#### ä»£å…¥ã¨ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³

`vector::erase`ã‚„`vector::insert`ç­‰ã®æ“ä½œã‚’ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¿ãªã™ã“ã¨ã¯ä¸€èˆ¬çš„ã§ã™ãŒã€æ¨™æº–ã§ã¯ã“ã®ã‚ˆã†ãªæ“ä½œãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’å†é…ç½®ã™ã‚‹ã®ã‹ã€å€¤ã ã‘ã‚’ç§»å‹•ã•ã›ã‚‹ã®ã‹ã«ã¤ã„ã¦ä¸é€æ˜ã§ã™ã€‚å®Ÿéš›ã«ã¯ã€ã“ã‚Œã‚‰ã®å†é…ç½®æ“ä½œã¯ä»£å…¥ã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä»•æ§˜ã§ã¯ã€è¦ä»¶ã‚„è¨ˆç®—é‡ã®è¦å®šã«ã‚ˆã£ã¦ãã‚Œã‚’æ˜ç¤ºã—ã¦ã„ã‚‹ã“ã¨ã™ã‚‰ã‚ã‚Šã¾ã™ã€‚

ä»£å…¥åŠã³æ§‹ç¯‰ã¯å€¤ã®ã¿ã‚’ç§»å‹•ã•ã›ã‚‹æ“ä½œã§ã‚ã‚‹ãŸã‚ã“ã‚Œã¾ã§åŒºåˆ¥ã•ã‚Œã¦ã¯ãŠã‚‰ãšã€å¤ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ä½•ãŒèµ·ã“ã‚‹ã®ã‹ã«ã¤ã„ã¦ã¯ã‚ã¾ã‚Šè€ƒæ…®ã•ã‚Œã¦ãã¾ã›ã‚“ã§ã—ãŸï¼ˆä½•ã§ã‚‚èµ·ã“ã‚Šå¾—ãŸã‚‚ã®ã®ã€ä»£å…¥ã¨ã„ã†æ„å‘³ã•ãˆé”æˆã§ãã¦ã„ã‚Œã°ä½•ãŒèµ·ãã¦ã„ã¦ã‚‚è‰¯ã‹ã£ãŸï¼‰ã€‚ã—ã‹ã—ã€ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å ´åˆã¯æ˜ç¢ºã«å¤ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç ´æ£„ã•ã‚Œã‚‹ãŸã‚ã€ã“ã®åŒºåˆ¥ãŒé‡è¦ã«ãªã‚Šã¾ã™ã€‚

ä¾‹ãˆã°ã€IDã¨å€¤ã‚’ä¿æŒã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è€ƒãˆã¾ã™ã€‚IDã¯ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ä»£å…¥æ“ä½œã«ä¼´ã£ã¦ã¯IDã‚’ç§»å‹•ã›ãšã«å€¤ã®ã¿ã‚’ç§»å‹•ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆã‚ˆã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ãŒå¿…è¦ã§ã™ï¼‰ã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®IDãŒé‡è¦ã§ã‚ã‚‹ãŸã‚ã€ã“ã®ã‚ˆã†ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä»£å…¥ã¯IDã‚’ã‚³ãƒ”ãƒ¼/ãƒ ãƒ¼ãƒ–ã—ã¾ã›ã‚“ã€‚ã—ã‹ã—ã€ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å ´åˆã€ãã®æ“ä½œã®å¾Œã§å¤ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç ´æ£„ã•ã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã‚‹ãŸã‚IDã¯é‡è¤‡ã›ãšã€ã“ã®å ´åˆã¯IDã‚’å†åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚IDã¨å€¤ãŒå…±ã«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã§ã‚ã‚‹å ´åˆã“ã®å‹å…¨ä½“ã‚‚ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã§ã‚ã‚Šã€ã“ã®ã‚ˆã†ãªå‹ã®ä½œæˆè€…ã¯å‹ã‚’ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã¨ã—ã¦ãƒãƒ¼ã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚çµå±€ã€å¤ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç ´æ£„ã¯ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸€éƒ¨ã§ã™ã€‚

P3236ã§ã¯ã€å†é…ç½®ã®å®Ÿè£…ã®ä¸€éƒ¨ã¨ã—ã¦ä»£å…¥ã‚’ä½¿ç”¨ã™ã‚‹æ—¢å­˜å®Ÿè£…ã®å•é¡Œç‚¹ã¨ã€ç¾åœ¨ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’ç¶­æŒã—ãŸã„ã¨ã„ã†è¦æœ›ã®ä¸¡æ–¹ã‚’èªè­˜ã—ã¦ã„ã¾ã™ã€‚å…¨ã¦ã®ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ“ä½œä¸å¿…è¦ã«æ‚²è¦³çš„ã«æ‰±ã†ã“ã¨ãªããã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã«ã¯ã€ä»£å…¥æ™‚ã«èµ·ã“ã‚‹äº‹ã¨ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«èµ·ã“ã‚‹äº‹ã‚’æ­£ã—ãåŒºåˆ¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã—ã¦ã“ã‚Œã¯ã€ã‚¹ãƒ¯ãƒƒãƒ—ã«ã‚‚å½“ã¦ã¯ã¾ã‚Šã¾ã™ã€‚

#### swapã¨ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³

æ¨™æº–ã¯ã€ã‚¹ãƒ¯ãƒƒãƒ—ã¯å€¤ã‚’äº¤æ›ã™ã‚‹ã‚‚ã®ã¨ã—ã¦ã„ã¾ã™ã€‚ç‰¹å®šã®å‹ã®å ´åˆã€å€¤ã¨ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã®ã“ã¨ã§ã‚ã‚Šã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã¨å€¤ãŒå®Œå…¨ã«ä¸€è‡´ã—ã¦ã„ã‚‹å ´åˆã€ã‚¹ãƒ¯ãƒƒãƒ—ã¯ãƒ“ãƒƒãƒˆå˜ä½ã®äº¤æ›æ“ä½œã¨ã—ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã‚ˆã†ãªèª¬æ˜ã§ã¯ã©ã®ã‚ˆã†ãªå‹ãŒæœ€é©åŒ–ã•ã‚ŒãŸã‚¹ãƒ¯ãƒƒãƒ—æ“ä½œã‚’æŒã¤ã“ã¨ãŒã§ãã‚‹ã‹ã¨ã„ã†äº‹ã ã‘ã‚’è¨€ã£ã¦ã„ã¾ã™ã€‚

æœ€é©åŒ–ã‚¹ãƒ¯ãƒƒãƒ—ã®ã‚‚ã†ä¸€ã¤ã®é‡è¦ãªäº‹é …ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿå­˜æœŸé–“ã‚’è€ƒæ…®ã™ã‚‹ã“ã¨ã§ã™ã€‚

ç”Ÿå­˜æœŸé–“ã®è€ƒæ…®äº‹é …ã‚’ç„¡è¦–ã™ã‚‹ã¨ã€ã‚¹ãƒ¯ãƒƒãƒ—ã‚’ãƒ“ãƒƒãƒˆå˜ä½ã®äº¤æ›æ“ä½œã§å®Ÿè£…ã™ã‚‹ã«ã¯æ¬¡ã®è¦ä»¶ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚Šã¾ã™

1. å‹ã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ã«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã§ã‚ã‚‹
2. ä»£å…¥ã®ä»£ã‚ã‚Šã«ãƒ“ãƒƒãƒˆã‚³ãƒ”ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã§ã‚‚ã€ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ãŒå¤‰æ›´ã•ã‚Œãªã„

2ã¤ç›®ã®è¦ä»¶ã¯ã€å†é…ç½®æ“ä½œã«ä»£å…¥ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ç¾åœ¨ã®å®Ÿè£…ï¼ˆãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä»¥å‰ï¼‰ã‚’æœ€é©åŒ–ã™ã‚‹ãŸã‚ã«å¿…è¦ãªè¦ä»¶ã¨åŒã˜ã‚‚ã®ã§ã™ã€‚ã—ã‹ã—ã€ç¾åœ¨ã®è­°è«–ã§ã¯ã€æš—é»™çš„ãªãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½æ€§ã¨ã„ã†æ¦‚å¿µã¨ã€ã€Œãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»£å…¥ã«ä½¿ç”¨ã§ãã‚‹ã€ã¨ã„ã†æ¦‚å¿µãŒæ··åŒã•ã‚Œã€ãã®çµæœã€Œãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚¹ãƒ¯ãƒƒãƒ—ã«ä½¿ç”¨ã§ãã‚‹ã€ã¨ã„ã†æ¦‚å¿µã‚’æ··åŒã—ã¦ã„ã¾ã™ã€‚

P1144ã®æš—é»™çš„ãªãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½æ€§ã®å®šç¾©ã§ã¯ä¸Šè¨˜1ã¨2ã‚’æº€ãŸã™ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ãŒã€æ˜ç¤ºçš„ã«ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã¨ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ã‚‹å‹ã§ã¯ãã®ã‚ˆã†ãªä¿è¨¼ã¯æˆã‚Šç«‹ã¡ã¾ã›ã‚“ã€‚

æ—¢å­˜å†é…ç½®æ“ä½œã¨ã‚¹ãƒ¯ãƒƒãƒ—ã®é–“ã«ã¯ã‚‚ã†ä¸€ã¤é‡è¦ãªé•ã„ãŒã‚ã‚‹äº‹ã‚’èªè­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

- å†é…ç½®æ“ä½œã§ã¯ã€ã‚½ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å†é…ç½®æ“ä½œã®å¾Œã§ç ´æ£„ã•ã‚Œã‚‹
- ã‚¹ãƒ¯ãƒƒãƒ—ã§ã¯ã€ã‚¹ãƒ¯ãƒƒãƒ—ã®å¾Œã‚‚ä¸¡æ–¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜ç¶šã™ã‚‹

ã“ã®ãŸã‚ã€æ˜ç¤ºçš„ã«ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã¨ãƒãƒ¼ã‚¯ã•ã‚ŒãŸå‹ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã‚¹ãƒ¯ãƒƒãƒ—ã‚’å®Ÿè¡Œã§ãã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’çŸ¥ã‚‹æ–¹æ³•ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

å…ˆç¨‹ã®ã€IDã¨å€¤ã‚’ä¿æŒã™ã‚‹å‹ã®ä¾‹ã‚’æ€ã„å‡ºã—ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªå‹ãŒãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã‚‹ã¨ã€ã‚½ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ç ´æ£„ã•ã‚Œã¦ã„ã‚‹ãŸã‚IDã®å†åˆ©ç”¨ãŒå¯èƒ½ã«ãªã‚‹ãŸã‚ã€IDã¯ä¿æŒã•ã‚Œã¾ã™ã€‚ä¸€æ–¹ã€ã“ã®ã‚ˆã†ãªå‹ã®2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¹ãƒ¯ãƒƒãƒ—ã«ãŠã„ã¦ã¯ã€ä»£å…¥ã«ã‚ˆã£ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼ˆç¾çŠ¶ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼‰å ´åˆã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®IDã«å¤‰åŒ–ã¯ãªãã€2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é–“ã§ãã®å€¤ã ã‘ãŒäº¤æ›ã•ã‚Œã¾ã™ã€‚çµæœã€IDã¯äº¤æ›ã•ã‚Œã¾ã›ã‚“ãŒå€¤ã¯äº¤æ›ã•ã‚Œã¾ã™ã€‚

ã¤ã¾ã‚Šã€ã“ã®å‹ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«ã«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã¨ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ã‚‹å ´åˆã§ã‚‚ã€ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæä¾›ã™ã‚‹ä¿è¨¼ï¼ˆã‚½ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç ´æ£„ï¼‰ãŒç„¡ããªã£ãŸã“ã¨ã«ã‚ˆã£ã¦ãã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ãŒå¤‰åŒ–ã—ã¦ã—ã¾ã£ã¦ãŠã‚Šã€ã‚¹ãƒ¯ãƒƒãƒ—ã‚’ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦æœ€é©åŒ–ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ï¼ˆå…ˆã®è¦ä»¶2ã¯æº€ãŸã•ã‚Œãªã„ï¼‰ã€‚

å¾“ã£ã¦ã€ãƒ ãƒ¼ãƒ–ä»£å…¥+ãƒ ãƒ¼ãƒ–æ§‹ç¯‰ã§è¡Œã‚ã‚Œã¦ã„ã‚‹ã‚¹ãƒ¯ãƒƒãƒ—æ“ä½œã¯å˜ç´”ã«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ç½®ãæ›ãˆã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãã‚Œã«ã¯P3239R0ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¹ãƒ¯ãƒƒãƒ—ã‚’åŒºåˆ¥ã—ã¦èªè­˜å¯èƒ½ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æ–‡æ›¸ã§ã¯ã€æ§‹ç¯‰ã¨ç ´æ£„ãŒä»£å…¥ã¨åŒç­‰ã§ã‚ã‚‹å‹ã‚’åˆ‡ã‚Šåˆ†ã‘ã‚‹ã“ã¨ã‚’ä»Šå¾Œã®æ–¹å‘æ€§ã¨ã—ã¦æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€ãã®ã‚ˆã†ãªåˆ‡ã‚Šåˆ†ã‘ã®æ–¹æ³•ã¨ã¯ç„¡é–¢ä¿‚ã«ã€ãƒ“ãƒƒãƒˆã‚³ãƒ”ãƒ¼ï¼ˆ`memcpy/memmove`ï¼‰æ“ä½œè‡ªä½“ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿå­˜æœŸé–“ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ä¸€æ–¹ã§ã‚¹ãƒ¯ãƒƒãƒ—æ“ä½œã¯ç”Ÿå­˜æœŸé–“ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã¨ã„ã†äº‹å®Ÿã‹ã‚‰ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã¾ãŸã¯ã‚ˆã‚Šå…·ä½“çš„ã«ãƒ“ãƒƒãƒˆã‚³ãƒ”ãƒ¼ã«ã‚ˆã£ã¦ã‚¹ãƒ¯ãƒƒãƒ—ã‚’å®Ÿè£…ã™ã‚‹ã«ã¯ã€ã‚¹ãƒ¯ãƒƒãƒ—ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿå­˜æœŸé–“ã‚’çµ‚äº†ã—ãªã„æ–¹æ³•ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚P3239ã§ã¯ãã®ãŸã‚ã«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„ã¦ã‚¹ãƒ¯ãƒƒãƒ—ã™ã‚‹ã‚‚ã®ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿå­˜æœŸé–“ã‚’ä¸­æ–­ã—ãªã„ç‰¹åˆ¥ãªé–¢æ•°ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

#### è¿½åŠ ã®å•é¡Œ

ã“ã®æ–‡æ›¸ã§ã¯ã€ã“ã®ã‚ˆã†ãªè€ƒå¯Ÿã®ä»®å®šã§æµ®ã‹ã‚“ã 2ã¤ã®å•é¡Œç‚¹ã«ã¤ã„ã¦ã®å ±å‘Šã¨æ¨å¥¨äº‹é …ã®ææ¡ˆã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

ã¾ãš1ã¤ç›®ã¯ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãªãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½æ€§ã®ä¼æ’­ã«ã¤ã„ã¦ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«å‹ã‚’ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã§ã‚ã‚‹ã¨ãƒãƒ¼ã‚¯ã™ã‚‹æ–¹æ³•ã«ã¯æ¬¡ã®3ã¤ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™

1. å¯¾è±¡ã®å‹ã®ã™ã¹ã¦ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ä¸€éƒ¨ã§ã‚‚ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã§ã¯ãªã„ãªã‚‰ã°ã€ãã®å‹ã¯ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã¨ã—ã¦ãƒãƒ¼ã‚¯ã§ããªã„
2. å…¨ã¦ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ˜ç¤ºçš„ã«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¸å¯èƒ½ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ãªã„å ´åˆã«ã®ã¿ã€ãã®å‹ã¯ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã¨ã—ã¦ãƒãƒ¼ã‚¯ã§ãã‚‹
3. å‹ã®ä½œæˆè€…ã¯ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®çŠ¶æ…‹ã«é–¢ã‚ã‚‰ãšã€å‹ã‚’ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã¨ã—ã¦ãƒãƒ¼ã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã‚‹

2ã¨3ã¯ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã®ç§»è¡Œã‚’å®¹æ˜“ã«ã—ã¾ã™ãŒã€1ãŒæœ€ã‚‚å®‰å…¨ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚1ã‚’æ¡ç”¨ã—ã¦ã‹ã‚‰2,3ã¸ç·©å’Œã™ã‚‹ã“ã¨ã¯ã§ãã‚‹ã‚‚ã®ã®ã€é€†ã¯ã§ãã¾ã›ã‚“ã€‚ã¾ãŸã€2,3ã§ã¯ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ™‚é–“ã®çµŒéã«ã‚ˆã£ã¦å¤‰æ›´ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚‹ãŸã‚ã€å®Ÿè³ªçš„ã«ç®¡ç†ã™ã‚‹ã“ã¨ãŒä¸å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ã‚‚ã†ä¸€ã¤ã®å•é¡Œã¯æ§‹æ–‡ã«ã¤ã„ã¦ã§ã™ã€‚P3236ã§ã¯ãã®ã‚ˆã†ãªå‹ã«å¯¾ã™ã‚‹ãƒãƒ¼ã‚­ãƒ³ã‚°ã®æ–¹æ³•ã¨ã—ã¦å±æ€§æ§‹æ–‡ã‚’ææ¡ˆã—ã¦ãŠã‚Šã€å±æ€§ãªã‚‰ã°ä»¥å‰ã®è¨€èªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚‚ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒãã‚Œã‚’èªè­˜ã™ã‚‹ã“ã¨ã§ï¼‰ã“ã‚Œã‚’æœ‰åŠ¹åŒ–ã§ãã‚‹ã¨ã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€å±æ€§ã®ç„¡è¦–å¯èƒ½æ€§ã«ã¤ã„ã¦ã¯EWGã§ä½•åº¦ã‚‚ç¢ºèªã•ã‚Œã¦ãŠã‚Šã€å±æ€§ã¯ç„¡è¦–ã•ã‚ŒãŸå ´åˆã§ã‚‚ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆãªã„å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯å‹ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã‚ã‚Šã€å‹ç‰¹æ€§ã‚’é€šã—ã¦è¦³å¯Ÿå¯èƒ½ã§ã‚ã‚‹ãŸã‚ã€ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚å±æ€§ã§ã‚ã‚ŠãªãŒã‚‰ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã¦ã—ã¾ã†ã‚‚ã®ã¨ã—ã¦ã¯`[[no_unique_address]]`ãŒçŸ¥ã‚‰ã‚Œã¦ãŠã‚Šã€ã“ã®ABIéäº’æ›ã®å½±éŸ¿ã«ã‚ˆã£ã¦MSVCã¯ã—ã°ã‚‰ãã“ã‚Œã‚’å®Ÿè£…ã—ãªã„ã“ã¨ã‚’é¸æŠã—ã¦ãŠã‚Šã€ã“ã®é–“é•ã„ã‚’ç¹°ã‚Šè¿”ã•ãªã„å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€Clangã®å®Ÿè£…è€…ã‚‚ä»Šå›ã®ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£ã®ãƒãƒ¼ã‚«ãƒ¼ã¨ã—ã¦å±æ€§ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«åå¯¾ã‚’è¡¨æ˜ã—ã¦ã„ã¾ã™ã€‚

EWGã§ã¯ã“ã“ã§ã‚‚ãã®è­°è«–ã‚’è’¸ã—è¿”ã•ãªã„ã“ã¨ãŒç¢ºèªã•ã‚Œã¦ãŠã‚Šã€ã“ã®æ–‡æ›¸ã§ã‚‚å±æ€§ã‚’ä½¿ç”¨ã—ãªã„ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãªãŠã€ã“ã®2ã¤ã®å•é¡Œç‚¹ã®æ¨å¥¨äº‹é …ã¯ã€ã“ã®ææ¡ˆã®ãƒ¡ã‚¤ãƒ³ã®éƒ¨åˆ†ã¨ã¯åˆ¥ã®å•é¡Œã§ã‚ã‚‹ãŸã‚ã€ã•ã‚‰ãªã‚‹æ¤œè¨ãŒå¿…è¦ãªå ´åˆã¯ææ¡ˆã‚’åˆ†ã‘ã¦è­°è«–ã™ã‚‹ã“ã¨ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®æ–‡æ›¸ã§æç¤ºã•ã‚Œã¦ã„ã‚‹å°‘ãªãã¨ã‚‚åˆæ„ãŒå¿…è¦ãªã“ã¨ã¨ã—ã¦ã¯

- å‹ã‚’ãƒˆãƒªãƒ“ã‚¢ãƒ«ã«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã¨ã—ã¦ãƒãƒ¼ã‚¯ã™ã‚‹ãŸã‚ã«ã¯å±æ€§ã‹åˆ¥ã®æ§‹æ–‡ã®ã©ã¡ã‚‰ã‚’ä½¿ç”¨ã™ã¹ãã‹ï¼Ÿ
- æš—é»™ã®ãƒˆãƒªãƒ“ã‚¢ãƒ«ãªãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½æ€§ã¯ä»£å…¥æ¼”ç®—å­ã®å½±éŸ¿ã‚’å—ã‘ã‚‹ã¹ãã‹ï¼Ÿ
- ãƒˆãƒªãƒ“ã‚¢ãƒ«ã«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚ŒãŸå‹ã¯ã«å¯¾ã™ã‚‹åˆ¶é™ã¯ä½•ã‹ï¼Ÿ
- ã‚¹ãƒ¯ãƒƒãƒ—ã§ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã®ç”Ÿå­˜æœŸé–“ã®å•é¡Œã¸ã®å¯¾å‡¦

ã‚’æŒ™ã’ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯P2786ã¸ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã•ã‚ŒãŸã‚ˆã†ã§ã™ï¼ˆä½•ãŒåˆæ„ã•ã‚ŒãŸã®ã‹ã¯ä¸æ˜ã§ã™ï¼‰ã€‚

- [P3278 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1932)

### [P3279R0 CWG2463: What 'trivially fooable' should mean](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3279r0.html)

C++ã«ãŠã‘ã‚‹trivially ï½ã¨ã„ã†æ¦‚å¿µã®å®šç¾©ã‚’ä¿®æ­£ã—æ˜ç¢ºåŒ–ã™ã‚‹ææ¡ˆã€‚

trivially ï½ã¨ã„ã†æ¦‚å¿µï¼ˆä¾‹ãˆã°trivially copyableï¼‰ã«ã¤ã„ã¦ã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©é–‹ç™ºè€…ã€è¨€èªè¨­è¨ˆè€…ã®é–“ã§ä¸‰è€…ä¸‰æ§˜ãªç†è§£ãŒã•ã‚Œã¦ã„ã¾ã™

- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…
    - å‹ãŒtrivially copyableã§ã‚ã‚‹å ´åˆã€5ã¤ã®ãƒ«ãƒ¼ãƒ«ï¼ˆRule-of-Fiveï¼‰ã®æ“ä½œï¼ˆç‰¹æ®Šãƒ¡ãƒ³ãƒé–¢æ•°ã®äº‹ï¼‰ã¯å…¨ã¦å˜ç´”ãª`memcpy`ã«ã¾ã§è½ã¨ã™ã“ã¨ãŒã§ãã‚‹
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©é–‹ç™ºè€…
    - å…¨ã¦ã®å‹ã¯æœ€åˆã¯trivially copyableã§ã‚ã‚‹ãŒã€ãã®å¾Œã«étrivially copyableã«ãªã‚‹
      - ä¾‹ãˆã°ã€ç‰¹æ®Šãƒ¡ãƒ³ãƒé–¢æ•°ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã§ã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã™ã‚‹ã¨ã€trivially copyableã§ã¯ãªããªã‚‹
      - ã¾ãŸã€étrivially copyableãªãƒ¡ãƒ³ãƒå¤‰æ•°ãŒã‚ã£ã¦ã‚‚ã€trivially copyableã§ã¯ãªããªã‚‹
- è¨€èªè¨­è¨ˆè€…ï¼ˆè¨€èªæ³•å¾‹å®¶ï¼‰
    - â†‘2ã¤ã¯ã€trivially copyableã®ç‰©ç†çš„ãªèªè­˜ã€ç›´æ„Ÿã«ã‚ˆã£ã¦ã¿ãªã•ã‚Œã¦ã„ã¾ã—ãŸ
    - è¨€èªè¨­è¨ˆè€…ã®ç†è§£ã¯ã€æ¨™æº–ã®è¦å®šã«ã‚ˆã£ã¦ç¢ºç«‹ã•ã‚Œã¦ã„ã‚‹
    - ãã‚Œã«ã‚ˆã£ã¦ã€`T`ãŒä»£å…¥å¯èƒ½ã§ãªã„å ´åˆã§ã‚‚`memcpy`ã‚’ä½¿ç”¨ã—ã¦ä»£å…¥ã‚’å®Ÿè¡Œã§ãã‚‹

ã“ã®ã‚ˆã†ã«ã€ç‰¹ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã¨è¨€èªæ³•å¾‹å®¶ã®é–“ã«ã¯ã€trivially copyableã®ç†è§£ã«ã¤ã„ã¦ç›¸é•ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã¯5ã¤ã®ç‰¹æ®Šãƒ¡ãƒ³ãƒé–¢æ•°ã«ã‚ˆã‚‹æ“ä½œã‚’å®Œå…¨ãª`memcpy`ã«è½ã¨ã™ã“ã¨ãŒã§ãã‚‹å ´åˆã«ã®ã¿ã€C++ãŒå‹ã‚’trivially copyableã¨å ±å‘Šã™ã‚‹ã“ã¨ã‚’æœ›ã‚“ã§ã„ã‚‹
    - èª¤æ¤œçŸ¥ã¯è‡´å‘½çš„
- è¨€èªæ³•å¾‹å®¶ã¯C++ãŒå‹ã‚’trivially copyableã§ã¯ãªã„ã¨å ±å‘Šã™ã‚‹ã®ã¯ã€ãã‚Œã‚‰ã‚’`memcpy`ã™ã‚‹ã“ã¨ãŒå…¨ãæ„å‘³ã‚’ãªã•ãªã„å ´åˆã«ã®ã¿ã§ã‚ã‚‹ã“ã¨ã‚’æœ›ã‚“ã§ã„ã‚‹
    - trivially copyableã§ãªã„é™ã‚Šã€`memcpy`ã™ã‚‹ã®ã¯UB
    - åŸºæœ¬çš„ã«ã€trivially copyableã¨ã„ã†æ€§è³ªã¯ã€ã©ã®ã‚ˆã†ãªå ´åˆã§ã‚‚ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä»£ã‚ã‚Šã«ãƒã‚¤ãƒˆã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ã‚‚ã®

ç‰¹ã«ã€åŒæ–¹ãŒæœ›ã‚“ã§ã„ã‚‹ã‚‚ã®ã¯

- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã¯ã€èª¤æ¤œçŸ¥ãŒç„¡ãå³å¯†ã«ä¿å®ˆçš„ãªtrivially copyableã¨ã„ã†æ€§è³ªã®ãƒ©ãƒ™ãƒ«ã‚’æ±‚ã‚ã¦ã„ã‚‹
    - ãªãœãªã‚‰ã€èª¤æ¤œçŸ¥ã¯å®Ÿè¡Œæ™‚ã®èª¤å‹•ä½œã‚’æ„å‘³ã™ã‚‹ãŸã‚
- è¨€èªæ³•å¾‹å®¶ã¯ã€èª¤æ¤œçŸ¥ãŒãªã‚‹ã¹ãå°‘ãªã„trivially copyableã¨ã„ã†æ€§è³ªã®ãƒ©ãƒ™ãƒ«ã‚’æ±‚ã‚ã¦ã„ã‚‹
    - ãªãœãªã‚‰ã€èª¤æ¤œçŸ¥ã¯ã€å®Ÿéš›ã«ã¯æ­£ã—ãå‹•ä½œã™ã‚‹ã‚‚ã®ã®å½¢å¼çš„ã«ã¯UBã¨ãªã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ„å‘³ã™ã‚‹ï¼ˆã ã‘ï¼‰ãªãŸã‚

ãã—ã¦ã€ç¾åœ¨ã®trivially ï½ã¨ã„ã†æ¦‚å¿µã¨ãã®å®šç¾©ã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã®æœŸå¾…ã™ã‚‹ã‚ˆã†ã«ã¯ãªã£ã¦ã„ã¾ã›ã‚“ã€‚

ã¾ãšã€ç¾åœ¨ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯ã©ã‚Œã‚‚ã€é–¢æ•°å‘¼ã³å‡ºã—ã§ãªã„é™ã‚Šã™ã¹ã¦ã®æ“ä½œã‚’ãƒˆãƒªãƒ“ã‚¢ãƒ«ãªã‚‚ã®ã¨ã—ã¦æ‰±ã„ã€é–¢æ•°å‘¼ã³å‡ºã—ã®å ´åˆã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ãªç‰¹æ®Šãƒ¡ãƒ³ãƒé–¢æ•°ã‚’å‘¼ã³å‡ºã™å ´åˆã«ã®ã¿ãƒˆãƒªãƒ“ã‚¢ãƒ«æ€§ãŒç¶­æŒã•ã‚Œã¾ã™ã€‚ç‰¹ã«ã€`memcpy`ã®ã‚ˆã†ãªã“ã¨ã‚’å…¨ãã—ãªã„ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€`is_trivially_constructible<int, float>`ã‚„`is_trivially_constructible<bool, int>`ã®ã‚ˆã†ãªã‚‚ã®ã¯`true`ã«ãªã‚Šã€é›†æˆä½“åˆæœŸåŒ–ã‚‚ãƒˆãƒªãƒ“ã‚¢ãƒ«ã¨ã¿ãªã•ã‚Œã¾ã™ï¼ˆé–¢æ•°å‘¼ã³å‡ºã—ã‚’ã—ãªã„ã®ã§ï¼‰ã€‚

æ¬¡ã«ã€`is_trivially_constructible`ã¨`is_trivially_assignable`åŠã³ã€ã‚³ãƒ”ãƒ¼/ãƒ ãƒ¼ãƒ–ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ä»£å…¥æ¼”ç®—å­ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«ã«ãªã‚‹æ¡ä»¶ã§ã¯ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã®çµæœã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€ã“ã“ã§è¦‹ã‚‰ã‚Œã¦ã„ã‚‹ã®ã¯ã©ã®ç‰¹æ®Šãƒ¡ãƒ³ãƒé–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ã§ã¯ãªãã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã«ã‚ˆã£ã¦ã©ã®é–¢æ•°ãŒé¸ã³ã ã•ã‚Œã‚‹ã‹ã§ã™ï¼ˆã“ã‚Œã¯ã©ã¡ã‚‰ã‹ã¨è¨€ãˆã°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã®ç›´æ„Ÿã«æ²¿ã£ã¦ã„ã¾ã™ï¼‰ã€‚ã—ã‹ã—ä¸€æ–¹ã§ã€`is_trivially_copyable`åŠã³ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«ã«ãªã‚‹æ¡ä»¶ã¯ç‰¹æ®Šãƒ¡ãƒ³ãƒé–¢æ•°ã®å­˜åœ¨ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚Œã¦ãŠã‚Šï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã®çµæœã¯ç„¡è¦–ã•ã‚Œã‚‹ï¼‰ã€ã“ã‚Œã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã®ç›´æ„Ÿã¨ã¯ç•°ãªã‚‹éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚

ã•ã‚‰ã«ã€ã“ã‚Œã‚‰ã®ã“ã¨ã«ã‚ˆã£ã¦ç•™æ„ã™ã¹ãç‚¹ãŒç”Ÿã˜ã¾ã™

- ã‚³ãƒ”ãƒ¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚„ã‚³ãƒ”ãƒ¼ä»£å…¥æ¼”ç®—å­ãªã©ã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯ãªã„ãŸã‚ã€ä¸€è‡´åº¦ã®ä½ã„ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ä¸€è‡´åº¦ã®é«˜ã„éãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå…±å­˜ã—ã†ã‚‹
    - ãã®å ´åˆã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã‚³ãƒ”ãƒ¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ã¯ãªã„ã®ã§ã€ã“ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¹ã§ã¯`is_trivially_copyable`ãŒ`true`ã«ãªã‚‹
- ç‰¹æ®Šãƒ¡ãƒ³ãƒé–¢æ•°ã‚’ãƒˆãƒªãƒ“ã‚¢ãƒ«ã¨å‘¼ç§°ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã¯æ–‡è„ˆã«ä¾å­˜ã›ãšã€ä¸€åº¦ãƒˆãƒªãƒ“ã‚¢ãƒ«ã¨åˆ¤å®šã•ã‚Œã‚Œã°ãšã£ã¨ãƒˆãƒªãƒ“ã‚¢ãƒ«ã«ãªã‚‹
    - å¾“ã£ã¦ã€ã‚ã‚‹ãƒˆãƒªãƒ“ã‚¢ãƒ«ãªãƒ¡ãƒ³ãƒé–¢æ•°ã‚’åŸºåº•ã‚¯ãƒ©ã‚¹ã‹ã‚‰ç¶™æ‰¿ã—ãŸå ´åˆã§ã‚‚ã€åŸºåº•ã‚¯ãƒ©ã‚¹ã§ã‚‚æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã§ã‚‚ãã®é–¢æ•°ã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ã§ã‚ã‚‹

ã“ã‚Œã‚‰ã®ã“ã¨ã‚’å¿µé ­ã«ã€ææ¡ˆã§ã¯trivially ï½ã«é–¢ã™ã‚‹äºˆæœŸã—ãªã„æŒ¯èˆã®ä¾‹ã‚’3ãƒ‘ã‚¿ãƒ¼ãƒ³ç…§ä¼šã—ã¦ã„ã¾ã™

#### 1. trivially copyableå‹ã¯étrivially copyableãƒ¡ãƒ³ãƒã‚’æŒã¤ã“ã¨ãŒã§ãã‚‹

```cpp
struct Hamlet {
  Hamlet(const Hamlet&) { puts("copied"); }
  Hamlet(Hamlet&&) = default;
  Hamlet& operator=(Hamlet&&) = default;
};

struct Nutshell {
  Hamlet h_;
  Nutshell(Nutshell&&) = default;
  Nutshell& operator=(Nutshell&&) = default;
};

// æ¨™æº–çš„ã«ã¯ã©ã¡ã‚‰ã‚‚ãƒ‘ã‚¹ã™ã‚‹ï¼ˆEDGã¨MSVCã¯ãƒ‘ã‚¹ã™ã‚‹ï¼‰
static_assert(!std::is_trivially_copyable_v<Hamlet>);
static_assert(std::is_trivially_copyable_v<Nutshell>);
```

ã“ã®ä¾‹ã¯ã€`Hamlet`ã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼ä¸å¯ã§ã‚ã‚‹ã®ã«`Nutshell`ã«åŒ…ã‚€ã¨ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ã«ãªã‚Š`memcpy`å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã£ã¦ã—ã¾ã†ä¾‹ã§ã™ã€‚

ã“ã‚Œã¯ã€è¨€èªæ³•å¾‹å®¶ã®ç†è§£ã‹ã‚‰ã™ã‚‹ã¨é–“é•ã£ã¦ã„ã‚‹ã‚‚ã®ã®ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã®ç†è§£ã‹ã‚‰ã™ã‚‹ã¨é©æ­£ãªæŒ¯ã‚‹èˆã„ã§ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã®ç«‹å ´ã‹ã‚‰ã¯ãã®å‹ã§ç›´æ¥æä¾›ã•ã‚Œã¦ã„ã‚‹æ“ä½œã®ã¿ã«ç€ç›®ã™ã‚‹ãŸã‚ã€ãã®è¦³ç‚¹ã‹ã‚‰ã¯æ­£ã—ã„æŒ¯ã‚‹èˆã„ã¨ãªã‚Šã¾ã™ã€‚

```cpp
struct Hamlet2 {
  Hamlet2(const Hamlet2&) { puts("copied"); }
  Hamlet2(Hamlet2&&) = default;
  Hamlet2& operator=(Hamlet2&&); // not defaulted
};
struct Nutshell {
  Hamlet2 h_;
  Nutshell(Nutshell&&) = default;
  Nutshell& operator=(Nutshell&&) = default;
};

static_assert(!std::is_trivially_copyable_v<Hamlet2>);
static_assert(!std::is_trivially_copyable_v<Nutshell>);
```

ã“ã®ä¾‹ã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©é–‹ç™ºè€…ã®ç†è§£ã«å•é¡ŒãŒã‚ã‚‹ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã‹ã‚‰è¦‹ã¦ï¼‰ã“ã¨ã‚’ç¤ºã™ä¾‹ã§ã™ã€‚`Hamlet2`ã¯ãƒ ãƒ¼ãƒ–ä»£å…¥æ¼”ç®—å­ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ï¼ˆå¾“ã£ã¦ãƒˆãƒªãƒ“ã‚¢ãƒ«ã§ã¯ãªã„ï¼‰ç‚¹ã ã‘ãŒ`Hamlet`ã¨ã¯ç•°ãªã‚Šã¾ã™ãŒã€`Nutshell`ã‚’ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼ä¸å¯ã®ã¾ã¾ã«ã—ã¾ã™ã€‚

ã“ã®ã“ã¨ã¯ã€`Nutshell`ã®trivially copyableæ€§ã¯ãƒ¡ãƒ³ãƒå¤‰æ•°å‹ã®æ€§è³ªã§ã¯ãªãã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæ„ŸçŸ¥ã—ã¦ã„ã‚‹ä»–ã®ä½•ã‹ã®æƒ…å ±ã«ã‚ˆã£ã¦æ±ºã¾ã£ã¦ã„ã‚‹ã¨è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### 2. å‹ã¯ã€trivially copyableã§ã‚ã‚‹ã¨ä¸»å¼µã—ãªãŒã‚‰ã€éãƒˆãƒªãƒ“ã‚¢ãƒ«ã«å‹•ä½œã™ã‚‹ã“ã¨ãŒã§ãã‚‹

```cpp
struct Plum {
  int *ptr_;
  explicit Plum(int& i) : ptr_(&i) {}
  Plum(const Plum&) = default;

  // ã‚³ãƒ”ãƒ¼ä»£å…¥æ¼”ç®—å­ï¼ˆå‰Šé™¤æ¸ˆï¼‰
  void operator=(const volatile Plum&) = delete;

  // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä»£å…¥æ¼”ç®—å­
  template<class=void>
  void operator=(const Plum& rhs) {
    *ptr_ = *rhs.ptr_;
  }
};


static_assert(std::is_trivially_copyable_v<Plum>);
static_assert(std::is_assignable_v<Plum&, const Plum&>);
static_assert(!std::is_trivially_assignable_v<Plum&, const Plum&>);
```

ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ã®å®šç¾©ã¯ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãªç‰¹æ®Šãƒ¡ãƒ³ãƒé–¢æ•°ã®å®£è¨€ã®å­˜åœ¨ã ã‘ã‚’è¦‹ã¾ã™ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã•ã‚Œã¦ã„ãªã„ã“ã¨ã¯å¿…é ˆã ãŒã€å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ã¯è¦‹ãªã„ï¼‰ã€‚ã“ã®`plam`ã®å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®`delete`ã‚³ãƒ”ãƒ¼ä»£å…¥æ¼”ç®—å­ï¼ˆã‚‚ã©ãï¼‰ã«ã‚ˆã£ã¦æš—é»™ã®ä»£å…¥æ¼”ç®—å­å®šç¾©ãŒï¼ˆã©ã¡ã‚‰ã‚‚ï¼‰æŠ‘åˆ¶ã•ã‚Œã¾ã™ãŒã€ã“ã®`delete`å®šç¾©ä»£å…¥æ¼”ç®—å­ã¯ã‚·ã‚°ãƒãƒãƒ£ã ã‘ã¯ã‚³ãƒ”ãƒ¼ä»£å…¥æ¼”ç®—å­ã¨ã—ã¦æ‰±ã‚ã‚Œã€ãªãŠã‹ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã®ãŸã‚`is_trivially_copyable_v<Plum>`ãŒ`true`ã«ãªã‚Šã¾ã™ã€‚

ä¸€æ–¹ã€ã‚³ãƒ”ãƒ¼ä»£å…¥æ“ä½œã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä»£å…¥æ¼”ç®—å­ã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã€ã“ã¡ã‚‰ã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ã§ã‚ã‚‹ã¨ã¯æ‰±ã‚ã‚Œãšã€`is_trivially_assignable`ã‚‚`false`ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ä¾‹ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©é–‹ç™ºè€…ã¨è¨€èªæ³•å¾‹å®¶ã®ä¸¡è€…ã«ã¨ã£ã¦ã¯æƒ³å®šã•ã‚Œã‚‹æŒ¯ã‚‹èˆã„ã®ã‚ˆã†ã§ã™ã€‚ä¸€æ–¹æ˜ã‚‰ã‹ã«ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ï¼ˆãŠã‚ˆã³ã»ã‹ã®ã™ã¹ã¦ã®äººï¼‰ã«ã¨ã£ã¦ã¯ã“ã‚Œã¯é©šãã¹ãã“ã¨ã§ã™ã€‚

#### 3. ãƒˆãƒªãƒ“ã‚¢ãƒ«ç‰¹æ®Šãƒ¡ãƒ³ãƒé–¢æ•°ã¯ã€memcpyã®ã‚ˆã†ã«å‹•ä½œã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹

```cpp
// å…¨ã¦ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«
struct Cat {};

// ä»£å…¥æ¼”ç®—å­ã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ã§ã¯ãªã„ã¯ãš
struct Leopard : Cat {
    int spots_;
    Leopard& operator=(Leopard&) = delete;
    using Cat::operator=;
};

static_assert(is_trivially_copyable_v<Leopard>);
static_assert(is_trivially_assignable_v<Leopard&, const Leopard&>);

void test(Leopard& a, const Leopard& b) {
  a = b; // absolutely no data is copied
}
```

ä¸€ã¤å‰ã¨åŒæ§˜ã«ã€`Leopard`ã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚ã—ã‹ã—ä»Šåº¦ã®å ´åˆã€`is_trivially_assignable`ã‚‚`true`ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ãªãœãªã‚‰ã€`Cat`ã‹ã‚‰ç¶™æ‰¿ã—ã¦ã„ã‚‹ä»£å…¥æ¼”ç®—å­ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«ãªã‚‚ã®ã‹ã¤`Leopard`ã§ä½¿ç”¨å¯èƒ½ã¨ã—ã¦ç™ºè¦‹ã•ã‚Œã‚‹ã‹ã‚‰ã§ã‚ã‚Šã€ã“ã®çµæœã¨ã—ã¦`Leopard`ã®ä»£å…¥æ“ä½œã¯ãªã«ã‚‚ï¼ˆåŸºåº•ã‚¯ãƒ©ã‚¹ã®éƒ¨åˆ†ã—ã‹ï¼‰ã‚³ãƒ”ãƒ¼ã—ãªã„ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã«ã¨ã£ã¦éå¸¸ã«å•é¡Œã«ãªã‚Šã¾ã™ã€‚ãªãœãªã‚‰ã€ã“ã®ã‚ˆã†ãªä¾‹ã‚’æ­£ã—ãæ¤œå‡ºã§ããªã„ãŸã‚ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã‚Œã‚‰ã®ãƒˆãƒªãƒ“ã‚¢ãƒ«æ€§ã®å®šç¾©ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã«ã¨ã£ã¦è‡ªæ˜ãªã‚‚ã®ã¨ãªã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚å…·ä½“çš„ã«ã¯

- `is_trivially_constructible<T>`ã¯ã€å¼•æ•°ç„¡ã—ã§`T`ã‚’æ§‹ç¯‰ã™ã‚‹æ“ä½œã‚’no-opã«ã§ãã‚‹ï¼ˆã¤ã¾ã‚Šçœç•¥å¯èƒ½ï¼‰ã“ã¨ã‚’æ­£ç¢ºã«æ„å‘³ã™ã‚‹
    - ã“ã‚Œã¯ç¾çŠ¶é€šã‚Š
- `is_trivially_constructible<To, From>`ã¯ã€`From`ã‹ã‚‰ã®å®Œå…¨ãª`To`ã®æ§‹ç¯‰ã‚’`memcpy`ã«ã§ãã‚‹ã“ã¨ã‚’æ­£ç¢ºã«æ„å‘³ã™ã‚‹
    - ä¾‹ãˆã°ã€`is_trivially_constructible<float, int>`ã¯`false`ã«ãªã‚‹
- `is_trivially_constructible<To, Args...>`ã¯ã€`Args`ãŒ1ã‚ˆã‚Šå¤§ãã„ãƒ‘ãƒƒã‚¯ã®å ´åˆå¸¸ã«`false`ã«ãªã‚‹ã¯ãšã§ã‚ã‚Šã€ãã‚Œã‚’éæ¨å¥¨åŒ–ã™ã‚‹
    - ã“ã‚Œã¯ç‰©ç†çš„ã«å¯¾å¿œã™ã‚‹ã‚‚ã®ãŒç„¡ãå½¹ã«ç«‹ãŸãªã„
- `is_trivially_destructible<T> `ã¯ã€`T`ã®ç ´æ£„ã‚’no-opã«ã§ãã‚‹ï¼ˆã¤ã¾ã‚Šçœç•¥å¯èƒ½ï¼‰ã“ã¨ã‚’æ­£ç¢ºã«æ„å‘³ã™ã‚‹
    - ã“ã‚Œã¯ç¾çŠ¶é€šã‚Š
- `is_trivially_assignable<To, From>`ã¯ã€`From`ã‹ã‚‰ã®å®Œå…¨ãª`To`ã®ä»£å…¥ã‚’`memcpy`ã«ã§ãã‚‹ã“ã¨ã‚’æ­£ç¢ºã«æ„å‘³ã™ã‚‹
    - ä¾‹ãˆã°ã€`is_trivially_assignable<float&, int&>`ã¯`false`ã«ãªã‚‹
- `is_trivially_copyable<T>`ã¯ã€å¼•æ•°ã®CV/å‚ç…§ä¿®é£¾ã«é–¢ã‚ã‚‰ãš`T`ãŒã‚µãƒãƒ¼ãƒˆã™ã‚‹ç‰¹æ®Šãƒ¡ãƒ³ãƒé–¢æ•°ã®æ“ä½œã‚’`memcpy`ã«ã§ãã‚‹ã“ã¨ã‚’æ­£ç¢ºã«æ„å‘³ã™ã‚‹

æœ€å¾Œã®ææ¡ˆã¯ã€ã¤ã¾ã‚Šæ¬¡ã®äº‹ã‚’æ„å‘³ã—ã¾ã™

```cpp
// å«æ„ï¼ˆa => bï¼‰ã‚’è¡¨ã™
constexpr bool implies(bool a, bool b) { return b || !a; }

template<class T>
inline constexpr bool is_trivially_copyable_v = 
  implies(is_constructible_v<T, T&>,        is_trivially_constructible_v<T, T&>) &&
  implies(is_constructible_v<T, T&&>,       is_trivially_constructible_v<T, T&&>) &&
  implies(is_constructible_v<T, const T&>,  is_trivially_constructible_v<T, const T&>) &&
  implies(is_constructible_v<T, const T&&>, is_trivially_constructible_v<T, const T&&>) &&
  implies(is_assignable_v<T&, T&>,          is_trivially_assignable_v<T&, T&>) &&
  implies(is_assignable_v<T&, T&&>,         is_trivially_assignable_v<T&, T&&>) &&
  implies(is_assignable_v<T&, const T&>,    is_trivially_assignable_v<T&, const T&>) &&
  implies(is_assignable_v<T&, const T&&>,   is_trivially_assignable_v<T&, const T&&>) &&
  implies(is_destructible_v<T>,             is_trivially_destructible_v<T>);
```

ã“ã‚Œã‚‰ã®å¤‰æ›´ã®å†…å®¹ã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã®ç›´æ„Ÿã«å¾“ã£ãŸã‚‚ã®ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚

- [P3279 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1933)

### [P3281R0 Contact checks should be regular C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3281r0.pdf)

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ç¾åœ¨ã®ä»•æ§˜ã‚’ã€ã‚ˆã‚Šä¸€èˆ¬çš„ãªç¾åœ¨ã®C++ã«ã¨ã£ã¦è‡ªç„¶ã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã§é¸æŠã•ã‚Œã¦ã„ã‚‹è¨­è¨ˆã¯ã€ã„ãã¤ã‹ã®ç‚¹ã§ä¸€èˆ¬çš„ãªC++ã‚³ãƒ¼ãƒ‰ã«ãŠã‘ã‚‹ã‚‚ã®ã¨ã¯ç•°ãªã‚‹ã“ã¨ãŒã‚ã‚Šã€ãã‚Œã¯ãŠãã‚‰ãå¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒã“ã®ã¾ã¾å°å…¥ã•ã‚ŒãŸå ´åˆã«ãã‚Œã‚’ä½¿ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹C++ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦é©šãã¹ãã‚‚ã®ã«ãªã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚ãã—ã¦ã€ã“ã®ã“ã¨ã¯Cã‚¢ã‚µãƒ¼ãƒˆã‚’ã¯ã˜ã‚ã¨ã™ã‚‹æ—¢å­˜ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³/ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‹ã‚‰å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¸ã®ç§»è¡Œã‚’å›°é›£ã«ã™ã‚‹ã“ã¨ãŒäºˆæƒ³ã•ã‚Œã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¸ã®ç§»è¡Œã®ã—ã‚„ã™ã•ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœŸå¾…ã¨ç•°ãªã‚‹æŒ¯ã‚‹èˆã„ã‚’ä¿®æ­£ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã‚ã’ã‚‰ã‚Œã¦ã„ã‚‹å•é¡Œç‚¹ã®ä¸€ã¤ã¯å¥‘ç´„æ¡ä»¶ã®è©•ä¾¡å›æ•°ã«é–¢ã™ã‚‹ã‚‚ã®ã§ã€è¤‡æ•°å›ã®è©•ä¾¡ã‚’èªã‚ã‚‹ä¸€æ–¹ã§è©•ä¾¡ã‚’çœç•¥ã™ã‚‹ã“ã¨ã‚‚èªã‚ã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚

```cpp
struct X {};

// ï¼ˆã©ã“ã‹ã«ã‚ã‚‹ï¼‰è¾æ›¸ï¼ˆãƒãƒƒãƒ—ï¼‰ã«xã‚’è¿½åŠ ã—ã€ãã‚ŒãŒã¾ã è¿½åŠ ã•ã‚Œã¦ã„ãªã‹ã£ãŸå ´åˆã¯trueã‚’è¿”ã™
bool not_already_processing(X* x);

// xã‚’è¾æ›¸ã‹ã‚‰å‰Šé™¤ã—ã€å‰Šé™¤ã•ã‚ŒãŸå ´åˆã«trueã‚’è¿”ã™
bool done_processing(X* x);

void f(X* x) {
  contract_assert(not_already_processing(x));
  
  // f()ã®å†å¸°å‘¼ã³å‡ºã—ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
  contract_assert(done_processing(x));
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ãªãƒã‚§ãƒƒã‚¯ã¯ã€ç¾åœ¨ã®Cã‚¢ã‚µãƒ¼ãƒˆãªã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒã®æœŸå¾…é€šã‚Šã«å‹•ä½œã—ã¾ã™ãŒã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®å ´åˆã¯å‹•ä½œã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãªãœãªã‚‰ã€å†å¸°å‘¼ã³å‡ºã—ã®å ´åˆã«ãƒã‚§ãƒƒã‚¯ãŒçœç•¥ã•ã‚ŒãŸã‚Šã€å†å¸°å‘¼ã³å‡ºã—ã§ãªã„å ´åˆã«ãƒã‚§ãƒƒã‚¯ãŒé‡è¤‡ã—ãŸã‚Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚

ã‚‚ã†ä¸€ã¤ã®å•é¡Œç‚¹ã¯ã€å¥‘ç´„æ³¨é‡ˆå†…ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹è‡ªå‹•å¤‰æ•°ãŒæš—é»™ã«`const`åŒ–ã•ã‚Œã‚‹ã“ã¨ã§ã™ã€‚

ã“ã‚Œã¯å¥‘ç´„æ¡ä»¶å¼ã§ã®å‰¯ä½œç”¨ã®åˆ©ç”¨ã‚’é˜²æ­¢ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦å°å…¥ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã«ã‚ˆã£ã¦ã€æ—¢å­˜ã®ã‚¢ã‚µãƒ¼ãƒˆã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã®æ„å‘³ã‚’å¤‰ãˆãšã«`contract_assert`ã¸ç§»è¡Œã™ã‚‹ã®ãŒé›£ã—ããªã‚‹ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã¯ã€é¸æŠã•ã‚Œã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«ã€ã“ã‚Œã¯ã‚ãã¾ã§æµ…ã„`const`ã§ã‚ã‚‹ã®ã§ã€ãƒã‚¤ãƒ³ã‚¿ã®å…ˆã¯å¤‰æ›´å¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

```cpp
void f(int* x)
  pre(x = nullptr)  // ngã€ãƒã‚¤ãƒ³ã‚¿ãã®ã‚‚ã®ã¯const
  pre(*x = 1)       // okã€ãƒã‚¤ãƒ³ã‚¿ã®å‚ç…§å…ˆã¯éconst
{
  ...
}
```

ç­†è€…ã®æ–¹ã¯EDGã®äººï¼ˆEDGã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®é–‹ç™ºè€…ã®ä¸€äººã¨æ€ã‚ã‚Œã‚‹ï¼‰ã§ã€EDGã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®å®Ÿè£…ã«ãŠã‘ã‚‹å„ç¨®ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¸ç§»è¡Œã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ã€ã“ã‚Œã‚‰ã®ç‚¹ã‚’è€ƒæ…®ã—ã¦æ—¢å­˜ã®ãƒã‚§ãƒƒã‚¯ãŒã“ã‚Œã‚‰ã®å•é¡Œç‚¹ã«å¼•ã£ã‹ã‹ã‚‹ã®ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦å›ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãã†ã™ã‚‹ã¨å¿…ç„¶çš„ã«ãƒã‚¯ãƒ­ã®ãƒ©ãƒƒãƒ—ãªã©ã«ã‚ˆã£ã¦ã€ã‚ã‚‹ç¨®ã®ã‚«ãƒ†ã‚´ãƒªã®ãƒã‚§ãƒƒã‚¯ã¯ã‚ã‚‹ãƒ•ãƒ©ã‚°ã«ã‚ˆã£ã¦åˆ¶å¾¡ã•ã‚Œã€æ®‹ã£ãŸãƒã‚§ãƒƒã‚¯ã¯ã¾ãŸåˆ¥ã®ãƒ•ãƒ©ã‚°ã«ã‚ˆã£ã¦åˆ¶å¾¡ã•ã‚Œã‚‹ã€ã®ã‚ˆã†ãªã‚ã¾ã‚Šæœ›ã¾ã—ããªã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã«ãªã‚Šã€ã“ã‚Œã«ã‚ˆã£ã¦ãƒã‚§ãƒƒã‚¯ã«é•åå‡¦ç†ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’å…±æœ‰ã§ããªããªã‚‹ã€ã¨è¿°ã¹ã¦ã„ã¾ã™ã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯C++ã«ãŠã‘ã‚‹å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®å‡ºç™ºç‚¹ã¨ãªã‚‹ã‚‚ã®ã§ã‚ã‚‹ãŸã‚ã€æ—¢å­˜ã®é€šå¸¸ã®è¨€èªã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«åŸºã¥ã„ãŸã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‹ã‚‰ã®ç§»è¡Œãƒ‘ã‚¹ã‚’æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¸ç°¡å˜ã«ç§»è¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã¯ã€ãã®ã‚ˆã†ãªé€šå¸¸ã®C++è¨€èªã‚’ä½¿ç”¨ã™ã‚‹ï¼ˆæ³¨é‡ˆå†…ã ã‘ç•°ãªã‚‹è¨€èªå‹•ä½œã«ãªã‚‰ãªã„ï¼‰å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒå¿…è¦ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã“ã®ãŸã‚ã«ã€ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ä»•æ§˜ï¼ˆP2900R6ï¼‰ã«å¯¾ã—ã¦æ¬¡ã®3ã¤ã®å¤‰æ›´ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

1. å¥‘ç´„æ¡ä»¶ã®è©•ä¾¡ã®çœç•¥ã‚’ã—ãªã„
    - å¥‘ç´„æ¡ä»¶å¼ã‚’è©•ä¾¡ã›ãšã«å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€æ¡ä»¶å¼ã®çµæœã‚’ä»®å®šã—ã¦ãƒã‚§ãƒƒã‚¯ã‚’çœç•¥ã™ã‚‹è¨±å¯ã‚’å‰Šé™¤
2. å¥‘ç´„æ¡ä»¶ã®è©•ä¾¡ã®ç¹°ã‚Šè¿”ã—ã‚’ã—ãªã„
    - ä¸€åº¦è©•ä¾¡ã•ã‚ŒãŸå¥‘ç´„æ¡ä»¶å¼ã‚’ã€åŒã˜ã¾ãŸã¯ç•°ãªã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦åŒã˜æ³¨é‡ˆå†…ã§å†åº¦è©•ä¾¡ã™ã‚‹è¨±å¯ã‚’å‰Šé™¤
3. å¥‘ç´„æ³¨é‡ˆå†…ã§å¤‰æ•°ã®`const`åŒ–ã‚’ã—ãªã„
    - å¥‘ç´„æ¡ä»¶å¼å†…ã®è‡ªå‹•å¤‰æ•°ï¼ˆãŠã‚ˆã³æ§‹é€ åŒ–æŸç¸›ã€é–¢æ•°ã®çµæœå€¤ï¼‰ã®åå‰ã®å¼ã®å‹ã«æš—é»™ã«`const`ãŒè¿½åŠ ã•ã‚Œã‚‹ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã‚’å‰Šé™¤

ãªãŠã€ã“ã‚Œã‚‰ã®å¤‰æ›´ã¯3ç¨®é¡ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã™ã¹ã¦ã«å¯¾ã—ã¦é©ç”¨ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ææ¡ˆã§ã¯ã€ã“ã‚Œã‚‰ã®å¤‰æ›´ã¯C++26ä»¥é™ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®æ‹¡å¼µã¨ã—ã¦æ‰±ã†ã¹ãã§ã‚ã‚Šã€ãƒ©ãƒ™ãƒ«æŒ‡å®šãªã©ã®æ–¹æ³•ã«ã‚ˆã£ã¦ç ´å£Šçš„å¤‰æ›´ã‚’ä¼´ã‚ãšã«å°å…¥ã§ãã‚‹ã¯ãšã¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€SG21ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ãŠã„ã¦å¦æ±ºã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

- [P3281 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1931)

### [P3282R0 Static Storage for C++ Concurrent bounded_queue](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3282r0.html)

`bounded_queue`ã«ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä½¿ç”¨ã™ã‚‹é ˜åŸŸã¸ã®ãƒã‚¤ãƒ³ã‚¿ã‚’å—ã‘å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

`bounded_queue`ã¨ã¯ç¾åœ¨P0260ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ä¸¦è¡Œã‚­ãƒ¥ãƒ¼ã§ã€å¯å¤‰é•·ã§ã¯ãªã„ï¼ˆäºˆã‚æœ€å¤§è¦ç´ æ•°ãŒæ±ºã¾ã£ã¦ã„ã‚‹ï¼‰ã‚¿ã‚¤ãƒ—ã®ä¸¦è¡Œã‚­ãƒ¥ãƒ¼ã§ã™ï¼ˆP0260ã«ã¯ã“ã‚Œä»¥å¤–ã®ã‚‚ã®ã¯ææ¡ˆã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰ã€‚

`bounded_queue`ã¨åŒã˜ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®ã‚­ãƒ¥ãƒ¼æ§‹é€ ã¯ãã®ç‰¹æ€§ã‹ã‚‰å°è¦æ¨¡ãªçµ„è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ ã§ã‚‚ã‚ˆãä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€P0260ã®å ´åˆã‚­ãƒ¥ãƒ¼ã®è¦ç´ æ•°ã¨ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§æ¸¡ã—ã¦å®Ÿè¡Œæ™‚ã«ãã®é ˜åŸŸå‹•çš„ç¢ºä¿ã«ã‚ˆã£ã¦å‰²ã‚Šå½“ã¦ã¦ãŠã‚Šã€ãƒ’ãƒ¼ãƒ—ãƒ¡ãƒ¢ãƒªã‚’ä½¿ç”¨ã—ãŸããªã„ï¼ˆã§ããªã„ï¼‰ç’°å¢ƒã«ãŠã„ã¦ã¯ç‰¹åˆ¥ãªã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã€ãã‚ŒãŒã§ããªã„å ´åˆã¯å…¨ãä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã§ã¯ã€`bounded_queue`ãŒé™çš„ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€ã‚­ãƒ¥ãƒ¼ã®è¦ç´ æ•°ã¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é ˜åŸŸã¸ã®ãƒã‚¤ãƒ³ã‚¿ã‚’å—ã‘å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ææ¡ˆã§ã¯æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™

```cpp
bounded_queue(size_t max_elems, void *storage);
```

ã“ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®è¦ä»¶ã¯å½“ç„¶`storage`ã®é ˜åŸŸã«`max_elems`å€‹ã®è¦ç´ ã‚’é…ç½®å¯èƒ½ãªã“ã¨ã§ã™ãŒã€é€šå¸¸ãã®ã‚ˆã†ãªãƒ¡ãƒ¢ãƒªã®é‡ã¯ä¸æ˜ï¼ˆåŒæœŸç”¨ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãªã©ãŒã‚ã‚‹ãŸã‚ï¼‰ã§ã™ã€‚

ãã®ãŸã‚ã€ãã®ã‚ˆã†ãªã‚µã‚¤ã‚ºã‚’çŸ¥ã‚‹ã“ã¨ã®ã§ãã‚‹ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

```cpp
static consteval size_t required_size(size_t max_elems);

static consteval size_t required_alignment();
```

`required_size(max_elems)`ã¯å¼•æ•°ã®`max_elems`å€‹ã®è¦ç´ æ•°ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã«å¿…è¦ãªé ˜åŸŸã‚µã‚¤ã‚ºã‚’è¿”ã—ã€`required_alignment()`ã¯ãã®æ™‚ã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦è¿”ã™ã‚‚ã®ã§ã™ã€‚

ã“ã®æ–°ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä½¿ç”¨ä¾‹

```cpp
using MyQueueT = std::bounded_queue<uint32_t>;

// é™çš„ãªé ˜åŸŸ
alignas (MyQueueT::required_alignment())
std::array<std::byte, MyQueueT::required_size(8)> myQStorage;

// é ˜åŸŸãƒã‚¤ãƒ³ã‚¿ã‚’æ¸¡ã—ã¦ã‚­ãƒ¥ãƒ¼ã‚’æ§‹ç¯‰
MyQueueT myQ{8, myQStorage.data()};

int main()
{
  // start tasks and use myQ
}
```

- [P0260R5 C++ Concurrent Queues - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/02/12/210302#P0260R5-C-Concurrent-Queues)
- [P3282 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1936)

### [P3283R0 Adding .first() and .last() to strings](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3283r0.html)

`std::string`ã«æ–‡å­—åˆ—æœ€åˆã¨æœ€å¾Œã®éƒ¨åˆ†æ–‡å­—åˆ—ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®APIã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

`std::string`ï¼ˆãŠã‚ˆã³`std::string_view`ï¼‰ã«ãŠã„ã¦ã€æœ€åˆã®Næ–‡å­—ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã¯`.substr(0, N)`ã¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚åŒæ§˜ã«ã€æœ€å¾Œã®Næ–‡å­—ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã¯`.substr(size() - N, N)`ã¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã©ã¡ã‚‰ã®æ“ä½œã‚‚å˜ç´”ã§ã¯ã‚ã‚‹ã‚‚ã®ã®ã€Næ–‡å­—ã‚’å–ã‚‹ã®ã«ä½™è¨ˆãªè¨ˆç®—ã¨å¼•æ•°ã®æŒ‡å®šãŒå¿…è¦ã«ãªã£ã¦ãŠã‚Šã€é–“é•ãˆã‚„ã™ãä½¿ã„ã¥ã‚‰ã„é¢ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã‚Œã‚‰ã®æ“ä½œã‚’ä½¿ã„ã‚„ã™ãã™ã‚‹ãŸã‚ã«ãƒ©ãƒƒãƒ‘ã§ã‚ã‚‹ãƒ¡ãƒ³ãƒé–¢æ•°`.first()`ã¨`.last()`ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

åˆ©ç‚¹ã¨ã—ã¦ã¯

- ãƒ—ãƒ­ã‚°ãƒ©ãƒã®æ„å›³ãŒã‚ˆã‚Šæ˜ç¢ºã§ä¼ã‚ã‚Šã‚„ã™ããªã‚Šã€å¯èª­æ€§ãŒå‘ä¸Šã™ã‚‹
- å¼•æ•°ã¯æ¬²ã—ã„æ–‡å­—æ•°Nã®ã¿ãªã®ã§ã€ã‚¨ãƒ©ãƒ¼ã®å¯èƒ½æ€§ãŒä½æ¸›ã•ã‚Œã‚‹
- ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹

ã“ã®ã‚ˆã†ãªé–¢æ•°ã¯`std::span`ã«æ—¢ã«å­˜åœ¨ã—ã¦ãŠã‚Š`span`ã«ã¯`.subspan()`ã‚‚åŒæ™‚ã«å­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€ã“ã®2ç¨®ã®é–¢æ•°ã‚’ã‚ãˆã¦åˆ¥ã€…ã«è¿½åŠ ã™ã‚‹ã ã‘ã®é–¢å¿ƒãŒã‚ã£ãŸã“ã¨ãŒåˆ†ã‹ã‚‹ãŸã‚ã€ç¾åœ¨`.substr()`ã—ã‹ãªã„`std::string/std::string_view`ã§ã‚‚åŒæ§˜ã«`.first()`ã¨`.last()`ã‚’è¿½åŠ ã™ã¹ãã€ã¨ã—ã¦ã„ã¾ã™ã€‚


è¿½åŠ ã™ã‚‹é–¢æ•°ã®å®£è¨€ã®ä¾‹

```cpp
namespace std {

  template <class charT,
            class traits = char_traits<charT>,
            class Allocator = allocator<charT> >
  class basic_string {
    ...

    constexpr basic_string first(size_t count) const &;
    constexpr basic_string first(size_t count) &&;

    constexpr basic_string last(size_t count) const &;
    constexpr basic_string last(size_t count) &&;

    ...
  };
}
```

`std::string_view`ã®å ´åˆã‚‚ã»ã¼åŒæ§˜ã®å¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚åŠ¹æœã¯ã€ä¸Šã§ç¤ºã—ãŸ`.substr()`ã®`N`ã«å¯¾ã™ã‚‹çµæœã¨åŒã˜ã§ã™ï¼ˆ`.substr()`ã‚’ä½¿ç”¨ã—ã¦ã¯ã„ã¾ã›ã‚“ï¼‰ã€‚

```cpp
int main() {
  std::string str = "abcdefghijk";

  auto first_substr = str.first(3); // abc
  auto last_substr = str.last(3);   // ijk

  std::string_view strview = str;

  auto first_substr_view = strview.first(3); // abc
  auto last_substr_view = strview.last(3);   // ijk
}
```

- [P3283 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1937)

### [P3284R0 `finally`, `write_env`, and `unstoppable` Sender Adaptors](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3284r0.html)

æ–°ã—ã„`sender`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ææ¡ˆã€‚

ã“ã®ææ¡ˆã¯ã€æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹P2300ã®éåŒæœŸå‡¦ç†ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å¯¾ã™ã‚‹C++26ã®æ‹¡å¼µã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã®ã¯

- `write_env`
- `unstoppable`
- `finally`

ã®3ã¤ã§ã™ã€‚ã“ã‚Œã‚‰ã®ã‚‚ã®ã¯ã€ä»¥å‰ã«P3175R0ã§ææ¡ˆã•ã‚Œã¦ã„ãŸã‚‚ã®ã§ã—ãŸãŒã€P3175ã®ãƒ¡ã‚¤ãƒ³ã®éƒ¨åˆ†ã‚’é€²ã‚ã‚‹ãŸã‚ã«åˆ†é›¢ã•ã‚Œã¾ã—ãŸã€‚

#### `write_env`

`receiver`ã«ã¯å®Ÿè¡Œç’°å¢ƒï¼ˆexecution environmentï¼‰ã¨ã„ã†ã‚‚ã®ãŒé–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã¯å˜ãªã‚‹Key/Valueã‚¹ãƒˆã‚¢ã§ã™ã€‚`sender`ã¨`receiver`ãŒæ¥ç¶šã•ã‚ŒãŸã¨ãã«ã€æ¥ç¶šã•ã‚ŒãŸ`receiver`ã‚’ä»‹ã—ã¦ãã“ã‹ã‚‰å€¤ã®ã‚¯ã‚¨ãƒª/å–å¾—ã‚’è¡Œã£ã¦ã€å®Ÿè¡Œç’°å¢ƒã«é–¢ã™ã‚‹ã‚‚ã®ï¼ˆä¾‹ãˆã°ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚„`stop_token`ãªã©ï¼‰ã‚’å–å¾—ã§ãã¾ã™ã€‚`sender`ã«ã‚ˆã‚‹ãƒã‚§ãƒ¼ãƒ³ã§ã¯ã€ãã®ã‚ˆã†ãªå®Ÿè¡Œç’°å¢ƒã¯ãƒã‚§ãƒ¼ãƒ³ã®ä¸Šæµã‹ã‚‰ä¸‹æµã«å‘ã‘ã¦ä¼æ’­ã—ã€ä½•ã‚‚ã—ãªã‘ã‚Œã°ä¸Šæµã§è¨­å®šã•ã‚ŒãŸã‚‚ã®ãŒä¸‹æµã®å‡¦ç†ã§ã‚‚ä½¿ç”¨ã•ã‚Œã¾ã™ãŒã€å ´åˆã«ã‚ˆã£ã¦ã¯é€”ä¸­ã§ãã‚Œã‚’å¤‰æ›´ã—ãŸã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚`write_env`ã‚¢ãƒ€ãƒ—ã‚¿ã¯ãã®ãŸã‚ã®ã‚‚ã®ã§ã€`sender`ãƒã‚§ãƒ¼ãƒ³ï¼ˆã®èƒŒå¾Œã«ã‚ã‚‹`receiver`ï¼‰ã®å®Ÿè¡Œç’°å¢ƒã«å€¤ã‚’ã‚¹ãƒˆã‚¢ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã‚Œã¯ã€`write_env(sender, environment) -> sender`ã®ã‚ˆã†ãªã‚¢ãƒ€ãƒ—ã‚¿ã§ã‚ã‚Šã€å…¥åŠ›ã®`sender`ã¨å®Ÿè¡Œç’°å¢ƒ`environment`ã‚’å—ã‘å–ã£ã¦ã€ã“ã‚Œã‚‰ã‚’æ ¼ç´ã—ã¦ã„ã‚‹`sender`ã‚’è¿”ã—ã¾ã™ã€‚è¿”ã•ã‚ŒãŸ`sender`ï¼ˆ`sndr`ï¼‰ãŒï¼ˆåˆ¥ã®`sender`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã®æ¥ç¶šãªã©ã«ã‚ˆã£ã¦ï¼‰`receiver`ï¼ˆ`rcvr`ï¼‰ã¨æ¥ç¶šã•ã‚Œã‚‹ã¨ã€å˜ã«ãã‚Œã‚‰ã‚’æ¥ç¶šã—ãŸçµæœã®`receiver`ã‚’è¿”ã—ã¾ã™ï¼ˆé€šå¸¸ã®ãƒãƒ£ãƒãƒ«ã¸ã®é–¢ä¸ã¯è¡Œã‚ãªã„ï¼‰ã€‚

ãŸã ã—ã€ãã†ã—ã¦è¿”ã•ã‚ŒãŸ`receiver`ã®å®Ÿè¡Œç’°å¢ƒã¯`environment`ã¨`rcvr`ã®ç’°å¢ƒãŒçµåˆã•ã‚ŒãŸã‚‚ã®ã«ãªã£ã¦ãŠã‚Šã€ãã®`receiver`ã¸ã®ã‚¯ã‚¨ãƒªã¯ã¾ãš`environment`ã«å¯¾ã—ã¦è¡Œã‚ã‚Œã€ãã“ã§è©²å½“ã™ã‚‹ã‚‚ã®ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã«`rcvr`ã®ç’°å¢ƒã«ã‚¯ã‚¨ãƒªã•ã‚Œã¾ã™ã€‚

ææ¡ˆã‚ˆã‚Šã€ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å¤‰æ›´ã™ã‚‹ä¾‹

```cpp
// ã‚¯ã‚¨ãƒªã‚­ãƒ¼ã¨å¯¾å¿œã™ã‚‹å€¤ã‚’å®Ÿè¡Œç’°å¢ƒã®ã‚¯ã‚¨ãƒªå¯èƒ½ãªã‚‚ã®ã«å¤‰æ›ã™ã‚‹ã‚¯ãƒ©ã‚¹
template <class Query, class Value>
struct with : Query {
  Value value;
  auto query(Query) const { return value; }
};

// æŒ‡å®šã—ãŸã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«senderã‚’å¤‰åŒ–ã•ã›ã‚‹
struct with_allocator_t {
  template <std::execution::sender Sndr, class Alloc>
  auto operator()(Sndr sndr, Alloc alloc) const {
    return std::execution::write_env(sndr, with{std::get_allocator, alloc});
  }
};

constexpr with_allocator_t with_allocator{};
```

ã“ã®`with_allocator`ã¯æ¬¡ã®ã‚ˆã†ã«ä½¿ç”¨ã—ã¾ã™

```cpp
namespace ex = std::execution;

ex::sender auto make_async_work_with_alloc() {
  // ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã‚‹éåŒæœŸä½œæ¥­
  ex::sender auto work = third_party::make_async_work();

  // ãã®ä½œæ¥­ã§ä½¿ç”¨ã•ã‚Œã‚‹ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹
  return with_allocator(std::move(work), custom_allocator());
}
```

#### `unstoppable`

`unstoppable`ã‚¢ãƒ€ãƒ—ã‚¿ã¯`write_env`åŒæ§˜ã«å®Ÿè¡Œç’°å¢ƒã‚’å¤‰åŒ–ã•ã›ã‚‹ã‚‚ã®ã§ã€ã“ã‚Œã®å ´åˆã¯`stop_token`ã‚’`never_stop_token`ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€å…¥åŠ›ã®`sender`ãŒå¤–éƒ¨ã‹ã‚‰ã®åœæ­¢è¦æ±‚ã«å¿œã˜ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚`unstoppable(sender) -> sender`ã®æ§˜ãªã‚·ã‚°ãƒãƒãƒ£ã«ãªã‚Šã€ã“ã‚Œã‚‚ãƒ¡ã‚¤ãƒ³ã®ãƒãƒ£ãƒãƒ«ã«ã¯é–¢ä¸ã—ã¾ã›ã‚“ã€‚

ã“ã‚Œã¯`write_env`ã‚’åˆ©ç”¨ã—ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™

```cpp
namespace std::execution {

  inline constexpr struct unstoppable_t {
    template <sender Sndr>
    auto operator()(Sndr sndr) const {
      return write_env(std::move(sndr), never_stop_token());
    }

    auto operator()() const {
      return write_env(never_stop_token());
    }
  } unstoppable{};
}
```

#### `finally`

C++è¨€èªã«ã¯éåŒæœŸç ´æ£„ã®ç›´æ¥ã®ã‚µãƒãƒ¼ãƒˆãŒç„¡ãã€ã€Œã“ã®éåŒæœŸå‡¦ç†ã®å¾Œã§æœ€åˆã®å‡¦ç†ãŒã©ã®ã‚ˆã†ã«çµ‚äº†ã—ãŸã‹ã«é–¢ä¿‚ãªãã€ç„¡æ¡ä»¶ã§åˆ¥ã®éåŒå‡¦ç†ã‚’é–‹å§‹ã™ã‚‹ã€ã¨ã„ã†ã“ã¨ã‚’ï¼ˆå®‰å…¨ã«ï¼‰è¡Œã†æ–¹æ³•ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€éåŒæœŸRAIIã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

`finally`ã‚¢ãƒ€ãƒ—ã‚¿ã¯ã€`sender`ã®é ˜åŸŸã§éåŒæœŸRAIIãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿç¾ã™ã‚‹ã‚‚ã®ã§ã™ã€‚`finally(sender, sender) -> sender`ã®æ§˜ãªã‚·ã‚°ãƒãƒãƒ£ã§ã€2ã¤ã®`sender`ï¼ˆéåŒæœŸå‡¦ç†ï¼‰ã‚’å—ã‘å–ã£ã¦ã€è¿”ã•ã‚ŒãŸ`sender`ãŒæ¥ç¶šã‚’å—ã‘ã¦é–‹å§‹ã•ã‚Œã‚‹ã¨ã€ã¾ãš1ã¤ç›®ã®`sender`ã®å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™ã€‚ãã‚ŒãŒå®Œäº†ã™ã‚‹ã¨ã€çµæœã‚’ä¿å­˜ã—ã¦ã‹ã‚‰2ã¤ç›®ã®`sender`ã‚’é–‹å§‹ã—ã¾ã™ã€‚ã“ã®`sender`ã®çµæœã¨ã—ã¦ã¯ã€2ã¤ç›®ã®`sender`ã®å‡¦ç†ãŒæ­£å¸¸ã«å®Œäº†ã—ãŸå ´åˆ1ã¤ç›®ã®`sender`ã®çµæœãŒè¿”ã‚Šã€ãã‚Œä»¥å¤–ã®å ´åˆã¯2ã¤ç›®ã®`sender`ã®çµæœãŒè¿”ã‚Šã¾ã™ã€‚

ææ¡ˆæ–‡æ›¸ã‚ˆã‚Šã€éåŒæœŸå‡¦ç†ã®éç¨‹ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸å¤‰æ¡ä»¶ãŒä¸€æ™‚çš„ã«ç ´æ£„ã•ã‚ŒãŸå¾Œã§å¾©å…ƒã•ã‚Œã‚‹ä¾‹

```cpp
namespace ex = std::execution;

ex::sender auto break_invariants(auto&... values);
ex::sender auto restore_invariants(auto&... values);

// ã“ã®é–¢æ•°ã¯senderã‚¢ãƒ€ãƒ—ã‚¿ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™
// senderã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ä¸å¤‰æ¡ä»¶ã‚’ç ´æ£„ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ã¦ã€ãã®å¾Œä¸å¤‰æ¡ä»¶ã‚’å¾©å…ƒã™ã‚‹æ–°ã—ã„senderã‚’è¿”ã™
auto safely_munge_data( ) {
  return ex::let_value( [](auto&... values) {
      return break_invariants(values...)
        | ex::then(do_munge) // `do_munge`ãŒä¾‹å¤–ã‚’é€å‡ºã—ãŸå ´åˆã§ã‚‚ä¸å¤‰æ¡ä»¶ã¯å¾©å…ƒã•ã‚Œã‚‹
        | ex::finally(ex::unstoppable(restore_invariants(values...)));
  } );
}

auto sndr = ...;
scope.spawn( sndr | safely_munge_data() ); // See `counting_scope` from P3149R2
```

Javaè¨€èªç­‰ã«ã‚ã‚‹`try-catch`ã«å¯¾ã™ã‚‹`finally`ã®ã‚ˆã†ãªã“ã¨ã‚’`sender`ãƒã‚§ãƒ¼ãƒ³ã§è¡Œã†ã‚‚ã®ã§ã™ã€‚

- [P3175R0 Reconsidering the std::execution::on algorithm - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3175R0-Reconsidering-the-stdexecutionon-algorithm)
- [P3284 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1938)

### [P3285R0 Contracts: Protecting The Protector](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3285r0.pdf)

å¥‘ç´„æ³¨é‡ˆã®æ¡ä»¶å¼ã‹ã‚‰UBã‚’èµ·ã“ã—ã†ã‚‹æ“ä½œã‚’å¯èƒ½ãªé™ã‚Šæ¸›ã‚‰ã™ææ¡ˆã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«ãŠã„ã¦ã€å¥‘ç´„æ¡ä»¶å¼ã¯ã»ã¨ã‚“ã©é€šå¸¸ã®C++ã‚³ãƒ¼ãƒ‰ã®å¼ã¨ç•°ãªã‚‹æŒ¯ã‚‹èˆã„ã‚’ã—ã¾ã›ã‚“ï¼ˆå¥‘ç´„æ³¨é‡ˆå†…ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹å¤–éƒ¨ã®è‡ªå‹•å¤‰æ•°ãŒæš—é»™`const`åŒ–ã—ãŸã‚Šã€é–¢æ•°å¼•æ•°ã®å‚ç…§ã«åˆ¶é™ãŒã‚ã£ãŸã‚Šã¯ã—ã¾ã™ï¼‰ã€‚ãã‚Œã«ã‚ˆã£ã¦ã€å¥‘ç´„æ¡ä»¶å¼ã¯ä»»æ„ã®å‰¯ä½œç”¨ã‚’ç™ºç”Ÿã•ã›ã‚‹ã“ã¨ãŒã§ãã€æœªå®šç¾©å‹•ä½œã‚’èµ·ã“ã™å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯C++ã‚³ãƒ¼ãƒ‰ã®å®‰å…¨æ€§å‘ä¸Šã«å¯„ä¸ã™ã‚‹ã¯ãšã®æ©Ÿèƒ½ã§ã‚ã‚‹ã®ã«ã€ãã®å¥‘ç´„æ¡ä»¶å¼ãŒç‰¹ã«åˆ¶é™ã•ã‚Œã¦ã„ãªã„ã“ã¨ã«ã‚ˆã£ã¦å®‰å…¨ã§ã¯ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã„ã†ã®ã¯åº¦ã€…è­°è«–ã«ãªã£ã¦ãŠã‚Šã€éå»ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯å‰¯ä½œç”¨ç¦æ­¢ãŒæ˜è¨˜ã•ã‚Œã¦ã„ãŸã“ã¨ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚ã—ã‹ã—ã€ãã®ã‚ˆã†ãªåˆ¶é™ã¯C++è¨€èªã®ã‚µãƒ–ã‚»ãƒƒãƒˆã‚’ç”Ÿã¿å‡ºã™ã ã‘ã§ãã®å®Ÿç¾å¯èƒ½æ€§ã‚‚ä½ã„ã¨è€ƒãˆã‚‰ã‚ŒãŸãŸã‚ã€ç‰¹ã«åˆ¶é™ã‚’è¡Œã‚ãªã„ã“ã¨ã«ãªã£ã¦ã„ã¾ã™ï¼ˆãŸã ã—æš—é»™`const`åŒ–ã‚„è©•ä¾¡å›æ•°ã®è¦å®šãªã—ãªã©ã§é–“æ¥çš„ã«ç¦æ­¢ã—ã¦ã„ã‚‹ï¼‰ã€‚

ã“ã®ææ¡ˆã¯ãã‚Œã«å¯¾ã—ã¦ç•°ã‚’å”±ãˆã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’ã‚ˆã‚Šå®‰å…¨ã«ã™ã‚‹ãŸã‚ã«å¥‘ç´„æ¡ä»¶å¼ã®å‰¯ä½œç”¨ã‚„æœªå®šç¾©å‹•ä½œã‚’æŠ‘åˆ¶ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã“ã§ã¯ã€ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ææ¡ˆï¼ˆP2900R6ï¼‰ã«å¯¾ã—ã¦æ¬¡ã®2ã¤ã®å¤‰æ›´ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

1. äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã‚’ã€éç·©å’Œå¥‘ç´„ï¼ˆNon-relaxed contractsï¼‰ã¨ç·©å’Œå¥‘ç´„ï¼ˆRelaxed contractsï¼‰ã®2ã¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†é¡ã™ã‚‹
2. ã‚³ãƒ³ãƒ™ã‚¢é–¢æ•°ã®æ¦‚å¿µã®å°å…¥

ç·©å’Œå¥‘ç´„ã¯ã€äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã‚’æŒ‡å®šã™ã‚‹éš›ã«`relaxed`ã¨ã„ã†ä¿®é£¾ã‚’è¡Œã†ã‚‚ã®ã§ã™ã€‚

```cpp
int rem(int x, int y)
  pre relaxed(event_log(y), y != 0)
{
  return x % y;
}
```

ã“ã®å ´åˆã€`rem()`ã®å‘¼ã³å‡ºã—ã«ä¼´ã†äº‹å‰æ¡ä»¶ãƒã‚§ãƒƒã‚¯ã«ãŠã„ã¦ã¯ã€`y != 0`ã®ãƒã‚§ãƒƒã‚¯ã®å‰ã«`event_log(y)`ã®å®Ÿè¡Œï¼ˆã™ãªã‚ã¡å‰¯ä½œç”¨ï¼‰ãŒè¨±å¯ã•ã‚Œã¾ã™ã€‚ã¾ãŸã€ç·©å’Œå¥‘ç´„ã§ã¯ã“ã“ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ãã®ä»–ã®ä¿è¨¼ã¯ä¸€åˆ‡é©ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚ã™ãªã‚ã¡ã“ã‚Œã¯ã€ç¾åœ¨ã®å¥‘ç´„æ©Ÿèƒ½ã®æŒ¯ã‚‹èˆã„ã§ã™ã€‚

éç·©å’Œå¥‘ç´„ã¨ã¯ã€ç¾åœ¨ã®P2900R6ã®æ§‹æ–‡ã‚’ä½¿ç”¨ã—ã¦ã€å¥‘ç´„æ¡ä»¶ãŒè©•ä¾¡ã•ã‚ŒãŸã¨ãã«å‰¯ä½œç”¨ãŒãã®è©•ä¾¡ã‚³ãƒ¼ãƒ³ã®å¤–å´ã«å‡ºãªã„ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ã¨ã„ã†è¿½åŠ çš„ãªåˆ¶ç´„ã‚’æŒã¤ã‚‚ã®ã§ã™ã€‚ã•ã‚‰ã«éç·©å’Œå¥‘ç´„ã®æ¡ä»¶ã®è©•ä¾¡ã¯ç‰¹å®šã®ã‚¯ãƒ©ã‚¹ã®æœªå®šç¾©å‹•ä½œã®å½±éŸ¿ã‚’å—ã‘ãªã„ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

éç·©å’Œå¥‘ç´„ã§ã¯ã€ã‚³ãƒ³ãƒ™ã‚¢é–¢æ•°ã¨ã‚³ãƒ³ãƒ™ã‚¢é–¢æ•°ã§è¨±å¯ã•ã‚Œã¦ã„ã‚‹æ“ä½œã®ã¿ãŒè¨±å¯ã•ã‚Œã€é–¢æ•°å¼•æ•°ãŒå¤‰æ›´ã•ã‚Œãªã„ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã«ã€éç·©å’Œå¥‘ç´„ã®ãªã•ã‚Œã¦ã„ã‚‹é–¢æ•°ã®å¼•æ•°ã¯ã€ãã®å†…éƒ¨ã§åˆ¥ã®é–¢æ•°ã«æ¸¡ã•ã‚Œã‚‹å ´åˆã¯å€¤ã§ï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦ï¼‰æ¸¡ã™ã‹ã€`const`å‚ç…§ã«æ¸¡ã™ã‹ã®ã©ã¡ã‚‰ã‹ã§ãªã‘ã‚Œã°ãªã‚‰ãšã€ã‚­ãƒ£ã‚¹ãƒˆç­‰ã®ãã®ã»ã‹ã®å¤‰æ›´ã‚’ä¼´ã†æ“ä½œã¯è¨±å¯ã•ã‚Œã¾ã›ã‚“ã€‚

ã‚³ãƒ³ãƒ™ã‚¢é–¢æ•°ã¯éç·©å’Œå¥‘ç´„ã«ãŠã„ã¦æœªå®šç¾©å‹•ä½œã‚’æŠ‘æ­¢ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼ã¨ãªã‚‹æ¦‚å¿µã§ã€å‘¼ã³å‡ºã•ã‚ŒãŸå ´åˆã«é–¢æ•°ã®å¤–éƒ¨ã«å¯¾ã—ã¦å‰¯ä½œç”¨ã‚’åŠã¼ã•ãªã„é–¢æ•°ã®äº‹ã§ã™ã€‚ã•ã‚‰ã«ã€ã‚³ãƒ³ãƒ™ã‚¢é–¢æ•°å†…éƒ¨ã§ã¯å¯èƒ½ãªæ“ä½œãŒåˆ¶é™ã•ã‚Œã€æœªå®šç¾©å‹•ä½œã‚’ç™ºç”Ÿã•ã›ã†ã‚‹æ“ä½œãŒç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã‚³ãƒ³ãƒ™ã‚¢é–¢æ•°ã¯`[[conveyor]]`å±æ€§ã‚’ä½¿ç”¨ã—ã¦å®£è¨€ã•ã‚ŒãŸé–¢æ•°ã§ã™ã€‚

```cpp
[[conveyor]]
int add(int x, int y) { return x + y; }

[[conveyor]]
int inc(int& x) { return ++x; }
```

ã“ã®ã‚ˆã†ã«å®£è¨€ã•ã‚ŒãŸé–¢æ•°å†…ã§ã¯ã€æœªå®šç¾©å‹•ä½œã‚’ç™ºç”Ÿã—ã†ã‚‹ç‰¹å®šã®ã‚¯ãƒ©ã‚¹ã®æ“ä½œãŒç¦æ­¢ï¼ˆå‡ºç¾ã—ãŸã‚‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼‰ã•ã‚Œã¾ã™ã€‚

```cpp
[[conveyor]]
int deref(int* p) 
{ 
  return *p; // error: pã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¿æŒã—ã¦ã„ã‚‹ã‹ä¸æ˜
}
```

ã“ã‚Œã¯æ¬¡ã®ã‚ˆã†ã«æ¨™æº–ã§æä¾›ã•ã‚Œã‚‹è¿°èªã«ã‚ˆã£ã¦ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§è¨±å¯ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™

```cpp
[[converyor]]
int deref(int* p) pre(object_address(p))
{
  return *p; // OK
}
```

ãƒã‚¤ãƒ³ã‚¿ã«ã‚ˆã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‚ç…§ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿå­˜æœŸé–“å¤–ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç¦æ­¢ã•ã‚Œã¾ã™ã€‚`object_address()`ã¨ã„ã†è¿°èªã¯æ¨™æº–ã§æä¾›ã•ã‚Œã‚‹ã‚‚ã®ã§ã€ãƒã‚¤ãƒ³ã‚¿ãŒç”Ÿå­˜æœŸé–“å†…ã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã—ã¦ã„ã‚‹ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã€ã“ã‚Œã‚’ç”¨ã„ã¦äº‹å‰æ¡ä»¶ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã‚³ãƒ³ãƒ™ã‚¢é–¢æ•°å†…ã§ã¯ãã®ãƒã‚¤ãƒ³ã‚¿ã®ä»•æ§˜ãŒå®‰å…¨ã ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒ™ã‚¢é–¢æ•°å†…ã§ã¯åŒæ§˜ã«æœªå®šç¾©å‹•ä½œã‚’ç™ºç”Ÿã•ã›ã†ã‚‹å¤šãã®æ“ä½œãŒç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ã»ã‹ã€ç®—è¡“æ¼”ç®—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã§ã¯å®Ÿè¡Œæ™‚ã®æŒ™å‹•ã‚’æŒ‡å®šã—ã¦å®šç¾©ã•ã‚ŒãŸæŒ¯ã‚‹èˆã„ã—ã‹ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§æœªå®šç¾©å‹•ä½œã‚’å›é¿ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªåˆ¶é™ã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒ™ã‚¢é–¢æ•°ãŠã‚ˆã³ãã‚Œã‚’ç”¨ã„ãŸéç·©å’Œå¥‘ç´„ã«ãŠã„ã¦ã¯æœªå®šç¾©å‹•ä½œã®ç™ºç”ŸãŒæŠ‘åˆ¶ã•ã‚Œã€å‰¯ä½œç”¨ã‚‚ãã®è©•ä¾¡ã®å†…å´ã«é–‰ã˜è¾¼ã‚ã‚‰ã‚Œã‚‹ã“ã¨ã§ãã®å½±éŸ¿ã‚’ç·©å’Œã§ãã¾ã™ã€‚ã¾ãŸã€ç·©å’Œå¥‘ç´„ã«ã‚ˆã£ã¦ç¾åœ¨ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã®æŒ¯ã‚‹èˆã„ãŒç¶­æŒã•ã‚Œã€æ˜ç¤ºçš„ãªå‰¯ä½œç”¨ãŒè¨±å¯ã•ã‚Œã¾ã™ã€‚

- [P3285 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1897)

### [P3286R0 Module Metadata Format for Distribution with Pre-Built Libraries](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3286r0.pdf)

ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé…å¸ƒã®ãŸã‚ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ææ¡ˆã€‚

ã“ã“ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã®ã¯ã€ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ãã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆBMIï¼‰ã‚’å¾—ã‚‹ãŸã‚ã«å¿…è¦ãªæƒ…å ±ã‚’ã¾ã¨ã‚ãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã™ã€‚ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦é…å¸ƒã™ã‚‹éš›ã«ã“ã®ã‚ˆã†ãªæƒ…å ±ã®æä¾›ã¯å¿…é ˆãªã‚‚ã®ã¨ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã®ä½œæ¥­ã¯P2701R0ãŠã‚ˆã³P2577R2ã«ç¶šãä½œæ¥­ã§ã‚ã‚Šã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã¿ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

libc++ã§æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å®Ÿé¨“çš„ã‚µãƒãƒ¼ãƒˆãŒé–‹å§‹ã•ã‚ŒãŸã“ã¨ã‚’å—ã‘ã¦ã€ã“ã®ã‚ˆã†ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ãã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒå¿…è¦ã¨ãªã‚Šè€ƒæ¡ˆã•ã‚Œã€ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¯ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æä¾›ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆBMIï¼‰ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆä½œæˆã§ãã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚ã“ã®ææ¡ˆã¯ã“ã†ã—ã¦è€ƒæ¡ˆã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã ã‘ã§ã¯ãªããƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå…¨èˆ¬ã§ä½¿ç”¨ã§ãã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã—ã¦ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ãã®ãŸã‚ã€ã“ã®ææ¡ˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯libc++ã§å®Ÿè£…çµŒé¨“ãŒã‚ã‚Šã€CMakeã¯ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®BMIã‚’ç”Ÿæˆã™ã‚‹è©¦é¨“å®Ÿè£…ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯P2701R0ãŠã‚ˆã³P2577R2ã§ç¤ºã•ã‚Œã¦ã„ã‚‹è¦ä»¶ã«å¾“ã£ãŸä¸Šã§ã€libc++ã«ãŠã‘ã‚‹å®Ÿè£…æ™‚ã«è¿½åŠ ã§ã¾ã¨ã‚ã‚‰ã‚ŒãŸè¦ä»¶ã«å¾“ã£ã¦ã„ã¾ã™ã€‚

- ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã«ã¯ã€ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è­˜åˆ¥ã™ã‚‹æ–¹æ³•ãŒå¿…è¦
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€
    - æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å ´åˆ
      - ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚‚ã—ãã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ï¼‰ã«å¯¾ã—ã¦ãã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’å•ã„åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã‚‹
    - ãã‚Œä»¥å¤–ã®å ´åˆ
      - å¼·åŠ›ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãŒå­˜åœ¨ã—ãªã„å ´åˆã€ï¼ˆãã‚ŒãŒå®Ÿè¡Œå¯èƒ½ãªç’°å¢ƒã§ã¯ï¼‰ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒªãƒ³ã‚«å¼•æ•°ã‹ã‚‰ãã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å ´æ‰€ã‚’æ¨æ¸¬ã§ãã‚‹
      - ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ãã®æ–¹æ³•ã¯å®Ÿè£…å®šç¾©ã®ï¼ˆãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã®æä¾›ã™ã‚‹ï¼‰æ–¹æ³•ã§åé›†ã§ãã‚‹
    - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒ‘ã‚¹ã¯ãƒªãƒ³ã‚«ã«æ¸¡ã•ã‚Œã‚‹å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¨é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹
      - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ“ãƒ«ãƒ‰æ¯ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒç•°ãªã‚‹ã“ã¨ã‚‚äºˆæƒ³ã•ã‚Œã‚‹
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ã¯æ¬¡ã®ã‚‚ã®ãŒå«ã¾ã‚Œã¦ã„ã‚‹
    - æä¾›ã•ã‚Œã‚‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ãªç¿»è¨³å˜ä½ã®è«–ç†å
    - ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ãªç¿»è¨³å˜ä½ã®ãƒ—ãƒ©ã‚¤ãƒãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¸ã®ãƒ‘ã‚¹
    - ç‰¹å®šã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ãªç¿»è¨³å˜ä½ã‚’ç¿»è¨³ã™ã‚‹ãŸã‚ã«å¿…è¦ãªè¿½åŠ ã®ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ãƒ‘ã‚¹
    - ç‰¹å®šã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ãªç¿»è¨³å˜ä½ã‚’ç¿»è¨³ã™ã‚‹ãŸã‚ã«å¿…è¦ãªè¿½åŠ ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å®šç¾©
    - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã‚ã‚‹ã‹ã©ã†ã‹ï¼ˆåå‰ãŒäºˆç´„ã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼‰
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ã¯æ¬¡ã®ã‚‚ã®ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹
    - ãã®ç¿»è¨³å˜ä½ã®ä¾å­˜é–¢ä¿‚ã§ã‚ã‚‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ãªç¿»è¨³å˜ä½ã®è«–ç†å
    - ãƒ™ãƒ³ãƒ€ãƒ¼å›ºæœ‰ã®å±æ€§

é•·ã„ã®ã§ã‚³ãƒ”ãƒšã—ã¾ã›ã‚“ãŒã€ææ¡ˆã«ã¯JSONã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å®Œå…¨ãªå®šç¾©ãŒè¨˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P2577R2 C++ Modules Discovery in Prebuilt Library Releases - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/06/11/191943#P2577R2-C-Modules-Discovery-in-Prebuilt-Library-Releases)
- [P2701R0 Translating Linker Input Files to Module Metadata Files - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/12/25/175304#P2701R0-Translating-Linker-Input-Files-to-Module-Metadata-Files)
- [P3286 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1939)

### [P3287R0 Exploration of namespaces for std::simd](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3287r0.pdf)

`std::simd`ã«é–¢ã™ã‚‹APIã‚’æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸­ã«ã©ã®ã‚ˆã†ã«é…ç½®ã™ã‚‹ã®ã‹ã«ã¤ã„ã¦ã‚’æ¢ã‚‹ææ¡ˆã€‚

`std::simd`ã«é–¢ã—ã¦ã¯ã€permute APIã«é–¢ã™ã‚‹è­°è«–ã®éç¨‹ã§ã€é–¢é€£ã™ã‚‹ãƒ•ãƒªãƒ¼é–¢æ•°ã‚’ãã®ã¾ã¾`std`åå‰ç©ºé–“ã«å…¥ã‚Œã¦ã—ã¾ã†ã“ã¨ã«ã¤ã„ã¦æ‡¸å¿µã®å£°ãŒä¸ŠãŒã£ãŸã‚ˆã†ã§ã™ã€‚ã“ã®ææ¡ˆã¯ãã‚Œã‚’å—ã‘ã¦ã€`std::simd`ã«é–¢é€£ã™ã‚‹ã‚‚ã®ã®åå‰ç©ºé–“åã‚‚å«ã‚ãŸå‘½åã«ã¤ã„ã¦è€ƒå¯Ÿã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã‚ãŒã£ã¦ã„ã‚‹ã®ã¯æ¬¡ã®7ã¤ã§ã™

1. ç¾çŠ¶ï¼ˆ`std`åå‰ç©ºé–“ç›´ä¸‹ï¼‰
    - åˆ©ç‚¹
      - ç°¡æ½”
      - ã‚¸ã‚§ãƒãƒªãƒƒã‚¯SIMDãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å¯èƒ½ãªé™ã‚Šã‚µãƒãƒ¼ãƒˆã§ãã‚‹
    - æ¬ ç‚¹
      - `simd_`ãƒ—ãƒªãƒ•ã‚£ãƒƒã‚¯ã‚¹æœ‰ã‚Šç„¡ã—ãŒæ··åœ¨ã—ã¦ã„ã‚‹
      - ä»–ã®åå‰ã‚’å æœ‰ã—ã¦ã—ã¾ã†
2. å…¨ã¦ã®é–¢æ•°ã‚’simdãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãã®éãƒ¡ãƒ³ãƒé–¢æ•°ã«ã™ã‚‹
    - åˆ©ç‚¹
      - ä¸€è²«æ€§ãŒã‚ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã©ã®é–¢æ•°ãŒsimdãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å¿…è¦ã¨ã—ãªã„ã‹ã‚’è¦šãˆã‚‹å¿…è¦ãŒãªã„
      - SIMDã¨SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ã®æ¦‚å¿µã®å‘½åè¦å‰‡ã«ä¸€è²«æ€§ãŒã‚ã‚‹
    - æ¬ ç‚¹
      - ã‚³ãƒ¼ãƒ‰ã«ã€Œsimdã€ã¨ã„ã†è¨˜è¿°ãŒå¤šãã€å†—é•·ã«ãªã‚‹
      - SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¯ã€constexpr-ifåˆ†å²ãŒå¤šã™ãã‚‹ãŸã‚ã€ã»ã¨ã‚“ã©ä¸å¯èƒ½
    - è©•ä¾¡: SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒã§ããªã„ã€å†—é•·ã™ãã‚‹ãŸã‚ã€å—ã‘å…¥ã‚Œã‚‰ã‚Œãªã„
3. å…¨ã¦ã®é–¢æ•°ã‚’simdãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—ã®éãƒ¡ãƒ³ãƒé–¢æ•°ã«ã™ã‚‹
    - åˆ©ç‚¹
      - ä¸€è²«æ€§ãŒã‚ã‚Šã€è¦šãˆã‚„ã™ã„
      - SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç°¡å˜ã«æä¾›ã§ãã‚‹
    - æ¬ ç‚¹
      - `auto x = std::copy_from(data.begin())`ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã‚‚ã€`basic_simd`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚‰ãªã„
      - åŒã˜åå‰ã®éSIMDã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯ã€æ©Ÿèƒ½ãŒåŒç­‰ã§ãªã„å ´åˆã€å•é¡Œã¨ãªã‚‹ï¼ˆåå‰ã®ç«¶åˆï¼‰
      - ä¸€è²«æ€§ã®ãªã„ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”¨èªã‚’æ˜ç¢ºã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€simd_ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒå¿…è¦ã«ãªã‚‹
    - è©•ä¾¡: åå‰ç©ºé–“ã®ç«¶åˆã‚„ã€æ··ä¹±ã‚’æ‹›ãå¯èƒ½æ€§ã®ã‚ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒã‚ã‚‹ãŸã‚ã€å—ã‘å…¥ã‚Œã‚‰ã‚Œãªã„
4. å‹ä»¥å¤–ã®å…¨ã¦ã‚’åå‰ç©ºé–“ã«å…¥ã‚Œã‚‹
    - åˆ©ç‚¹
      - æ–°ã—ã„åå‰ç©ºé–“ã‹ã‚‰è‡ªç”±ã«åå‰ã‚’å–å¾—ã§ãã‚‹
    - æ¬ ç‚¹
      - å‹ã¨é–¢æ•°ãŒç•°ãªã‚‹åå‰ç©ºé–“ã«ã‚ã‚‹ã®ã¯ãã“ã¡ãªã„
      - æ©Ÿèƒ½ï¼ˆ`std::simd`ï¼‰ã¨åå‰ç©ºé–“ã®é–“ã«å¿…è¦ãªä¸ä¸€è‡´ã¯ã€ä¸æº€ã‚’æ„Ÿã˜ã‚‹
      - SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¯ã€constexpr-ifåˆ†å²ãŒå¤šã™ãã‚‹ãŸã‚ã€ã»ã¨ã‚“ã©ä¸å¯èƒ½ã§ã‚ã‚‹
    - è©•ä¾¡: SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒã§ããªã„ã€ADLãŒæ©Ÿèƒ½ã—ãªã„ãŸã‚ã€å—ã‘å…¥ã‚Œã‚‰ã‚Œãªã„
5. å…¨ã¦ã®éãƒ¡ãƒ³ãƒé–¢æ•°ã‚’éš è”½ãƒ•ãƒ¬ãƒ³ãƒ‰ã«ã™ã‚‹
    - æ¬ ç‚¹
      - generateã‚„copy_fromãªã©ã‚’å‘¼ã³å‡ºã™æ–¹æ³•ãŒãªãã€æ©Ÿèƒ½ã—ãªã„
      - ç„¡æ¡ä»¶ã«å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚‹ã®ã¯å¥‡å¦™ã§ã‚ã‚‹
      - SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒéå¸¸ã«é›£ã—ããªã‚‹
    - è©•ä¾¡: ä½¿ã„ç‰©ã«ãªã‚‰ãªã„
6. å…¨ã¦ã‚’å˜ä¸€ã®åå‰ç©ºé–“ã«å…¥ã‚Œã‚‹
    - åˆ©ç‚¹
      - æ–°ã—ã„åå‰ç©ºé–“ã‹ã‚‰è‡ªç”±ã«åå‰ã‚’å–å¾—ã§ãã‚‹
      - ADLãŒæ©Ÿèƒ½ã™ã‚‹
      - ä¸€è²«æ€§ãŒã‚ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œ`std::simd`åå‰ç©ºé–“ã«ã‚ã‚‹ã‚‚ã®ã¯simdã§å‹•ä½œã™ã‚‹ã€‚simdç”¨ã®é–¢æ•°ã‚’æ¢ã™ã¨ãã¯ã€`std::simd`åå‰ç©ºé–“ã‚’æ¢ã™ã€ã¨ã„ã†ã“ã¨ã‚’å­¦ã¶ã ã‘ã§ã‚ˆã„
    - æ¬ ç‚¹
      - SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒé›£ã—ããªã‚‹
      - ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå`std::simd::simd`ãŒå°‘ã—ãã“ã¡ãªã„
    - è©•ä¾¡: SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒã§ããªã„ãŸã‚ã€å—ã‘å…¥ã‚Œã‚‰ã‚Œãªã„ã€‚ãŸã ã—ã€constexpr-ifã‚’ã™ãã«ä½¿ç”¨ã—ãªãã¦ã‚‚æ¸ˆã‚€ã‚ˆã†ã«ã™ã‚Œã°èˆˆå‘³æ·±ã„
7. æ˜ã‚‰ã‹ãªã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ä»¥å¤–ã®å…¨ã¦ã‚’å˜ä¸€ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«å…¥ã‚Œã‚‹
    - åˆ©ç‚¹
      - æ–°ã—ã„åå‰ç©ºé–“ã‹ã‚‰è‡ªç”±ã«åå‰ã‚’å–å¾—ã§ãã‚‹
      - ADLãŒæ©Ÿèƒ½ã™ã‚‹
      - æ¯”è¼ƒçš„ä¸€è²«æ€§ãŒã‚ã‚‹
      - SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æä¾›ã¨ä½¿ç”¨ãŒç°¡å˜ã§ã‚ã‚‹
    - æ¬ ç‚¹
      - ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå`std::simd::simd`ãŒå°‘ã—ãã“ã¡ãªã„
      - `std`ã¨`std::simd`ã«éãƒ¡ãƒ³ãƒé–¢æ•°ãŒæ··åœ¨ã—ã¦ã„ã‚‹
    - è©•ä¾¡: å—ã‘å…¥ã‚Œã‚‰ã‚Œã‚‹ãŒã€ç¾çŠ¶ã¨ã‚ã¾ã‚Šå¤‰ã‚ã‚‰ãªã„ãŸã‚ã€å®Ÿéš›ã«è‰¯ããªã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã¯ã‚ã‹ã‚‰ãªã„
8. simdã‚’å˜ä¸€ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«ã€SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯åˆ¥ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«é…ç½®ã™ã‚‹
    - åˆ©ç‚¹
      - æ–°ã—ã„åå‰ç©ºé–“ã‹ã‚‰è‡ªç”±ã«åå‰ã‚’å–å¾—ã§ãã‚‹
      - ADLãŒæ©Ÿèƒ½ã™ã‚‹
      - ä¸€è²«æ€§ãŒã‚ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œ`std::simd`åå‰ç©ºé–“ã«ã‚ã‚‹ã‚‚ã®ã¯simdã§å‹•ä½œã™ã‚‹ã€‚simdç”¨ã®é–¢æ•°ã‚’æ¢ã™ã¨ãã¯ã€`std::simd`åå‰ç©ºé–“ã‚’æ¢ã™
        - simdã¨ã‚¹ã‚«ãƒ©ã®ä¸¡æ–¹ã§æ±ç”¨çš„ã«å‹•ä½œã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€`std::simd_generic`ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€ã¨ã„ã†ã“ã¨ã‚’å­¦ã¶ã ã‘ã§ã‚ˆã„
      - èª¤ã£ã¦é–“é•ã£ãŸã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã—ã¾ã†ã“ã¨ã«å¯¾ã—ã¦ã€æ¯”è¼ƒçš„ã€Œå®‰å…¨ã€ãªã‚ªãƒ—ãƒˆã‚¤ãƒ³SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã‚ã‚‹
    - æ¬ ç‚¹
      - ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå`std::simd::simd`ãŒã¾ã å°‘ã—ãã“ã¡ãªã„
      - `std::simd_generic`ã¯é•·ã™ãã‚‹ãŸã‚ã€ç•°ãªã‚‹ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ç•°ãªã‚‹åå‰ç©ºé–“ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«çœç•¥ã•ã‚Œã‚‹
    - è©•ä¾¡: ã‚¹ã‚«ãƒ©/SIMD/SIMDã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãŒæ˜ç¢ºã«åˆ†ã‹ã‚Œã¦ã„ã‚‹ãŸã‚ã€å¥½æ„ŸãŒæŒã¦ã‚‹ã€‚åå‰ç©ºé–“ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã‚ˆã‚‹ç°¡æ½”ãªã‚³ãƒ¼ãƒ‰è¡¨ç¾ã‚‚å¥½ã¾ã—ã„

ã“ã®ææ¡ˆã§ã¯ã©ã‚Œã‚’é¸æŠã™ã‚‹ã‹ã‚’æ±ºå®šã—ã¦ã„ãªã„ã‚‚ã®ã®ã€8ã¤ç›®ï¼ˆæœ€å¾Œï¼‰ã®é¸æŠè‚¢ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚

- [P3287 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1940)

### [P3288R0 `std::elide`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3288r0.html)

ã‚³ãƒ”ãƒ¼ã‚‚ãƒ ãƒ¼ãƒ–ã§ããªã„ã‚¯ãƒ©ã‚¹å‹ã®prvalueã®ç”Ÿæˆã‚’é…å»¶ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã®ææ¡ˆã€‚

ã‚³ãƒ”ãƒ¼ã‚‚ãƒ ãƒ¼ãƒ–ã‚‚ã§ããªã„ã‚¯ãƒ©ã‚¹å‹ã¯æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚‚å­˜åœ¨ã—ã¦ãŠã‚Šã€ä¾‹ãˆã°`std::mutex`ã‚„`std::counting_semaphore`ãªã©ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¹å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é–¢æ•°ã‹ã‚‰ã®`return`ã™ã‚‹å ´åˆã€`return`æ–‡ã§ç›´æ¥æ§‹ç¯‰ã—ã¦prvalueã‚’è¿”ã™ã‚ˆã†ã«ã™ã‚Œã°å¯èƒ½ã§ã™ã€‚

```cpp
std::counting_semaphore<8> FuncReturnsByValue(unsigned const a, unsigned const b) {
  return std::counting_semaphore<8>(a + b); // ok
}

int main() {
  auto cs = FuncReturnsByValue(1, 2); // okã€ã‚³ãƒ”ãƒ¼çœç•¥ã«ã‚ˆã‚‹ç›´æ¥æ§‹ç¯‰
}
```

ã“ã‚Œã¯ã‚³ãƒ”ãƒ¼çœç•¥ä¿è¨¼ã«ã‚ˆã‚‹prvalueã®ç‰¹åˆ¥æ‰±ã„ã§ã‚ã‚Šã€ã“ã®ã‚ˆã†ãªé–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã‚³ãƒ”ãƒ¼ã‚‚ãƒ ãƒ¼ãƒ–ã‚‚ã§ããªã„å‹ã®ç”Ÿæˆã‚’ç°¡å˜ã«ã—ã¦ã€å–ã‚Šæ‰±ã„ã®å„ä»‹ã•ã‚’è»½æ¸›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ã‹ã—ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ã‚‚ãªãŠã€`optional`ã®`.emplace()`ã®ã‚ˆã†ãªé–¢æ•°ã§ã‚³ãƒ”ãƒ¼ã‚‚ãƒ ãƒ¼ãƒ–ã‚‚ã§ããªã„å‹ã®å€¤ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

```cpp
int main() {
  std::optional< std::counting_semaphore<8> > var;

  var.emplace( FuncReturnsByValue(1,2) );  // compiler error
}
```

ã“ã‚Œã¯ã€`.emplace()`ã®å¼•æ•°ãŒ`T&&`ã«ã‚ˆã£ã¦å¤‰æ•°ã‚’å—ã‘å–ã£ã¦ã„ã‚‹ãŸã‚ã«prvalueãŒå®Ÿä½“åŒ–ã•ã‚Œã¦ã—ã¾ã†ã“ã¨ã§ã‚³ãƒ”ãƒ¼çœç•¥ãŒå¦¨ã’ã‚‰ã‚Œã€`.emplace()`ã®å†…éƒ¨ã§ãã®ã‚³ãƒ”ãƒ¼ã‚‚ãƒ ãƒ¼ãƒ–ã‚‚ã§ããªã„å‹ï¼ˆã“ã®ä¾‹ã§ã¯`counting_semaphore`ï¼‰ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‘¼ã³å‡ºã™ã¨ã“ã‚ã§å˜ãªã‚‹ãƒ ãƒ¼ãƒ–æ§‹ç¯‰ã¨ãªã‚‹ã“ã¨ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

ã”ãå˜ç´”ã«ç¤ºã™ã¨ã€`.emplace()`ã¯æ¬¡ã®ã‚ˆã†ã«é…ç½®`new`ã«ã‚ˆã£ã¦ç‰¹å®šé ˜åŸŸã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚

```cpp
template<typename... Params>
T &emplace(Params&&... args) {
  ...

  ::new(buffer) T( forward<Params>(args)... );

  ...
}
```

`T`ãŒã‚³ãƒ”ãƒ¼ã‚‚ãƒ ãƒ¼ãƒ–ã§ããªã„å‹ã§ã‚ã‚Šã€å…ˆç¨‹ã®ä¾‹ã®ã‚ˆã†ã«é–¢æ•°ãŒè¿”ã™prvalueã‹ã‚‰æ§‹ç¯‰ã—ã‚ˆã†ã¨ã™ã‚‹å ´åˆã€ã“ã“ã§ã®`T`ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å‘¼ã³å‡ºã—ã«ãŠã„ã¦æ¸¡ã•ã‚Œã‚‹å¼•æ•°ãŒprvalueã«ãªã‚‹ã“ã¨ã¯ãªãã€ãã‚Œã«ã‚ˆã£ã¦å¿…ãšã‚³ãƒ”ãƒ¼ã‹ãƒ ãƒ¼ãƒ–ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒæ¢ç´¢ã•ã‚Œã€ãã‚Œã¯è¦‹ã¤ã‹ã‚‹ã“ã¨ã¯ç„¡ã„ãŸã‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

çµ„ã¿è¾¼ã¿ã®`new`æ¼”ç®—å­ã®å ´åˆã€ãã®å¼•æ•°åˆ—ã«prvalueãŒã‚ã‚Œã°ã‚³ãƒ”ãƒ¼çœç•¥ã•ã‚Œã‚‹ãŸã‚ã€ã“ã‚Œã‚’æ©Ÿèƒ½ã•ã›ã‚‹ã«ã¯ã€ã“ã®å ´æ‰€ã¾ã§prvalueã‚’å±Šã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã€ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªç°¡å˜ãªãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ã«ã‚ˆã£ã¦å¯èƒ½ã«ãªã‚Šã¾ã™

```cpp
int main() {
  std::optional< std::counting_semaphore<8> > var;

  struct Helper {
    operator std::counting_semaphore<8>() {
      return FuncReturnsByValue(1,2);
    }
  };

  var.emplace( Helper() );  // ok
}
```

ã“ã†ã™ã‚‹ã¨ã€é…ç½®`new`ã®å¼•æ•°ã§ã“ã®`Helper`ã‹ã‚‰å¤‰æ›ã—ã¦æ§‹ç¯‰ã™ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒãªã„ã“ã¨ã‹ã‚‰å‹å¤‰æ›ãŒè€ƒæ…®ã•ã‚Œã€å‹å¤‰æ›ã¯`counting_semaphore`ã®prvalueã‚’è¿”ã™ã“ã¨ã‹ã‚‰ã€é…ç½®`new`ã®æ§‹ç¯‰ã«ãŠã„ã¦ã‚³ãƒ”ãƒ¼çœç•¥ãŒåƒãã€ãã‚Œã«ã‚ˆã£ã¦ã‚³ãƒ”ãƒ¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚‚ãƒ ãƒ¼ãƒ–ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚‚ä½¿ç”¨ã›ãšã«æ§‹ç¯‰ã§ãã‚‹ãŸã‚ã‚¨ãƒ©ãƒ¼ã¯å‡ºãªããªã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªã‚‚ã®ä¾‹ãˆã°ã€`std::vsriant`ã€`std::any`ã€ã‚ã‚‹ã„ã¯ã‚³ãƒ³ãƒ†ãƒŠãªã©ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã®ã‚ˆã†ãªåƒãã‚’ã™ã‚‹æ±ç”¨çš„ãªã‚¯ãƒ©ã‚¹å‹ã§ã‚ã‚‹`std::elide`ã®ææ¡ˆã§ã™ã€‚

```cpp
int main() {
  std::optional< std::counting_semaphore<8> > var;

  var.emplace( std::elide(FuncReturnsByValue,1,2) );  // ok
}
```

ææ¡ˆã‚ˆã‚Šã€å®Ÿè£…ä¾‹

```cpp
namespace std {
  template<typename F_ref, typename... Params_refs>
  class elide final {
    using R = invoke_result_t< F_ref, Params_refs... >;
    static_assert( is_same_v< R, remove_reference_t<R> > );  // F must return by value
    using F = remove_reference_t<F_ref>;
    F &&f;  // 'f' is always an Rvalue reference
    tuple< Params_refs... > const args_tuple;  // just a tuple full of references
  
  public:
    template<typename F, typename... Params>
    explicit elide(F &&arg, Params&&... args) noexcept  // see explicit deduction guide
      : f(move(arg)), args_tuple( static_cast<Params&&>(args)... ) {}

    operator R(void) noexcept(noexcept(apply(static_cast<F_ref>(f),move(args_tuple))))
    {
        return apply( static_cast<F_ref>(f), move(args_tuple) );
    }

    /* -------- Delete all miranda methods -------- */
    elide(     void     ) = delete;
    elide(elide const & ) = delete;
    elide(elide       &&) = delete;
    elide &operator=(elide const & ) = delete;
    elide &operator=(elide       &&) = delete;
    elide const volatile *operator&(void) const volatile = delete;
    template<typename U> void operator,(U&&) = delete;
    /* -------------------------------------------- */
  };

  template<typename F, typename... Params>  
  elide(F&&,Params&&...) -> elide<F&&,Params&&...>;  // explicit deduction guide
}
```

- [P3288 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1941)

### [P3289R0 Consteval blocks](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3289r0.html)

å®£è¨€ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ä»»æ„ã®å®šæ•°å¼ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ–ãƒ­ãƒƒã‚¯ã®ææ¡ˆã€‚

P2996ã®é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚„ã€P2758R2ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡ºåŠ›ãªã©ã€å®šæ•°å¼ã«ãŠã„ã¦ãã®å¼ã®è©•ä¾¡ã®å¤–å´ã«å‡ºã¦ã„ãå‰¯ä½œç”¨ã‚’ã‚‚ãŸã‚‰ã™ã‚ˆã†ãªææ¡ˆãŒC++26ã«å‘ã‘ã¦é€²è¡Œã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ãŒå°å…¥ã•ã‚Œã‚‹ã¨ã€å¿…ç„¶çš„ã«å®£è¨€ã ã‘ãŒè¡Œãˆã‚‹é ˜åŸŸã«ãŠã„ã¦ç‰¹å®šã®å®šæ•°å¼ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ã‚’ã—ãŸããªã‚‹ã§ã—ã‚‡ã†ã€‚

ãã®ã‚ˆã†ãªé ˜åŸŸã«ã¯ä¾‹ãˆã°ã‚¯ãƒ©ã‚¹ã®ãƒ¡ãƒ³ãƒå®£è¨€ã®é ˜åŸŸãŒã‚ã‚Šã€ãã®ã‚ˆã†ãªå ´æ‰€ã§ä»»æ„ã®å®šæ•°å¼ã‚’èµ·å‹•ã™ã‚‹ã«ã¯`static_assert()`ã‚’æ‚ªç”¨ã§ãã¾ã™

```cpp
#include <meta>

template<typename... Ts>
struct Tuple {
  struct storage;

  static_assert(
    is_type(define_class(^storage,
                         {data_member_spec(^Ts)...})));
  // â†‘ã®è§£èª¬
  // define_class()ã¯ä¸å®Œå…¨å‹ã«å¯¾ã—ã¦æŒ‡å®šã•ã‚ŒãŸãƒ¡ãƒ³ãƒã§å®šç¾©ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
  // data_member_spec()ã¯ä¸ãˆã‚‰ã‚ŒãŸå‹ã®ãƒ¡ãƒ³ãƒå¤‰æ•°ã‚’è¡¨ã™meta::info()ã‚’è¿”ã™é–¢æ•°
  // is_type()ã¯ã€å¼•æ•°ã®meta::infoãŒå‹ã‚’è¡¨ã—ã¦ã„ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹è¿°èª
  // ã™ãªã‚ã¡ã€storageå‹ãŒTs...ã‚’ãƒ¡ãƒ³ãƒã¨ã—ã¦æŒã¤ã‚ˆã†ã«å®šç¾©ã—ã¦ã„ã‚‹
  
  storage data;
};
```

ã—ã‹ã—ã“ã‚Œã¯ï¼ˆå¼ã®å†…å®¹ã‚’é™¤ã„ã¦ã‚‚ï¼‰ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹åˆ†ã‹ã‚Šã¥ã‚‰ãã€é›£è§£ã§ã™ã€‚ã“ã“ã§ã‚„ã‚ŠãŸã„ã“ã¨ã¯ä½•ã‹ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãªãã¦ã€ä½•ã‹å®šæ•°å¼ã®èµ·å‹•ã®å¼·åˆ¶ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ã‚·ãƒ³ãƒ—ãƒ«ãª`conseval{}`ãƒ–ãƒ­ãƒƒã‚¯ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã‚Œã¯`static_assert`ã®å˜ç´”ãªãƒ©ãƒƒãƒ‘ã§ã‚ã‚Šã€æ¬¡ã®ã‚ˆã†ãªãƒ–ãƒ­ãƒƒã‚¯ã¯

```cpp
consteval {
  statement-seq(opt)
}
```

æ¬¡ã®ã‚ˆã†ã«å±•é–‹ã•ã‚Œã¾ã™

```cpp
static_assert(
  (
    []() -> void consteval {
      statement-seq(opt)
    }(),
    true
  )
);
```

ã“ã‚Œã«ã‚ˆã‚Šã€å†’é ­ã®ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ãç›´ã•ã‚Œã¾ã™

```cpp
#include <meta>

template<typename... Ts> struct Tuple {
  struct storage;
  
  consteval {
    define_class(^storage,
                 {data_member_spec(^Ts)...});
  }

  storage data;
};
```

ã“ã®ä¾‹ã§ã¯èµ·å‹•ã—ãŸã„å¼ã¯1ã¤ã ã‘ã§ã™ãŒã€ã‚ˆã‚Šè¤‡é›‘ãªã“ã¨ã‚’ã—ãŸã„å ´åˆã®ãŸã‚ã«è¤‡æ•°ã®å¼ã‚’ç½®ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚

- [P3289 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1942)

### [P3290R0 Integrating Existing Assertions With Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3290r0.pdf)

æ—¢å­˜ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã«å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’çµ±åˆã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä¸€ã¤ã®ç‰¹å¾´ã¨ã—ã¦ã€å…¨ã¦ã®å¥‘ç´„æ³¨é‡ˆã®å¥‘ç´„æ¡ä»¶ã®ãã‚Œãã‚Œã®è©•ä¾¡ãŒã€æ¡ä»¶ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹å ´åˆã«åŒã˜å¥‘ç´„æ¡ä»¶ã®ä»¥å‰/å°†æ¥ã®è©•ä¾¡ã‚‚å«ã‚ã¦ãã®ä»–ã®å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‹ã‚‰ç‹¬ç«‹ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã’ã‚‰ã‚Œã¾ã™ã€‚ã“ã®æ€§è³ªã«ã‚ˆã£ã¦ã€å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯å®Ÿè£…å®šç¾©ã¨ãªã‚Šã€å®Ÿè¡Œæ™‚ã«ã‚‚è©•ä¾¡æ¯ã«å¤‰åŒ–ã™ã‚‹ã“ã¨ãŒè¨±å¯ã•ã‚Œã¾ã™ã€‚

ãŸã ã—ã€æ¨™æº–ã®`assert`ãƒã‚¯ãƒ­ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹æ—¢å­˜ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã‚„å¥‘ç´„ãƒã‚§ãƒƒã‚¯æ©Ÿæ§‹ã¯ã“ã‚Œã¨ã¯å¾®å¦™ã«ç•°ãªã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã“ã“ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚¯ãƒ­ã¯ãã®ãƒã‚¯ãƒ­è‡ªä½“ãŒå®šç¾©ã•ã‚Œã‚‹ã¨ãã«å‚ç…§ã•ã‚Œã‚‹ã€`NDEBUG`ãªã©ã®1ã¤ä»¥ä¸Šã®ãƒã‚¯ãƒ­ã®å­˜åœ¨ã«åŸºã¥ã„ã¦ã€ã‚ã‚‹ç¿»è¨³å˜ä½å†…ã§ã®ä½¿ç”¨ã™ã‚‹æ™‚ã¯ã„ã¤ã§ã‚‚å…¨ã¦ã®ä½¿ç”¨ãŒåŒã˜ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒã¡ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«èªè­˜å¯èƒ½ã§ã‚ã‚‹å¿…è¦ã¯ç„¡ãã€é€šå¸¸æ°—ã«ã•ã‚Œã¾ã›ã‚“ã€‚

ã¾ãŸã€å¥‘ç´„æ¡ä»¶å¼ã«ã¯é€šå¸¸ã®C++ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾æ›¸ãã“ã¨ãŒã§ãã€ã“ã‚Œã«ã‚ˆã‚‹å¥‘ç´„æ¡ä»¶å¼ã¸ã®å‰¯ä½œç”¨ã®åŸ‹ã‚è¾¼ã¿ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã€è‡ªå‹•å¤‰æ•°ã‚„`*this`ã®æš—é»™`const`åŒ–åŠã³å¥‘ç´„æ¡ä»¶è©•ä¾¡å›æ•°ã‚’ä¸å®šï¼ˆ0ä»¥ä¸Šã®ä»»æ„ã®å›æ•°ï¼‰ã¨ã™ã‚‹ã“ã¨ãªã©ã®ã¨ã“ã‚ã‚‚ã€æ—¢å­˜ã®`assert`ã¨ç•°ãªã‚‹éƒ¨åˆ†ã§ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚ˆã†ãªå·®ç•°ã«ã‚ˆã£ã¦ã€æ—¢å­˜ã®`assert`ã‹ã‚‰å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¸ï¼ˆç‰¹ã«ã€`assert`ã‹ã‚‰`contract_assert`ã¸ï¼‰å˜ç´”ã«ç§»è¡Œã™ã‚‹ã“ã¨ãŒã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ï¼ˆP2900R7ï¼‰ãŒEWGã«è»¢é€ã•ã‚Œã¦ä»¥é™ã€ãã‚Œã¾ã§ã¯æ¤œè¨ã•ã‚Œã¦ã“ãªã‹ã£ãŸã“ã®éƒ¨åˆ†ï¼ˆæ—¢å­˜æ©Ÿèƒ½ã‹ã‚‰ã®ç§»è¡Œã®ã—ã‚„ã™ã•ï¼‰ãŒå•é¡Œã¨ãªã£ã¦ãã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€æ—¢å­˜ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã‚’å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«ç°¡å˜ã«ç§»è¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€æ—¢å­˜ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã¸å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’çµ„ã¿è¾¼ã‚€ã‚ˆã†ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã—ã¦ã„ã‚‹ã‚‚ã®ã¯æ¬¡ã®3ã¤ã§ã™

1. å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã‚’ç›´æ¥å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹
    - æ—¢å­˜ã®å¥‘ç´„ãƒã‚§ãƒƒã‚¯æ©Ÿæ§‹ã‚’P2900ã®å¥‘ç´„é•åå‡¦ç†æ©Ÿæ§‹ã«çµ±åˆã™ã‚‹ãŸã‚ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’æä¾›ã™ã‚‹
    - ãªãŠã‹ã¤ã€ï¼ˆäº’æ›æ€§ã®ãªã„å¯èƒ½æ€§ã®ã‚ã‚‹ï¼‰æ—¢å­˜ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’å®Œå…¨ã«ç¶­æŒã™ã‚‹
2. æ¡ä»¶ä»˜ãã§`assert`ã‚’å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«çµ±åˆã™ã‚‹
    - ç¾åœ¨ã®`assert`ãƒã‚¯ãƒ­ã®ä»•æ§˜ã‚’æ‹¡å¼µã—ã€ä¸­æ–­ï¼ˆã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã™ã‚‹ï¼‰å‰ã«å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ï¼ˆä¾‹å¤–é€å‡ºãªã—ï¼‰ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹
    - ã“ã‚Œã‚’æ¡ä»¶ä»˜ãã§ã‚µãƒãƒ¼ãƒˆã™ã‚‹
3. ã‚ˆã‚Šä½¿ã„æ…£ã‚ŒãŸã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒã¤æ–°ã—ã„å½¢å¼ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹
    - `contract_assert`ãŒæä¾›ã—ã¦ã„ãªã„ã€æ—¢å­˜ã®`assert`ãƒã‚¯ãƒ­ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã‚‹
    - ã“ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¯å‰¯ä½œç”¨ã‚’è¨±å®¹ã—ã€æš—é»™`const`åŒ–ã‚’è¡Œã‚ãªã„

ã“ã®3ã¤ã®ææ¡ˆã¯ãã‚Œãã‚Œç‹¬ç«‹ã—ã¦ãŠã‚Šã€ç•°ãªã‚‹æ–¹æ³•ã«ã‚ˆã£ã¦æ—¢å­˜ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã‹ã‚‰å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¸ç§»è¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚3ã¤ã®ã†ã¡ã®1ã¤ä»¥ä¸Šã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã€`assert`ã®ä»£æ›¿æ©Ÿèƒ½ä¸è¶³ã¨ã„ã†æ‡¸å¿µã®å¤§éƒ¨åˆ†ãŒæ”¹å–„ã•ã‚Œã€P2900ã‚’å…ˆã«é€²ã‚ã‚‹åŸå‹•åŠ›ã¨ãªã‚Šã¾ã™ã€‚

#### 1. é•åãƒãƒ³ãƒ‰ãƒ©ã®ç›´æ¥å‘¼å‡ºã—

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’æ¡ç”¨ã™ã¹ãå¤§ããªåˆ©ç‚¹ã®ä¸€ã¤ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å„æ‰€ã§ä»»æ„ã«å‡ºç¾ã—ã†ã‚‹ãƒã‚°ï¼ˆå¥‘ç´„é•åï¼‰ã«ã¤ã„ã¦ã€ãã‚Œã‚’æ¤œå‡ºã—ãŸå¾Œã®ç®¡ç†ï¼ˆå¯¾å‡¦ã€çµ‚äº†ã€ç·©å’Œã€ãªã©ï¼‰ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªé•åãƒãƒ³ãƒ‰ãƒ©ã«ã‚ˆã£ã¦ä¸€å…ƒçš„ã«å–ã‚Šæ‰±ãˆã‚‹ã“ã¨ã§ã™ã€‚

3ç¨®é¡ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦æ¤œå‡ºã•ã‚ŒãŸå¥‘ç´„é•åã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã©ã“ã§ç™ºç”Ÿã—ãŸã‹ã«é–¢ã‚ã‚‰ãšåŒã˜å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚ã“ã‚Œã¯å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒè¨€èªæ©Ÿèƒ½ã§ã‚ã‚‹äº‹ã®åˆ©ç‚¹ã®ä¸€ã¤ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚

ç¾åœ¨é¡ä¼¼ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã‚„å¥‘ç´„ãƒã‚§ãƒƒã‚¯æ©Ÿæ§‹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ãã®ã‚ˆã†ãªã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆã‚ã£ã¦ã‚‚ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–“ã§ç•°ãªã‚‹ã‚‚ã®ã«ãªã£ã¦ã—ã¾ã†ï¼‰ã€‚ã“ã®ææ¡ˆ1ã¯ã€å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã‚’ç›´æ¥å‘¼ã³å‡ºã™ã“ã¨ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ã€ãƒãƒ³ãƒ‰ãƒ©å‘¼ã³å‡ºã—å¾Œã«çµ‚äº†ã™ã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¨åŒä¸€ã®æ–¹æ³•ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’çµ‚äº†ã™ã‚‹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’æä¾›ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã¾ãšã€æ¬¡ã®é–¢æ•°ã‚’`<contracts>`ã«è¿½åŠ ã—ã¾ã™

```cpp
namespace std::contracts {
  [[noreturn]]
  void handle_enforced_contract_violation(const char* comment);

  void handle_observed_contract_violation(const char* comment);
}
```

ã“ã®2ã¤ã®é–¢æ•°ã¯åå‰ã®é€šã‚Šãã‚Œãã‚Œ`enforced/observed`ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®ä¸‹ã§å‘¼ã³å‡ºã•ã‚Œã‚‹é•åãƒãƒ³ãƒ‰ãƒ©ã¨åŒã˜å‹•ä½œã‚’ã™ã‚‹ã‚ˆã†ã«é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

é•åãƒãƒ³ãƒ‰ãƒ©ã«ã¯5ã¤ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒè¨­å®šã•ã‚Œã¾ã™ãŒã€ã“ã‚Œã‚‰ã®é–¢æ•°ã§ã¯ãã‚Œã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

- `comment` : é–¢æ•°å¼•æ•°`comment`ã«æŒ‡å®šã•ã‚ŒãŸå†…å®¹
- `location` : ã“ã‚Œã‚‰ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ãŸå ´æ‰€ã®`std::source_location`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `kind` : `std::contracts::assertion_kind::manual`ï¼ˆæ–°è¦è¿½åŠ ã™ã‚‹åˆ—æŒ™å€¤ï¼‰
- `detection_mode` : `std::contracts::detection_mode::manul`ï¼ˆæ–°è¦è¿½åŠ ã™ã‚‹åˆ—æŒ™å€¤ï¼‰
- `evaluation_semantic` : å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°ã«å¯¾å¿œã™ã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®åˆ—æŒ™å€¤
    - `handle_enforced_contract_violation()` : `enforce`
    - `handle_observed_contract_violation()` : `observe`

ã“ã‚Œã‚‰ã®é–¢æ•°ã¯ã“ã®ã‚ˆã†ãªå€¤ã‚’æŒã¤`std::contract_violation`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ãã®ç’°å¢ƒã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸé•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

ãã—ã¦ã€ãã®å®Ÿè¡ŒãŒå®Œäº†ã—ãŸå¾Œã®å‹•ä½œã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

- `handle_enforced_contract_violation()` : å®Ÿè£…å®šç¾©ã®æ–¹æ³•ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†
- `handle_observed_contract_violation()` : é•åãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰æ­£å¸¸ã«ãƒªã‚¿ãƒ¼ãƒ³ã—ãŸå ´åˆã€ãã®ã¾ã¾å¾©å¸°ã™ã‚‹
- é•åãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰ä¾‹å¤–ãŒé€å‡ºã•ã‚ŒãŸå ´åˆ : é€šå¸¸é€šã‚Šä¼æ’­ã™ã‚‹

ã“ã®2ã¤ã®é–¢æ•°ã¯ã€å¥‘ç´„é•åã®å ´åˆã«é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã™å…¨ã¦ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ã¤ã„ã¦ã‚«ãƒãƒ¼ã—ã¦ãŠã‚Šã€ææ¡ˆ1ã¨ã—ã¦ã¯ã“ã‚ŒãŒãƒ¡ã‚¤ãƒ³ã§ã™ã€‚ãŸã ã—ã€æœ€è¿‘è¿½åŠ ã•ã‚ŒãŸã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®ä¸­ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µã‚¤ãƒ‰ã§ã®å†ç¾ãŒé›£ã—ã„ã‚‚ã®ãŒã‚ã‚Šã€ãã‚Œã‚’å†ç¾ã™ã‚‹å‘¼ã³å‡ºã—ã‚’è¡Œã†é–¢æ•°ã‚’æ¤œè¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™

```cpp
namespace std::contracts {
  [[noreturn]]
  void handle_quick_enforced_contract_violation(const char* comment) noexcept;
}
```

ã“ã‚Œã¯`quick_enforce`ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ã‚ˆã‚‹å¥‘ç´„é•åæ™‚ã®å‹•ä½œã‚’å†ç¾ã™ã‚‹ã‚‚ã®ã§ã€å‘¼ã³å‡ºã•ã‚Œã‚‹ã¨å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã•ãšã€é€Ÿã‚„ã‹ã«å®Ÿè£…å®šç¾©ã®æ–¹æ³•ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’çµ‚äº†ã—ã¾ã™ã€‚

ãã—ã¦æœ€å¾Œã«ã€é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã™æœ€åˆã®2ã¤ã®é–¢æ•°ã«ã¤ã„ã¦ã€`noexcept`æŒ‡å®šã•ã‚ŒãŸã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’æä¾›ã™ã‚‹ã“ã¨ã‚‚æ¤œè¨ã§ãã¾ã™

```cpp
namespace std::contracts {

  [[noreturn]]
  void handle_enforced_contract_violation(const char* comment,
                                          const std::nothrow_t&) noexcept;

  void handle_observe_contract_violation(const char* comment,
                                         const std::nothrow_t&) noexcept;
}
```

ã“ã‚Œã‚‰ã®é–¢æ•°ã¯`std::nothrow_t`ã‚’å—ã‘å–ã‚‰ãªã„åŒåã®é–¢æ•°ã¨åŒã˜åŠ¹æœã‚’æŒã¡ã¾ã™ãŒã€é•åãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰ä¾‹å¤–ãŒæŠ•ã’ã‚‰ã‚ŒãŸå ´åˆã«`std::terminate()`ã‚’å‘¼ã³å‡ºã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’çµ‚äº†ã—ã¾ã™ã€‚

#### 2. `assert`ã‹ã‚‰ã®é•åãƒãƒ³ãƒ‰ãƒ©å‘¼ã³å‡ºã—

æ¨™æº–`assert`ãƒã‚¯ãƒ­ã¯ç¾å®Ÿã®C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å¤šãã®å ´æ‰€ã§ä½¿ç”¨ã•ã‚Œã¦ãŠã‚Šã€ãã‚Œã‚‰ã®åˆ©ç”¨ã®ã»ã¨ã‚“ã©ã®ã‚‚ã®ã«ã¯ãƒã‚§ãƒƒã‚¯ã™ã‚‹è¿°èªã«å‰¯ä½œç”¨ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å‰¯ä½œç”¨ã‚’ã‚‚ã¤ã‚ˆã†ãªç”¨æ³•ã‚‚å¤šããŒãƒã‚°ã‹ãƒŸã‚¹ã§ã§ã™ãŒã€ä¸­ã«ã¯å®Ÿç”¨çš„ã§æœ‰ç”¨ãªä½¿ç”¨æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚

å‰è¿°ã®ã‚ˆã†ã«å‰¯ä½œç”¨ã®æ‰±ã„ã«é–¢ã—ã¦ã¯ç‰¹ã«`assert`ãƒã‚¯ãƒ­ã¨å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯äº’æ›æ€§ãŒç„¡ã„ã®ã§ã€ç§»è¡Œã«éš›ã—ã¦ã¯æ—¢å­˜ã®`asset`ãƒã‚¯ãƒ­ã®ä½¿ç”¨æ³•ã‚’ã™ã¹ã¦ãƒã‚§ãƒƒã‚¯ã—ã¦éäº’æ›ã§å•é¡Œã«ãªã‚‰ãªã„ã‹ã‚’ç¢ºèªã—ã€å¿…è¦ãªã‚‰ä¿®æ­£ã‚’è¡Œã‚ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ãŒã€ã“ã‚Œã¯ã‚³ã‚¹ãƒˆãŒé«˜ãã€æ–°ãŸãªãƒã‚°ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ã«ãªã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚

ææ¡ˆ1ã®ã‚ˆã†ã«æ—¢å­˜ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã«ä¸€å…ƒçš„ãªå¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ãŒã§ããŸã¨ã—ã¦ã‚‚ã€æ¨™æº–ã®`assert`åˆ©ç”¨è€…ã«ã¯ãã®æ–¹æ³•ã¯æä¾›ã•ã‚Œãªã„ãŸã‚ã€ãã‚Œãã‚Œã®çµ„ç¹”ãƒ»é–‹ç™ºè€…ãŒç‹¬è‡ªã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å¯¾å¿œã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã‚’ä½œæˆã—ã¦`assert`ã‹ã‚‰ç§»è¡Œã™ã‚‹ã—ã‹ãªãã€ãã®ã‚ˆã†ãªæœªæ¥ã¯æœ›ã¾ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã§ã¯ã€C++ã®`assert`ãƒã‚¯ãƒ­ã®ä»•æ§˜ã‚’æ‹¡å¼µã—ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡ºåŠ›ã ã‘ã§ã¯ãªãã€å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚ªãƒ•ã«ã—ã¦ç¾åœ¨ã®å‹•ä½œã‚’å®Œå…¨ã«ç¶­æŒã—ã€åˆ©ç”¨ã™ã‚‹å ´åˆã¯æ˜ç¤ºçš„ãªã‚ªãƒ—ãƒˆã‚¤ãƒ³ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

å…·ä½“çš„ãªã‚¹ã‚¤ãƒƒãƒã®æ–¹æ³•ãªã©ã¯æŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

- `NDEBUG`ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„å ´åˆã«ã€ãƒã‚¯ãƒ­ã«æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶å¼ãŒ`false`ã‚’è¿”ã—ãŸã¨ãã€ãã®è¨ºæ–­çµæœã‚’stderrã«å‡ºåŠ›ã™ã‚‹ã‹ã€é•åãƒãƒ³ãƒ‰ãƒ©ã‚’èµ·å‹•ã™ã‚‹ã‹ã‚’å®Ÿè£…å®šç¾©ã¨ã™ã‚‹
    - ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç­‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã™ã‚‹
- é•åãƒãƒ³ãƒ‰ãƒ©ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹å ´åˆã€ãã®å‹•ä½œã¯`handle_enforced_contract_violation(#__VA_ARGS__, std::nothrow)`ã®å‘¼ã³å‡ºã—ã¨ç­‰ä¾¡
    - ãŸã ã—ã€`kind`ã¯`std::contracts::assertion_kind::cassert`ï¼ˆæ–°è¦è¿½åŠ ã™ã‚‹åˆ—æŒ™å€¤ï¼‰ã«ãªã‚Š
    - `detection_mode`ã¯``std::contracts::detection_mode::predicate_false`ï¼ˆæ–°è¦è¿½åŠ ã™ã‚‹åˆ—æŒ™å€¤ï¼‰ã«ãªã‚‹


ãŸã ã—ã€ä¸€éƒ¨ã®ç’°å¢ƒã§ã¯`assert`ãƒã‚¯ãƒ­ã®å¤‰æ›´ãŒå›°é›£ã§ã‚ã‚‹å ´åˆãŒã‚ã‚‹ãŸã‚ã€ã“ã®å¤‰æ›´ã¯å®Ÿè£…å®šç¾©ã¨ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

#### 3. `assert`äº’æ›ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³

C++ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®è¨­è¨ˆã«ãŠã„ã¦ä¸­å¿ƒã«ã‚ã‚‹è€ƒãˆæ–¹ã¨ã—ã¦ã€å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å°å…¥ã—ã¦ã‚‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ­£ã—ã•ã¯å¤‰ã‚ã‚‰ãªã„ã¯ãšã§ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæ­£ã—ã„ã‹é–“é•ã£ã¦ã„ã‚‹ã‹ã‚’è­˜åˆ¥ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã ã‘ã€ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯è©•ä¾¡æ¯ã«ç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ãã‚Œã‚’å¤‰æ›´å¯èƒ½ã§ã‚ã‚‹ãŸã‚ã€å¥‘ç´„æ³¨é‡ˆã®è©•ä¾¡ã«ãŠã„ã¦ã¯ãã®è©•ä¾¡ãŒãã®ã»ã‹ã®å¥‘ç´„æ³¨é‡ˆã®ã™ã¹ã¦ã®è©•ä¾¡ã¨ã¯ç„¡é–¢ä¿‚ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ­£ã—ã•ã‚’å¤‰æ›´ã—ãªã„ã“ã¨ãŒä¸å¯æ¬ ã§ã™ã€‚

`assert`ãƒã‚¯ãƒ­ã§ã¯ãã‚Œã¨ã¯å¯¾ç…§çš„ã«ã€ãã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯`NDEBUG`ãƒã‚¯ãƒ­ã®çŠ¶æ…‹ã«åŸºã¥ã„ã¦é¸æŠã•ã‚Œã¾ã™ã€‚`NDEBUG`ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚Œã°ãƒã‚§ãƒƒã‚¯ã‚’å¼·åˆ¶ã—ã€å®šç¾©ã•ã‚Œã¦ã„ãªã‘ã‚Œã°æ¡ä»¶ã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€`assert`ã®æ¡ä»¶å¼ã®è©•ä¾¡ãŒåŒã˜ç¿»è¨³å˜ä½å†…ã®ä»–ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã®è©•ä¾¡ã‚„`#ifndef NDEBUG`ç­‰ã®ä¿è­·ã•ã‚ŒãŸãƒ–ãƒ­ãƒƒã‚¯ã«ä¾å­˜ã™ã‚‹ã®ã¯å®Œå…¨ã«åˆç†çš„ã§ã™ã€‚

å¾“ã£ã¦ã€`assert`ãƒã‚¯ãƒ­ã®è©•ä¾¡ã«ãŠã‘ã‚‹å‰¯ä½œç”¨ã«ä¾å­˜ã—ã¦ã„ã‚‹ç­‰ã®åˆ©ç”¨æ³•ã¯å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«ã™ãã«ç§»è¡Œã§ãã¾ã›ã‚“ã€‚å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®æ‹¡å¼µã¨ã—ã¦ãã‚Œã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚è€ƒãˆã‚‰ã‚Œã¾ã™ãŒã€ãã‚Œã¯å°‘ãªãã¨ã‚‚æœ€åˆã®MVPã®å¾Œã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€æš«å®šçš„ãªè§£æ±ºç­–ã¨ã—ã¦ã€`assert`ãƒã‚¯ãƒ­ã¨ã‚ˆãä¼¼ãŸå¥‘ç´„æ³¨é‡ˆæ§‹æ–‡ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`contract_assert`ã¯ãã®ã¾ã¾ã«ã—ã¦ã»ã¨ã‚“ã©ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ã‚«ãƒãƒ¼ã™ã‚‹ä¸€æ–¹ã§ã€`contract_assert`ã‚’åˆ©ç”¨ã§ããªã„ã‚ˆã†ãªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯ã“ã¡ã‚‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¸ã®ç§»è¡Œã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚

ææ¡ˆã™ã‚‹ã®ã¯ã€`partial_contract_assert()`ã¨ã„ã†å¥‘ç´„æ³¨é‡ˆã§ã€ã“ã‚Œã¯`contract_assert`ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãªãŒã‚‰ã‚‚æ¬¡ã®é•ã„ãŒã‚ã‚Šã¾ã™

- `partial_contract_assert`ã¯æ–°ã—ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦å°å…¥
- ç¿»è¨³å˜ä½å†…ã®`partial_contract_assert`ã¯ã€åŒã˜å®Ÿè£…å®šç¾©ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã§è©•ä¾¡ã•ã‚Œã‚‹
- `partial_contract_assert`ãŒå¸¸ã«åŒã˜è©•ä¾¡ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒã¤ã‚ˆã†ã«ODRã‚’æ‹¡å¼µ
- ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆenforce, quick_enforce, observeï¼‰ã‚’åˆ©ç”¨ã—ã¦ã€`partial_contract_assert`ã‚’è©•ä¾¡ã™ã‚‹å ´åˆã€è¿°èªã¯é€šå¸¸é€šã‚Šè©•ä¾¡ã•ã‚Œã€çœç•¥ã•ã‚Œãªã„
- `partial_contract_assert`ã¯contract-assertion sequencesã®ä¸€éƒ¨ã§ã¯ãªã„ãŸã‚ã€ä»–ã®ã™ã¹ã¦ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦å¸¸ã«èªå½™é †ã§è©•ä¾¡ã•ã‚Œã‚‹
- `partial_contract_assert`ã®è©•ä¾¡ã¯ç¹°ã‚Šè¿”ã™ã“ã¨ãŒã§ããªã„
- `partial_contract_assert`å†…ã§ã¯è‡ªå‹•è¨˜æ†¶åŸŸæœŸé–“ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã™ã‚‹idå¼ã®å‹ã¯ã€ä»–ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ç•°ãªã‚Šæš—é»™çš„ã«`const`ã«ãªã‚‰ãªã„

 `partial_contract_assert`ã¯ã»ã¼ã€`assert`ãƒã‚¯ãƒ­ã¨åŒã˜ã‚ˆã†ãªå‹•ä½œã‚’ã—ã¾ã™ã€‚


SG21ã«ãŠã‘ã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã¯ã€ææ¡ˆ1ã¨2ã¯ç¶™ç¶šã—ã¦è­°è«–ã™ã‚‹ã“ã¨ã«åˆæ„ã•ã‚ŒãŸã‚‚ã®ã®ã€ææ¡ˆ3ã¯ã‚ã¾ã‚Šå¥½ã¾ã‚Œãšã€MVPå¾Œã®æ©Ÿèƒ½ã¨ã—ã¦æ¤œè¨ã—ã¦ã„ãã“ã¨ã«ã‚‚åˆæ„ãŒå–ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚

- [P3290 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1943)

### [P3292R0 Provenance and Concurrency](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3292r0.html)

C++ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã®é–‹å§‹ä»˜è¿‘ã§ã®å¾®å¦™ãªå•é¡Œã«ã¤ã„ã¦ã®æ”¹å–„ç­–ã®ææ¡ˆã€‚



ã“ã®ææ¡ˆã§ã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒé–“é•ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹2ã¤ã®ä¾‹ã‚’æŒ™ã’ã¦ã„ã¾ã™ã€‚

ã¾ãšä¸€ã¤ã¯ã€é“å¾³çš„ã«ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæ­£ã—ã„ã¨æ€ã‚ã‚Œã‚‹ã‚‚ã®ã®ã€å®Ÿéš›ã«ã¯æ­£ã—ããªã„ä¾‹ã§ã™ã€‚

```cpp
void some_extern_func(int);

int* f(int* q) {
  int* p = new int;
  *p = 123; // A
  *q = 456; // B
  some_extern_func(*p); // Cã€`some_extern_func(123)`ã¨æ›¸ãæ›ãˆã¦ã‚‚ã„ã„?
  return p;
}
```

clangã¨gccã¯ã©ã¡ã‚‰ã‚‚ã€O1ä»¥ä¸Šã®æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«ã§ã“ã‚Œã‚’é–“é•ã£ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã€Cã®å€‹æ‰€ã‚’å®šæ•°ä¼æ’­ã—ã¦`some_extern_func(123)`ã¨æ›¸ãæ›ãˆã¾ã™ã€‚ã—ã‹ã—ã“ã‚Œã¯é–“é•ã£ã¦ãŠã‚Šã€å®Ÿéš›ã«ã¯`p`ã¨`q`ãŒãƒ©ã‚¤ãƒ•ãƒ©ã‚¤ãƒ ãƒ«ãƒ¼ãƒ«ã«é•åã™ã‚‹ã“ã¨ãªãç­‰ã—ããªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã€Bã§ã¯Aã«ãŠã‘ã‚‹ã‚¹ãƒˆã‚¢ã‚’ä¸Šæ›¸ãã—ã¾ã™ã€‚

å½“ç„¶ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ãŠã„ã¦ã¯ãã‚Œã¯èµ·ã“ã‚‰ãªã„ã®ã§ã™ãŒã€ä¸¦è¡Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ãŠã„ã¦ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ãƒã‚¤ãƒ³ã‚¿ã‚’ãã®ä½œæˆå‰ã®æ™‚ç‚¹ã«é€ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```cpp
int* f(int* q) {
  int* p = new int;
  *p = 123; // A
  *q = 456; // B
  some_extern_func(*p); // C. Can we rewrite this to `some_extern_func(123)` ?
  return p;
}

int dummy;
std::atomic<int *> ptr_to_int_1{&dummy};
std::atomic<int *> ptr_to_int_2{&dummy};

void t1() {
  int* q = ptr_to_int_1.load(relaxed);
  int* p = f(q);
  // ptr_to_int_1.load()ã‚ˆã‚Šã‚‚å‰ã«ã“ã®è¡Œã‚’ç§»å‹•ã§ãã‚‹
  ptr_to_int_2.store(p, relaxed);
}

void t2() {
  // t1ã®ã‚¹ãƒˆã‚¢ã‚’ãƒ­ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã€t1ã«é€ã‚Šè¿”ã™
  int* p = ptr_to_int_2.load(relaxed);
  ptr_to_int_1.store(p, relaxed);
}
```

`t1(), t2()`ãŒãã‚Œãã‚Œåˆ¥ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚`t1()`ã‚’å‡¦ç†ã™ã‚‹CPUã¯`ptr_to_int_2.store(p, relaxed)`ã‚’ä»–ã®ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã‚ˆã‚Šã‚‚å‰ã«ä¸¦ã¹æ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆ`relaxed`ã¯ã‚ã‚‰ã‚†ã‚‹é †åºä»˜ã‘ä¿è¨¼ãŒãªã„ï¼‰ã€‚ ãã®å¾Œ`t2()`ã¯`ptr_to_int_2`ã«ã‚¹ãƒˆã‚¢ã•ã‚ŒãŸå€¤ã‚’èª­ã¿å–ã£ã¦`ptr_to_int_1`ã¸ã‚¹ãƒˆã‚¢ã—ã€`t1()`ã¯ãã®å¾Œã§`ptr_to_int_1`ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦`f`ã«æ¸¡ã™ã€ã¨ã„ã†ã“ã¨ãŒã§ãã¾ã™ã€‚ã™ã‚‹ã¨ã€`p`ã¨`q`ã¯åŒã˜å€¤ã«ãªã‚Šã¾ã™ã€‚

`f()`å†…ã§`new int`ã¨ç¢ºä¿ã•ã‚Œã¦ã„ã‚‹`int`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã¯ãã®ã‚¢ã‚¯ã‚»ã‚¹ãŒèµ·ã“ã‚‹ã‚ˆã‚Šã‚‚å‰ã«é–‹å§‹ã•ã‚Œã¦ãŠã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã“ã®`int`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ é–‹å§‹å‰ã«ãã®ãƒã‚¤ãƒ³ã‚¿ã‚’æ“ä½œã—ã¦ã„ã‚‹ã‚‚ã®ã®ã€ãƒ‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¯ã—ã¦ã„ãªã„ã®ã§ã€ã“ã‚Œã¯ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã®ãƒ«ãƒ¼ãƒ«ã«é•åã—ã¦ã„ã¾ã›ã‚“ã€‚

2ã¤ç›®ã®ä¾‹ã¯é“å¾³çš„ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒé–“é•ã£ã¦ãŠã‚Šã€å®Ÿéš›é–“é•ã£ã¦ã„ã‚‹ä¾‹ã§ã™ã€‚

```cpp
void some_extern_function();

int* f() {
  int *p = new int;
  *p = 123; // A
  some_extern_function(); // B
  return p;
}
```

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®æœ€é©åŒ–ã¯ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’æ¬¡ã®ã‚ˆã†ã«ä¸¦ã¹æ›¿ãˆã‚‹ï¼ˆAã¨Bã‚’å…¥ã‚Œæ›¿ãˆã‚‹ï¼‰ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ

```cpp
int* f() {
  int *p = new int;
  some_extern_function(); // B
  *p = 123; // A
  return p;
}
```

clangã¯èª¤ã£ã¦ã€ã“ã‚Œã«ã€Œã¯ã„ã€ã¨ç­”ãˆã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãŸã ã—ã€ã“ã®ã‚³ãƒ¼ãƒ‰å˜ä½“ã§ã¯ãã‚Œã¯èµ·ã“ã‚‰ãšã€ã‚³ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã‚‹ã¨ãƒ«ãƒ¼ãƒ—åˆ†æãƒ‘ã‚¹ã®ãƒã‚°ã«ã‚ˆã‚Šã“ã‚ŒãŒèµ·ã“ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãŸã ã—ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒä¸¦ã¹æ›¿ãˆã‚‹ã‹ã©ã†ã‹ã¨ã„ã†å•é¡Œã¯ã€ä¸¦ã¹æ›¿ãˆã‚’è¨±å¯ã™ã¹ãã‹ã¨ã„ã†å•é¡Œã¨ã¯ç„¡é–¢ä¿‚ã§ã™ã€‚ã“ã‚Œã¯è¨±å¯ã™ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚ŒãŒé–“é•ã£ã¦ã„ã‚‹ç†ç”±ã¯ã€`some_extern_function()`ã®å®Ÿè£…ã§`release`ãƒ•ã‚§ãƒ³ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¦`some_extern_function()`ãŒä»–ã®å ´æ‰€ã‹ã‚‰ã‚‚å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã€ãƒ•ã‚§ãƒ³ã‚¹ã‚’ä½¿ç”¨ã—ãŸå˜ç´”ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ãƒƒã‚·ãƒ³ã‚°ãŒé˜»å®³ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚

```cpp
atomic<int*> atomic_int_ptr;

void some_extern_function() {
  atomic_thread_fence(memory_order_release);
}

int* f() {
  int *p = new int;
  *p = 123; // A
  some_extern_function(); // B
  return p;
}

void message_pass_f() {
  int* p = f();
  atomic_int_ptr.store(p, relaxed);
}

void receive_message() {
  int* p = atomic_int_ptr.load(relaxed);
  atomic_thread_fence(acquire);
  if (p != nullptr) {
    assert(*p == 123);
  }
}
```

`receive_message()`ã«ãŠã„ã¦ã€`p`ãŒ`nullptr`ã§ã¯ãªã„å ´åˆï¼ˆã™ãªã‚ã¡ã€`message_pass_f()`ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰ã€`*p`ã®å€¤ã¯`123`ã§ã‚ã‚‹ã“ã¨ãŒãƒ¡ãƒ¢ãƒªãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã£ã¦ä¿è¨¼ã•ã‚Œã¦ã„ã¾ã™ï¼ˆ`message_pass_f()`ã§`atomic_int_ptr.store(p, relaxed)`ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆã€`release`ãƒ•ã‚§ãƒ³ã‚¹ã¨`acquire`ãƒ•ã‚§ãƒ³ã‚¹ã®é–“ã«é †åºãŒæˆç«‹ã—ã€ãªãŠã‹ã¤`relaxed`ãªãƒ­ãƒ¼ãƒ‰ã‚¹ãƒˆã‚¢ãŒãƒ•ã‚§ãƒ³ã‚¹ã‚’è·¨ãŒãªã„ã“ã¨ã§ã€`*p`ã«123ãŒæ›¸ãè¾¼ã¾ã‚ŒãŸå¾Œã§`atomic_int_ptr`ã«ã‚»ãƒƒãƒˆã•ã‚Œã€`p`ãŒ`nullptr`ã§ãªã„å€¤ã§èª­ã¿ã ã•ã‚ŒãŸå ´åˆã¯`*p`ã¯ç¢ºå®Ÿã«123ã«ãªã‚Šã¾ã™ï¼‰ã€‚

ã“ã®å ´åˆã«Aã¨Bã‚’å…¥ã‚Œæ›¿ãˆã‚‹ã¨ã€ã“ã®ãƒ¡ãƒ¢ãƒªãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã£ã¦ä¿è¨¼ã•ã‚ŒãŸå‹•ä½œãŒå£Šã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã®ã‚ˆã†ãªæœ€é©åŒ–ã¯å³å¯†ã«ã¯è¨±å¯ã•ã‚Œã¾ã›ã‚“ã€‚

ã—ã‹ã—ã€ã“ã®ã‚ˆã†ãªã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®é–“é•ã„ã¯è¨±ã•ã‚Œã‚‹å´é¢ã‚‚ã‚ã‚Šã¾ã™ã€‚`p`ã®ãƒ¡ãƒ¢ãƒªã®å‰²ã‚Šå½“ã¦ã¯é–¢æ•°ãƒ­ãƒ¼ã‚«ãƒ«ãªã‚‚ã®ã§ã‚ã‚Šã€ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ä¸€è‡´ã™ã‚‹é™ã‚Šãã®ã‚¹ã‚³ãƒ¼ãƒ—ã‹ã‚‰å¤–ã«å‡ºã‚‹ã¾ã§ã¯è‡ªç”±ã«ä¸¦ã¹æ›¿ãˆã‚‰ã‚Œã‚‹ã¯ãšã§ã™ã€‚ã‚€ã—ã‚ã€ä¸¦è¡Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ãŠã‘ã‚‹åŒæœŸã«ã‚ˆã£ã¦ãã‚ŒãŒé˜»å®³ã•ã‚Œã€ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã¯ãšã®ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ãŒã§ãã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã®provenanceã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚‰ã®æ§˜ãªã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®é–“é•ã„ã‚’é¡åŠçš„ã«æ­£å½“åŒ–ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚ãƒã‚¤ãƒ³ã‚¿ã®provenanceã¨ã¯ã€ãƒã‚¤ãƒ³ã‚¿ã®å‡ºã©ã“ã‚ï¼ˆç”±æ¥ã€æ¥æ­´ï¼‰ã‚’é‡è¦–ã—ãŸãƒã‚¤ãƒ³ã‚¿ãƒ¢ãƒ‡ãƒ«ã§ã‚ã‚Šã€ãƒã‚¤ãƒ³ã‚¿ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå˜ãªã‚‹æ•´æ•°å€¤ã§ã‚ã‚‹ã¨ã„ã†æ—¢å­˜ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‹ã‚‰è„±å´ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã‚ã‚‹ãƒã‚¤ãƒ³ã‚¿ã®å‹ã¨ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒåŒä¸€ã ã£ãŸã¨ã—ã¦ã‚‚ã€provenanceã®ç•°ãªã‚‹ãƒã‚¤ãƒ³ã‚¿ã¯åˆ¥ã®ãƒã‚¤ãƒ³ã‚¿ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ï¼ˆè©³ã—ãã¯ã€Œãƒã‚¤ãƒ³ã‚¿ provenanceã€ãªã©ã§æ¤œç´¢ã—ã¦ã„ãŸã ãã¨è‰²ã€…è¦‹ã¤ã‹ã‚Šã¾ã™ï¼‰ã€‚

ã“ã®ææ¡ˆã§ç¢ºç«‹ã—ãŸç›´æ„Ÿçš„ãªå‹•ä½œã¯ã€Œã‚ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ãŒã‚ã‚‹ãƒã‚¤ãƒ³ã‚¿ã®ãƒ‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹æ¨©ã‚’æŒã£ã¦ã„ãªã„å ´åˆã€ãã®ãƒã‚¤ãƒ³ã‚¿ã‚’åˆ¥ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«æ¸¡ã™ã¨æ¸¡ã•ã‚ŒãŸã‚¹ãƒ¬ãƒƒãƒ‰ã‚‚ãã®ãƒã‚¤ãƒ³ã‚¿ã®ãƒ‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹æ¨©ã‚’æŒãŸãªã„ã€ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€Cã®provenanceãƒ¢ãƒ‡ãƒ«ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ã€ãã“ã«æ–°ã—ã„ç¨®é¡ã®provenanceãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

- full provenance: Cã§ææ¡ˆä¸­ã®provenanceãƒ¢ãƒ‡ãƒ«
    - empty provenance: ç„¡åŠ¹ãªãƒã‚¤ãƒ³ã‚¿ã®provenance
    - specific provenance: ãã®ä»–ã®ãƒã‚¤ãƒ³ã‚¿ã®provenance
- provisional provenance: ã“ã®ææ¡ˆ
    - åˆ¥ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‹ã‚‰å—ã‘å–ã£ãŸãƒã‚¤ãƒ³ã‚¿ã®provenance
    - ä½•ã‚‰ã‹ã®åŒæœŸãŒç¢ºç«‹ã•ã‚Œã‚‹ã¾ã§ã¯ã€ãƒ‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹æ¨©ã‚’å¾—ã‚‰ã‚Œãªã„
    - ãƒã‚¤ãƒ³ã‚¿ãŒåŒæœŸã•ã‚Œãªã„è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰é–“ã§ã‚„ã‚Šå–ã‚Šã•ã‚Œã‚‹å ´åˆã€å†å¸°çš„ã«é©ç”¨ã•ã‚Œã‚‹

ã“ã®ææ¡ˆã®ä¸‹ã§ã¯ã€ãƒã‚¤ãƒ³ã‚¿ã‚’è‡ªç”±ã«ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã¯full provenanceãŒå¿…è¦ã¨ãªã‚Šã€provisional provenanceã—ã‹ãªã„ãƒã‚¤ãƒ³ã‚¿ã§ãƒ‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’è¡Œã†ã¨UBã«ãªã‚Šã¾ã™ã€‚

ã“ã®provenanceãƒ¢ãƒ‡ãƒ«ã®ä¸‹ã§ã¯ã€ã¾ãš1ã¤ç›®ã®å•é¡Œã¯æ¬¡ã®ã‚ˆã†ã«è§£æ±ºã•ã‚Œã¾ã™ã€‚

```cpp
int* f(int* q) {
  int* p = new int;
  *p = 123;
  *q = 456; // E
  some_extern_func(*p);
  return p;
}

int dummy;
std::atomic<int *> ptr_to_int_1{&dummy};
std::atomic<int *> ptr_to_int_2{&dummy};

void t1() {
  int* q = ptr_to_int_1.load(relaxed); // D
  int* p = f(q);
  ptr_to_int_2.store(p, relaxed); // A
}

void t2() {
  int* p = ptr_to_int_2.load(relaxed); // B
  ptr_to_int_1.store(p, relaxed); // C
}
```

`t2()`ãŒãƒã‚¤ãƒ³ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰ï¼ˆBï¼‰ã™ã‚‹ã¨ã€provisional provenanceã‚’æŒã¤ãƒã‚¤ãƒ³ã‚¿ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚ãã®ãƒã‚¤ãƒ³ã‚¿ã¯Cã§ã‚¹ãƒˆã‚¢ã•ã‚Œã€Dã§ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ãƒã‚¤ãƒ³ã‚¿`q`ã‚‚provisional provenanceã‚’æŒã¡ã¾ã™ã€‚`E`ã¯provisional provenanceã§ãƒ‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã•ã‚Œã‚‹ãŸã‚UBã«ãªã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€`q`ã¨`p`ãŒåŒä¸€ã§ã‚ã‚‹å¯èƒ½æ€§ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ã¯ç„¡ããªã‚Šã¾ã™ï¼ˆUBã¯èµ·ã“ã‚‰ãªã„ã®ã§ã€`q`ã¯å¸¸ã«full provenanceã‚’æŒã¤ã¯ãšã§ã‚ã‚Šã€ã“ã®ãƒ­ãƒ¼ã‚«ãƒ«ã§full provenanceãŒç™ºç”Ÿã™ã‚‹`p`ã¨ã¯provenanceãŒæ˜ã‚‰ã‹ã«ç•°ãªã‚‹ï¼‰ã€‚

2ã¤ç›®ã®å•é¡Œã‚‚è§£æ±ºã•ã‚Œã¾ã™

```cpp
atomic<int*> atomic_int_ptr;

int* f() {
  int *p = new int;
  *p = 123; // A
  some_extern_function(); // Really, a release fence
  return p;
}

int* f() {
  int *p = new int;
  some_extern_function(); // just a release fence
  *p = 123;
  return p;
}

void message_pass_f() {
  int* p = f();
  atomic_int_ptr.store(p, relaxed);  
}

void receive_message() {
  int* p = atomic_int_ptr.load(relaxed);
  atomic_thread_fence(acquire);
  // P
  if (p != nullptr) {
    assert(*p == 123);
  }
}
```

`receive_message()`ã§å–å¾—ã•ã‚Œã‚‹ãƒã‚¤ãƒ³ã‚¿`p`ã¯provisional provenanceã‚’æŒã¡ã¾ã™ã€‚`acquire`ãƒ•ã‚§ãƒ³ã‚¹ç›´å¾Œã®ç‚¹Pã«ã¤ã„ã¦è€ƒãˆã‚‹ã¨ã€`p`ãŒ`nullptr`ã§ã¯ãªã„å ´åˆã€`int`ã®ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã®é–‹å§‹ã¯Pã‚ˆã‚Šã‚‚å‰ã«ç™ºç”Ÿã—ã¦ãŠã‚Šã€Pã¯ãƒ‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚ˆã‚Šã‚‚å‰ã«ç™ºç”Ÿã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€`p`ã¯full provenanceã‚’ç²å¾—ã—ã€ã“ã®ä¾‹ã«ã¯UBã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆ`f()`ã®å®šç¾©ã«é–¢ã‚ã‚‰ãšï¼‰ã€‚ãã®å¾Œã®ã‚¢ã‚µãƒ¼ãƒˆãŒã©ã†ç™ºå‹•ã™ã‚‹ã‹ã¯`f()`ãŒã©ã†æœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ã«ã‚ˆã‚Šã¾ã™ã€‚

ææ¡ˆã«ã¯è¿½åŠ ã®ä¾‹ãŒã‚ã‚Šã€ä»£æ›¿ã®è§£æ±ºæ‰‹æ®µã®æ¤œè¨ãªã©ã‚‚ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P3292 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1944)

### [P3293R0 Splicing a base class subobject](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3293r0.html)

ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã«ãŠã„ã¦ã€åŸºåº•ã‚¯ãƒ©ã‚¹ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ç°¡å˜ãªæ–¹æ³•ã‚’æä¾›ã™ã‚‹ææ¡ˆã€‚

P2996ã®é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã«ãŠã„ã¦ã¯ã€ã‚ã‚‹å‹ï¼ˆã‚‚ã—ãã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆéé™çš„ãƒ¡ãƒ³ãƒ or åŸºåº•ã‚¯ãƒ©ã‚¹ï¼‰ã«å¯¾ã—ã¦åŒã˜æ“ä½œã‚’é †ç•ªã«é©ç”¨ã—ã¦ã„ãã“ã¨ãŒæœ‰ç”¨ãªçŠ¶æ³ãŒã„ãã¤ã‚‚ã‚ã‚Šã¾ã™ã€‚

P2996ã§ã¯`T`ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ`obj`ã¨`T`ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¡¨ã™é¡åƒï¼ˆ`meta::info`ï¼‰`sub`ã‚’ç”¨ã„ã¦ã€`obj.[:sub:]`ã¨ã„ã†æ§‹æ–‡ã§ãã‚Œã‚’å®Ÿç¾ã—ã¤ã¤ã‚¹ãƒ—ãƒ©ã‚¤ã‚·ãƒ³ã‚°ï¼ˆå€¤ã®å±•é–‹ï¼‰ã¾ã§è¡Œã†ã“ã¨ãŒã§ãã‚‹ã®ã§ã™ãŒã€ã“ã‚Œã¯åŸºåº•ã‚¯ãƒ©ã‚¹ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã™

```cpp
template <class T, class F>
void for_each_subobject(T const& obj, F f) {
  // Tã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ãƒ«ãƒ¼ãƒ—ã™ã‚‹
  template for (constexpr auto sub : subobjects_of(^T)) {
    f(obj.[:sub:]); // éé™çš„ãƒ¡ãƒ³ãƒå¤‰æ•°ã«å¯¾ã—ã¦ã¯æœ‰åŠ¹ã ãŒã€åŸºåº•ã‚¯ãƒ©ã‚¹ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã¯ä½¿ç”¨ã§ããªã„
  }
}
```

ã—ãŸãŒã£ã¦ã€ã“ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«å ´åˆåˆ†ã‘ã—ã¦æ›¸ãç›´ã™å¿…è¦ãŒã‚ã‚Šã¾ã™

```cpp
template <class T, class F>
void for_each_subobject(T const& obj, F f) {
  // åŸºåº•ã‚¯ãƒ©ã‚¹ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  template for (constexpr auto base : bases_of(^T)) {
    f(static_cast<type_of(base) const&>(obj));
  }

  // éé™çš„ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒ³ãƒã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  template for (constexpr auto sub : nonstatic_data_members_of(^T)) {
    f(obj.[:sub:]);
  }
}
```

ãŸã ã—ã“ã®ã‚³ãƒ¼ãƒ‰ã«ã‚‚ã¾ã å•é¡ŒãŒã‚ã‚Šã€`static_cast`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå…¥ã‚Šã€`private`ãªåŸºåº•ã‚¯ãƒ©ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚ã“ã‚Œã‚’å›é¿ã™ã‚‹ã«ã¯ã•ã‚‰ã«Cã‚­ãƒ£ã‚¹ãƒˆã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```cpp
template <class T, class F>
void for_each_subobject(T const& obj, F f) {
  // åŸºåº•ã‚¯ãƒ©ã‚¹ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  template for (constexpr auto base : bases_of(^T)) {
    f((typename [: type_of(base) :]&)obj);
  }

  // éé™çš„ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒ³ãƒã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  template for (constexpr auto sub : nonstatic_data_members_of(^T)) {
    f(obj.[:sub:]);
  }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã«ã‚‚ã•ã‚‰ã«å•é¡ŒãŒã‚ã‚Šã€`const`ã‚’æ›¸ãã®ã‚’å¿˜ã‚Œã¦ã„ã‚‹ãŸã‚æ„å›³ã›ãš`const`æ€§ã®ã‚­ãƒ£ã‚¹ãƒˆã‚‚è¡Œã£ã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚ãã—ã¦ã€ã“ã‚Œã¯Cã‚­ãƒ£ã‚¹ãƒˆãªã®ã§ã€å®Ÿéš›ã®ç¶™æ‰¿é–¢ä¿‚ã«é–¢ä¿‚ãªãã‚­ãƒ£ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã™ã€‚

ã¾ãŸã€ã‚­ãƒ£ã‚¹ãƒˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆå®›å…ˆã®å‹ã‚’æ›¸ã‹ãªã‘ã‚Œã°ãªã‚‰ãšã€ã•ã‚‰ã«CVä¿®é£¾ã¨å€¤ã‚«ãƒ†ã‚´ãƒªã‚’æ­£ã—ãæŒ‡å®šã‚‚ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å®Œå…¨ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯é–¢æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™

```cpp
template <std::meta::info M, class T>
constexpr auto subobject_cast(T&& arg) -> auto&& {
    constexpr auto stripped = remove_cvref(^T);
    if constexpr (is_base(M)) {
      // åŸºåº•ã‚¯ãƒ©ã‚¹ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
      static_assert(is_base_of(type_of(M), stripped));
      return (typename [: copy_cvref(^T, type_of(M)) :])arg;
    } else {
      // éé™çš„ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒ³ãƒã®å ´åˆ
      static_assert(parent_of(M) == stripped);
      return ((T&&)arg).[:M:];
    }
}

template <class T, class F>
void for_each_subobject(T const& obj, F f) {
  template for (constexpr auto sub : subobjects_of(^T)) {
    f(subobject_cast<sub>(obj));
  }
}
```

ã“ã‚Œã¯ã‚ã¾ã‚Šã«å†—é•·ã§ã€ã“ã‚Œã‚’æ›¸ãå¿…è¦æ€§ã‚’è¦æ±‚ã™ã‚‹ã®ã¯é–“é•ã£ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã“ã®è§£æ±ºã®ãŸã‚ã«ã€ç¾åœ¨ã®`obj.[:nsdm:]`ï¼ˆ`nsdm`ã¯`T`å‹ã®éé™çš„ãƒ¡ãƒ³ãƒå¤‰æ•°ã®é¡åƒï¼‰ã¨ã„ã†è¨˜æ³•ãŒéé™çš„ãƒ¡ãƒ³ãƒå¤‰æ•°ã«ã—ã‹ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã®ã‚’ä¿®æ­£ã—ã¦ã€åŒã˜è¨˜æ³•ã‚’ã‚¯ãƒ©ã‚¹ã®ä»»æ„ã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã¨ã—ã¦å†å®šç¾©ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ã•ã‚‰ã«è¿½åŠ ã§ã€`&[:mem:]`ï¼ˆ`mam`ã¯`T`ã®åŸºåº•ã‚¯ãƒ©ã‚¹`B`ã®é¡åƒï¼‰ã¨ã„ã†æ§‹æ–‡ã¯ã€é©åˆ‡ãªã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’æŒã¤`B T::*`ã‚’ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

P2996ãŒã“ã†ãªã£ã¦ã„ãªã„ç†ç”±ã¯ã€éãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®å ´åˆã«`obj.member_name`ã®è¨˜æ³•ã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã®ã¯ãƒ¡ãƒ³ãƒå¤‰æ•°ã«é™å®šã•ã‚Œã‚‹ãŸã‚ã§ã€åŸºåº•ã‚¯ãƒ©ã‚¹ãŒã“ã®ã‚ˆã†ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã®ã¯åŸºåº•ã‚¯ãƒ©ã‚¹ã«ã¯é€šå¸¸ãƒ¡ãƒ³ãƒå¤‰æ•°ã®ã‚ˆã†ãªåå‰ãŒç„¡ã„ãŸã‚ã§ã™ã€‚

ã“ã®ææ¡ˆã®å¤‰æ›´ã§ã¯ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®æ–‡è„ˆï¼ˆã‚¹ãƒ—ãƒ©ã‚¤ã‚·ãƒ³ã‚°ï¼‰ã«ãŠã„ã¦å¯¾å¿œã™ã‚‹æ§‹æ–‡ã§è¨€èªï¼ˆéãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³éƒ¨åˆ†ã®C++ï¼‰ãŒå®Ÿè¡Œã§ããªã„ã“ã¨ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã—ã¾ã„ã¾ã™ã€‚ã—ã‹ã—ã€ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¯ç¾åœ¨ã®ã‚³ã‚¢è¨€èªãŒãƒã‚¤ãƒ†ã‚£ãƒ–ã«å®Ÿè¡Œã§ããªã„ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ãŸã‚ã€ã“ã‚Œã¯å•é¡Œã«ãªã‚‰ãªã„ã¨ä¸»å¼µã—ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã«ã‚ˆã£ã¦ã€æœ€åˆã®ã‚³ãƒ¼ãƒ‰ãŒãã®ã¾ã¾æ„å›³é€šã‚Šã«å‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™

```cpp
template <class T, class F>
void for_each_subobject(T const& obj, F f) {
  // Tã®ã‚µãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ãƒ«ãƒ¼ãƒ—ã™ã‚‹
  template for (constexpr auto sub : subobjects_of(^T)) {
    f(obj.[:sub:]); // okã€ã“ã®ææ¡ˆå¾Œ
  }
}
```

- [P3293 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1945)

### [P3294R0 Code Injection with Token Sequences](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3294r0.html)
### [P3295R0 Freestanding constexpr containers and constexpr exception types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3295r0.html)

ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã®å®šæ•°å¼ã«ãŠã„ã¦ã€`std::vector`ç­‰ã‚’ä½¿ç”¨å¯èƒ½ã«ã™ã‚‹ææ¡ˆã€‚

P2996ã®é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã§ã¯ã€`members_of()`ãªã©`vector<meta::info>`ã‚’è¿”ã™é–¢æ•°ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¯ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‹ã©ã†ã‹ã«é–¢ã‚ã‚‰ãšä¾¡å€¤ãŒã‚ã‚Šåˆ©ç”¨ã§ãã‚‹ã¹ãã§ã™ãŒã€`std::vector`ã¯ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã§ã¯å¿…é ˆã§ã¯ãªãåˆ©ç”¨ã§ããªã„å ´åˆãŒã‚ã‚‹ãŸã‚ã€ãã®ã›ã„ã§ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã§é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨ã§ããªããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ãã®è§£æ¶ˆã®ãŸã‚ã«ã€P2996ã§åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã§å¿…é ˆã§ã¯ãªã„æ©Ÿèƒ½ã®æœ€å°ã‚»ãƒƒãƒˆã«ã¤ã„ã¦ã€å®šæ•°å¼ã§ã®ã¿ä½¿ç”¨å¯èƒ½ã¨ãªã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã§ã¯å¤šãã®å ´åˆã€å®Ÿè¡Œæ™‚ã«ãƒ¡ãƒ¢ãƒªã‚’ç¢ºä¿ã—ãŸã‚Šä¾‹å¤–ã‚’æŠ•ã’ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ãŒã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã¯ãã®ã‚ˆã†ãªåˆ¶é™ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã§ã¯`std::vector`ã¨`std::allocator`ã‚’`consteval`ã§æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚

`std::vector`ã¯ä¾‹å¤–ã‚’æŠ•ã’ã‚‹APIãŒã‚ã‚Šã€ãã“ã§ã¯`out_of_range`ã¨`length_error`ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã“ã‚Œã‚‚ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã§ã¯ãªã„ãŸã‚ã“ã‚Œã‚‰ãŒã‚³ãƒ¼ãƒ‰ã«å‡ºç¾ã—ã¦ã—ã¾ã†ã¨ã€å®šæ•°å¼ãŒãã“ã‚’é€šã‚‰ãªãã¦ã‚‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’èµ·ã“ã—ã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã‚‰ã®ä¾‹å¤–å‹ã‚’ãƒ›ã‚¹ãƒˆç’°å¢ƒã§ã¯`constexpr`ã€ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã§ã¯`consteval`ã§æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚

ã•ã‚‰ã«ã€`out_of_range`ã¨`length_error`ã«ã¯æ–‡å­—åˆ—ã‚’å—ã‘å–ã‚‹APIãŒã‚ã‚Šã€ã“ã‚Œã‚‚ã¾ãŸãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°æŒ‡å®šã•ã‚Œã¦ã„ãªã„`std::string`ã«ä¾å­˜ã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€`std::string`ã‚‚åŒæ§˜ã«ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã§ã¯`consteval`ã§æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚æœ€å¾Œã«ã€ç¾åœ¨`std::string_view`ã®ä¸€éƒ¨ã®é–¢æ•°ã¯`freestanding-deleted`æŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚’`consteval`ã§æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚

ã¾ã¨ã‚ã‚‹ã¨

- ãƒ›ã‚¹ãƒˆç’°å¢ƒã§`constecpr`ã‚’ä»˜åŠ 
  - `exception`
  - `logic_error`
  - `length_error`
  - `out_of_range`
- ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã§`consteval`ã‚’ä»˜åŠ 
  - `logic_error`
  - `length_error`
  - `out_of_range`
  - `allocator`
  - `string_view`
    - `freestanding-deleted`ãƒ¡ãƒ³ãƒã‚’å¤‰æ›´
  - `string`
  - `vector`

ã¨ãªã‚Šã¾ã™ã€‚

ä¾‹å¤–é–¢é€£å‹ã‚’`constexpr`æŒ‡å®šã—ã¦ãŠãã“ã¨ã¯å°†æ¥çš„ãªå®šæ•°å¼ã«ãŠã‘ã‚‹ä¾‹å¤–æ©Ÿæ§‹ï¼ˆãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†æ©Ÿæ§‹ï¼‰ã«ã¨ã£ã¦ãƒ¡ãƒªãƒƒãƒˆã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

- [P3295 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1947)

### [P3296R0 `let_with_async_scope`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3296r0.html)

ææ¡ˆä¸­ã®`counting_scope`ã®å•é¡Œã‚’ä¿®æ­£ã™ã‚‹ææ¡ˆã€‚

`counting_scope`ã¯P3149ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã€ä¸¦åˆ—æ•°ã‚„å‡¦ç†ã®ç¶™ç¶šæœ‰ç„¡ãŒå®Ÿè¡Œæ™‚ã«æ±ºã¾ã‚‹å ´åˆã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®`|`ã«ã‚ˆã‚‹ãƒã‚§ãƒ¼ãƒ³ã¨åŒæ§˜ã«å‡¦ç†ã®ä¾å­˜é–¢ä¿‚ã«ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä»˜ã‘ã¦ç®¡ç†ã™ã‚‹ã“ã¨ã§ã€éåŒæœŸå‡¦ç†ãŒç¢ºå®Ÿã«å®Œäº†ã™ã‚‹ã¾ã§é–¢é€£ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¿è­·ã—ã¦ãŠã“ã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

`counting_scope`ã«ã¤ã„ã¦ã¯ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3149R0 async_scope -- Creating scopes for non-sequential concurrency - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3149R2-async_scope----Creating-scopes-for-non-sequential-concurrency)

`counting_scope`ã¯`.nest()`ã«ã‚ˆã£ã¦å‡¦ç†ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’é–‹ãã€ãã®å†…éƒ¨ã§ã•ã‚‰ã«`.nest()`ã‚’å‘¼ã¶ã“ã¨ã§éåŒæœŸå‡¦ç†ã®ãƒã‚¹ãƒˆã‚’è¡¨ç¾ã—ã€ãƒã‚¹ãƒˆã›ãšã«å˜ã«ç¶™ç¶šã™ã‚‹ã“ã¨ã§ç•°ãªã‚‹ã‚¹ã‚³ãƒ¼ãƒ—ã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†ã®ç¶™ç¶šã‚’è¡¨ç¾ã—ã¾ã™ã€‚ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§è¨€ã†ãªã‚‰`.nest()`ã¯å˜ã«ãƒ–ãƒ­ãƒƒã‚¯ã‚¹ã‚³ãƒ¼ãƒ—`{}`ã‚’å°å…¥ã—ã¦ã„ã‚‹ã®ã«ã‚ãŸã‚Šã¾ã™ã€‚

`counting_scope`ã¯ãã®éåŒæœŸå‡¦ç†ã‚’å¾…æ©Ÿã™ã‚‹ãŸã‚ã«`.join()`ã‚’æ˜ç¤ºçš„ã«å‘¼ã³å‡ºã•ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã¯`counting_scope`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç®¡ç†ã—ã¦ã„ã‚‹ã™ã¹ã¦ã®éåŒæœŸå‡¦ç†ãŒå®Œäº†ã™ã‚‹ã®ã‚’å¾…æ©Ÿã—ãªã‘ã‚Œã°ã€é–¢é€£ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’ç ´æ£„ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒåˆ†ã‹ã‚‰ãªã„ãŸã‚ã§ã™ã€‚

```cpp
// ä¿è­·å¯¾è±¡ã®ãƒªã‚½ãƒ¼ã‚¹
some_data_type scoped_data = make_scoped_data();

// counting_scopeã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
ex::counting_scope scope;

// å®Ÿè¡Œæ™‚ã«ãã®æ§‹é€ ãŒæ±ºå®šã•ã‚Œã‚‹éåŒæœŸå‡¦ç†
ex::sender auto async_work = scope.nest(on(exec, [&] {
    scope.nest(on(exec, [&] {
        if (need_more_work(scoped_data)) {
            scope.nest(on(exec, [&] { do_more_work(scoped_data); }));
            scope.nest(on(exec, [&] { do_more_other_work(scoped_data); }));
        }
    }));
    scope.nest(on(exec, [&] { do_something_else_with(scoped_data); }));
}));

// éåŒæœŸå‡¦ç†ã‚’é–‹å§‹ï¼ˆåˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã¨ã™ã‚‹
ex::spawn(std::move(async_work), scope);

// ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã¨ãƒ»ãƒ»ãƒ»ï¼Ÿ
maybe_throw();

// éåŒæœŸå‡¦ç†ã®å®Œäº†å¾…æ©Ÿ
this_thread::sync_wait(scope.join());
```

`maybe_throw()`é–¢æ•°ã®å‘¼ã³å‡ºã—ãŒç„¡ã„å ´åˆã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯`scope`ã«ç™»éŒ²ã•ã‚ŒãŸéåŒæœŸå‡¦ç†ãŒå®Œäº†ã™ã‚‹ã®ã‚’æœ€å¾Œã®è¡Œã®`scope.join()`ï¼ˆãŒè¿”ã™`sender`ã‚’å—ã‘ã¦ã„ã‚‹`sync_wait()`ï¼‰ã§å¾…æ©Ÿã—ã¾ã™ã€‚éåŒæœŸå‡¦ç†ãŒå®Œäº†ã™ã‚‹ã¨ãã®ãƒ–ãƒ­ãƒƒã‚¯ãŒè§£é™¤ã•ã‚Œã€ã“ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹æ™‚ã«ã€`scope` -> `scoped_data`ã®é †ã§ç ´æ£„ã•ã‚Œã‚‹ã“ã¨ã§ã€éåŒæœŸå‡¦ç†ãŒå®Œäº†ã—ãŸã“ã¨ã‚’ç¢ºèªã—ãŸã†ãˆã§ãã“ã§ä½¿ç”¨ã•ã‚Œã¦ã„ãŸãƒªã‚½ãƒ¼ã‚¹ã®è§£æ”¾ã‚’å®‰å…¨ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã—ã‹ã—ã€`maybe_throw()`é–¢æ•°ãŒä¾‹å¤–ã‚’æŠ•ã’ã¦ã„ã‚‹å ´åˆãã®ä¿è¨¼ã¯ç ´å£Šã•ã‚Œã¾ã™ã€‚`.join()`å‘¼ã³å‡ºã—å‰ï¼ˆã™ãªã‚ã¡ã€éåŒæœŸå‡¦ç†ãŒå®Œäº†ã—ã¦ã‚‹ã‹ã©ã†ã‹ã‚ã‹ã‚‰ãªã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ï¼‰ã«ä¾‹å¤–ã«ã‚ˆã£ã¦ã“ã®ã‚¹ã‚³ãƒ¼ãƒ—ã®å¤‰æ•°ãŒç ´æ£„ã•ã‚Œã‚‹ã“ã¨ã§ã€`scoped_data`ã ã‘ã§ãªã`scope`ã«å¯¾ã—ã¦ã‚‚ç”Ÿå­˜æœŸé–“å¤–ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒªã‚¹ã‚¯ãŒç”Ÿã˜ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã®å•é¡Œã®è§£æ±ºã®ãŸã‚ã«`counting_scope`ã¨éåŒæœŸã‚¿ã‚¹ã‚¯ã‚’ãƒ©ãƒƒãƒ—ã—ã¦ç®¡ç†ã™ã‚‹`let_async_scope`ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚`let_async_scope`ã®è¿”ã™`sender`ã¯æ¸¡ã•ã‚ŒãŸéåŒæœŸå‡¦ç†å†…ã§ä¾‹å¤–ãŒé€å‡ºã•ã‚Œã¦ã‚‚ã€é–¢é€£ã™ã‚‹ï¼ˆ`.nest()`ã•ã‚ŒãŸï¼‰éåŒæœŸå‡¦ç†ãŒã™ã¹ã¦å®Œäº†ã™ã‚‹ã¾ã§å®Œäº†çŠ¶æ…‹ã«ãªã‚‰ãšã€ã“ã‚Œã«ã‚ˆã£ã¦å…ˆç¨‹ã®å•é¡Œã¯èµ·ããªããªã‚Šã¾ã™ã€‚ãªãŠã€ä¾‹å¤–ã¯`sender`ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ£ãƒãƒ«ã§ä¼æ’­ã•ã‚Œã¾ã™ã€‚

```cpp
auto scope_sender = just(make_scoped_data())  // éåŒæœŸãƒªã‚½ãƒ¼ã‚¹ã‚’just()ã§æ³¨å…¥
                  | let_async_scope([](auto scope_token,  // counting_scopeã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
                                       auto& scoped_data) // éåŒæœŸãƒªã‚½ãƒ¼ã‚¹
  {
    scope_token.nest(on(exec, [scope_token, &scoped_data] {
        scope_token.nest(on(exec, [scope_token, &scoped_data] {
            if (need_more_work(scoped_data)) {
                scope_token.nest(on(exec, [&scoped_data] { do_more_work(scoped_data); }));
                scope_token.nest(on(exec, [&scoped_data] { do_more_other_work(scoped_data); }));
            }
        }));
        scope_token.nest(on(exec, [&scoped_data] { do_something_else_with(scoped_data); }));
    }));

    maybe_throw();
  });

// éåŒæœŸå‡¦ç†ã®å®Ÿè¡Œå¾…æ©Ÿ
this_thread::sync_wait(scope_sender);
```

ã¾ãŸã€`let_async_scope`ã®è¿”ã™`sender`ã«å¯¾ã™ã‚‹åœæ­¢è¦æ±‚ã¯ã€ãƒã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®`sender`ã«ä¼é”ã•ã‚Œã€ãã‚Œã‚‰ã®`sender`ãŒãã‚Œã«å¿œç­”ã—ã¦ã•ã‚‰ã«`.nest()`ã«ã‚ˆã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä½œæ¥­ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒè¨±å¯ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€ãƒã‚¹ãƒˆã—ãŸ`sender`ã¯`let_async_scope`ã®ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§ãã®ã¾ã¾å‡¦ç†ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä½œæ¥­ã‚’è¡Œã†ã“ã¨ãŒã§ãã€ãã®å ´åˆã§ã‚‚ä½¿ç”¨ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ç ´æ£„ã¯å®‰å…¨ã«ãªã•ã‚Œã¾ã™ã€‚

- [P3296 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1948)

### [P3297R0 C++26 Needs Contract Checking](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3297r0.pdf)

C++26ã§å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’å‡ºè·ã™ã¹ãã¨ã™ã‚‹ææ¡ˆã€‚

ã“ã®ææ¡ˆã®ç›®çš„ã¯

1. C++ã§æ—¥å¸¸çš„ã«å®Ÿç”¨çš„ã§å®‰å…¨æ€§ãŒé‡è¦–ã•ã‚Œã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æ›¸ã„ã¦ã„ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒã®å£°ã‚’å±Šã‘ã‚‹ã“ã¨
2. SG21ã¨EWGãŒæ´»å‹•ã®è³ªã¨å°‚é–€å®¶æ„è­˜ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®è¡Œå‹•ã‚’å‘¼ã³ã‹ã‘ã‚‹ã“ã¨
3. SG21ã¨EWGã«å¯¾ã—ã¦ã€C++26ã®ãƒ‰ãƒ©ãƒ•ãƒˆã«åŸºæœ¬çš„ãªè¦ä»¶ã‚’æº€ãŸã™æœ€å°é™ã®å®Ÿè¡Œå¯èƒ½ãªä»•æ§˜ã‚’ç››ã‚Šè¾¼ã‚€ã‚ˆã†ã«å‘¼ã³æ›ã‘ã‚‹

ãªã©ã«ã‚ã‚Šã¾ã™ã€‚ã“ã®ææ¡ˆã«ã‚ˆã‚‹æœ€å°é™ã®å®Ÿè¡Œå¯èƒ½ãªä»•æ§˜ã¨ã¯

1. é–¢æ•°ã«ä»˜éšã™ã‚‹æ§‹æ–‡
    - äº‹å‰æ¡ä»¶ã‚’å®£è¨€ã™ã‚‹
    - é™çš„è§£æãƒ„ãƒ¼ãƒ«ãŒãƒ‘ãƒ¼ã‚¹ã§ãã‚‹
2. å®Ÿè¡Œæ™‚ãƒã‚§ãƒƒã‚¯ã®æŒ¿å…¥
    - é€šå¸¸ã®C++ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ 
    - ãƒã‚§ãƒƒã‚¯å†…ã§ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒ™ãƒ«æœ€é©åŒ–ã‚’ç¦æ­¢ã™ã‚‹

ã“ã®ãŸã‚ã«ã€å§”å“¡ä¼šã«å¯¾ã—ã¦å‘¼ã³ã‹ã‘ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

- SG21
    1. å¦å®šçš„ãªæ…‹åº¦ã€ã‚ã‚‹ã„ã¯è¨€è‘‰ã«ã‚ˆã‚‹é—˜äº‰å¿ƒã¯ã€è­°è«–ã®è³ªã‚’ä½ä¸‹ã•ã›ã€è²¢çŒ®è€…ã‚’è¿½ã„å‡ºã™ã€‚ã“ã‚Œã¯ã‚‚ã¯ã‚„å®¹èªã§ããªã„
    2. æ–°ã—ã„æƒ…å ±ãªã—ã«åŒã˜è­°è«–ã‚’ç¹°ã‚Šè¿”ã™ã®ã¯æ™‚é–“ã®ç„¡é§„ã€‚èª°ã®è€ƒãˆã‚‚å¤‰ãˆã‚‰ã‚Œãªã„ã®ã§ã‚ã‚Œã°ç¹°ã‚Šè¿”ã™å¿…è¦ã¯ãªã„
    3. å„ªã‚ŒãŸæ ¹æ‹ ã‚’æŒã¤ææ¡ˆã¯äººã€…ã®å¿ƒã‚’å¤‰ãˆã‚‹ã€‚èª¬å¾—åŠ›ã®ã‚ã‚‹ææ¡ˆã‚’ç™ºè¡¨ã—ãªã„ã“ã¨ã¯ã€è‡ªèº«ã®å½±éŸ¿åŠ›ã‚’åˆ¶é™ã™ã‚‹ã“ã¨ã«ãªã‚‹
- SG22
    1. C++ã®å®‰å…¨æ€§ã¨ã¯ä½•ã‹ã«ã¤ã„ã¦ã€å¼·ã„å§¿å‹¢ã‚’ç¤ºã™
    2. EWGãŒC++ã®å®‰å…¨æ€§ã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã«ä½•ãŒã§ãã‚‹ã‹ã‚’å®šç¾©ã—ã€ãã®ç›®æ¨™ã‚’è¨­å®šã™ã‚‹
- EWG
    1. ç¾åœ¨æº€ãŸã•ã‚Œã¦ã„ãªã„å®‰å…¨æ€§ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹ãƒ‹ãƒ¼ã‚ºã¯ã€C++ã®å­˜ç«‹ã«é–¢ã‚ã‚‹å•é¡Œã§ã‚ã‚‹ã“ã¨ã‚’èªè­˜ã™ã‚‹
    2. å°‘ãªãã¨ã‚‚æ¬¡ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ã‚’å„ªå…ˆã™ã‚‹
        - é–¢æ•°ã«ä»˜éšã™ã‚‹æ§‹æ–‡
        - å®Ÿè¡Œæ™‚ãƒã‚§ãƒƒã‚¯ã®æŒ¿å…¥
    3. ç†æƒ³çš„ãªæ©Ÿèƒ½ã‚’è¿½æ±‚ã™ã‚‹ãŸã‚ã®æ©Ÿä¼šè²»ç”¨ã‚’ç†è§£ã™ã‚‹
        - ç¾åœ¨ã®C++ã‚³ãƒ¼ãƒ‰ã¯ã€å˜ç´”ãªå¥‘ç´„ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ãŒç„¡ã„ã¾ã¾ã€ä½•å¹´ã‚‚ã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‹ã‚Œã€å®Ÿè¡Œã•ã‚Œã€ç²¾æŸ»ã•ã‚Œã¦ã„ã‚‹

ã“ã®ææ¡ˆã®è‘—è€…ã®æ–¹ã¯ã€çµ„ã¿è¾¼ã¿æ¥­ç•Œãªã©å®‰å…¨æ€§ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã‚ã‚‹éƒ¨åˆ†ã§C++ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’æ‰±ã£ã¦ããŸçµŒé¨“ã‚’ã‚‚ã¨ã«ã€ç¾åœ¨ã®ç’°å¢ƒã§ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã¸ã®å®‰å…¨æ€§ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è¦ä»¶ãŒé‡è¦ã«ãªã£ã¦ãŠã‚Šã€ç¾åœ¨ã®C++ã¯ãã®ãƒ‹ãƒ¼ã‚ºã‚’ã»ã¨ã‚“ã©æº€ãŸã—ã¦ã„ãªã„ã“ã¨ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚ãã®ä¸Šã§ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒC++ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®å®‰å…¨æ€§å‘ä¸Šã«è²¢çŒ®ã™ã‚‹é‡è¦ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã‚ã‚Šã€ã“ã‚ŒãŒC++29ã«3å¹´é–“é…ã‚Œã‚‹ã“ã¨ã®æ©Ÿä¼šè²»ç”¨ãŒé«˜ã™ãã‚‹ï¼ˆãã®é–“ã«ã€Rustã‚’ã¯ã˜ã‚ã¨ã™ã‚‹ä»–ã®è¨€èªåŸºç›¤ã¸ã®ç§»è¡Œã‚’é¸æŠã•ã›ã¦ã—ã¾ã†ï¼‰ã¨ã—ã¦ã€MVPï¼ˆP2900ï¼‰ã®å…¨ä½“ã§ãªãã¦ã‚‚æœ€ä½é™ã®éƒ¨åˆ†ã‚’C++26ã«é–“ã«åˆã‚ã›ã‚‹ã¹ãã¨ã—ã¦ã„ã¾ã™ã€‚

- [P3296 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1949)

### [P3298R0 Implicit user-defined conversion functions as operator.()](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3298r0.pdf)

ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®å¤‰æ›é–¢æ•°ã¨ã—ã¦ã®`operator.()`ã®ææ¡ˆã€‚

C++ã§ã‚¹ãƒãƒ¼ãƒˆå‚ç…§ã¨ã¯ã‚¹ãƒãƒ¼ãƒˆãƒã‚¤ãƒ³ã‚¿ã®å‚ç…§ç‰ˆã®ã‚ˆã†ãªã‚‚ã®ã§ã€ãƒã‚¤ãƒ³ã‚¿ã®å‹•ä½œã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å…¬é–‹ã—ãªã„ã‚ˆã†ã«ã—ãŸåˆ¥ã®å ´æ‰€ã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ã‚­ã‚·ã‚¯ãƒ©ã‚¹ã§ã™ã€‚ã“ã®ã‚ˆã†ãªã‚‚ã®ã‚’ä½œæˆã—ã‚ˆã†ã¨ã™ã‚‹å ´åˆã€`operator.()`ãŒå¿…é ˆã«ãªã‚Šã¾ã™ã€‚

```cpp
template<class X>
class Ref {
public:
  explicit Ref(int a) :p{new X{a}} {}
  ~Ref() { delete p; }

  // operator.()ã¯ãªã„
  X& operator.() {
    /* maybe some code here */
    return *p;
  }

  void rebind(X* pp) {
    delete p;
    p = pp;
  }
  
  ...

private:
  X* p;
};

Ref<X> x{99};
x.f();    // => (x.operator.()).f()  => (*x.p).f()
x = X{9}; // => x.operator.() = X{9} => (*x.p )=X{9}

x.rebind(p); // delete old x.p and make x.p=pï¼ˆoperator.()ã‚’ä½¿ç”¨ã—ãªã„
```

ã—ã‹ã—`operator.()`ã®é©ç”¨ç¯„å›²ã«ã¯å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚1ã¤ã¯ã€ä»£å…¥æ“ä½œï¼ˆ`=`ï¼‰ã¯`.`æ¼”ç®—å­ã‚’æ˜ç¤ºçš„ã«ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ãŒ`operator.()`ã‚’å‘¼ã³å‡ºã™ã¹ãã‹ï¼Ÿï¼ˆåŒæ§˜ã®ã“ã¨ãŒå„æ¼”ç®—å­ã«è¨€ãˆã‚‹ï¼‰ã¨ã„ã†å•é¡Œã§ã‚ã‚Šã€ã‚‚ã†ä¸€ã¤ã¯ã€`.`ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã§ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè‡ªèº«ã®ãƒ¡ãƒ³ãƒï¼ˆ`Ref<T>`å‹ã®ãƒ¡ãƒ³ãƒï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã„ã„ã‹ï¼Ÿã¨ã„ã†å•é¡Œã§ã™ã€‚

`operator.()`ã¯ä»¥å‰ã‹ã‚‰ä½•åº¦ã‚‚ææ¡ˆã•ã‚Œã¦ãã¾ã—ãŸãŒã€ã“ã‚Œã‚‰ã®å•é¡Œã‚’è§£æ±ºã§ããªã‹ã£ãŸãŸã‚ã€ä½•åº¦ã‹ææ¡ˆã•ã‚Œã¦ã¯å¦æ±ºã•ã‚Œã¦ããŸã‚ˆã†ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©`.`æ¼”ç®—å­ã‚’æš—é»™å¤‰æ›ã®å»¶é•·æˆ¦ä¸Šã«å®Ÿç¾ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ`obj`ã«å¯¾ã—ã¦`obj.member()`ã®ã‚ˆã†ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†æ™‚ã€ç¾åœ¨ã§ã‚‚åŸºåº•ã‚¯ãƒ©ã‚¹ã¸ã®å¤‰æ›ã¯è€ƒæ…®ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ææ¡ˆã¯ã“ã®å¤‰æ›ä»®å®šã«ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å¤‰æ›æ¼”ç®—å­ã‚’ä½œç”¨ã•ã›ã‚‹ã“ã¨ã§`.`ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å¯èƒ½ã«ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€`implicit`æŒ‡å®šå­ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å¤‰æ›æ¼”ç®—å­ã«æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ãã®å¤‰æ›æ¼”ç®—å­ã‚’`.`ã«ã‚ˆã‚‹åŸºåº•ã‚¯ãƒ©ã‚¹ã¸ã®å¤‰æ›æ™‚ã«å€™è£œã«å…¥ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã®å ´åˆã®åå‰æ¢ç´¢ã®ãƒ«ãƒ¼ãƒ«ã¯ç¶™æ‰¿ã¨åŒæ§˜ãªã®ã§ã€äºˆæœŸã—ãªã„å¤‰æ›ãŒèµ·ã“ã‚‹å¯èƒ½æ€§ã¯ä½ããªã‚Šã¾ã™ã€‚

```cpp
// ãƒ—ãƒ­ã‚­ã‚·å‚ç…§å‹ã®ä¾‹
template<typename T>
class Proxy {
  Proxy(T& object) : m_ptr(&object) {}

  // ã“ã®ææ¡ˆã«ã‚ˆã‚‹implicitå¤‰æ›æ¼”ç®—å­
  implicit operator T&() { return *m_ptr; }
  implicit operator const T&() const { return *m_ptr; }
private:
  T* m_ptr;
};

struct MyClass {
  using Type = int;
  int x;
  void f();
  static void s();
};

void g(MyClass& o);

void test() {
  MyClass obj;

  Proxy<MyClass> p(obj);
  Proxy<MyClass>* pp = &p;
  
  p.f();    // Proxy<T>ã«ã¯.f()ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ã®ã§ã€ãã®åŸºåº•ã‚¯ãƒ©ã‚¹ã¨implicitå¤‰æ›æ¼”ç®—å­ã‚’ã®æˆ»ã‚Šå€¤å‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
  p.x = 43; // Proxy<T>ã«ã¯.xãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ã®ã§ã€ãã®åŸºåº•ã‚¯ãƒ©ã‚¹ã¨implicitå¤‰æ›æ¼”ç®—å­ã‚’ã®æˆ»ã‚Šå€¤å‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
  g(p);     // g()ã¯Proxy<T>ã‚’å—ã‘å–ã‚‰ãªã„ãŸã‚ã€ãã®åŸºåº•ã‚¯ãƒ©ã‚¹ã¨implicitå¤‰æ›æ¼”ç®—å­ã‚’ã®æˆ»ã‚Šå€¤å‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹

  // All name lookup considers names in bases and ICF return types
  // å…¨ã¦ã®åå‰æ¢ç´¢ã§ã¯ã€åŸºåº•ã‚¯ãƒ©ã‚¹ã¨implicitå¤‰æ›æ¼”ç®—å­ã®æˆ»ã‚Šå€¤å‹ã«ãŠã‘ã‚‹åå‰ãŒè€ƒæ…®ã•ã‚Œã‚‹
  Proxy<MyClass>::Type anInt;

  // operator-> ã‚‚ã¾ãŸã€åŸºåº•ã‚¯ãƒ©ã‚¹ã¨implicitå¤‰æ›æ¼”ç®—å­ã®æˆ»ã‚Šå€¤å‹ã‚’è€ƒæ…®ã™ã‚‹
  pp->f();
  pp->MyClass::f();     // å†—é•·ã ãŒè¨±å¯ã•ã‚Œã‚‹ã€‚Proxyå‹ãŒf()ã‚’å‚™ãˆã¦ã„ã‚‹å ´åˆã«ä¾¿åˆ©
  Proxy<MyClass>::s();  // åå‰æ¢ç´¢ã«ã‚ˆã£ã¦ã€MyClassã®é™çš„ãƒ¡ãƒ³ãƒé–¢æ•°s()ã‚’å‘¼ã³å‡ºã™
}
```

ã“ã®ææ¡ˆã¯`.`ã ã‘ã§ã¯ãªãã€ãƒ¡ãƒ³ãƒã‚¢ã‚¯ã‚»ã‚¹ã¨åŒæ§˜ã«åŸºåº•ã‚¯ãƒ©ã‚¹ã¸ã®å¤‰æ›ãŒè€ƒæ…®ã•ã‚Œã‚‹å ´æ‰€ã§`implicit`å¤‰æ›æ¼”ç®—å­ã®çµæœå‹ã‚’å€™è£œã¨ã—ã¦åŠ ãˆã¾ã™ã€‚ãã®ãŸã‚ã€é–¢æ•°ã¸æ¸¡ã™å ´åˆãªã©ã®æš—é»™å¤‰æ›ã‚„ã€`->`æ¼”ç®—å­ã§ã‚‚åŒæ§˜ã«`implicit`å¤‰æ›æ¼”ç®—å­ãŒä½œç”¨ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã®ä»¥å‰ã®ææ¡ˆã‹ã‚‰ã®æ”¹å–„ç‚¹ã¯

- ä»•æ§˜ã®è¤‡é›‘åŒ–ã‚’å›é¿ã™ã‚‹
  - `operator.()`ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹ç‰¹åˆ¥ãªæ§‹æ–‡ã‚’å°å…¥ã§ãšã€åå‰æ¢ç´¢ã¯åŸºåº•ã‚¯ãƒ©ã‚¹ã¸ã®å¤‰æ›ã¨åŒã˜ãƒ«ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹
      - `.`ã‚¢ã‚¯ã‚»ã‚¹ã§ãã®ã‚¯ãƒ©ã‚¹è‡ªèº«ã«è‡ªç„¶ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
      - `=`ç­‰æ¼”ç®—å­ã®å‘¼ã³å‡ºã—ã§ã‚‚ã€é–¢æ•°å‘¼ã³å‡ºã—æ™‚ã®åŸºåº•ã‚¯ãƒ©ã‚¹ã¸ã®å¤‰æ›ãƒ«ãƒ¼ãƒ«ã¨åŒæ§˜ã«æ‰±ã‚ã‚Œã‚‹
        - `.`ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ã“ã¨ã§ã€`.`ã‚’ä½¿ã£ã¦ã„ãªã„ã®ã«è€ƒæ…®ã•ã‚Œã‚‹ã€ã¨ã„ã†çŠ¶æ³ã«ãªã‚‰ãªã„
- `implicit`æŒ‡å®šå­ã®ã¿ã§ã‚·ãƒ³ãƒ—ãƒ«ã«å®Ÿç¾å¯èƒ½
  - ä»¥å‰ã®ææ¡ˆã«ã‚ã£ãŸã‚ˆã†ãªå†—é•·ãªè¨˜è¿°ã‚’å›é¿ 

ææ¡ˆã‚ˆã‚Šã€æ±ç”¨`lazy`ã‚¯ãƒ©ã‚¹ã®ä¾‹

```cpp
template<typename F>
struct lazy {
  lazy(F f) : func(std::move(f)) {}
  implicit operator decltype(auto)() { return func(); }
  F func;
};
```

ææ¡ˆã«ã¯ã“ã‚Œã‚‰ã®ã»ã‹ã«ã‚‚ã„ãã¤ã‹åˆ©ç”¨ã§ãã‚‹ã‚·ãƒ¼ãƒ³ãŒæŒ™ã’ã‚‰ã‚Œã¦ã„ã¾ã™ï¼ˆã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯ã‚ã¾ã‚Šã‚ã‚Šã¾ã›ã‚“ãŒï¼‰ã€‚

- [N4477 Operator Dot (R2)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/n4477.pdf)
- [P3298 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1950)

### [P3299R0 Range constructors for `std::simd`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3299r0.html)

`std::simd`ã«`range`ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®`std::simd`ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’1ã¤ã ã‘å—ã‘å–ã£ã¦ã€`std::simd`ã«æŒ‡å®šã•ã‚ŒãŸã‚µã‚¤ã‚ºã§ãã“ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿ã ã—ã¦æ§‹ç¯‰ã™ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒä¸»ãªã‚‚ã®ã¨ãªã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€å…¥åŠ›ã®ãƒ‡ãƒ¼ã‚¿ç¯„å›²ã®çµ‚ç«¯ã‚’çŸ¥ã‚‹æ–¹æ³•ãŒç„¡ãã€å®‰å…¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```cpp
int main() {
  float input[4] = {...};

  // ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿1ã¤ã ã‘ã‚’æ¸¡ã—ã¦åˆæœŸåŒ–
  std::simd<float, 4> simd1{input};

  // ãƒ¡ãƒ³ãƒé–¢æ•°ã«ã‚ˆã‚‹åˆæœŸåŒ–ã‚‚åŒæ§˜
  std::simd<float, 4> simd2{};
  simd2.copy_from(input);
}
```

ã“ã®ç†ç”±ã¯ã€`std::simd`ãŒä¸»ã«è¨ˆç®—ã®é«˜é€ŸåŒ–ã®ãŸã‚ã®ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€åˆæœŸåŒ–æ™‚ï¼ˆã™ãªã‚ã¡ã€SIMDãƒ¬ã‚¸ã‚¹ã‚¿ã¸ã®å€¤ã®ãƒ­ãƒ¼ãƒ‰æ™‚ï¼‰ã®ç¯„å›²ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã‚ãªã„ã“ã¨ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚ã—ã‹ã—ã€å®Ÿéš›ã®è¨ˆç®—ä¸­ã¯ã¨ã‚‚ã‹ãåˆæœŸåŒ–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ç¯„å›²ãƒã‚§ãƒƒã‚¯ã‚’ãã¡ã‚“ã¨ã—ãŸã„éœ€è¦ã‚‚ã‚ã‚Šã€ãã®å‹•ä½œï¼ˆå®‰å…¨æ€§ã‹ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‹ï¼‰ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã“ã¨ã‚’æœ›ã‚€å‘ãã‚‚ã‚ã‚Šã¾ã—ãŸã€‚

ã“ã®ææ¡ˆã¯ã€`std::simd`ã«`range`ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§å®‰å…¨ãªåˆæœŸåŒ–ã®ãŸã‚ã®é¸æŠè‚¢ã‚’ç”¨æ„ã—ã€ãªãŠã‹ã¤ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’é‡è¦–ã™ã‚‹å ´åˆã«å‹•ä½œã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã§ã¯ã€ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªç¯„å›²ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™

```cpp
template<class T, class Abi>
class basic_simd {
  ...

  // ç¾åœ¨ã‚ã‚‹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿1ã¤ã—ã‹å–ã‚‰ãªã„ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
  template<class It, class... Flags>
  constexpr basic_simd(It first, simd_flags<Flags...> = {});

  // ææ¡ˆ ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãƒšã‚¢ã‚’å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
  constexpr basic_simd(It begin, It end, simd_flags<Flags...> = {});

  // ææ¡ˆ ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã‚µã‚¤ã‚ºã‚’å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
  constexpr basic_simd(It begin, size_type count, simd_flags<Flags...> = {});

  // ææ¡ˆ å›ºå®šã‚µã‚¤ã‚ºspanã‚’ã¨ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
  constexpr basic_simd(span<T, N>, simd_flags<Flags...> = {});

  // ææ¡ˆ å‹•çš„ã‚µã‚¤ã‚ºã®ç¯„å›²ã‚’å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
  constexpr basic_simd(Range r, simd_flags<Flags...> = {});

  ...
};
```

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãã®ã‚µã‚¤ã‚ºãŒæ—¢çŸ¥ã®é…åˆ—ã‹ã‚‰å€¤ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆã€ãã®ã‚µã‚¤ã‚ºã¯å¸¸ã«ã´ã£ãŸã‚Šåˆã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ã™ãªã‚ã¡ã€ãƒ‡ãƒ¼ã‚¿ã®åˆ‡ã‚Šæ¨ã¦ã‚„æš—é»™ã®å€¤ã®è¿½åŠ ã¯è¨±å¯ã›ãšã€ãƒ—ãƒ­ã‚°ãƒ©ãƒãŒæ˜ç¤ºçš„ã«ãã‚Œã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```cpp
int main() {
  // å…¥åŠ›ã¨ã‚µã‚¤ã‚ºãŒã´ã£ãŸã‚Šã®ä¾‹
  std::array<float, 6> ad;
  std::simd<float, 6> simdA(ad);

  std::span<int, 8> sd(d.begin(), 8);
  std::simd<int, 8> simdB(sd);
  
  // å…¥åŠ›ã¨ã‚µã‚¤ã‚ºãŒåˆã‚ãªã„ä¾‹
  std::array<float, 6> ad;
  std::simd<float 8> simdA(ad); // ng

  // æ˜ç¤ºçš„ã«ãƒªã‚µã‚¤ã‚ºã—ã¦ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
  std::simd<float, 6> simdA(ad);
  auto simdA8 = resize<8>(simdA); // ok
}
```

ã¾ãŸã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚µã‚¤ã‚ºãŒæ—¢çŸ¥ã®å ´åˆã®ãŸã‚ã®æ¨è«–è£œåŠ©ã‚‚æä¾›ã§ãã¾ã™

```cpp
template <contiguous-range-with-static-extent Rg>
basic_simd(Rg)
  -> basic_simd<ranges::range_value_t<Rg>,
                deduce-t<ranges::range_value_t<Rg>, static-range-size<Rg>>>;
```

ã“ã‚Œã‚’ç”¨ã„ã‚‹ã¨ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æŒ‡å®šã‚’çœç•¥ã§ãã¾ã™ã€‚

```cpp
std::array<float, 4> data;

std::simd v = data;       // simd<float>::size()ãŒ4ã®å ´åˆã®ã¿ok
std::basic_simd w = data; // ABIã‚¿ã‚°ã‚‚æ¨è«–ã™ã‚‹
```

å…¥åŠ›ç¯„å›²ã®ã‚µã‚¤ã‚ºãŒå®Ÿè¡Œæ™‚ã¾ã§åˆ†ã‹ã‚‰ãªã„å ´åˆã€ã‚µã‚¤ã‚ºã®ãƒŸã‚¹ãƒãƒƒãƒã¯å®Ÿè¡Œæ™‚ã«ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã‚³ã‚¹ãƒˆã®ã‹ã‹ã‚‰ãªã„ã‚‚ã®ã‹ã‚‰æ¬¡ã®3ã¤ãŒã‚ã‚Šã¾ã™

1. æœªå®šç¾©å‹•ä½œã«ã™ã‚‹
2. æ­£å¸¸ã«å‡¦ç†ã•ã‚Œã‚‹å®šç¾©æ¸ˆã¿å‹•ä½œã«ã™ã‚‹
    - å¤šã„å ´åˆã¯åˆ‡ã‚Šæ¨ã¦ã€å°‘ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
3. ä¾‹å¤–ã‚’é€å‡ºã™ã‚‹

ã“ã‚Œã‚‰ã®3ã¤ã«å¯¾å¿œã•ã›ãŸãƒ•ãƒ©ã‚°ï¼ˆ`simd_unchecked, simd_default_init, simd_exception`ï¼‰ã‚’ç”¨æ„ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠå¯èƒ½ã«ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ãŒã€ãã‚Œã§ã‚‚ãªãŠãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’é¸æŠã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ææ¡ˆã§ã¯ã€1ã‹2ã®ã©ã¡ã‚‰ã‹ã‚’é¸æŠã™ã‚‹ã“ã¨ã«ãªã‚‹ã ã‚ã†ã¨è¿°ã¹ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã¾ã ã€ææ¡ˆã¨ã„ã†ã‚ˆã‚Šã¯æ–¹å‘æ€§ã‚’æ¢ã‚‹æ®µéšã§ã™ã€‚

- [P3299 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1951)

### [P3301R0 `inplace_stoppable_base`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3301r0.html)

P2300ã®`inplace_stop_callback`ã«ä»£ã‚ã‚‹`inplace_stoppable_base`ã®ææ¡ˆã€‚

ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒˆãƒ¼ã‚¯ãƒ³ã€ç‰¹ã«`std::inplace_stop_token`ã‚’ä½¿ç”¨ã—ã¦ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ“ä½œã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸã„`sender`ã§ã¯ã€ãã®`operation_state`ï¼ˆ`receiver`ã¨æ¥ç¶šã•ã‚ŒãŸå¾Œã®ã‚‚ã®ï¼‰ã¸ã®å‚ç…§ã‚’å«ã‚€`std::inplace_stop_callback`ãƒ¡ãƒ³ãƒã‚’`operation_state`å‹ã¸è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚


```cpp
// è‡ªä½œsenderå‹ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ“ä½œã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸã„
class my_sender {

  // my_senderã®ãŸã‚ã®operation_stateå‹
  template<typename R>
  class op_state {
    R receiver;

    // ã‚­ãƒ£ãƒ³ã‚»ãƒ«å—ä»˜ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹
    class cb_t {
      op_state& op;
    public:
      cb_t(op_state& op)
        : op(op) {}
      void operator()() const {
        op.on_stop_requested();
      }
    };

    // inplace_stop_callbackã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    std::inplace_stop_callback<cb_t> cb;  // ã‚µã‚¤ã‚ºã¯éã‚¼ãƒ­

    // ã‚­ãƒ£ãƒ³ã‚»ãƒ«è¦æ±‚ã‚’å—ã‘ãŸæ™‚ã®å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹
    void on_stop_requested();
  };
};
```

`inplace_stop_callback`ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«è¦æ±‚ã‚’å—ã‘ãŸå ´åˆã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä¿æŒã—ã¦ãŠããŸã‚ã®ã‚‚ã®ã§ã™ã€‚ãŸã ã€ã“ã®ã‚ˆã†ãªå®Ÿè£…æ–¹æ³•ã ã¨`operation_state`å‹ã«åƒ…ã‹ã§ã¯ã‚ã‚‹ã‚‚ã®ã®ã‚¹ãƒšãƒ¼ã‚¹ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒç”Ÿã˜ã¾ã™ã€‚

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å®Ÿè£…ã¯ã“ã®ã‚³ã‚¹ãƒˆã‚’å›é¿ã§ãã‚‹å ´åˆãŒã‚ã‚‹ã‚ˆã†ã§ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®`sender`å®Ÿè£…ã§ã¯ãã‚Œã¯ã§ãã¾ã›ã‚“ã€‚ã“ã®ææ¡ˆã¯ã€CRTPã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ`inplace_stop_token`ã‚’è¿½åŠ ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚ã“ã®å•é¡Œã‚’å›é¿ã§ãã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã¨å…ˆç¨‹ã®ä¾‹ã¯å¤§å¹…ã«ç°¡ç•¥åŒ–ã•ã‚Œã€ã•ã‚‰ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å–ã‚Šé™¤ãã“ã¨ãŒã§ãã¾ã™ã€‚

```cpp
class my_sender {

  // inplace_stop_tokenã‚’ä½¿ã£ãŸoperation_stateå®Ÿè£…
  template<typename R>
  class op_state : std::inplace_stoppable_base<op_state<R>> {
    R receiver;

    // invoked upon request for cancellation.
    void on_stop_requested();
  };
};
```

`inplace_stoppable_base`ã®å”¯ä¸€ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯`protected`ã§ã€`inplace_stop_token`å‹ã®å¼•æ•°1ã¤ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

`std::inplace_stoppable_base<D>`ã‚’CRTPã§æ´¾ç”Ÿã™ã‚‹ã“ã¨ã§`operation_state`å‹ã‚’æ§‹æˆã™ã‚‹ã“ã¨ãŒã§ãã€ã“ã®å ´åˆã«`inplace_stop_token`çµŒç”±ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãŒé€šçŸ¥ã•ã‚Œã‚‹ã¨ã€`on_stop_requested()`ãŒæ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚

- [1952 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1951)

### [P3302R0 SG16: Unicode meeting summaries 2024-03-13 through 2024-05-08](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3302r0.html)

SG16ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è­°äº‹éŒ²ã€‚

2024å¹´3æœˆã‹ã‚‰5æœˆã«ã‹ã‘ã¦ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§è¡Œã‚ã‚ŒãŸSG16ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è­°äº‹éŒ²ã§ã€ã©ã‚“ãªå†…å®¹ã®è©±ã‚’ã—ãŸã‹ã‚„èª°ãŒã©ã‚“ãªç™ºè¨€ã‚’ã—ãŸã‹ãªã©ãŒè©³ç´°ã«è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P3303R0 Fixing Lazy Sender Algorithm Customization](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3303r0.html)

P2999ã®ææ¡ˆã®æ¬ ã‘ã¦ã„ãŸéƒ¨åˆ†ã‚’åŸ‹ã‚ã‚‹ææ¡ˆã€‚

P2999ã«ã¤ã„ã¦ã¯ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2999R3 Sender Algorithm Customization - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/02/29/191439#P2999R3-Sender-Algorithm-Customization)

P2999ã§ã¯ææ¡ˆä¸­ã§è§¦ã‚Œã‚‰ã‚Œã¦ã¯ã„ãŸã‚‚ã®ã®ã€`connect`ãŠã‚ˆã³`get_completion_signatures`ã«å¯¾ã™ã‚‹å¤‰æ›´ã«ã¤ã„ã¦å¿…è¦ãªæ–‡è¨€ãŒæŠœã‘è½ã¡ã¦ã„ãŸã‚ˆã†ã§ã™ã€‚ã“ã®ææ¡ˆã¯ã€ãã‚Œã‚’æ‹¾ã„ä¸Šã’ã¦è£œå®Œã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã®å¤‰æ›´ã¯æ¬¡ã®2ç‚¹ã§ã™

- `get_completion_signatures(sndr, env)`
    - ã¾ãšã€`transform_sender(get-domain-late(sndr, env), sndr, env)`ã‚’ä½¿ç”¨ã—ã¦å…¥åŠ›ã®`sender`ï¼ˆ`sndr`ï¼‰ã‚’å¤‰æ›ã—ã€æ¬¡ã®ãã®çµæœã‚’`sndr`ã®ä»£ã‚ã‚Šã«ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹
- `connect(sndr, rcvr)`
    - ã¾ãšã€`transform_sender(get-domain-late(sndr, get_env(rcvr)), sndr, get_env(rcvr))`ã‚’ä½¿ç”¨ã—ã¦å…¥åŠ›ã®`sender`ï¼ˆ`sndr`ï¼‰ã‚’å¤‰æ›ã—ã€æ¬¡ã®ãã®çµæœã‚’`sndr`ã®ä»£ã‚ã‚Šã«ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹

ã“ã‚Œã¯P2999R3ã§ã™ã§ã«è­°è«–ã•ã‚Œã€æ±ºå®šã•ã‚Œã€LEWGã§æ¡æŠã•ã‚ŒãŸè¨­è¨ˆã«æ²¿ã†ã‚‚ã®ã§ã™ã€‚ã—ã‹ã—ã€P2999R3ã§ã¯ãã‚Œã‚’æ¨™æº–ï¼ˆæ­£ç¢ºã«ã¯P2300ï¼‰ã«é©ç”¨ã™ã‚‹ãŸã‚ã®æ–‡è¨€ãŒæŠœã‘è½ã¡ã¦ã„ã¾ã—ãŸï¼ˆã†ã£ã‹ã‚ŠãƒŸã‚¹ã®ã‚ˆã†ã§ã™ï¼‰ã€‚ã“ã®ææ¡ˆã¯ãã‚Œã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã€è¨­è¨ˆå¤‰æ›´ãªã©ã¯è¡Œã‚ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã¯2024å¹´7æœˆã«è¡Œã‚ã‚ŒãŸå…¨ä½“ä¼šè­°ã§æ‰¿èªã•ã‚Œã€C++26WDã«é©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P3303 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1954)

### [P3304R0 SG14: Low Latency/Games/Embedded/Financial Trading virtual Meeting Minutes 2024/04/10](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3304r0.pdf)

2024å¹´4æœˆ10æ—¥ã«è¡Œã‚ã‚ŒãŸã€SG14ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è­°äº‹éŒ²ã€‚

ã©ã®ã‚ˆã†ãªã“ã¨ã‚’è­°è«–ã—ãŸã®ã‹ãŒç°¡å˜ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P3305R0 SG19: Machine Learning virtual Meeting Minutes to 2024/04/11-2024/05/09](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3305r0.pdf)
### [P3306R0 Atomic Read-Modify-Write Improvements](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3306r0.html)

`std::atomic`ã®Read-Modify-Writeã«ã€æ•°å€¤å‹ã®æ¼”ç®—ã«ã¤ã„ã¦ã®APIã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

Read-Modify-Writeï¼ˆRMWï¼‰æ“ä½œã¨ã¯ã€1æ“ä½œã§å€¤ã®èª­ã¿å‡ºã—ãƒ»å€¤ã®æ›´æ–°ãƒ»æ›´æ–°å€¤ã®æ›¸ãè¾¼ã¿ã‚’è¡Œã†æ“ä½œã®äº‹ã§ã€æ•´æ•°å‹ãƒ»æµ®å‹•å°æ•°ç‚¹æ•°å‹ã®`std::atomic`ç‰¹æ®ŠåŒ–ã«å­˜åœ¨ã™ã‚‹`fetch_add`ã‚„`+=`ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹æ“ä½œãŒè©²å½“ã—ã¾ã™ã€‚

ãŸã ã—ã€æµ®å‹•å°æ•°ç‚¹æ•°å‹ã®å ´åˆã¯`+= -=`ã«ç›¸å½“ã™ã‚‹ã‚‚ã®ã—ã‹ç”¨æ„ã•ã‚Œã¦ãŠã‚‰ãšã€æ•´æ•°å‹ã®å ´åˆã§ã‚‚åŠ æ¸›ç®—ã¨æœ€ä½é™ã®ãƒ“ãƒƒãƒˆæ¼”ç®—ãã‚‰ã„ã—ã‹ç”¨æ„ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã¯ã€`std::atomic`ã®RMWæ“ä½œã¨ã—ã¦é€šå¸¸ã®æ¼”ç®—ã«å¯¾å¿œã™ã‚‹ã‚‚ã®ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã“ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã®ã¯æ¬¡ã®ã‚‚ã®ã§ã™

- æ•´æ•°å‹
  - `shl` : å·¦ã‚·ãƒ•ãƒˆ
  - `shr` : å³ã‚·ãƒ•ãƒˆ
  - `mod` : å‰°ä½™
  - `nand` : ãƒ“ãƒƒãƒˆæ¯ã®NAND
  - `div` : å‰²ã‚Šç®— `/=`
  - `mul` : æ›ã‘ç®— `*=`
- æµ®å‹•å°æ•°ç‚¹æ•°å‹
  - `div` : å‰²ã‚Šç®— `/=`
  - `mul` : æ›ã‘ç®— `*=`

ææ¡ˆã•ã‚Œã¦ã„ã‚‹APIã¯ã€`std::atomic`ã®ãƒ¡ãƒ³ãƒé–¢æ•°åŠã³ãƒ•ãƒªãƒ¼é–¢æ•°ã®2ç¨®é¡ã§ã™ã€‚

ã“ã‚Œã‚‰ã®æ“ä½œã¯ã€Kokkosã®`atomic_fetch_<op>`ã‚„Rustã®ã‚¢ãƒˆãƒŸãƒƒã‚¯APIã§åˆ©ç”¨å¯èƒ½ã§ã‚ã‚Šã€ã“ã‚Œã‚‰ãŒç„¡ã„å ´åˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯`std::atomic`ã®ä¸Šã«CASãƒ«ãƒ¼ãƒ—ãªã©ã‚’åˆ©ç”¨ã—ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€ãã‚Œã¯æœ€é©åŒ–ã‚„é€²è¡Œä¿è¨¼ã‚’å¦¨ã’ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

- [P3306 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1957)

### [P3307R0 Floating-Point Maximum/Minimum Function Objects](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3307r0.html)

æµ®å‹•å°æ•°ç‚¹æ•°å‹ãŒæœ€å¤§å€¤ãƒ»æœ€å°å€¤ã‚’æ±‚ã‚ã‚‹C23æº–æ‹ ã®é–¢æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

C++ã®æµ®å‹•å°æ•°ç‚¹æ•°å‹ã®`max()/min()`ã«é–¢ã™ã‚‹å•é¡Œç‚¹ã«ã¤ã„ã¦ã¯ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P3008R0 Atomic floating-point min/max - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P3008R0-Atomic-floating-point-minmax)

æµ®å‹•å°æ•°ç‚¹æ•°å€¤ã®åˆ—ã«å¯¾ã—ã¦ã€æœ€å¤§å€¤ã‚„æœ€å°å€¤ã‚’æ±‚ã‚ã‚‹æ“ä½œã¯éå¸¸ã«ä¸€èˆ¬çš„ã§ã™ã€‚ãã‚Œã¯é«˜æ€§èƒ½ç§‘å­¦è¨ˆç®—ã§ã‚‚åŒæ§˜ã§ã‚ã‚Šã€ãã“ã§ã¯ä¸¦åˆ—`std::reduce`ã‚„`std::transform_reduce`ã‚’ä½¿ç”¨ã—ã¦ãã‚ŒãŒè¡Œã‚ã‚Œã€ãã®ã‚ˆã†ãªç‰¹å®šã®æ¼”ç®—ã¯HWã«ã‚ˆã‚‹æœ€é©åŒ–ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚ã—ã‹ã—ã€C++ã®`std::(ranges)::min/max`ã¯IEE754æ¨™æº–ã«å¾“ã£ã¦ã„ãªã„ã‚‚ã®ã—ã‹ãªãã€HWå‘½ä»¤ãŒå¾“ã£ã¦ã„ã‚‹çµæœã‚’è¿”ã™å ´åˆã«ãã®ã‚ˆã†ãªæœ€é©åŒ–ã‚’åˆ©ç”¨ã§ããªããªã‚Šã¾ã™ã€‚

```cpp
#include <cassert>
#include <execution>
#include <numeric>
#include <ranges>

int main() {
  double data[] = {2, 1, 4, 3};
  double max = std::reduce(
    std::execution::par,
    data, data + 5,
    0,
    // HWã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã§ããªã„
    std::ranges::max
  );
  assert(max == 4);
  return 0;
}
```

ã“ã®ææ¡ˆã¯ã€ãã®ã‚ˆã†ãªäº‹æ…‹ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã€IEE754ã«æº–æ‹ ã—ãŸC23ã®APIã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸæµ®å‹•å°æ•°ç‚¹æ•°å‹ã®æœ€å¤§ãƒ»æœ€å°å€¤ã‚’å¾—ã‚‹é–¢æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã§ã™ã€‚

è¿½åŠ ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã®ã¯ã€æ¬¡ã®6ã¤ã§ã™

```cpp
namespace std {
  struct fmin_t;
  struct fmax_t;
  struct fminimum_t;
  struct fmaximum_t; 
  struct fminimum_num_t;
  struct fmaximum_num_t; 
}
```

ã“ã‚Œã‚‰ã®é–¢æ•°å‘¼ã³å‡ºã—æ¼”ç®—å­ã¯å¯¾å¿œã™ã‚‹C23ã®APIã‚’å‘¼ã³å‡ºã™ã ã‘ã®ã‚‚ã®ã§ã™ã€‚

```cpp
#include <cassert>
#include <execution>
#include <functional>
#include <numeric>

int main() {
  double data[] = {2., 1, 4, 3};
  double max = std::reduce(
    std::execution::par,
    data, data + 5,
    0,
    // HWã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚‹
    std::fmaximum_num_t{}
  );
  assert(max == 4);
  return 0;
}
```

- [P3307 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1958)

### [P3308R0 `mdarray` design questions and answers](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3308r0.html)

`mdarray`ã®è¨­è¨ˆã¸ã®ç–‘å•ç‚¹ã¨å›ç­”ã‚’ã¾ã¨ã‚ãŸæ–‡æ›¸ã€‚

ã“ã‚Œã¯ã€LEWGã«ãŠã‘ã‚‹P1684R5ï¼ˆ`mdarray`ï¼‰ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ãŠã„ã¦æŒ‡æ‘˜ã•ã‚ŒãŸç–‘å•ç‚¹ãªã©ã«å¿œãˆã‚‹ã‚‚ã®ã§ã™ã€‚

P1684ã«ã¤ã„ã¦ã¯ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1684R5 mdarray: An Owning Multidimensional Array Analog of mdspan - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P1684R5-mdarray-An-Owning-Multidimensional-Array-Analog-of-mdspan)

ã“ã“ã§å ±å‘Šã•ã‚Œã¦ã„ã‚‹è­°è«–ã¨ãã®å¯¾å¿œã‚’ã–ã£ã¨ã¾ã¨ã‚ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

- LEWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®è¦æ±‚
    - ï¼ˆå¤šæ¬¡å…ƒã‹ã‚‚ã—ã‚Œãªã„ï¼‰Cé…åˆ—ã‹ã‚‰ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®è¿½åŠ ã‚’æ¤œè¨ã™ã‚‹
        - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨æ¨è«–è£œåŠ©ã‚’è¿½åŠ ã™ã‚‹
    - `in_place_t`ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆå¼•æ•°ã‚’å†…éƒ¨ã‚³ãƒ³ãƒ†ãƒŠã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¸è»¢é€ã™ã‚‹ï¼‰ã®è¿½åŠ ã®æ¤œè¨
        - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨æ¨è«–è£œåŠ©ã‚’è¿½åŠ ã™ã‚‹
    - åˆæœŸåŒ–å­ãƒªã‚¹ãƒˆã‹ã‚‰ã®æ§‹ç¯‰ã«ã¤ã„ã¦è­°è«–ã™ã‚‹
        - å¤šæ¬¡å…ƒãƒã‚¹ãƒˆã—ãŸåˆæœŸåŒ–å­ãƒªã‚¹ãƒˆã‹ã‚‰ã®æ§‹ç¯‰ã¨æ¨è«–è£œåŠ©ã®è¿½åŠ ã‚’æ¤œè¨ã™ã‚‹
- LEWGãŒè¦æ±‚ã—ãŸæ”¹è¨‚
    - æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒã‚¯ãƒ­è¿½åŠ 
        - å¯¾å¿œäºˆå®š
    - `mdarray`ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–¹æ³•ã®èª¬æ˜
        - `mdspan`ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ä¹—ã£ã‹ã‚‹ã“ã¨ã§é©åˆ‡ã«å¯¾å‡¦å¯èƒ½
    - ç„¡åŠ¹ãªçŠ¶æ…‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½¿ç”¨ã‚’å›é¿ã™ã‚‹ãŸã‚ã®äº‹å‰æ¡ä»¶
        - å¯¾å¿œäºˆå®š
- ãã®ä»–ã®ãƒˆãƒ”ãƒƒã‚¯
    - `mdspan`ã‚’å—ã‘å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§å¤šæ¬¡å…ƒã‚³ãƒ”ãƒ¼ã‚’ä¸¦åˆ—åŒ–ã™ã‚‹ãŸã‚ã«ã€`ExecutionPolicy&&`ã‚’å–ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹
        - ä¸€æ–¹ã€`in_place_t`ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ`mdspan`ã‹ã‚‰åŠ¹ç‡çš„ã«æ§‹ç¯‰ã§ãã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’æŒã£ã¦ã„ã‚‹å ´åˆã«ã€ãã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”¨ã„ã¦`mdspan`ã‹ã‚‰`mdarray`ã®æ§‹ç¯‰ã‚’è¡Œã†ã“ã¨ã§ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œã¯è§£æ¶ˆã•ã‚Œã‚‹
    - ã‚³ãƒ³ãƒ†ãƒŠã‚¢ãƒ€ãƒ—ã‚¿ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã¸ã®è¨­è¨ˆå¤‰æ›´
        - å¤‰æ›´ã®ç†ç”±ã¯ç¾çŠ¶ã‚’ä¸Šå›ã‚‰ãªã„ï¼ˆ`mdarray`ã¯ã‚³ãƒ³ãƒ†ãƒŠã‚¢ãƒ€ãƒ—ã‚¿ã®ã¾ã¾ã§ã‚ã‚‹ã¹ãï¼‰

æ–‡æ›¸ã§ã¯å„é …ç›®ã«ã¤ã„ã¦ã‚ˆã‚Šè©³ç´°ã«èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P3309R0 `constexpr` `atomic` and `atomic_ref`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3309r0.html)

`std::atomic/stomic_ref`ã‚’`constexpr`åŒ–ã™ã‚‹ææ¡ˆã€‚

ã“ã®ææ¡ˆã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã¨å®Ÿè¡Œæ™‚ã§ã‚ˆã‚Šå¤šãã®ã‚³ãƒ¼ãƒ‰ã‚’å…±é€šåŒ–ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã™ã€‚ãã®ãŸã‚ã«ã€`std::atomic/stomic_ref`ã®`volatile`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŠã‚ˆã³é€šçŸ¥ãƒ»å¾…æ©Ÿé–¢æ•°ã‚’é™¤ãã»ã¨ã‚“ã©ã®ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’`constexpr`æŒ‡å®šã—ã¾ã™ã€‚

ã¨ã¯ã„ãˆã€ä»Šã®ã¨ã“ã‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã¯ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ¦‚å¿µãŒç„¡ãå¸¸ã«ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚¢ãƒˆãƒŸãƒƒã‚¯ãªå‹•ä½œãŒå¿…è¦ã«ãªã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ææ¡ˆã§ã¯ã€`if consteval`ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã¯é€šå¸¸ã®éã‚¢ãƒˆãƒŸãƒƒã‚¯ãªå‹•ä½œã‚’ã™ã‚‹ã‚ˆã†ã«åˆ†å²ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

`atomic_fetch_add()`ã®å®Ÿè£…ä¾‹

```cpp
template<class T>
constexpr T atomic_fetch_add(atomic<T>* target, typename atomic<T>::difference_type diff) noexcept {
	if consteval {
		const auto previous = target->value;
		target->value += diff;
		return previous;
	} else {
		__atomic_fetch_add(target->value, diff);
	}
}
```

ææ¡ˆæ–‡æ›¸ã‚ˆã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

```cpp
constexpr bool process_first_unprocessed(std::atomic<size_t> & counter, std::span<cell> subject) {
	// BEFORE: å®šæ•°å¼ã ã¨ã“ã“ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
	// AFTER: å®šæ•°å¼ã§ã‚‚å‹•ä½œã™ã‚‹
	const size_t current = counter.fetch_add(1); 
	
	if (current >= subject.size()) {
		return false;
	}
	
	process(subject[current]);
	return true;
}

constexpr void process_all(std::span<cell> subject, unsigned thread_count = 1) {
	// BEFORE: å®šæ•°å¼ã§ã“ã“ã«åˆ°é”ã™ã‚‹ã¨ã€thread_countã«é–¢ã‚ã‚‰ãšã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
	// AFTER: å®šæ•°è©•ä¾¡ã‚³ãƒ¼ãƒ‰ã§ã‚‚ã€thread_count == 1ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„
	std::atomic<size_t> counter{0};
	auto threads = std::vector<std::jthread>{};
	
	assert(thread_count >= 1);
	
	for (unsigned i = 1; i < thread_count; ++i) {
		threads.emplace_back([&]{
			while (process_first_unprocessed(counter, subject));
		});
	}
	
	while (process_first_unprocessed(counter, subject));
}
```

- [P3309 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1960)

### [P3310R0 Solving partial ordering issues introduced by P0522R0](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3310r0.html)

P0552R0ã®å½±éŸ¿ã‚’ç·©å’Œã™ã‚‹ãŸã‚ã®ææ¡ˆã€‚

P0552R0ã¯C++17ã«æ¡ç”¨ã•ã‚ŒãŸã‚‚ã®ã§ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨é€šå¸¸ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®éƒ¨åˆ†ç‰¹æ®ŠåŒ–ã«ã‚ˆã£ã¦ãƒãƒƒãƒãƒ³ã‚°ã™ã‚‹éš›ã®ä¸€è‡´ã®ãƒ«ãƒ¼ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ãŸã ã—ã“ã®ææ¡ˆã¯å‰¯ä½œç”¨ãŒå¤§ããã€ä»¥å‰ã«æœ‰åŠ¹ã§ã‚ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–ã—ã¦ã—ã¾ã£ã¦ã„ã¾ã—ãŸã€‚

ã“ã®ææ¡ˆã¯ã€ãã‚Œã«å¯¾å‡¦ã™ã‚‹ãŸã‚ã«ã€å¤ã„ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œã‚’ç¶­æŒã™ã‚‹ã‚ˆã†ã«ãã®ãƒ«ãƒ¼ãƒ«ã‚’ä¿®æ­£ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã§ã¯2ã¤ã®å€‹åˆ¥ã®å•é¡Œã®ä¾‹ã¨ã€ãã‚Œã«å¯¾ã™ã‚‹è§£æ±ºç­–ãŒææ¡ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

1ã¤ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¼•æ•°ã‚’æŒã¤ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å¯¾ã™ã‚‹éƒ¨åˆ†ç‰¹æ®Šã®ãƒãƒƒãƒãƒ³ã‚°ã«é–¢ã—ã¦ã§ã™ã€‚

```cpp
template<class T1>
struct A;

template<template<class T2> class TT1, class T3>
struct A<TT1<T3>>; // #1

template<template<class T4, class T5> class TT2, class T6, class T7>
struct A<TT2<T6, T7>> {}; // #2

template<class T8, class T9 = float>
struct B;

template struct A<B<int>>;
```

P0552R0ä»¥å‰ã¯ã€#2ã®ã¿ãŒå€™è£œã¨ã—ã¦è€ƒæ…®ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚`B`ã«ã¯2ã¤ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Šã€#1ã«ã¯1ã¤ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã—ã‹ç‰¹æ®ŠåŒ–ã•ã‚Œã¦ã„ãªã‹ã£ãŸãŸã‚ã§ã™ã€‚

ã—ã‹ã—ã€P0552R0ã«ã‚ˆã£ã¦#1ã‚‚è€ƒæ…®ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯ã€`A<TT1<T3>>`ã§`TT1`ã«`B`ã‚’å•é¡Œãªãå½“ã¦ã¯ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ãŸã‚ã§ã™ã€‚
ãŸã ã—ã€éƒ¨åˆ†ç‰¹æ®ŠåŒ–ã«ãŠã‘ã‚‹é †åºä»˜ã‘ã§ã¯ã€`B`ã«ã‚¢ã‚¯ã‚»ã‚¹ã›ãšã«å€™è£œè‡ªä½“ã®ã¿ã‚’è€ƒæ…®ã—ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã®ä¾‹ã§`TT1`ãŒ2ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒã¤ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ç½®ãæ›ã‚ã£ãŸã¨ã—ã¦ã‚‚ã€å‹•ä½œã™ã‚‹ã‹ã¯æ˜ç™½ã§ã¯ã‚ã‚Šã¾ã›ã‚“

ã“ã®ææ¡ˆã§ã¯ã€#2ã‚’é¸å®šã™ã‚‹ã¨ã„ã†ä»¥å‰ã®å‹•ä½œã‚’ç¶­æŒã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

2ã¤ç›®ã¯ã€

```cpp
template<template<class ...T1s> class TT1>
struct A {};

template<class T2>
struct B;

template struct A<B>; // #1

template<template<class T3> class TT2>
struct C {};

template<class ...T4s>
struct D;

template struct C<D>; // #2
```

P0552R0ä»¥å‰ã¯#1ã¯æœ‰åŠ¹ã§#2ã¯ç„¡åŠ¹ã§ã—ãŸãŒã€P0552R0ä»¥å¾Œã§ã¯#1ã¯æœ‰åŠ¹ãªã¾ã¾#2ã‚‚æœ‰åŠ¹ã¨ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã ã‘ã ã¨å•é¡ŒãŒç„¡ã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€ä¼¼ãŸã‚ˆã†ãªå ´åˆã®é †åºä»˜ã‘ã‚’è¦‹ã¦ã‚‹ã¨

```cpp
template<class T1>
struct A;

template<template<class ...T2s> class TT1, class T3>
struct A<TT1<T3>>; // #1

template<template<class T4> class TT2, class T5>
struct A<TT2<T5>> {}; // #2

template<class T6> struct B;
template struct A<B<int>>;
```

P0552R0ä»¥å‰ã¯#2ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€P0552R0ã«ã‚ˆã£ã¦ã“ã‚Œã¯æ›–æ˜§ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ç ´å£Šçš„å¤‰æ›´ã§ã‚ã‚Šæœ›ã¾ã—ããªãŸã„ã‚ã€å†ã³#2ãŒé¸æŠã•ã‚Œã‚‹ã‚ˆã†ã«èª¿æ•´ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ææ¡ˆã«ã¯ã‚‚ã†å°‘ã—è©³ã—ã„èª¬æ˜ãŒè¼‰ã£ã¦ã„ã¾ã™ã€‚

- [P3310 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1961)

### [P3311R0 An opt-in approach for integration of traditional assert facilities in C++ contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3311r0.html)

C`assert`ã‚’å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«çµ±åˆã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã§ã¯ã€å¾“æ¥ã®`assert`ãƒã‚¯ãƒ­ã®å½¹å‰²ã«ç›¸å½“ã™ã‚‹ã‚‚ã®ã¨ã—ã¦`contract_assert`ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚`assert`ã¨ã„ã†åå‰ã‚’ä½¿ç”¨ã§ããªã‹ã£ãŸãŸã‚åå‰ãŒç•°ãªã‚Šã¾ã™ãŒã€`assert`ãƒã‚¯ãƒ­ã®å•é¡Œç‚¹ã‚’ä¿®æ­£ã—ã¦ã„ã¾ã™ã€‚

`contract_assert`ã«å¯¾ã™ã‚‹C`assert`ã®å•é¡Œç‚¹ã¯æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã§ã™

- `NDEBUG`ã®å®šç¾©ã®æœ‰ç„¡ã§ODRã®çµæœãŒå¤‰ã‚ã‚‹
    - `contract_assert`ã¯ignoreã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®å ´åˆã§ã‚‚ODRã®çµæœãŒå¤‰ã‚ã‚‰ãªã„
- å˜ãªã‚‹ãƒã‚¯ãƒ­ã§ã‚ã‚‹ãŸã‚ã€ä»»æ„ã®å ´æ‰€ã§å†å®šç¾©ã•ã‚Œã†ã‚‹
    - `contract_assert`ã¯ãƒã‚¯ãƒ­ã§ã¯ãªãæ–‡ã§ã‚ã‚Šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
- ã‚«ãƒ³ãƒãŒã‚ã‚‹ã¨ãƒã‚°ã‚‹å ´åˆãŒã‚ã£ãŸ
    - ã“ã‚Œã¯ã€C/C++åŒæ–¹ã§P2264R7ã«ã‚ˆã£ã¦è§£æ¶ˆæ¸ˆ
    - `contract_assert`ã¯ãƒã‚¯ãƒ­ã§ã¯ãªãã€æ§‹æ–‡çš„ã«ã‚‚å¼ã‚’å—ã‘å–ã‚‹
- ä»»æ„ã®å‰¯ä½œç”¨ã‚’ãƒˆãƒªã‚¬ãƒ¼ã§ãã‚‹
    - `contract_assert`ã®å ´åˆã€å‚ç…§ã™ã‚‹ã‚‚ã®ã®æš—é»™`const`åŒ–ã‚„è©•ä¾¡å›æ•°ã®ä¸å®šæ€§ãªã©ã§å¯¾å‡¦ã—ã¦ã„ã‚‹

ãŸã ã€ã“ã‚Œã‚‰ã®ã“ã¨ã«ã‚ˆã£ã¦`contract_assert`ã¨`assert`ã®é–“ã«ã¯äº’æ›æ€§ãŒãªãã€å˜ç´”ã«ç§»è¡ŒãŒã§ããªã„éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚ç‰¹ã«ã€æœ€å¾Œã®å‰¯ä½œç”¨ã®å®Ÿè³ªç¦æ­¢ã®ãŸã‚ã®ä»•çµ„ã¿ã«é–¢ã—ã¦ã¯ã€`contract_assert`ãŒC`assert`ã®å®Œå…¨ãªä»£æ›¿ã¨ãªã‚Šå¾—ãªã„ã¨è€ƒãˆã‚‰ã‚Œã¦ã—ã¾ã†éƒ¨åˆ†ã«ãªã£ã¦ã„ã¾ã™ã€‚

å¾“æ¥ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¯`assert`ã‚‚ã—ãã¯ä¼¼ãŸã‚ˆã†ãªä»•çµ„ã¿ã«ã‚ˆã‚‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã‚‰ã®æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’C++26ç§»è¡Œã«ä¼´ã£ã¦æ›¸ãç›´ã™ã“ã¨ã‚’æœŸå¾…ã—ãŸã‚Šè¦æ±‚ã—ãŸã‚Šã™ã‚‹ã®ã¯ç¾å®Ÿçš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ©Ÿæ¢°çš„ã«ï¼ˆå˜ç´”ãªãƒ†ã‚­ã‚¹ãƒˆç½®æ›ãªã©ã«ã‚ˆã£ã¦ï¼‰ç§»è¡ŒãŒã§ããªã„å ´åˆã€C++26ç§»è¡Œã®ä¸–ç•Œã§ã¯ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã¨ã—ã¦ã“ã®2ã¤ãŒä¸¦ç«‹ã™ã‚‹ã“ã¨ã«ãªã‚Šã€ãã®æ•™è‚²ã‚„å­¦ç¿’ã®ã‚³ã‚¹ãƒˆä¸Šæ˜‡ã«ã‚‚ã¤ãªãŒã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã‚ªãƒ—ãƒˆã‚¤ãƒ³æ–¹å¼ã«ã‚ˆã£ã¦C`assert`ã‚’å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«çµ„ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€`contract_assert`ã®å¤‰æ›´ã‚’å¿…è¦ã¨ã™ã‚‹ã“ã¨ãªãå¾“æ¥ã®`assert`ã‚’ã»ã¼ãã®ã¾ã¾å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«ç§»è¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚

ææ¡ˆã§ã¯ã¾ãšã€`contract_assert`ã®æ§‹æ–‡ã‚’æ‹¡å¼µã—ã¦ã€æ–‡è„ˆä¾å­˜ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰`traditional`ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```cpp
contract_assert traditional (...);
```

ã“ã®å ´åˆã®`contract_assert`ã¯å‹•ä½œãŒæ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã•ã‚Œã¾ã™

- æš—é»™ã®`const`åŒ–ã®ç„¡åŠ¹åŒ–
- è©•ä¾¡å›æ•°ã¯æ­£ç¢ºã«ä¸€å›
- æ¡ä»¶å¼ã‹ã‚‰ã®ä¾‹å¤–ã¯ä¼æ’­ã•ã‚Œã‚‹ï¼ˆé•åãƒãƒ³ãƒ‰ãƒ©ã¯å‘¼ã³å‡ºã•ã‚Œãªã„ï¼‰
- æ¡ä»¶å¼ã®çµæœãŒ`false`ã¨ãªã£ãŸå ´åˆã€`detection_mode()`ãŒ`predicate_false`ã‚’è¿”ã—ã€`kind()`ãŒ`traditional_assert`ï¼ˆæ–°è¦è¿½åŠ ï¼‰ã‚’è¿”ã—ã€`semantic()`ãŒ`enforce`ã‚’è¿”ã™`std::contracts::contract_violation`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å‚ç…§ã‚’ä½¿ç”¨ã—ã¦é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã™
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é•åãƒãƒ³ãƒ‰ãƒ©æ¨å¥¨äº‹é …ã‚’å¤‰æ›´ã—ã€`kind()`ãŒ`traditional_assert`ã‚’è¿”ã™å¼•æ•°ã§å‘¼ã°ã‚ŒãŸå ´åˆã«ã€å¤±æ•—ã—ãŸã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦Cæ¨™æº–ã§è¦æ±‚ã•ã‚Œã‚‹å‹•ä½œã‚’å®Ÿè£…ã™ã‚‹ï¼ˆã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ï¼‰
    - ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’ã‚¨ãƒ©ãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«æ›¸ãè¾¼ã‚“ã§ã‹ã‚‰`abort()`ã‚’å‘¼ã³å‡ºã™ã€ãªã©

ã™ãªã‚ã¡ã€`assert`ãƒã‚¯ãƒ­ã¨ã»ã¼åŒã˜å‹•ä½œã‚’ã—ã¾ã™ã€‚

ãã—ã¦ã€`assert.h/cassert`ãƒ˜ãƒƒãƒ€ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹æ™‚ç‚¹ã§`NDEBUG`ãƒã‚¯ãƒ­ãŒå®šç¾©ã•ã‚Œã¦ãŠã‚‰ãšã€ `ASSERT_USES_CONTRACTS`ãƒã‚¯ãƒ­ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã€`assert`ãƒã‚¯ãƒ­ã®å®šç¾©ã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™

```cpp
#define assert(...) \
  [&] { contract_assert traditional (__VA_ARGS__); }()
```

ãŸã ã—ã€ä¸‹ä½äº’æ›æ€§ã®ç¶­æŒã®ãŸã‚ã«`NDEBUG`ã¨`ASSERT_USES_CONTRACTS`ã®ä¸¡æ–¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯`NDEBUG`ãŒå„ªå…ˆã•ã‚Œã¾ã™ï¼ˆ`assert`ãƒã‚¯ãƒ­ã¯å¾“æ¥é€šã‚Šå¼•æ•°ã‚’æ¡ã‚Šã¤ã¶ã™å½¢ã§å®šç¾©ã•ã‚Œã‚‹ï¼‰ã€‚

ã“ã®ã‚ˆã†ãªæ–¹æ³•ã«ã‚ˆã£ã¦å¾“æ¥ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ãŒæ–°ã—ã„å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«çµ±åˆã•ã‚Œã¦ã„ã‚Œã°ã€ãã‚Œã‚’åˆ©ç”¨ã—ãŸç§»è¡Œã‚’èµ·ç‚¹ã¨ã—ã¦å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®åˆ©ç”¨ã‚’æ¨é€²ã™ã‚‹ææ–™ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€2ã¤ã®ç•°ãªã‚‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ãŒä¸¦ç«‹ã—ã¦ã„ã‚‹ã¨ã„ã†çŠ¶æ³ã‚‚è§£æ¶ˆã•ã‚Œã¾ã™ã€‚

ã“ã®ææ¡ˆã®æ–¹å‘æ€§ã¯æ¦‚ã­SG21ã«æ”¯æŒã•ã‚Œã€é¡ä¼¼ã®ææ¡ˆã§ã‚ã‚‹P3290R1ã«çµ±åˆã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚

- [P3311 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1962)

### [P3312R0 Overload Set Types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3312r0.pdf)

é–¢æ•°ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã‚’å°å…¥ã™ã‚‹ææ¡ˆã€‚

ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€å‹ï¼ˆ`auto`ï¼‰ã§å®£è¨€ã•ã‚ŒãŸã‚‚ã®ã«é–¢æ•°åã‚’æ¸¡ã™ã¨é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ãŒæ¨è«–ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€ãã®é–¢æ•°ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹å ´åˆã©ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’å–å¾—ã™ã‚‹ã¹ãã‹åˆ†ã‹ã‚‰ãªã„ãŸã‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

```cpp
auto call(auto sin, auto v) {
  return sin(v);
}

int main() {
  call(std::sin, 3.14f);  // ngã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒã‚ã‚‹ãŸã‚æ›–æ˜§
}
```

ã“ã®ææ¡ˆã§ã¯ã€ã“ã®ã‚ˆã†ãªå ´åˆã«é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã§ã¯ãªãã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ï¼ˆ*overload-set-type*ï¼‰ã‚’æ¨è«–ã—ã€ãã®é–¢æ•°åã«ã¤ã„ã¦ãã®æ™‚ç‚¹ã§åˆ©ç”¨å¯èƒ½ãªã™ã¹ã¦ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã«é–¢ã™ã‚‹æƒ…å ±ã‚’ãƒ©ãƒƒãƒ—ã—ã¦æ¸¡ã—ã¾ã™ã€‚ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¡Œã†ã¨ã€ãã®å ´æ‰€ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºãŒè¡Œã‚ã‚Œã€å¼•æ•°ã«å¿œã˜ãŸæœ€é©ãªã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚Œã¾ã™ã€‚

```cpp
// ã“ã®ææ¡ˆã§ã¯ã€ç¬¬ä¸€å¼•æ•°ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ãŒæ¨è«–ã•ã‚Œã‚‹
auto call(auto sin, auto v) {
  return sin(v);  // vã«ã‚ˆã£ã¦ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºãŒè¡Œã‚ã‚Œã‚‹
}

int main() {
  call(std::sin, 3.14f);  // okã€std::sin(float)ãŒå‘¼ã°ã‚Œã‚‹
  call(std::sin, 3.14);   // okã€std::sin(double)ãŒå‘¼ã°ã‚Œã‚‹
}
```

ã“ã®ã‚ˆã†ãªã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã¯å®Ÿè¡Œæ™‚çŠ¶æ…‹ã‚’æŒãŸãšã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®å‹ç”Ÿæˆã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã«ã®ã¿ä¾å­˜ã—ã¦ã„ã¾ã™ã€‚ç‰¹ã«ã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®ã‚ˆã†ã«å®Ÿè¡Œæ™‚ã¾ã§å‘¼ã°ã‚Œã‚‹é–¢æ•°ãŒåˆ†ã‹ã‚‰ãªã„ã¨ã„ã†ã“ã¨ã¯ãªãã€å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ç¢ºå®šã•ã‚Œã¦ã„ã¾ã™ã€‚

ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ãŒæ¨è«–ã•ã‚Œã‚‹ã®ã¯ã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€å‹ã§å®£è¨€ã•ã‚ŒãŸå¤‰æ•°ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸé–¢æ•°åã§åˆæœŸåŒ–ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã®ã¿ã§ã™ã€‚æŒ‡å®šã—ãŸé–¢æ•°ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ç¾åœ¨ã¨åŒã˜ãé–¢æ•°ãƒã‚¤ãƒ³ã‚¿å‹ã‚’æ¨è«–ã—ã¾ã™ã€‚

ã“ã®å‹ã®åŸºæœ¬çš„ãªè€ƒãˆæ–¹ã¯ã€é–¢æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦é–¢æ•°å‘¼ã³å‡ºã—æ¼”ç®—å­ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã«ã€å…ƒã®é–¢æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆï¼ˆé–¢æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ãŒä½œæˆã•ã‚ŒãŸåœ°ç‚¹ï¼‰ã®ã™ã¹ã¦ã®å´é¢ãŒç¶­æŒã•ã‚Œã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚ã™ãªã‚ã¡ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰å€™è£œã¯é–¢æ•°å‘¼ã³å‡ºã—ãŒå®Ÿéš›ã«è¡Œã‚ã‚Œã‚‹å ´æ‰€ã§ã¯ãªãã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ãŒæ¨è«–ã•ã‚ŒãŸå ´æ‰€ã§æœ‰åŠ¹ãªã‚‚ã®ãŒå€™è£œã¨ãªã‚Šã¾ã™ã€‚

`std::sin`ãŒ`float/double`ã®2ç¨®é¡ã®ã¿ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’æŒã¤å ´åˆã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã‚’ã‚ãˆã¦æ˜ç¤ºã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãªå‹ã¨ã»ã¼åŒã˜æŒ¯ã‚‹èˆã„ã‚’ã—ã¾ã™ã€‚

```cpp
struct __std_sin_overload_set_type_1 {
  decltype(auto) operator()(auto&&... as) {
    return std::sin(std::forward<decltype(as)>(as)...);
  }

  // é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ï¼ˆé–¢æ•°å‚ç…§ï¼‰å‹ã«å¤‰æ›å¯èƒ½
  operator float (&)(float) const { return std::sin; }
  operator double (&)(double) const { return std::sin; }
};
```

ã“ã‚Œã¯ä¾‹ç¤ºã®ãŸã‚ã®ã‚‚ã®ã§ã‚ã£ã¦ã€å®Ÿéš›ã«ã¯ã“ã®ã‚ˆã†ãªå‹ãŒç”Ÿæˆã•ã‚Œã‚‹ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚ç‰¹ã«ã€é–¢æ•°å‘¼ã³å‡ºã—æ¼”ç®—å­ãªã©ã¯æ˜ç¤ºçš„ã«å®Ÿè£…ã•ã‚Œã‚‹ã®ã§ã¯ãªãçœç•¥ã—ã€å…ƒã®é–¢æ•°ã§æ­£ã—ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒç›´æ¥çš„ã«ã‚ãŸã‚‹ã‚ˆã†ãªå½¢ã«ãªã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã«å¿…è¦ãªæƒ…å ±ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ãŒæ¨è«–ã•ã‚ŒãŸåœ°ç‚¹ã®ã‚‚ã®ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã®æ‰±ã„ã¯ãƒ©ãƒ ãƒ€å¼ã®ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å‹ã«è¿‘ã„ã‚‚ã®ã§ã€åå‰ã¯ãªã„ã‚‚ã®ã®`decltype()`ã‚’é©ç”¨ã§ãã€å„ç¨®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿åŠã³ä»£å…¥æ¼”ç®—å­ã‚‚å®šç¾©ã•ã‚Œã¾ã™ã€‚ãŸã ã—ã€ç•°ãªã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã®é–“ã§ã®ä»£å…¥ã¯ã§ãã¾ã›ã‚“ã€‚

ææ¡ˆã™ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã«ã¤ã„ã¦å¯èƒ½ãªæ“ä½œã®ä¾‹

```cpp
void compose(auto F, auto G, auto value) { return F(G(value)); }

double one = compose(std::tan, std::atan, 1);

auto s = std::sin;  // å¤‰æ•°ã¨ã—ã¦å–å¾— 

using SinOverloads = decltype(s); // å‹åã‚’å–å¾—

callWihtFloat(SinOverloads());  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰

void cc(float (*f)(float));

cc(s);  // é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸ã®å¤‰æ›

auto sptr = declcall(s(2.0f));  // P2825ã®æ©Ÿèƒ½

cc(sptr);

auto sptr2 = static_cast<float(*)(float)>(s);

cc(sptr2);

double x = s(3.14);

// decay-copyï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã«å¯¾ã—ã¦ï¼‰
auto(std::sin);
auto{std::sin};

decltype(std::sin); // ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ãŒæ¨è«–ã•ã‚Œã‚‹

template<auto F>
void myFun()
  requires requires { F(1.2); }
{
  F(2.3);
}

myFun<std::sin>();  // NTTPã«æ¸¡ã™
```

é–¢æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦é–¢æ•°å‘¼ã³å‡ºã—æ¼”ç®—å­ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã«ã€å…ƒã®é–¢æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆï¼ˆé–¢æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ãŒä½œæˆã•ã‚ŒãŸåœ°ç‚¹ï¼‰ã®ã™ã¹ã¦ã®å´é¢ãŒç¶­æŒã•ã‚Œã‚‹ã€ã¨ã„ã†åŸºæœ¬çš„ãªè€ƒãˆæ–¹ã«åŸºã¥ã„ã¦ãã®ä»–ã®å‹•ä½œã‚‚è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºæ™‚ã«è€ƒæ…®ã•ã‚Œã‚‹ã‚‚ã®ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸ã®å¤‰æ›æ™‚ã¯è€ƒæ…®ã•ã‚Œãšã€é–¢æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰å€™è£œã«å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã§ã‚‚åŒæ§˜ã«å‹•ä½œã—ï¼ˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–åœ°ç‚¹ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºãŒè¡Œã‚ã‚ŒãŸå ´æ‰€ï¼‰ã€`noexcept/constexpr`ãªã©ã‚‚é¸æŠã•ã‚ŒãŸé–¢æ•°ã®ã‚‚ã®ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ADLã«é–¢ã—ã¦ã‚‚ã“ã®å‹•ä½œã‚’è¸è¥²ã—ã€ADLã®å€™è£œé›†åˆã‚‚ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºãŒè¡Œã‚ã‚Œã‚‹å ´æ‰€ã§ã¯ãªãã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ãŒæ¨è«–ã•ã‚ŒãŸå ´æ‰€ã®ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚ã™ãªã‚ã¡ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ãŒæ¨è«–ã•ã‚ŒãŸåœ°ç‚¹ã®ã‚·ãƒ³ãƒœãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãƒ©ãƒ ãƒ€ã®å ´åˆã¨åŒã˜ãƒ«ãƒ¼ãƒ«ã§ã™ã€‚

ã“ã“ã¾ã§ã¯ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã¿ã‚’å¯¾è±¡ã¨ã—ã¦èª¬æ˜ã—ã¦ãã¾ã—ãŸãŒã€ã“ã®ææ¡ˆã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã¯ãƒ¡ãƒ³ãƒé–¢æ•°ã‚„é–¢æ•°å‘¼ã³å‡ºã—æ¼”ç®—å­ãªã©ã«å¯¾ã—ã¦ã‚‚å‹•ä½œã—ã¾ã™ã€‚ãŸã ã—ã€ãƒ¡ãƒ³ãƒé–¢æ•°ã®å ´åˆã¯`&`ã‚’ä»˜ã‘ã¦æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆã‚¯ãƒ©ã‚¹å`C`ã¨ãƒ¡ãƒ³ãƒé–¢æ•°`memf`ã«å¯¾ã—ã¦`&C::memf`ï¼‰ã€‚ã¾ãŸã€ã“ã®ãƒ¡ãƒ³ãƒé–¢æ•°ã«ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚„ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚‚å«ã¾ã‚Œã¦ãŠã‚Šã€ãã‚Œãã‚Œã‚¯ãƒ©ã‚¹å`CName`ã«å¯¾ã—ã¦`&CName::CName`ã€`&CName::~CName`ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãƒ¡ãƒ³ãƒé–¢æ•°ã®å ´åˆã¯ã€ãƒ¡ãƒ³ãƒãƒã‚¤ãƒ³ã‚¿å‘¼ã³å‡ºã—ã«é–¢ã—ã¦ãƒ•ãƒªãƒ¼é–¢æ•°ã®é–¢æ•°å‘¼ã³å‡ºã—æ¼”ç®—å­ã¨åŒæ§˜ã®æ‰±ã„ã¨ãªã‚Šã¾ã™ï¼ˆãƒ¡ãƒ³ãƒé–¢æ•°ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãªã„å ´åˆã¨ã®ä¸€è²«æ€§ã®ãŸã‚ï¼‰ã€‚

æ¼”ç®—å­ã«ã¤ã„ã¦ã¯`operator@`ã®å½¢å¼ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰å¯èƒ½ãªã‚‚ã®ã«ã¤ã„ã¦ã€`operator@`ã®å½¢ã§æ¸¡ã™ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ãŒæ¨è«–ã•ã‚Œã¾ã™ã€‚å‘¼ã³å‡ºã—ã®éš›ã¯`operator@(args...)`ã®å½¢å¼ã§å‘¼ã°ã‚ŒãŸæ™‚ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã•ã‚Œã¾ã™ã€‚ã™ãªã‚ã¡ã€ãƒ¡ãƒ³ãƒé–¢æ•°éãƒ¡ãƒ³ãƒé–¢æ•°ã®æ¼”ç®—å­ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’1ã¤ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰é›†åˆå‹ã«å«ã‚ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

ææ¡ˆã‚ˆã‚Šã€`std::transform`ã§ä½¿ç”¨ã™ã‚‹ä¾‹

```cpp
std::vector<float> in = getInputValues();
std::vector<float> out;

// std::sinã‚’å„è¦ç´ ã«é©ç”¨ã™ã‚‹
std::transform(in.begin(), in.end(), std::back_inserter(out), std::sin);

// Rangeã‚¢ãƒ€ãƒ—ã‚¿ã§ã‚‚å‹•ä½œ
auto out_r = std::views::all(in) |
             std::views::transform(std::sin) |
             std::ranges::to<std::vector>();

// æ¼”ç®—å­ã§ã‚‚å‹•ä½œï¼ˆãƒ•ãƒªãƒ¼é–¢æ•°ã®å ´åˆã®ã¿
auto neg_r = std::views::all(out_r) |
             std::views::transform(operator-) |
             std::ranges::to<std::vector>();
```

- [P3312 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1963)

### [P3313R0 Impacts of noexept on ARM table based exception metadata](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3313r0.html)

`noexept`ãŒç”Ÿæˆã‚³ãƒ¼ãƒ‰ã«ã©ã®ã‚ˆã†ãªå½±éŸ¿ã‚’ä¸ãˆã‚‹ã‹ã«ã¤ã„ã¦ã®èª¿æŸ»å ±å‘Šã®æ–‡æ›¸ã€‚

ã“ã®æ–‡æ›¸ã®ç›®çš„ã¯æ¬¡ã®ã‚ˆã†ãªè³ªå•ã¸å›ç­”ã™ã‚‹ã“ã¨ã§ã™

- é–¢æ•°ã‚’`noexcept`æŒ‡å®šã™ã‚‹ã¨ã€ãã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯ã©ã®ã‚ˆã†ã«å¤‰æ›´ã•ã‚Œã‚‹ã‹ï¼Ÿ
- é–¢æ•°ãŒ`noexcept`é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã¨ã€é–¢æ•°ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ã©ã®ã‚ˆã†ãªå¤‰æ›´ãŒã‚ã‚‹ã‹ï¼Ÿ
- `try`ãƒ–ãƒ­ãƒƒã‚¯ãŒ`noexcept`é–¢æ•°ã®ã¿ã‚’å‘¼ã³å‡ºã™ã¨ã€ã©ã®ã‚ˆã†ãªå½±éŸ¿ãŒç”Ÿã˜ã‚‹ã‹ï¼Ÿ
- `noexcept`é–¢æ•°ã¨ã®ç›¸äº’ä½œç”¨ã¯ã€éãƒˆãƒªãƒ“ã‚¢ãƒ«ãªãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç®¡ç†ã™ã‚‹é–¢æ•°ã«ã©ã®ã‚ˆã†ã«å½±éŸ¿ã™ã‚‹ã‹ï¼Ÿ

ã“ã®æ–‡æ›¸ã§ã¯ã€GCCãŒä½¿ç”¨ã—ã¦ã„ã‚‹ARMç’°å¢ƒã«ãŠã‘ã‚‹Itanium ABIã®ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ™ãƒ¼ã‚¹ä¾‹å¤–ã®å®Ÿè£…ã«ã‚ˆã£ã¦æ§˜ã€…ãªå®Ÿé¨“ã‚’è¡Œã£ã¦ã„ã¾ã™ãŒã€ã“ã“ã§å¾—ã‚‰ã‚Œã‚‹è¦‹è­˜ã¯ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ™ãƒ¼ã‚¹ä¾‹å¤–ã®å®Ÿè£…ã«ãŠã„ã¦ã‚‚ä¸€è²«ã—ã¦ã„ã‚‹ã€ã¨ã—ã¦ã„ã¾ã™ã€‚

æ–‡æ›¸ã§ã¯ã€ARM EHABIã®å®Ÿè£…ã‚„GCC C++ LSDAã«ã¤ã„ã¦è§£èª¬ã—ãŸå¾Œã€`noexcept`åŠã³é`noexcept`é–¢æ•°ã®æ§˜ã€…ãªå‘¼ã³å‡ºã—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿé¨“ã—ã¦ã„ã¾ã™ã€‚ã“ã®å®Ÿé¨“ã®ç›®çš„ã¯æ¬¡ã®äº‹æŸ„ã«ã¤ã„ã¦ã®è¦‹è­˜ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã™

- é–¢æ•°ã®ä¾‹å¤–ãƒ©ãƒ³ã‚¯
- LSDAã‚µã‚¤ã‚ºã¨ãã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚µã‚¤ã‚º

çµæœã¨åˆ†æã‚’é€šã˜ã¦ã“ã“ã§ã®å®Ÿé¨“ã®çµè«–ã¯ã€`noexcept`ã¯å¼·åŠ›ãªä¾‹å¤–ä¿è¨¼ãŒå¿…è¦ãªå ´åˆã«å½¹ç«‹ã¤ã‚‚ã®ã®ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«é–¢ã—ã¦ã¯å¿…ãšã—ã‚‚åˆ©ç‚¹ãŒã‚ã‚‹ã¨ã¯é™ã‚‰ãªã„ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚ä¸€èˆ¬çš„ã«è¨€ã‚ã‚Œã¦ã„ã‚‹`noexcept`ã®åˆ©ç‚¹ã¯ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã§ã®ã¿ç™ºç”Ÿã™ã‚‹ã‚ˆã†ã§ã™ã€‚

ä¾‹å¤–æ©Ÿæ§‹ã®ç”Ÿæˆã‚³ãƒ¼ãƒ‰æ”¹å–„ã¨ã„ã†è¦³ç‚¹ã‹ã‚‰ã¯ã‚€ã—ã‚ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®æ”¹å–„ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹ã¹ãã ã¨è¿°ã¹ã¦ãŠã‚Šã€æ¨å¥¨äº‹é …ã¨ã—ã¦æ¬¡ã®äº‹ã‚’æŒ™ã’ã¦ã„ã¾ã™

- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®é¸æŠã®æ”¹å–„
    - ãƒªãƒ¼ãƒ•é–¢æ•°ã®å ´åˆ: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚¨ãƒ³ãƒˆãƒªã‚’çœç•¥ã™ã‚‹
    - `noexcept`é–¢æ•°ã®ã¿ã‚’å‘¼ã³å‡ºã™å ´åˆ: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚¨ãƒ³ãƒˆãƒªã‚’çœç•¥ã™ã‚‹
    - `noexcept`é–¢æ•°ã§`try`ãƒ–ãƒ­ãƒƒã‚¯ã‚’æŒãŸãªã„å ´åˆ: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³`noexcept`ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã™ã‚‹
    - `noexcept`é–¢æ•°ã§éãƒˆãƒªãƒ“ã‚¢ãƒ«ãªãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã™ã‚‹å ´åˆ: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³`noexcept`ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã™ã‚‹
- åŒä¸€ã®ä¾‹å¤–ã‚¨ãƒ³ãƒˆãƒªã‚’æŒã¤é–¢æ•°ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    - ãƒªãƒ³ã‚«ã¯åŒä¸€ã®ä¾‹å¤–ã‚¨ãƒ³ãƒˆãƒªã‚’æŒã¤é–¢æ•°ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã€ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦åŒä¸€ã®ä¾‹å¤–ã‚¨ãƒ³ãƒˆãƒªã‚’1ã¤ã®ã‚¨ãƒ³ãƒˆãƒªã«ãƒãƒ¼ã‚¸ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ã‚ºã‚’å‰Šæ¸›ã™ã‚‹ã“ã¨ãŒã§ãã‚‹
- é–¢æ•°ã«ãŠã‘ã‚‹`noexcept`ã®æ¨è«–
    - ä»–ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã‚‚ã®ã®ã€ãã®å‘¼ã³å‡ºã—ã‚°ãƒ©ãƒ•ã®å…¨ä½“ã«ã‚ãŸã£ã¦å…¨ã¦ã®é–¢æ•°ãŒä¾‹å¤–ã‚’é€å‡ºã—ãªã„å ´åˆã€ãã®é–¢æ•°ã¯`noexcept`ã¨ã—ã¦å‹•ä½œã™ã‚‹ã€‚ã“ã®ã‚ˆã†ãªé–¢æ•°ã‚’æ‰‹å‹•ã§`noexcept`æŒ‡å®šã™ã‚‹ä»£ã‚ã‚Šã«ã€ãƒªãƒ³ã‚«ãŒãã®é–¢æ•°ãŒä¾‹å¤–ã‚’é€å‡ºã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹
    - ãƒªãƒ³ã‚«ãŒå®Œå…¨ãªã‚¢ã‚»ãƒ³ãƒ–ãƒªæƒ…å ±ã‚’æŒã¤ã™ã¹ã¦ã®é–¢æ•°ã‚’è©•ä¾¡ã—ã¦ã€ã©ã®é–¢æ•°ãŒä¾‹å¤–ã‚’é€å‡ºã™ã‚‹ã‹ã‚’åˆ¤å®šã—ã€ä¾‹å¤–ã‚’é€å‡ºã™ã‚‹ã“ã¨ãŒç„¡ã„é–¢æ•°ã‚’è‡ªå‹•ã§`noexpcet`æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹

ã“ã®æ–‡æ›¸ã¯ä½•ã‹ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãŠãã‚‰ãã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®è­°è«–ã®éç¨‹ã«ãŠã‘ã‚‹`noexcept`ã®åŠ¹æœã«ã¤ã„ã¦ã®è­°è«–ã‚„LEWGã«ãŠã‘ã‚‹`noexcept`ä»˜åŠ ãƒãƒªã‚·ãƒ¼ã«é–¢é€£ã—ãŸãƒ¬ãƒãƒ¼ãƒˆã ã¨æ€ã‚ã‚Œã¾ã™ã€‚

### [P3316R0 A more predictable unchecked semantic](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3316r0.pdf)

æ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã—ãªã„æ–°ã—ã„å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã§ã‚ã‚‹*Promise*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®ææ¡ˆã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ä»•æ§˜ã«ã¯ã€å¥‘ç´„æ³¨é‡ˆãŒå®Ÿè¡Œæ™‚ã«ã©ã†æŒ¯èˆã†ã®ã‹ã«ã¤ã„ã¦ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ãŒ4ç¨®é¡ã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é™çš„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é–‹ç™ºã—ã¦å‡ºè·ã—ã¦ã„ã‚‹å ´åˆã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«å¯¾å¿œã™ã‚‹ã«ã¯ç¾åœ¨ã®4å€ã®æ•°ã®ãƒãƒªã‚¢ãƒ³ãƒˆã‚’å‡ºè·ã™ã‚‹å¿…è¦ãŒã‚ã‚‹äº‹ã‚’æ„å‘³ã—ã¾ã™ã€‚

ã“ã‚Œã«ã¯ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹ãŸã‚ã€å˜ä¸€ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å‡ºè·ã—ã¦ãƒªãƒ³ã‚«ãŒãƒªãƒ³ã‚¯æ™‚æœ€é©åŒ–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«å¿œã˜ã¦ä½¿ç”¨ã•ã‚Œãªã„ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§å¯¾å¿œã§ããªã„ã‹ï¼Ÿã¨è€ƒãˆã¾ã™ã€‚ä½¿ç”¨ã•ã‚Œãªã„ã‚³ãƒ¼ãƒ‰ã¨ã¯ã€æ¡ä»¶å¼ãƒã‚§ãƒƒã‚¯ã€é•åãƒãƒ³ãƒ‰ãƒ©å‘¼ã³å‡ºã—ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¸­æ–­ã®3ã¤ã§ã™ã€‚ä½•ã‚‚å–ã‚Šé™¤ã‹ãšå…¨ã¦ã‚’æ®‹ã™å ´åˆã¯*Enforce*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ãªã‚Šã€ãƒãƒ³ãƒ‰ãƒ©å‘¼ã³å‡ºã—ã ã‘ã‚’å‰Šé™¤ã™ã‚‹ã¨*quick_enforce*ã«ãªã‚Šã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸­æ–­ã ã‘ã‚’å‰Šé™¤ã™ã‚‹ã¨*Observe*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ãªã‚Šã€å…¨ã¦ã‚’å‰Šé™¤ã™ã‚‹ã¨*Ignore*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªæœ€é©åŒ–ã¯ã€ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã—ãŸå ´åˆã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒçµ‚äº†ã™ã‚‹ã“ã¨ã‚’ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶ãŒèªè­˜ã—ã€ãã‚Œã«åŸºã¥ã„ã¦è¡Œã‚ã‚Œã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚ã—ã‹ã—ã“ã‚Œã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæœ€åˆã‹ã‚‰*Ignore*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã¦ã„ãŸå ´åˆã¨åŒã˜ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€ãƒã‚§ãƒƒã‚¯ã—ã¦å¥‘ç´„ãŒç ´ã‚‰ã‚Œã¦ã„ãŸå ´åˆã®ãƒ–ãƒ©ãƒ³ãƒãŒçµ‚äº†ã—ãªã„å ´åˆï¼ˆ*Enforce*/*quick_enforce*ä»¥å¤–ã®å ´åˆï¼‰ã€ç¶™ç¶šãƒ‘ã‚¹ã«UBãŒå«ã¾ã‚Œã¦ã„ã‚‹ã¨ã€ç¾åœ¨ã®æœ€é©åŒ–ãŒãã†ã—ã¦ã„ã‚‹ã‚ˆã†ã«UBã¯èµ·ã“ã‚‰ãªã„ã‚‚ã®ã¨ã—ã¦æœ€é©åŒ–ãŒè¡Œã‚ã‚Œã€çµæœå¥‘ç´„ãƒã‚§ãƒƒã‚¯ã¨ç ´ã‚‰ã‚Œã¦ã„ãŸå ´åˆã®ãƒãƒ³ãƒ‰ãƒ©å‘¼ã³å‡ºã—ã‚’è¡Œã†ã‚³ãƒ¼ãƒ‰ãŒæœ€é©åŒ–ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚

ã“ã‚Œã¯ç‰¹ã«ã€*Observe*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ãŒé¸æŠã•ã‚ŒãŸå ´åˆã«èµ·ã“ã‚Šå¾—ã¾ã™ã€‚ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªç°¡å˜ãª`contract_assert`ã‚’å«ã‚€ã‚³ãƒ¼ãƒ‰ã¯

```cpp
bool f(int* p, int* q) {
  if (q != nullptr) {
    puts("got null");
  }

  contract_assert(p != nullptr);
  
  return *p == *q;
}
```

*Enforce*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®å ´åˆæœ€ã‚‚æœ€é©åŒ–ã•ã‚ŒãŸã¨ã—ã¦ã‚‚æ¬¡ã‚‚æ§˜ãªã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™

```cpp
bool f(int* p, int* q) {

  // qã®ãƒã‚§ãƒƒã‚¯ã¯èµ·ã“ã‚‰ãªã„ã‚‚ã®ã¨ã—ã¦å‰Šé™¤ã•ã‚Œã‚‹
  // qã®ãƒã‚§ãƒƒã‚¯ã§çµ‚äº†ã¯ã—ãªã„ãŸã‚

  if (not (p != nullptr)) {
    invoke_handler();
    die();  // ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†ç‚¹ãŒã‚ã‚‹äº‹ã§pã®ãƒã‚§ãƒƒã‚¯ã¯æ®‹ã‚‹
  }
  
  return *p == *q;
}
```

*Observe*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®å ´åˆã¯æœ€æ‚ªæ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

```cpp
bool f(int* p, int* q) {

  // pã®ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¹ã®die()ãŒç„¡ããªã‚‹ã“ã¨ã§pãŒnullptrã§ã‚‚*pã¾ã§è¡Œãã¤ã
  // UBã¯èµ·ã“ã‚‰ãªã„ã®ã§Pã®ãƒã‚§ãƒƒã‚¯ã¯ãƒãƒ³ãƒ‰ãƒ©å‘¼ã³å‡ºã—æ¯æ¶ˆãˆã‚‹
  
  return *p == *q;
}
```

ã“ã‚Œã¯*Ignore*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®çµæœã¨åŒã˜ã§ã™ã€‚

åŒæ§˜ã®äº‹ã¯äº‹å‰ãƒ»äº‹å¾Œæ¡ä»¶ãƒã‚§ãƒƒã‚¯ã«ãŠã„ã¦ã‚‚èµ·ã“ã‚Šå¾—ã‚‹ã»ã‹ã€ç´”ç²‹ã«*Ignore*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ã‚ˆã£ã¦æœ€é©åŒ–ãŒè¡Œã‚ã‚ŒãŸå ´åˆã§ã‚‚ï¼ˆå¥‘ç´„ãƒã‚§ãƒƒã‚¯ã®å¾Œã®ãƒ‘ã‚¹ã§åŒã˜æ¡ä»¶ã§åˆ†å²ã—ã¦ã‚‹å ´åˆãªã©ã«ï¼‰åŒã˜ã“ã¨ãŒèµ·ã“ã‚Šå¾—ã¾ã™ã€‚

ã™ãªã‚ã¡ã€*Ignore*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯UBã«å¯¾ã—ã¦è„†å¼±ã§ã‚ã‚Šæœ¬è³ªçš„ã«å±é™ºãªã‚‚ã®ã§ã€å¥‘ç´„æ³¨é‡ˆã‚’ç„¡è¦–ã§ãã‚‹ã®ã¯é˜²å¾¡çš„ãªã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆäºŒé‡ã«åŒã˜æ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ä¾‹å¤–ã«ã‚ˆã£ã¦è„±å‡ºã™ã‚‹ãªã©ï¼‰ãŒè¬›ã˜ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿ã¨ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€ãƒªãƒªãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’*Enforce*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã§ãƒ†ã‚¹ãƒˆã—ã¦ã‹ã‚‰*Ignore*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆã¦å†åº¦å®Ÿè¡Œã™ã‚‹å ´åˆã€æœ€é©åŒ–å‚¾å‘ãŒç•°ãªã‚‹ãŸã‚ä¿¡é ¼ã§ããªã„ã‚‚ã®ã¨ãªã‚Šã¾ã™ã€‚

ã“ã“ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã®ã¯æ¬¡ã®3ã¤ã§ã™

1. æ¨å¥¨ã•ã‚Œã‚‹å¥‘ç´„ãƒã‚§ãƒƒã‚¯ãŒè¡Œã‚ã‚Œãªã„ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦ã€*Ignore*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’*Promise*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã§ç½®ãæ›ãˆã‚‹
2. æ¨å¥¨ã•ã‚Œã‚‹*Observe*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¨ã—ã¦ã€*Promise*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«åŸºã¥ã*Observe*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹
3. `[[establish( expression )]]`ã‚’è¿½åŠ ã™ã‚‹
    - ã“ã®å±æ€§ã®å‡ºç¾ä»¥é™ã«å¼ãŒ`true`ã«ãªã‚‹ã“ã¨ã‚’è¡¨ã™ï¼ˆå‰ã«ãªã£ã¦ã„ã‚‹å¿…è¦ã¯ç„¡ã„

ææ¡ˆå¾Œã®*Observe*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®å…ˆç¨‹ã®ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«çµæœã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

```cpp
bool f(int* p, int* q) {


  if (not (p != nullptr)) {
    invoke_handler();
    [[establish(p != nullptr)]];
  }
  
  return *p == *q;
}
```

`[[establish( expression )]]`ã¯ä¸€ç¨®ã®æœ€é©åŒ–ãƒãƒªã‚¢ã§ã‚ã‚Šã€ãã®å‡ºç¾ä»¥é™ã§ãã®æ¡ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒä»®å®šã™ã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ã§ã€ãƒã‚§ãƒƒã‚¯ã—å¤±æ•—å¾Œã«çµ‚äº†ã—ãªã„å ´åˆã§ã‚‚ã€UBãŒèµ·ã“ã‚‰ãªã„ã¨ä»®å®šã—ãŸæœ€é©åŒ–ã«ã‚ˆã£ã¦å¥‘ç´„ãƒã‚§ãƒƒã‚¯ãƒ–ãƒ©ãƒ³ãƒãŒä¸¸ã”ã¨å‰Šé™¤ã•ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã—ã¾ã™ã€‚

*Primise*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã§ã¯å¥‘ç´„ãƒã‚§ãƒƒã‚¯ãŒå®Œå…¨ã«ç„¡è¦–ã•ã‚Œã‚‹å ´åˆã§ã‚‚ã“ã®`[[establish( expression )]]`å±æ€§ãŒæ®‹ã•ã‚Œã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ä»¥é™ã®ãƒ‘ã‚¹ã§UBã¯èµ·ã“ã‚‰ãªã„ã‚‚ã®ã¨ã—ãŸæœ€é©åŒ–ã‚’æŠ‘æ­¢ã™ã‚‹ã“ã¨ãŒã§ãã€ç„¡è¦–ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®ä¿¡é ¼æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚ã¾ãŸã€å†’é ­ã§è¿°ã¹ã¦ã„ãŸã‚ˆã†ãªãƒªãƒ³ã‚«ã«ã‚ˆã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®é¸æŠã‚‚é©åˆ‡ã«å‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã®å†…å®¹ã¯SG21ã§ã‚ã¾ã‚Šè³›åŒã‚’å¾—ã‚‰ã‚Œãªã‹ã£ãŸã‚ˆã†ã§ã€ãƒªã‚¸ã‚§ã‚¯ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P3316 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1965)

### [P3317R0 Compile time resolved contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3317r0.pdf)

å¥‘ç´„ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãŠãã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’è¨­è¨ˆã™ã¹ãã¨ã„ã†ææ¡ˆã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã¯ä¸æ„ã®çµ‚äº†ãŒè‡´å‘½çš„ã§ã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã€å®Ÿè¡Œæ™‚ã«ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿ã‚’ç´ é€šã—ã™ã‚‹ã®ã‚‚ã¾ãŸå±é™ºã§ã‚ã‚‹ãŸã‚ã€å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã¯*enforce*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã§æ®‹ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã¾ãŸã€å®Ÿè¡Œæ™‚ã®ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ãŸã„ãŒãã®ãŸã‚ã®ä½™åˆ†ãªãƒªã‚½ãƒ¼ã‚¹ï¼ˆCPU/ãƒ¡ãƒ¢ãƒªï¼‰ãŒç¢ºä¿ã§ããªã„ã¨ã„ã†ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªç’°å¢ƒã«ãŠã„ã¦ã¯ã€ã»ã¨ã‚“ã©ã®å¥‘ç´„æ³¨é‡ˆã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãƒã‚§ãƒƒã‚¯ã—ã¦å®Ÿè¡Œæ™‚ã®ã‚³ã‚¹ãƒˆã¨çµ‚äº†ã®å±é™ºæ€§ã‚’å‰Šæ¸›ã™ã‚‹ã‚ˆã†ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã™ã‚‹ã®ã¯åŠ´åŠ›ã«è¦‹åˆã†ä¾¡å€¤ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã»ã©ã«è¦æ±‚ãŒå³ã—ããªã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ã‚‚ã€å¤šãã®å¥‘ç´„æ³¨é‡ˆãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚ˆã£ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ï¼ˆå¥‘ç´„ãŒç ´ã‚‰ã‚Œãªã„ï¼‰ã“ã¨ãŒåˆ†ã‹ã‚Œã°ã€å¤§ããªå®‰å¿ƒæ„Ÿã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®å°†æ¥ã®æ‹¡å¼µã®ä¸€ã¤ã¨ã—ã¦ã€å¥‘ç´„æ³¨é‡ˆã‚’ã‚³ãƒ¼ãƒ‰ã®ä»®å®šã¨ã—ã¦æ‰±ã£ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæœ€é©åŒ–ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹æ–¹å‘æ€§ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§å•é¡Œã¨ãªã‚‹ã®ã¯ã€å¥‘ç´„ãŒç ´ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã«æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹ã“ã¨ã§ã‚³ãƒ¼ãƒ‰ãŒã‚€ã—ã‚å±é™ºãªã‚‚ã®ã«ãªã£ã¦ã—ã¾ã†äº‹ã§ã™ã€‚ã“ã®å ´åˆã«ã€å¥‘ç´„æ³¨é‡ˆã®å¤šãã®éƒ¨åˆ†ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«è§£æ±ºã•ã‚Œã¦ã„ã‚Œã°ã€å®Ÿè¡Œæ™‚ã®æœªå®šç¾©å‹•ä½œã®ãƒªã‚¹ã‚¯ã‚’è»½æ¸›ã—ã¦æœ€é©åŒ–ã®æ©æµã ã‘ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã¯å¥‘ç´„ã®è¨­è¨ˆã‚’æ‹¡å¼µã™ã‚‹æ™‚ã«è€ƒæ…®ã™ã¹ãé‡è¦ãªæ©Ÿèƒ½ã§ã‚ã‚Šã€ã“ã‚Œã‚‰ã®ã“ã¨ã‚’å°†æ¥çš„ã«å¯èƒ½ãªã‚ˆã†ã«ã—ã¦ãŠããŸã‚ã«ã¯é™çš„è§£æãŒå¯èƒ½ãªã‚ˆã†ã«å¥‘ç´„æ©Ÿèƒ½ã‚’è¨­è¨ˆã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ãã®æ–¹é‡ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã“ã§ã¯æ¬¡ã®3ã¤ã®äº‹ã‚’ææ¡ˆï¼ˆSG21ã«ãŠã‘ã‚‹æŠ•ç¥¨ã‚’æ¨å¥¨ï¼‰ã—ã¦ã„ã¾ã™

- å¥‘ç´„æ³¨é‡ˆã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚è¨ºæ–­ã‚’æ¨™æº–åŒ–ã™ã‚‹
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®è¨ºæ–­ã¯æ¬¡ã®4ã¤
    - *None* : ä½•ã‚‚ã—ãªã„
    - *Known violations*
    - *Unhandled conditions*
    - *Runtime conditions*
- å…¨ã¦ã®å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®è§£æ±ºã‚’å¦¨ã’ãªã„ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã‚‹ã¹ã

ææ¡ˆã•ã‚Œã¦ã„ã‚‹4ã¤ã®è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰ã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã©ã®ç¨‹åº¦è§£æ±ºã™ã‚‹ã‹ã‚’æŒ‡å®šã™ã‚‹ã‚‚ã®ã§ã™ã€‚ãªãŠã€*None*ã¯ç¾åœ¨ã®å‹•ä½œï¼ˆã™ã¹ã¦å®Ÿè¡Œæ™‚è§£æ±ºï¼‰ã§ã™ã€‚

ã¾ãš*Known violations*ã¯å‘¼ã³å‡ºã•ã‚ŒãŸå ´åˆã«å¿…ãšå¤±æ•—ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã«ã¤ã„ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«è¨ºæ–­ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚

```cpp
void f0()
  post(false) // å¤±æ•—ã‚’è¨ºæ–­ã™ã‚‹
{
}

void f1()
  pre(false) // å‘¼ã³å‡ºã™ã¾ã§ã¯è¨ºæ–­ã•ã‚Œãªã„
{
}

void f2()
{
  f1(); // å¤±æ•—ã‚’è¨ºæ–­ã™ã‚‹
}

void f3()
{
  contract_assert(false) // å¤±æ•—ã‚’è¨ºæ–­ã™ã‚‹
}
```

ã“ã‚Œã‚‰ã¯ã‚ã¾ã‚Šã«ã‚‚è‡ªæ˜ãªä¾‹ã§ã™ãŒã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚å®šæ•°ã‚„ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«åˆ†æå¯èƒ½ãªæ¡ä»¶å¼ãªã©ã«ã‚ˆã£ã¦ã“ã‚Œã‚‰ã¨åŒç­‰ã«ãªã‚‹å ´åˆã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å¥‘ç´„æ³¨é‡ˆã®æœ‰åŠ¹æ€§ã‚’æ¤œå‡ºã§ãã¾ã™ã€‚

*Unhandled conditions*ã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å¥‘ç´„ã‚’å¤±æ•—ã•ã›ã‚‹å…¥åŠ›ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’è¨ºæ–­ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚

```cpp
int f0(int x)
  post(r: r > 5) // è¨ºæ–­: ç„¡åŠ¹ãªå…¥åŠ›ãŒå­˜åœ¨ã™ã‚‹
{
  return x;
}
```

*Runtime conditions*ã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã¯ãã®å¥‘ç´„ãŒç ´ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ã©ã†ã‹åˆ†ã‹ã‚‰ãªã„ã‚‚ã®ã«ã¤ã„ã¦ã‚‚è¨ºæ–­ã‚’æä¾›ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚

```cpp
void f0()
  post(secret_check()) // è¨ºæ–­: å¥‘ç´„æ¡ä»¶ã®æœ‰åŠ¹æ€§ã¯ä¸æ˜
{
}
```

ã“ã‚Œã‚‰ã®è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰ã®ã†ã¡ã€æœ€åˆã®2ã¤ï¼ˆ*Known violations*ã¨*Unhandled conditions*ï¼‰ã¯é–“é•ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹ã‚‚ã®ãªã®ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã«ã—ã€æœ€å¾Œã®ã‚‚ã®ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦ãŠãã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€ã“ã‚Œã‚‰ã®å•é¡Œã‚’æ¤œå‡ºã™ã‚‹èƒ½åŠ›ã¯å¿…ãšã—ã‚‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©é–“ã§åŒã˜ã§ã¯ãªã„ãŸã‚è¨ºæ–­ç„¡ã—ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ã“ã“ã§ã®è¨ºæ–­ã¨ã¯ã€è­¦å‘Šã¨ã‚¨ãƒ©ãƒ¼ã‹ã¯ã£ãã‚Šã—ã¦ã„ã¾ã›ã‚“ãŒã€ãŠãã‚‰ãæœ€åˆã®2ã¤ã®è¨ºæ–­ã¯ã‚¨ãƒ©ãƒ¼ã‚’æ„å›³ã—ã¦ãŠã‚Šã€æœ€å¾Œã®ã‚‚ã®ã®è¨ºæ–­ã¯è­¦å‘Šã‚’æ„å›³ã—ã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚

- [P3317 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1966)

### [P3318R0 Throwing violation handlers, from an application programming perspective](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3318r0.html)

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®`noexcept`ãƒãƒªã‚·ãƒ¼ã¨ã—ã¦ã€Lakos Ruleã‚’ç¶­æŒã¾ãŸã¯å¾©æ´»ã•ã›ã‚‹ã¹ãã¨ã™ã‚‹æ–‡æ›¸ã€‚

LEWGã«ãŠã‘ã‚‹ãƒãƒªã‚·ãƒ¼ã®ç­–å®šãŒè¡Œã‚ã‚Œã¦ãŠã‚Šã€`noexcept`ã«é–¢ã™ã‚‹ãƒãƒªã‚·ãƒ¼ã‚‚ææ¡ˆã•ã‚Œã¦ã„ã¾ã™ï¼ˆP3085ã‚„P3155ï¼‰ã€‚ã“ã®æ–‡æ›¸ã¯ã€ãã®è­°è«–ã«é–¢ã™ã‚‹ç¬¬ä¸‰è€…æ„è¦‹æ›¸ã¨ã—ã¦æå‡ºã•ã‚ŒãŸã‚‚ã®ã§ã€Lakos Ruleã«åŸºã¥ã„ãŸãƒãƒªã‚·ãƒ¼ã¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

å¥‘ç´„é•åãŒèµ·ãã¦ã„ã‚‹å ´åˆã§ã‚‚å¿…ãšã—ã‚‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒè‡´å‘½çš„ã§ç¶šè¡Œä¸å¯èƒ½ãªçŠ¶æ…‹ã«ã‚ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚€ã—ã‚ã€å¥‘ç´„é•åã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ãŸçŠ¶æ…‹ã¨ã„ã†ã®ã¯UBã«çªå…¥ã—ã†ã‚‹çŠ¶æ³ã®ç›´å‰ã§ãã‚Œã‚’é˜²æ­¢ã—ãŸã¨ã„ã†äº‹ã§ã‚ã‚Šã€ãã®åŸå› ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒã®äº›ç´°ãªãƒŸã‚¹ï¼ˆãƒã‚¤ãƒ³ã‚¿å¼•æ•°ã«èª¤ã£ã¦`nullptr`ã‚’æ¸¡ã™ã€ã‚¿ã‚¤ãƒ—ãƒŸã‚¹ã€è«–ç†æ¡ä»¶ã®åè»¢ã€etc...ï¼‰ã§ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã§ã€ãã®å ´æ‰€ãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ å…¨ä½“ã‹ã‚‰è¦‹ã‚‹ã¨é‡è¦åº¦ã®ä½ã„ç®‡æ‰€ã§ã‚ã‚‹å ´åˆã€ãã®ãƒã‚°ã‹ã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å›å¾©ã•ã›ã‚‹é¸æŠè‚¢ã‚’å–ã‚‹ã“ã¨ãŒã§ãã€ãƒ¡ã‚¤ãƒ³ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç¶šè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã‚ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã§ã¯æ­£ã—ã„æŒ¯ã‚‹èˆã„ã§ã‚ã‚Šã€å³çµ‚äº†ã™ã‚‹ã“ã¨ã¯æœ›ã¾ã—ã„æŒ¯ã‚‹èˆã„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é–¢æ•°ãŒLakos Ruleã«å¾“ã‚ãªã„`noexcept`ãƒãƒªã‚·ãƒ¼ï¼ˆç‹­ã„å¥‘ç´„ã‚’æŒã¡"Throws: nothing"ã¨ã‚ã‚‹é–¢æ•°ã§ã‚‚`noexcept`æŒ‡å®šã•ã‚Œã‚‹ï¼‰ã‚’å–ã‚‹ã¨ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒã‚‚ãŸã‚‰ã•ã‚Œæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚‚ãã‚ŒãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ä¸–ç•Œã«ãŠã„ã¦ã€é•åãƒãƒ³ãƒ‰ãƒ©ã«ã‚ˆã‚Šäº‹å‰æ¡ä»¶é•åã‚’æ¤œå‡ºã—ã¦ï¼ˆ*enforce*ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ã‚’é¸æŠã—ã¦ã„ã‚‹ã¨ã™ã‚‹ï¼‰ã€ãã‚ŒãŒï¼ˆä¸Šè¨˜ã®ã‚ˆã†ã«ï¼‰å›å¾©å¯èƒ½ãªãƒã‚°ã§ã‚ã‚‹å ´åˆã¯ä¾‹å¤–é€å‡ºã™ã‚‹ã“ã¨ã§å¾©å¸°ã™ã‚‹ã€ã¨ã„ã†æ‰‹æ®µã‚’å–ã‚‹ã“ã¨ãŒã§ããªããªã‚Šã¾ã™ã€‚

ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«ãŠã„ã¦

```cpp
void whatever_func() {
  try {
    // äº‹å‰æ¡ä»¶ã‚’æŒã¤é–¢æ•°
    some_func_with_preconditions(oink, boink);
  } catch (const MyOutOfRangeContractException& e) {
    // å¾©å¸°å‡¦ç†
    log(e);
	  disable_offending_subsystem();
	  resume_normal_operation();
  }
}
```

`some_func_with_preconditions()`ãŒæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é–¢æ•°ã§ã‚ã‚Šã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒæ¡ç”¨ã•ã‚ŒãŸä¸–ç•Œã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®Ÿè£…ã«ã‚ˆã£ã¦äº‹å‰æ¡ä»¶ãŒã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦è¨˜è¿°ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ã“ã®å ´åˆã«Lakos Ruleã«å¾“ã‚ãªã„`noexcept`ãƒãƒªã‚·ãƒ¼ã«åŸºã¥ãå ´åˆã€äº‹å‰æ¡ä»¶ãŒç ´ã‚‰ã‚Œä¾‹å¤–ãŒé€å‡ºã•ã‚Œã‚‹ã¨ï¼ˆé•åãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰ä¾‹å¤–ã«ã‚ˆã£ã¦å¾©å¸°ã—ã‚ˆã†ã¨ã™ã‚‹å ´åˆã‚‚å«ã‚ã¦ï¼‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒçµ‚äº†ã•ã›ã‚‰ã‚Œã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µã‚¤ãƒ‰ã§ã¯ãã“ã‹ã‚‰å¾©å¸°ã™ã‚‹ã‚ã‚‰ã‚†ã‚‹æ‰‹æ®µãŒå°ã˜ã‚‰ã‚Œã¾ã™ã€‚

Lakos Ruleã«å¾“ã‚ãªã„`noexcept`ãƒãƒªã‚·ãƒ¼ã‚’æ¡ç”¨ã™ã‚‹ã¨ã€ã“ã®ã‚ˆã†ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¸ã®æ‰‰ãŒé–‰ã–ã•ã‚Œã¾ã™ã€‚ãã—ã¦ã€ä¸€åº¦é–‰ã–ã•ã‚ŒãŸæ‰‰ã¯å¾Œæ–¹äº’æ›æ€§ã«ã‚ˆã£ã¦äºŒåº¦ã¨ã¯é–‹ãã“ã¨ãŒã§ããªããªã‚Šã€é•åãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰ã®ä¾‹å¤–é€å‡ºã«ã‚ˆã£ã¦å¥‘ç´„é•åå¾Œã®çŠ¶æ…‹å›å¾©ã¨ã„ã†æ‰‹æ®µã¯ä½¿ç”¨ã§ããªããªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ãã†ã—ãŸã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãŒãã†ã§ããªã„ã¨ã„ã†äº‹ã§ã‚ã‚Šã€WG21ã®å§”å“¡ä¼šã®äººã®å¤§å¤šæ•°ãŒãã†ã™ã‚‹å¿…è¦ãŒç„¡ã„ï¼ˆã‹ã‚‰ãã†ã§ããªã„ã‚ˆã†ã«ã—ãŸã„ï¼‰ã¨ã„ã†äº‹ã‚ˆã‚Šã‚‚ãšã£ã¨æ‚ªã„ã“ã¨ã§ã™ã€‚

ãã®ã‚ˆã†ãªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®æ„è¦‹ã¯WG21ã§ååˆ†ã«ä»£è¡¨ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã€ãã®ã‚ˆã†ãªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’è»½è¦–ã—ã¦WG21ã§ä»£è¡¨ã•ã‚Œã¦ã„ã‚‹æ„è¦‹ã ã‘ã«åŸºã¥ã„ã¦ãã®ã‚ˆã†ãªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ç¦æ­¢ã—ã¦ã—ã¾ãˆã°ã€ãã®ã‚ˆã†ãªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¯C++ã‹ã‚‰è¶³ã‚’é ã–ã‘ã‚‹ã“ã¨ã‚’é¸æŠã—ã¦ã—ã¾ã†ã§ã—ã‚‡ã†ã€‚

ã“ã‚Œã‚‰ã®ç†ç”±ã‹ã‚‰ã€ã“ã®æ–‡æ›¸ã§ã¯LEWGã®`noexcept`ãƒãƒªã‚·ãƒ¼ã¨ã—ã¦Lakos Ruleã‚’ç¶­æŒã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚

- [P3085R0 noexcept policy for SD-9 (throws nothing) - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3085R0-noexcept-policy-for-SD-9-throws-nothing)
- [P3155R0 noexcept policy for SD-9 (The Lakos Rule) - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3155R0-noexcept-policy-for-SD-9-The-Lakos-Rule)
- [P3318 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1967)

### [P3319R0 Add an iota object for simd (and more)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3319r0.pdf)

`std::simd`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆSIMDãƒ¬ã‚¸ã‚¹ã‚¿ï¼‰ã‚’é€£ç•ªã®å€¤ã§åˆæœŸåŒ–ã™ã‚‹APIã®ææ¡ˆã€‚

`std::simd`ã®ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆ0~SIMDå¹…ã®æ•´æ•°å®šæ•°ã‚’å—ã‘ã¦å€¤ã‚’ç”Ÿæˆã™ã‚‹å‘¼ã³å‡ºã—å¯èƒ½ãªã‚‚ã®ã‚’å—ã‘å–ã£ã¦åˆæœŸåŒ–ã™ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼‰ã®9å‰²ã®ç”¨é€”ã¨ã—ã¦ã€SIMDãƒ¬ã‚¸ã‚¹ã‚¿ã‚’é€£ç•ªï¼ˆ`0, 1, 2, 3...`ãŠã‚ˆã³ãã®å®šæ•°å€ã¨æ‰‹æ•°ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¶³ã—ãŸã‚‚ã®ï¼‰ã§åˆæœŸåŒ–ã™ã‚‹ã®ã«ã«ä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ãŒæƒ³å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

```cpp
// SIMDãƒ¬ã‚¸ã‚¹ã‚¿ã‚’0å§‹ã¾ã‚Šã®é€£ç•ªã§åˆæœŸåŒ–
std::simd<int> a ([](int i) { return i; }); 

// SIMDãƒ¬ã‚¸ã‚¹ã‚¿ã‚’2, 5, 8, 11...ã®é€£ç•ªã§åˆæœŸåŒ–
std::simd<int> b ([](int i) { return 2 + 3 * i; });
```

`std::simd<int>`ã¨ã™ã‚‹ã¨ã€ãã®ç’°å¢ƒã®`int`å‹ã®SIMDæ¼”ç®—ãŒæœ€ã‚‚åŠ¹ç‡çš„ã¨ãªã‚‹SIMDå¹…ãŒè‡ªå‹•ã§é¸æŠã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ©ãƒ ãƒ€å¼ã‚’æ¸¡ã™ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼‰ã¯ã€ãã®ãƒ©ãƒ ãƒ€å¼ã«å¯¾ã—ã¦0ã‹ã‚‰å§‹ã¾ã‚‹å®šæ•°å€¤ã‚’æ¸¡ã—ã¦å‘¼ã³å‡ºã—ã¦å¾—ã‚‰ã‚ŒãŸå€¤ã§ãã®SIMDãƒ¬ã‚¸ã‚¹ã‚¿ã‚’åˆæœŸåŒ–ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ã‚ˆã†ã«å¼·ãç‰¹å®šã®ç”¨é€”ã§ä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆã€æ±åŒ–ã™ã‚‹ã‚ˆã‚Šã‚‚ç‰¹åŒ–ã—ãŸAPIã«ã—ãŸæ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚

```cpp
// ä¸Šã®ä¾‹ã¨åŒã˜åˆæœŸåŒ–ã‚’è¡Œã†
auto a = std::iota_v<std::simd<int>>;
auto b = 2 + 3 * std::iota_v<std::simd<int>>
```

ã“ã®ææ¡ˆã¯ã€ã“ã®ã‚ˆã†ãªç”¨é€”ã®`std::simd`åˆæœŸåŒ–ã®ãŸã‚ã«ã“ã®`std::iota_v`ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

åå‰ã‹ã‚‰åˆ†ã‹ã‚‹ã‚ˆã†ã«ã€`std::iota_v`ã¯`std::simd`ã«å¯¾ã—ã¦`std::iota()`ï¼ˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰ãŒã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦è¡Œã†ã®ã¨åŒã˜åˆæœŸåŒ–ã‚’è¡Œã„ã¾ã™ã€‚ãŸã ã—ã€`std::iota_v`ã¯åˆæœŸåŒ–å¯¾è±¡ã®`std::simd`å‹ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§å—ã‘å–ã‚‹å¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã‚ã‚Šã€ãã®åˆæœŸåŒ–ã¯å¿…ãšå®šæ•°ã§åˆæœŸåŒ–ã•ã‚Œã€ã‹ã¤SIMDãƒ¬ã‚¸ã‚¹ã‚¿åˆæœŸåŒ–ã«ã¨ã£ã¦ã‚ˆã‚ŠåŠ¹ç‡çš„ãªã‚‚ã®ã¨ãªã‚Šã¾ã™ã€‚

```cpp
// ææ¡ˆã•ã‚Œã¦ã„ã‚‹å®£è¨€ã®ä¾‹

template<class T>
inline constexpr T iota_v;

// ç®—è¡“å‹ç”¨ã®ç‰¹æ®ŠåŒ–
template<class T>
  requires (std::is_arithmetic_v<T>)
inline constexpr T iota_v<T> = T();

// std::simdç”¨ã®ç‰¹æ®ŠåŒ–
template<detail::simd_type T>
inline constexpr T iota_v <T> = T([](auto i) { return static_cast<typename T::value_type>(i); });
```

ã•ã‚‰ã«ã“ã®ææ¡ˆã§ã¯ã€`std::iota_v<T>`ã§ä½¿ç”¨å¯èƒ½ãª`T`ã¨ã—ã¦ç®—è¡“å‹ã®ä»–

- é™çš„ãªè¦ç´ ç´ ã‚’æŒã¤
- `value_type`ãƒ¡ãƒ³ãƒã‚’æŒã¤
- é™çš„ãªè¦ç´ æ•°`N`ã«å¯¾ã—ã¦ã€`N`å€‹ã®`value_type`å‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«ã‚ˆã‚‹åˆæœŸåŒ–ãŒå¯èƒ½
- `value_type() + 1`ã¯å®šæ•°å¼ã§ã‚ã‚Šã€`value_type`ã«å¤‰æ›å¯èƒ½

ã‚’æº€ãŸã™ä»»æ„ã®å‹ã‚’ä½¿ç”¨å¯èƒ½ã«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

```cpp
// ã©ã¡ã‚‰ã‚‚å¯èƒ½
auto x = std::iota_v<float[5]>;
auto y = std::iota_v<std::array<my_fixed_point, 8>>;
```

ã“ã®ææ¡ˆã®é‡è¦ãªç‚¹ã¯ã€åˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰ãŒå®Ÿéš›ã®SIMDå¹…ã«åˆã‚ã›ã¦è‡ªå‹•ã§ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€å¯å¤‰é•·ã®ãƒªã‚¹ãƒˆåˆæœŸåŒ–ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹æ›¸ãã™ã‚‹å¿…è¦ã‚’ç„¡ãã™ã“ã¨ã§ã™ã€‚

- [P3319 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1968)

### [P3320R0 EWG slides for P3144 "Delete if Incomplete"](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3320r0.pdf)
### [P4000R0 To TS or not to TS: that is the question](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p4000r0.pdf)

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒTSã‚’ç›®æŒ‡ã™å ´åˆã«è€ƒæ…®ã™ã‚‹ã¹ãäº‹æŸ„ã«ã¤ã„ã¦ã¾ã¨ã‚ãŸã‚¹ãƒ©ã‚¤ãƒ‰ã€‚

å†…å®¹ã¨ã—ã¦ã¯ã€ä»Šæœˆåˆ†ã«ã‚ã‚‹P3269R0ã‚’ç´¹ä»‹ã™ã‚‹ã‚‚ã®ã®ã‚ˆã†ã§ã™ã€‚
