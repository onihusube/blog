# ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´05æœˆï¼‰

æ–‡æ›¸ã®ä¸€è¦§

- [JTC1/SC22/WG21 - Papers 2024 mailing2024-05](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/#mailing2024-05)

å…¨éƒ¨ã§139æœ¬ã‚ã‚Šã¾ã™ã€‚

ã‚‚ãã˜

[:contents]

### [N4983 WG21 agenda: 24-29 June 2024, St. Louis, MO, USA](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/n4983.html)

2024å¹´6æœˆã«ã‚»ãƒ³ãƒˆãƒ«ã‚¤ã‚¹ã§è¡Œã‚ã‚ŒãŸä¼šè­°ã®ã‚¢ã‚¸ã‚§ãƒ³ãƒ€ã€‚

### [P0260R9 C++ Concurrent Queues](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p0260r9.html)

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¸¦è¡Œã‚­ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã®è¨­è¨ˆã‚’ç·´ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0260R5 C++ Concurrent Queues - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/02/12/210302#P0260R5-C-Concurrent-Queues)
- [P0260R7 C++ Concurrent Queues - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/02/12/210302#P0260R5-C-Concurrent-Queues)
- [P0260R8 C++ Concurrent Queues - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P0260R8-C-Concurrent-Queues)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ææ¡ˆã™ã‚‹æ–‡è¨€ã®æ‹¡å……
- `capacity`ã®ä¿®æ­£
- `push()/pop()`ã®æ–‡è¨€ã«"strongly happens before"ã‚’ä½¿ã†ã‚ˆã†ã«å¤‰æ›´
- discussion pointsã‚’è¿½åŠ 
- ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒåŒã˜ã‚¹ãƒ¬ãƒƒãƒ‰ã«æˆ»ã‚‹ã“ã¨ã«é–¢ã™ã‚‹æ®µè½ã‚’å‰Šé™¤
- `try_*`ã¯ãƒ–ãƒ­ãƒƒã‚¯ã—ãªããªã£ãŸ
- `try_*`ã®spurious failureã«é–¢ã™ã‚‹æ–‡è¨€ã‚’è¿½åŠ 
- ã‚­ãƒ¥ãƒ¼ã‚’äº‹å‰ã«åŸ‹ã‚ã‚‹`bounded_queue`ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‰Šé™¤
- P3282ã¸ã®å‚ç…§ã‚’è¿½åŠ 
- `try_push(T &&, T &)`ã«é–¢ã™ã‚‹è­°è«–ã‚’Historic Contentsã«ç§»å‹•

ãªã©ã§ã™ã€‚

- [P0260 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/99)

### [P0843R12 inplace_vector](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p0843r12.html)

é™çš„ãªæœ€å¤§ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã‚’æŒã¡ãƒ’ãƒ¼ãƒ—é ˜åŸŸã‚’ä½¿ç”¨ã—ãªã„`std::vector`ã§ã‚ã‚‹`inplace_vector`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0843R5 static_vector - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´08æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/09/04/141015#P0843R5-static_vector)
- [P0843R6 static_vector - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P0843R6-static_vector)
- [P0843R8 `inplace_vector` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/09/23/203644#P0843R8-inplace_vector)
- [P0843R9 `inplace_vector` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/29/180915#P0843R9-inplace_vector)
- [P0843R10 `inplace_vector` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P0843R10-inplace_vector)
- [P0843R11 `inplace_vector` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P0843R11-inplace_vector)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ä»¥å‰ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚’å¾©å¸°ã—ã¦ã€æ¡ä»¶ä»˜ã`constexpr`ã‚’æœ‰åŠ¹åŒ–
- R8ã§å‰Šé™¤ã•ã‚ŒãŸ`constexpr`å¯¾å¿œã®è­°è«–ã‚’å†å°å…¥

ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã€2024å¹´6æœˆã®å…¨ä½“ä¼šè­°ã§C++26ã«å‘ã‘ã¦æ¡æŠã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P0843 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/114)

### [P0963R2 Structured binding declaration as a condition](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p0963r2.html)

æ§‹é€ åŒ–æŸç¸›å®£è¨€ã‚’æ¡ä»¶å¼ã‚’æ›¸ãã¨ã“ã‚ã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0963R1 Structured binding declaration as a condition - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´08æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/14/223052#P0963R1-Structured-binding-declaration-as-a-condition)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€åˆ†è§£å‰ã«æ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨ã„ã†è©•ä¾¡é †åºã‚’è¦å®šã—ãã‚Œã«ã¤ã„ã¦ã®è­°è«–ã‚’è¿½åŠ ã—ãŸã“ã¨ã¨ã€ææ¡ˆã™ã‚‹æ–‡è¨€ã®æ”¹å–„ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã€2024å¹´6æœˆã®å…¨ä½“ä¼šè­°ã§C++26ã«å‘ã‘ã¦æ¡æŠã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P0963 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1617)

### [P1000R6 C++ IS schedule](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1000r6.pdf)

C++26ç­–å®šã¾ã§ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãªã©ã‚’èª¬æ˜ã—ãŸæ–‡æ›¸ã€‚

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã¯R5ã®ã‚‚ã®ã¨ã»ã¼åŒã˜ã§ã™ãŒã€æ±ºå®šæ¸ˆã¿ã®ä¼šè­°é–‹å‚¬åœ°ã®åœ°åãŒè¨˜è¼‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

### [P1083R8 Move resource_adaptor from Library TS to the C++ WP](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1083r8.html)

`pmr::resource_adaptor`ã‚’Library Foundermental TSã‹ã‚‰ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‰ãƒ©ãƒ•ãƒˆã¸ç§»å‹•ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1083R4 Move `resource_adaptor` from Library TS to the C++ WP - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/02/19/181101#P1083R4-Move-resource_adaptor-from-Library-TS-to-the-C-WP)
- [P1083R5 Move `resource_adaptor` from Library TS to the C++ WP - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´03æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/04/02/175835#P1083R5-Move-resource_adaptor-from-Library-TS-to-the-C-WP)
- [P1083R6 Move `resource_adaptor` from Library TS to the C++ WP - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/08/11/193828#P1083R6-Move-resource_adaptor-from-Library-TS-to-the-C-WP)
- [P1083R7 Move `resource_adaptor` from Library TS to the C++ WP - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/11/13/233529#P1083R7-Move-resource_adaptor-from-Library-TS-to-the-C-WP)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€`resource-adaptor-imp`ã«å¯å¤‰é•·å¼•æ•°ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ ã—ãŸäº‹ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ç¾åœ¨LWGã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­ã§ã™ã€‚

- [P1083 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/33)

### [P1112R5 Language support for class layout control](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1112r5.pdf)

ã‚¯ãƒ©ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ˜ç¤ºçš„ã«åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®æ§‹æ–‡ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1112R4 Language support for class layout control - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P1112R4-Language-support-for-class-layout-control)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- Cã§ã¯æ§‹é€ ä½“ãƒ¡ãƒ³ãƒã®å®£è¨€é †èª¿æ•´ã§ã“ã®å•é¡Œã‚’è§£æ¶ˆã§ãã‚‹ãŒã€C++ã§ã¯ãã‚Œã¯å®Ÿè¡Œå¯èƒ½ã§ã¯ãªã„ã“ã¨ã«ã¤ã„ã¦ã®èª¬æ˜ã®è¿½åŠ 
- ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã“ã®å•é¡Œã‚’è§£æ±ºã§ããªã„ã“ã¨ã«ã¤ã„ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- Design principlesã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- `eval`ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼ã‚’è¿½åŠ 
- `smallest`ã‚’`small`ã«å¤‰æ›´ã—ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®èª¬æ˜ã‚’è¿½åŠ 
- å¯¾è±¡èª­è€…ã‚’è¿½åŠ 
- æ–‡è¨€ä½œæˆã«é–¢ã™ã‚‹æˆ¦ç•¥ã‚’è¿½è¨˜

ãªã©ã§ã™ã€‚

ä»Šå›ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«é–¢ã™ã‚‹æŒ‡ç¤ºã‚’è¡Œã†æ–¹æ³•ãŒ1ã¤è¿½åŠ ã•ã‚Œã¾ã—ãŸ

- `layout(eval(consteval_func))`
  - å…ƒã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã®é…åˆ—ã¨ã—ã¦å–å¾—ã—ã€ã‚ªãƒ•ã‚»ãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å¤‰æ›´ã§ãã‚‹`consteval`é–¢æ•°ã‚’å‘¼ã³å‡ºã™

`layout(eval(func))`ã«æ¸¡ã™`consteval`é–¢æ•°ã¯ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å¤‰æ›´ã™ã‚‹å ´åˆã«`true`ã‚’è¿”ã—ã€å¤‰æ›´ã—ãªã„ãªã‚‰ã°`false`ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã—ã¦ã€ãã®å¼•æ•°ã«ã¯æ¬¡ã®ã‚ˆã†ãªæ§‹é€ ä½“ã®é…åˆ—ãŒæ¸¡ã•ã‚Œã¾ã™

```cpp
// ã‚¯ãƒ©ã‚¹ã®å…ƒã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ã¤ã„ã¦ã®ã€å„ãƒ¡ãƒ³ãƒæ¯ã®æƒ…å ±ã‚’æŒã¤
struct layout_entry {
  enum type_id { base, member, tech };
  type_id type;
  string_view name; // ãƒ¡ãƒ³ãƒå
  size_t index;     // å®£è¨€é †ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  size_t size;      // sizeof()ã®çµæœã®å€¤
  int alignment;    // alignas()ã®çµæœã®å€¤
  bool noua;        // [[no_unique_address]]ã®æœ‰ç„¡
  bool fixed;       // ãƒ ãƒ¼ãƒ–å¯èƒ½ã‹ã©ã†ã‹
  size_t orig_offset;    // å…ƒã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ãŠã‘ã‚‹ã‚ªãƒ•ã‚»ãƒƒãƒˆ
  mutable size_t offset; // å¤‰æ›´ã™ã‚‹ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆåˆæœŸå€¤ã¯orig_offsetã®å€¤ï¼‰
};

// layout(eval(f))ã«æ¸¡ã™é–¢æ•°ã®ä¾‹
consteval bool my_layout_func(span<const layout_entry> entries);
```

ã“ã‚Œã«ã‚ˆã£ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒã¯ã‹ãªã‚Šè©³ç´°ã«ãã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã“ã‚Œä»¥ä¸Šè¿½æ±‚ã—ãªã„ã“ã¨ãŒEWGã§æ±ºå®šã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

- [P1112 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/38)

### [P1144R11 `std::is_trivially_relocatable`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1144r11.html)

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†é…ç½®ï¼ˆ*relocation*ï¼‰ã¨ã„ã†æ“ä½œã‚’å®šç¾©ã—ã€ãã‚Œã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®åŸºç›¤ã‚’æ•´ãˆã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1144R6 Object relocation in terms of move plus destroy - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´06æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/07/09/160343#P1144R6-Object-relocation-in-terms-of-move-plus-destroy)
- [P1144R7 `std::is_trivially_relocatable` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/04/23/192236#P1144R7-stdis_trivially_relocatable)
- [P1144R8 `std::is_trivially_relocatable` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P1144R8-stdis_trivially_relocatable)
- [P1144R9 `std::is_trivially_relocatable` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P1144R9-stdis_trivially_relocatable)
- [P1144R10 `std::is_trivially_relocatable` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P1144R10-stdis_trivially_relocatable)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ã“ã®ææ¡ˆã«æº–æ‹ æ¸ˆã¿ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¤ã„ã¦ã®å‚ç…§ã®è¿½åŠ 
- `uninitialized_relocate_n`ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãŸã‚ã«`NoThrowInputIterator`è¦ä»¶ã‚’è¿½åŠ 
- P3279ã¸ã®ç›¸äº’å‚ç…§ã‚’è¿½åŠ 

ãªã©ã§ã™ã€‚

- [P1144 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/43)

### [P1255R13 A view of 0 or 1 elements: views::nullable And a concept to constrain maybes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1255r13.pdf)

ä»»æ„ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„`std::optional`ç­‰ã®maybeãƒ¢ãƒŠãƒ‰ãªå¯¾è±¡ã‚’è¦ç´ æ•°0ã‹1ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¤‰æ›ã™ã‚‹Rangeã‚¢ãƒ€ãƒ—ã‚¿`views::maybe`/`views::nullable`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1255R6 : A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/05/01/194425#P1255R6--A-view-of-0-or-1-elements-viewsmaybe)
- [P1255R7 : A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/06/11/191943#P1255R7-A-view-of-0-or-1-elements-viewsmaybe)
- [P1255R8 A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/08/11/193828#P1255R8-A-view-of-0-or-1-elements-viewsmaybe)
- [P1255R9 A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´08æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/09/04/141015#P1255R9-A-view-of-0-or-1-elements-viewsmaybe)
- [P1255R10 A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/29/180915#P1255R10-A-view-of-0-or-1-elements-viewsmaybe)
- [P1255R12 A view of 0 or 1 elements: `views::maybe` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/03/10/170322#P1255R12-A-view-of-0-or-1-elements-viewsmaybe)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- `views::maybe`ã‚’å‰Šé™¤ã—ã€`std::optional`ã®`range`åŒ–ã‚’å¥½ã‚€
- `std::maybe`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®è¿½åŠ 
- `std::optional`ã‚„ãƒã‚¤ãƒ³ã‚¿å‹ãªã©`maybee`å‹ã®ãŸã‚ã®ãƒ•ãƒªãƒ¼é–¢æ•°ã‚’è¿½åŠ 

ãªã©ã§ã™ã€‚

`std::maybe`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¯æ¬¡ã®ã‚ˆã†ãªå˜ç´”ãªã‚‚ã®ã§ã™

```cpp
template <class T>
concept maybe = requires(const T t) {
  bool(t);
  *(t);
};
```

ã“ã‚Œã«å¯¾ã—ã¦æ¬¡ã®ãƒ•ãƒªãƒ¼é–¢æ•°ã‚’è¿½åŠ ã—ã¾ã™

```cpp
template <class T, class R = optional<decay_t<T>>>
constexpr auto yield_if(bool b, T&& t) -> R {
  return b ? forward<T>(t) : R{};
}

template <maybe T,
          class U,
          class R = common_reference_t<iter_reference_t<T>, U&&>>
constexpr auto reference_or(T&& m, U&& u) -> R {
  static_assert(!reference_constructs_from_temporary_v<R, U>);
  static_assert(!reference_constructs_from_temporary_v<R, T&>);
  return bool(m) ? static_cast<R>(*m) : static_cast<R>((U&&)u);
}

template <maybe T,
          class U,
          class R = common_type_t<iter_reference_t<T>, U&&>>
constexpr auto value_or(T&& m, U&& u) -> R {
  return bool(m) ? static_cast<R>(*m) : static_cast<R>(forward<U>(u))
}

template <maybe T,
          class I,
          class R = common_type_t<iter_reference_t<T>,
          invoke_result_t<I>>>
constexpr auto or_invoke(T&& m, I&& invocable) -> R {
  return bool(m) ? static_cast<R>(*m) : static_cast<R>(invocable());
}
```

- [P1255 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/60)

### [P1306R2 Expansion statements](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1306r2.pdf)

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ãƒ«ãƒ¼ãƒ—ç”Ÿæˆã™ã‚‹ã“ã¨ã®ã§ãã‚‹ã€å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®ææ¡ˆã€‚

å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¨ã¯ã€é€šå¸¸ã®`range`ï¼ˆé…åˆ—ã‚„`std::vector`ç­‰ã‚³ãƒ³ãƒ†ãƒŠï¼‰ã«åŠ ãˆã¦ã‚¿ãƒ—ãƒ«ã‚„ã‚¯ãƒ©ã‚¹ã€æ³¢ã‹ã£ã“ã®ãƒªã‚¹ãƒˆã‚’åå¾©ã™ã‚‹ã“ã¨ã®ã§ãã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®ãƒ«ãƒ¼ãƒ—æ§‹æ–‡ã§ã‚ã‚Šã€ãƒ«ãƒ¼ãƒ—ã®çµæœã¨ã—ã¦ã¯ãƒ«ãƒ¼ãƒ—æœ¬ä½“ã®ã‚³ãƒ¼ãƒ‰ï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆï¼‰ã‚’ãƒ«ãƒ¼ãƒ—ã®åº¦ã«ãã®å ´ã«å±•é–‹ã—ã¦ã„ãã¾ã™ã€‚

ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªæ‹¡å¼µã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯

```cpp
auto tup = std::make_tuple(0, â€˜aâ€™, 3.14);
template for (auto elem : tup) {
  std::cout << elem << std::endl;
}
```

æ¬¡ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’ã¹ãŸæ›¸ãã—ãŸã®ã¨ç­‰ä¾¡ã«ãªã‚Šã¾ã™

```cpp
auto tup = std::make_tuple(0, â€˜aâ€™, 3.14);
{
  auto elem = std::get<0>(tup);
  std::cout << elem << std::endl;
}
{
  auto elem = std::get<1>(tup);
  std::cout << elem << std::endl;
}
{
  auto elem = std::get<2>(tup);
  std::cout << elem << std::endl;
}
```

ã¾ãŸå±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã§ã¯ã€æ³¢ã‹ã£ã“ãƒªã‚¹ãƒˆãŒç‰¹åˆ¥æ‰±ã„ã•ã‚Œã¦ãŠã‚Šã€ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™

```cpp
template for (auto elem : {0, 'a', 3.14}) {
  std::cout << elem << std::endl;
}
```

ã“ã®æ³¢ã‹ã£ã“ãƒªã‚¹ãƒˆã¯åˆæœŸåŒ–å­ãƒªã‚¹ãƒˆã§ã¯ãªãã€ã“ã®æ³¢ã‹ã£ã“ãƒªã‚¹ãƒˆã¯åˆæœŸåŒ–ã‚’è¡Œã‚ãšã«å„è¦ç´ ã«å¯¾ã—ã¦ç›´æ¥ãƒ«ãƒ¼ãƒ—ãŒå±•é–‹ã•ã‚Œã¾ã™ã€‚

å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯æ¬¡ã®ã‚‚ã®ã«å¯¾ã—ã¦ä½¿ç”¨ã§ãã¾ã™

- æ§‹é€ åŒ–æŸç¸›å¯èƒ½ãªã‚¯ãƒ©ã‚¹å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    - ãƒ—ãƒ¬ãƒ¼ãƒ³ãªæ§‹é€ ä½“ã‚„ã‚¿ãƒ—ãƒ«ãªã©
- `constexpr`ãªç¯„å›²ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    - ä¸»ã«`std::vector`
- æ³¢ã‹ã£ã“ã§åŒºåˆ‡ã‚‰ã‚ŒãŸå¼ã®ãƒªã‚¹ãƒˆï¼ˆå±•é–‹åˆæœŸåŒ–å­ãƒªã‚¹ãƒˆã€"expansion-init-lists"ï¼‰
    - ä¾‹ãˆã°ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ‘ãƒƒã‚¯ã‚‚`{pack...}`ã¨ã™ã‚‹ã“ã¨ã§ãƒ«ãƒ¼ãƒ—å¯¾è±¡ã«ãªã‚‹

å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯ãƒ«ãƒ¼ãƒ—ãªé¢¨ã‚’è£…ã£ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®ã¨ã“ã‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã£ã¦ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ãã®ã§ã¯ãªãã€äºˆã‚ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾è±¡ã®å„è¦ç´ ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®åˆ—ã¨ã—ã¦ã€ç¯„å›²`for`åŒæ§˜ã«è¨€èªçµ„ã¿è¾¼ã¿ã®ãƒã‚¯ãƒ­ã®ã‚ˆã†ãªå½¢ã§ã€ä¸€ç™ºã§ç½®æ›ã•ã‚Œã¾ã™ã€‚ã¨ã¯ã„ãˆã€çµæœã®ã‚³ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–é †åºã‚„å®Ÿè¡Œã•ã‚ŒãŸæ™‚ã®å®Ÿè¡Œé †ã¯ã‚ãŸã‹ã‚‚ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã£ã¦é †ç•ªã«ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆãŒç”Ÿæˆã•ã‚Œã¦ã„ã£ãŸã®ã¨åŒã˜ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

ã“ã®å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯ç‰¹ã«é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã¨éå¸¸ã«ç›¸æ€§ãŒè‰¯ã„æ©Ÿèƒ½ã§ã™ã€‚P2996R5ã‚ˆã‚Šã€åˆ—æŒ™å€¤ã‚’åˆ—æŒ™å€¤åã®æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

```cpp
template <typename E>
  requires std::is_enum_v<E>
constexpr std::string enum_to_string(E value) {
  template for (constexpr auto e : std::meta::enumerators_of(^E)) {
    if (value == [:e:]) {
      return std::string(std::meta::identifier_of(e));
    }
  }

  return "<unnamed>";
}

enum Color { red, green, blue };
static_assert(enum_to_string(Color::red) == "red");
static_assert(enum_to_string(Color(42)) == "<unnamed>");
```

`^E`ã¯åˆ—æŒ™å‹`E`ã‹ã‚‰ãã®ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’å–ã‚Šå‡ºã—ã¦ãŠã‚Šã€ãã‚Œã«å¯¾ã™ã‚‹`std::meta::enumerators_of()`ã¯åˆ—æŒ™å‹ã®å„åˆ—æŒ™å­ã®ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’å–ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾è±¡`e`ã¯`std::meta::info`ã®å€¤ã§ã€`[:e:]`ï¼ˆã‚¹ãƒ—ãƒ©ã‚¤ã‚·ãƒ³ã‚°ï¼‰ã«ã‚ˆã£ã¦å¯¾å¿œã™ã‚‹åˆ—æŒ™å€¤ã®å®šæ•°å€¤ã«å¤‰æ›ã™ã‚‹ã“ã¨ã§ã€å±•é–‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®å„ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯åˆ—æŒ™å‹`E`ã®åˆ—æŒ™å­1ã¤ã«å¯¾ã—ã¦ãƒãƒƒãƒã™ã‚‹`if`æ–‡ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

`(std::meta::identifier_of()`ã¯ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã‹ã‚‰ãã‚Œã«å¯¾å¿œã™ã‚‹è­˜åˆ¥å­åã‚’æ–‡å­—åˆ—ã§å¾—ã‚‹ã‚‚ã®ã§ã€ã“ã“ã§ã¯`e`ã¯åˆ—æŒ™å­ã‚’æ˜ ã—ãŸã‚‚ã®ãªã®ã§ã€åˆ—æŒ™å­åãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æ–‡å­—åˆ—ã§å¾—ã‚‰ã‚Œã¾ã™ã€‚

ã“ã®`template for`ä»¥å¤–ã®ã‚‚ã®ã¯P2996ã®é™çš„ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆã§ã™ã¹ã¦ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚

- [P1306 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/156)

### [P1494R3 Partial program correctness](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1494r3.html)

å› æœé–¢ä¿‚ã‚’é€†è»¢ã™ã‚‹ã‚ˆã†ãªéåº¦ãªæœ€é©åŒ–ã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã®ãƒãƒªã‚¢ã§ã‚ã‚‹`std::observable()`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1494R2 Partial program correctness - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/12/11/220126#P1494R2-Partial-program-correctness)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã§ã®ã‚µãƒãƒ¼ãƒˆã‚’è¦æ±‚
- å®Ÿè£…å¯èƒ½æ€§ã‚’æ˜ç¢ºåŒ–
- I/Oé–¢æ•°ã‚’æš—é»™çš„ãªãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æ‰±ã†ã‚ˆã†ã«ã™ã‚‹ä»£æ›¿æ¡ˆã«ã¤ã„ã¦ã®èª¬æ˜ã®è¿½åŠ 

ãªã©ã§ã™ã€‚

- [P1494 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/376)

### [P1928R9 `std::simd` - Merge data-parallel types from the Parallelism TS 2](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1928r9.pdf)

`std::simd<T>`ã‚’Parallelism TS v2ã‹ã‚‰æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ç§»ã™ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1928R1 Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/11/02/221657#P1759R3-Native-handles-and-file-streams)
- [P1928R2 Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/02/12/210302#P1928R2-Merge-data-parallel-types-from-the-Parallelism-TS-2)
- [P1928R3 Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/03/19/184146#P1928R3-Merge-data-parallel-types-from-the-Parallelism-TS-2)
- [P1928R4 `std::simd` - Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/07/08/205803#P1928R4-stdsimd---Merge-data-parallel-types-from-the-Parallelism-TS-2)
- [P1928R6 `std::simd` - Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/09/23/203644#P1928R6-stdsimd---Merge-data-parallel-types-from-the-Parallelism-TS-2)
- [P1928R7 `std::simd` - Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/01/08/203712#P1928R7-stdsimd---Merge-data-parallel-types-from-the-Parallelism-TS-2)
- [P1928R8 `std::simd` - Merge data-parallel types from the Parallelism TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/02/29/191439#P1928R8-stdsimd---Merge-data-parallel-types-from-the-Parallelism-TS-2)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ãƒ™ã‚¯ãƒˆãƒ«åŒ–å¯èƒ½ãªå‹ã¨ã—ã¦ã€C++23ã®æ‹¡å¼µæµ®å‹•å°æ•°ç‚¹æ•°å‹ã‚’è¿½åŠ 
- "selected indicesâ€ã¨â€œselected elementsâ€ã®å®šç¾©ã‚’æ”¹å–„
- ABIã‚¿ã‚°ã®æ„å›³ã‚’ç´¹ä»‹ã™ã‚‹æ–‡è¨€ã®æ”¹å–„
- `size`ã‚’å‘¼ã³å‡ºã—å¯èƒ½ã¨ã—ã¦ä¸€è²«ã—ã¦ä½¿ç”¨
- ä¸è¶³ã—ã¦ã„ãŸ`reduce`ã®`type_identity_t`ã‚’è¿½åŠ 
- `basic_simd_mask`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¼•æ•°ã‚’`native-abi`ã«ä¿®æ­£
- `simd_mask`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¼•æ•°ã‚’`simd`ã¨ä¸€è²«ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£
- `<simd>`ãƒ˜ãƒƒãƒ€ã‚’è¿½åŠ ã™ã‚‹ã®ã«å¿…è¦ãªå¤‰æ›´ã‚’è¿½åŠ 
- 2ã¤ã®æŠ•ç¥¨çµæœã‚’è¿½åŠ 
- `simd_size(_v)`ã‚’èª¬æ˜å°‚ç”¨ã«ã™ã‚‹
- `reduce_min_index`ã¨`reduce_max_index`äº‹å‰æ¡ä»¶ã‚’å¾©å…ƒ

ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ç¾åœ¨ã€LWGã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­ã§ã™ã€‚

- [P1928 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/670)

### [P2019R6 Thread attributes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2019r6.pdf)
### [P2034R4 Partially Mutable Lambda Captures](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2034r4.pdf)
### [P2079R4 System execution context](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2079r4.html)
### [P2413R1 Remove unsafe conversions of unique_ptr](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2413r1.html)
### [P2434R1 Nondeterministic pointer provenance](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2434r1.html)
### [P2689R3 Atomic Refs Bound to Memory Orderings & Atomic Accessors](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2689r3.html)
### [P2719R0 Type-aware allocation and deallocation functions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2719r0.html)

å‹ã‚’æŒ‡å®šã™ã‚‹å½¢ã®`new/delete`æ¼”ç®—å­ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ–¹æ³•ã®ææ¡ˆã€‚

ã‚ã‚‹å‹ã«ã¤ã„ã¦ã€`new/delete`æ¼”ç®—å­ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹æ–¹æ³•ã¯ã€ã‚¯ãƒ©ã‚¹ã®é™çš„ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦å®šç¾©ã™ã‚‹ã‹ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª`new/delete`æ¼”ç®—å­ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹ã‹ã®2æŠã§ã™ã€‚`new/delete`æ¼”ç®—å­ã‚’å‹ã”ã¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å ´åˆã¯ãã®å‹ã«ã¤ã„ã¦ã®çŸ¥è­˜ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ãŒã€å‰è€…ã®æ–¹æ³•ã ã¨ãã‚ŒãŒå¾—ã‚‰ã‚Œã‚‹ã‚‚ã®ã®å‹ã«å¯¾ã—ã¦ä¾µå…¥çš„ã«ã—ã‹å®šç¾©ã§ãã¾ã›ã‚“ã€‚ä¸€æ–¹å¾Œè€…ã®æ–¹æ³•ã¯éä¾µå…¥çš„ã«å®šç¾©ã§ãã‚‹ã‚‚ã®ã®ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª`new/delete`ã‚’ä¸¸ã”ã¨ç½®ãæ›ãˆã‚‹ã“ã¨ã«ãªã‚‹ï¼ˆå‹æ¯ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰å¯èƒ½ãªã‚‚ã®ã®ã€ç¾å®Ÿã«ã¯`::operator new(void*)`ã‚’ä¸¸ã”ã¨ç½®æ›ã—ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ãŒã»ã¨ã‚“ã©ï¼‰ãŸã‚å½±éŸ¿ç¯„å›²ãŒå¤§ããã€è¤‡æ•°ã®ç¿»è¨³å˜ä½ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ãŒç‹¬è‡ªã«ãã‚Œã‚’è¡Œã£ã¦ã„ã‚‹ã¨ODRé•åã®æœªå®šç¾©å‹•ä½œã§å„ä»‹ãªãƒã‚°ã‚’æŠ±ãˆè¾¼ã‚€ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã‚ã‚‹å‹ã«ã¤ã„ã¦ã®`new/delete`æ¼”ç®—å­ã®éä¾µå…¥çš„ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ–¹æ³•ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã«ã‚ˆã‚‹ã‚«ã‚¹ã‚¿ãƒ æ–¹æ³•ã¯ã€æ—¢å­˜ã®`operator new/delete`ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒã‚¿ã‚°å‹ã‚’å–ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã®å»¶é•·ã§ã€ã‚ã‚‹å‹`T`ã«ã¤ã„ã¦ã®`new/delete`æ¼”ç®—å­ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯ã‚¿ã‚°å‹ã¨ã—ã¦`std::type_identity<T>`ã‚’å–ã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ãã—ã¦ã€`new/delete`å¼ãŒæ¼”ç®—å­ã‚’æ¢ç´¢ã™ã‚‹éç¨‹ã‚’å°‘ã—èª¿æ•´ã—ã¦ã€ã“ã®ã‚ˆã†ãªã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒç™ºè¦‹ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã®å‰å¾Œã§ã‚ã‚‹`new`æ¼”ç®—å­å‘¼ã³å‡ºã—ï¼ˆ`new`å¼ï¼‰ã«å¯¾ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè€ƒæ…®ã™ã‚‹`new`æ¼”ç®—å­ã®ã‚·ã‚°ãƒãƒãƒ£å€™è£œã¨é †ç•ªã¯æ¬¡ã®ã‚ˆã†ã«å¤‰åŒ–ã—ã¾ã™

<table>
<tr>
<th>ç¾åœ¨</th>
<th>ã“ã®ææ¡ˆ</th>
</tr>
<tr>
<td valign="top">

```cpp
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãnewæ¼”ç®—å­
new (args...) T(...)

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè€ƒæ…®ã™ã‚‹æ¼”ç®—å­
T::operator new(sizeof(T), args...)
::operator new(sizeof(T), args...)
```

</td>
<td valign="top">

```cpp
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãnewæ¼”ç®—å­
new (args...) T(...)

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè€ƒæ…®ã™ã‚‹æ¼”ç®—å­
T::operator new(sizeof(T), args...)
operator new(sizeof(T), type_identity<T>{}, argsâ€¦)  // ğŸ‘ˆè¿½åŠ 
::operator new(sizeof(T), args...)
```

</td>
</tr>
</table>


<table>
<tr>
<th>ç¾åœ¨</th>
<th>ã“ã®ææ¡ˆ</th>
</tr>
<tr>
<td valign="top">

```cpp
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãdeleteæ¼”ç®—å­
delete ptr

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè€ƒæ…®ã™ã‚‹æ¼”ç®—å­
T::operator delete(void-ptr)
::operator delete(void-ptr)
```

</td>
<td valign="top">

```cpp
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›¸ãdeleteæ¼”ç®—å­
delete ptr

// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè€ƒæ…®ã™ã‚‹æ¼”ç®—å­
T::operator delete(void-ptr)
operator delete(void-ptr, type_identity<T>{})  // ğŸ‘ˆè¿½åŠ 
::operator delete(void-ptr)
```

</td>
</tr>
</table>

é…åˆ—ç‰ˆã‚‚åŒæ§˜ã§ã™ã€‚

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã«ã€å‹æ¯ã«ç•°ãªã‚‹ãƒ¡ãƒ¢ãƒªé ˜åŸŸã«é…ç½®ã™ã‚‹ï¼ˆåŒã˜å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åŒã˜ãƒ¡ãƒ¢ãƒªé ˜åŸŸã«é…ç½®ã™ã‚‹ï¼‰ã¨ã„ã†ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒã‚ã‚Šã€ã“ã‚Œã«ã‚ˆã£ã¦Type Confusionæ”»æ’ƒã«å¯¾ã™ã‚‹è€æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã§ã™ã€‚å®Ÿéš›ã«ã€Appleã§ã¯è‡ªç¤¾é–‹ç™ºã®OSã‚«ãƒ¼ãƒãƒ«ã§ã“ã‚Œã‚’å°å…¥ã™ã‚‹ã“ã¨ã§Type Confusionè„†å¼±æ€§ã®è»½æ¸›ã«å¤§ããªåŠ¹æœãŒã‚ã£ãŸã¨ã®ã“ã¨ã§ã™ï¼ˆç­†è€…ã®æ–¹ã¯Appleã®æ–¹ï¼‰ã€‚

ã‚«ãƒ¼ãƒãƒ«ã«é™ã‚‰ãšã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒé‡è¦ãªã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã¯ã“ã®ã‚ˆã†ãªæ‰‹æ³•ã‚’å–ã‚Šå…¥ã‚Œã‚‹ã“ã¨ãŒåˆç†çš„ãªå ´åˆãŒã‚ã‚Šã¾ã™ãŒã€ç¾åœ¨ã®C++ã®`new/delete`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯ã“ã®ã‚ˆã†ãªæ‰‹æ³•ã‚’å¤§è¦æ¨¡ã‹ã¤ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§é”æˆã™ã‚‹ã“ã¨ã‚’ã‚µãƒãƒ¼ãƒˆã§ãã¦ã„ã¾ã›ã‚“ã€‚ã“ã®ææ¡ˆã®å†…å®¹ã¯ãã®ã‚ˆã†ãªæ‰‹æ³•ã‚’é”æˆã™ã‚‹ãŸã‚ã®æ§‹æˆè¦ç´ ã§ã‚ã‚Šã€é–“æ¥çš„ã«C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã«ç¹‹ãŒã‚Šã¾ã™ã€‚

ææ¡ˆæ–‡æ›¸ã‚ˆã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

```cpp
namespace lib {
  struct Foo { };

  void* operator new(std::size_t, std::type_identity<Foo>); // (1)

  struct Foo2 { };
}

struct Bar {
  static void* operator new(std::size_t); // (2)
};

void* operator new(std::size_t); // (3)

void f() {
  new lib::Foo();  // calls (1)
  new Bar();       // calls (2)
  new lib::Foo2(); // (1)ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã«å¤±æ•—ã™ã‚‹ãŸã‚ã€(3)ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹
  new int();       // calls (3)
}
```

ç¾åœ¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯`new`æ¼”ç®—å­ã®æ¢ç´¢ã«ãŠã„ã¦ã€ã¾ãšå¯¾è±¡ã®å‹ï¼ˆ`new T{}`ã®`T`ï¼‰ã®ã‚¯ãƒ©ã‚¹ã‚¹ã‚³ãƒ¼ãƒ—ã§`T::operator new()`ã‚’æ¢ç´¢ã—ã€è¦‹ã¤ã‹ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã—ã¾ã™ã€‚è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€æ¬¡ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®`::operator new()`ã‚’æ¢ç´¢ã—ã€è¦‹ã¤ã‹ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã©ã¡ã‚‰ã‹ãŒè¦‹ã¤ã‹ã‚Œã°ä¾‹ãˆã°ãã‚ŒãŒã‚¨ãƒ©ãƒ¼ã§ã‚‚æ¢ç´¢ã¯ãã‚Œã§çµ‚äº†ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª`::operator new()`ã‚’æ¢ç´¢ã™ã‚‹å‰ã«ã€ãƒ•ãƒªãƒ¼é–¢æ•°ã®`operator new()`ã‚’è€ƒæ…®ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ãã®éš›ã®ã‚·ã‚°ãƒãƒãƒ£ã¯æ¬¡ã®ã‚‚ã®ã§ã™

```cpp
operator new(sizeof(T), std::type_identity<T>{}, placement-args...)
```

å‹`T`ã«å¯¾ã—ã¦ç¬¬äºŒå¼•æ•°ã§`std::type_identity<T>`ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã—ã¦ãŠãã“ã¨ã§ã€ã“ã®æŒ¿å…¥ã•ã‚ŒãŸ2ã‚¹ãƒ†ãƒƒãƒ—ç›®ã®æ¢ç´¢ã§ãã‚Œã‚’ä½¿ã‚ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‚ã‘ã§ã™ã€‚ãã—ã¦ã€ã“ã®æ¢ç´¢ã¯ADLã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã‚‹ãŸã‚ã€åå‰ç©ºé–“å†…ã§`new/delete`æ¼”ç®—å­ã‚’å®šç¾©ã—ã¦ãŠãã“ã¨ã‚‚ã§ãã€ã“ã‚Œã«ã‚ˆã£ã¦ODRé•åã‚’ç·©å’Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- [å‹ã®å–ã‚Šé•ãˆã¨ã¯(Type Confusion) | ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒå¤§è¾å…¸](https://securitychecklist.net/security/cyber-attack/Type-Confusion.html)
- [P2719 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1898)

### [P2758R3 Emitting messages at compile time](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2758r3.html)
### [P2761R1 Slides: If structured binding (P0963R1 presentation)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2761r1.pdf)
### [P2786R6 Trivial Relocatability For C++26](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2786r6.pdf)
### [P2822R1 Providing user control of associated entities of class types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2822r1.pdf)
### [P2830R4 Standardized Constexpr Type Ordering](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2830r4.html)
### [P2835R4 Expose std::atomic_ref's object address](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2835r4.html)
### [P2841R3 Concept and variable-template template-parameters](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2841r3.pdf)
### [P2846R2 reserve_hint: Eagerly reserving memory for not-quite-sized lazy ranges](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2846r2.pdf)
### [P2849R0 async-object - aka async-RAII objects](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2849r0.pdf)

`sender`ãƒã‚§ãƒ¼ãƒ³ã«RAIIãƒªã‚½ãƒ¼ã‚¹ã‚’æ³¨å…¥ã™ã‚‹ãŸã‚ã®ã€éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ææ¡ˆã€‚

`sender/receiver`è‡ªä½“ã¯éåŒæœŸé–¢æ•°ã®å®Ÿè£…ã®ä¸€éƒ¨ã§ã‚ã‚Šã€P2300ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯éåŒæœŸé–¢æ•°ã¯å€¤ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã®ã„ãšã‚Œã‹ã®çµæœã«ã‚ˆã£ã¦éåŒæœŸçš„ã«å®Œäº†ã—ã¾ã™ã€‚

éåŒæœŸé–¢æ•°ã®å†…éƒ¨ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ï¼ˆéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã¯ã€éé“çš„å‡¦ç†ãŒå˜ä¸€ã®ãƒ­ãƒ¼ã‚«ãƒ«ãªãƒ–ãƒ­ãƒƒã‚¯ã«åã¾ã‚‹ã‚‚ã®ã§ã¯ãªã„ãŸã‚ã€é€šå¸¸æ‰‹å‹•ã§ãƒ¡ãƒ¢ãƒªã‚’ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

`sender`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ãƒã‚§ãƒ¼ãƒ³ã«å¯¾ã—ã¦å€¤ã‚’æ³¨å…¥ã™ã‚‹ã«ã¯ã€`let_value(value, func)`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€`func(value)`ã®çµæœã‚’ï¼ˆ`receiver`ã®å€¤ãƒãƒ£ãƒãƒ«ã§ï¼‰è¿”ã™`sender`ã‚’è¿”ã™ã‚‚ã®ã§ã€ãã“ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹å€¤ï¼ˆ`func(value)`ã®çµæœï¼‰ã¯å®‰å®šã—ãŸã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿æŒã•ã‚Œã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

ã“ã‚Œã¨åŒç¨®ãªã‚‚ã®ã¨ã—ã¦ã€`let_stop_source(sender, sender(inplace_stop_source&))`ã¨ã„ã†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€`sender`ãƒã‚§ãƒ¼ãƒ³ã«å¯¾ã—ã¦`inplace_stop_source`ã‚’æ³¨å…¥ã—ã€ãªãŠã‹ã¤ãã‚Œã«å®‰å®šçš„ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã®å»¶é•·ã§ã€`sender`ãƒã‚§ãƒ¼ãƒ³ã«å¯¾ã—ã¦å¤šæ§˜ãªéåŒæœŸãƒªã‚½ãƒ¼ã‚¹ã‚’æ³¨å…¥ã™ã‚‹ã‚ã®`let_xxx`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒå€‹åˆ¥ã«è€ƒæ¡ˆã•ã‚Œã¤ã¤ã‚ã‚Šã¾ã™ã€‚ã“ã®ã“ã¨ã¯ã€ã“ã®ã‚ˆã†ãªéåŒæœŸãƒªã‚½ãƒ¼ã‚¹ã‚’`sender`ãƒã‚§ãƒ¼ãƒ³ã§æ‰±ã†ãŸã‚ã®æ±ç”¨çš„ãªè¨­è¨ˆãŒæ¬ ã‘ã¦ã„ã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

ãã®ã‚ˆã†ãªéåŒæœŸã‚³ãƒ¼ãƒ‰ã§ã¯å¤šãã®å ´åˆã€`shared_ptr`ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ‰ãƒ›ãƒƒã‚¯ãªã‚¬ãƒ¼ãƒšãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè£…ã•ã‚Œã¾ã™ã€‚ã“ã®ã‚ˆã†ãªã‚¢ãƒ‰ãƒ›ãƒƒã‚¯ãªéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éåŒæœŸçš„ãªæ§‹ç¯‰ã¨ç ´æ£„ã¯ã‚ã‚‹çµ±ä¸€çš„ãªæ±ç”¨è¨­è¨ˆã«å¾“ã£ã¦ã„ãªã„å ´åˆã€æ±ç”¨çš„ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‹ã‚‰ãã®ã‚ˆã†ãªéåŒæœŸãƒªã‚½ãƒ¼ã‚¹ã‚’è¤‡æ•°ã¾ã¨ã‚ã¦æ‰±ã†ã“ã¨ã‚’å›°é›£ã«ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€`sender/receiver`ã‚’ç”¨ã„ãŸéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹ç¯‰ã¨ç ´æ£„ã®ãƒ«ãƒ¼ãƒ«ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å®Ÿè£…ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãŸã‚ã®3ã¤ã®åŸºæœ¬çš„ãªè¦ä»¶ã«ã¤ã„ã¦å®šç¾©ã—ã¦ã„ã¾ã™

- éåŒæœŸæ§‹ç¯‰ï¼ˆ*async constructio*ï¼‰
    - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã«ã¯æ§‹ç¯‰ä¸­ã«å®Ÿè¡Œã•ã‚Œã‚‹éåŒæœŸé–¢æ•°ãŒã‚ã‚‹
        - ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€é€šä¿¡ã‚’ç¢ºç«‹ã™ã‚‹ã€ãªã©
    - ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã“ã¨ãªãã€æ§‹ç¯‰ä¸­ã«éåŒæœŸé–¢æ•°ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
    - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã“ã‚Œã‚’æº€ãŸã™ã“ã¨ãŒã§ããªã„
- éåŒæœŸç ´æ£„ï¼ˆ*async destruction*ï¼‰
    - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã«ã¯ç ´æ£„ä¸­ã«å®Ÿè¡Œã•ã‚Œã‚‹éåŒæœŸé–¢æ•°ãŒã‚ã‚‹
        - ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ã€é€šä¿¡ã‚’ä¸­æ–­ã™ã‚‹ã€ãªã©
    - ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã“ã¨ãªãã€ç ´æ£„ä¸­ã«éåŒæœŸé–¢æ•°ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
    - ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã“ã‚Œã‚’æº€ãŸã™ã“ã¨ãŒã§ããªã„
- æ§‹é€ åŒ–ã•ã‚ŒãŸæ­£ã—ã„æ§‹ç¯‰ï¼ˆ*structured and correct-by-construction*ï¼‰
    - ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒ«ã‹ã‚‰æ´¾ç”Ÿã—ãŸã€ç›´æ„Ÿçš„ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ§‹ç¯‰ã®ãƒ«ãƒ¼ãƒ«
    - structured concurrencyã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿/ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ç‰ˆ

ã“ã‚Œã‚‰ã®è¦ä»¶ã®å…ƒã€ã“ã®ææ¡ˆã§ã¯ã¤ãã®3ã¤ã®ã‚‚ã®ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

- éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    - éåŒæœŸæ§‹ç¯‰ãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹ã¾ã§ä½¿ç”¨ã§ããªã„
    - éåŒæœŸæ§‹ç¯‰ãŒã‚¨ãƒ©ãƒ¼ã§å®Œäº†ã™ã‚‹å ´åˆãŒã‚ã‚‹
    - éåŒæœŸæ§‹ç¯‰ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹
    - éåŒæœŸç ´æ£„ãŒå¤±æ•—ã›ãšã€åœæ­¢ã§ããªã„ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹
- `async_using`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
    - å¸¸ã«ã€å†…éƒ¨ã®éåŒæœŸé–¢æ•°ã‚’å‘¼ã³å‡ºã™å‰ã«éåŒæœŸæ§‹ç¯‰ã‚’å®Œäº†ã™ã‚‹
    - å¸¸ã«ã€å†…éƒ¨ã®éåŒæœŸé–¢æ•°ãŒå®Œäº†ã™ã‚‹å‰ã«éåŒæœŸç ´æ£„ã‚’å®Œäº†ã™ã‚‹
    - å¸¸ã«ã€å†…éƒ¨ã®éåŒæœŸé–¢æ•°ã®å®Œäº†ã«ä¼´ã£ã¦éåŒæœŸç ´æ£„ã‚’å‘¼ã³å‡ºã™
    - å¸¸ã«ã€è¤‡æ•°ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éåŒæœŸç ´æ£„ã‚’ã€ãã®éåŒæœŸæ§‹ç¯‰ã®é€†é †ã§å‘¼ã³å‡ºã™
    - å¸¸ã«ã€éåŒæœŸæ§‹ç¯‰ã«æˆåŠŸã—ãŸéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã ã‘ã€éåŒæœŸç ´æ£„ã‚’å‘¼ã³å‡ºã™
- `async_tuple`
    - å¸¸ã«ã€`async_tuple`ãã®ã‚‚ã®ã®éåŒæœŸæ§‹ç¯‰å®Œäº†ã®å‰ã«ã€å†…åŒ…ã™ã‚‹å…¨ã¦ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éåŒæœŸæ§‹ç¯‰ã‚’å®Œäº†ã™ã‚‹
    - å¸¸ã«ã€å†…åŒ…ã™ã‚‹å…¨ã¦ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éåŒæœŸç ´æ£„ã‚’ã€ãã®éåŒæœŸæ§‹ç¯‰ã®é€†é †ã§å‘¼ã³å‡ºã™
    - å¸¸ã«ã€éåŒæœŸæ§‹ç¯‰ã«æˆåŠŸã—ãŸå†…åŒ…ã™ã‚‹éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã ã‘ã€éåŒæœŸç ´æ£„ã‚’å‘¼ã³å‡ºã™

éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒå£«ã¯çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã€ãã®è¦ä»¶ã¯æ¬¡ã®ã‚‚ã®ã§ã™

- æ§‹æˆï¼ˆ*composition*ï¼‰
    - è¤‡æ•°ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãƒã‚¹ãƒˆã›ãšã«åŒæ™‚ã«ä½¿ç”¨å¯èƒ½ã«ãªã‚‹
    - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®ä¾å­˜é–¢ä¿‚ã¯ãƒã‚¹ãƒˆã«ã‚ˆã£ã¦è¡¨ç¾ã•ã‚Œã‚‹
    - æ§‹æˆã¯ã€è¤‡æ•°ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸¦è¡ŒéåŒæœŸæ§‹ç¯‰ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹
    - æ§‹æˆã¯ã€è¤‡æ•°ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸¦è¡ŒéåŒæœŸç ´æ£„ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹

ã“ã®ææ¡ˆãŒæä¾›ã™ã‚‹ã®ã¯ã€ã“ã‚Œã‚‰ã®è¦ä»¶ã‚’å…·ä½“åŒ–ã—ãŸ`async_object<T>`ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨ã€`async_using`ã¨`async_tuple`ã€ãŠã‚ˆã³`packaged_async_object`ï¼ˆéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãã®éåŒæœŸã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å¼•æ•°ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã™ã‚‹ã‚‚ã®ï¼‰ã§ã™ã€‚

ææ¡ˆã‚ˆã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã€‚

éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ï¼ˆ`Foo`ï¼‰ã®å®Ÿè£…ä¾‹

```cpp
// Fooã¯intå€¤ã‚’æ ¼ç´ã™ã‚‹éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
struct Foo {
  // éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®šç¾©
  // éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒ ãƒ¼ãƒ–ä¸å¯ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
  struct object : __immovable {
    object() = delete;
    int v;
  private:
    // only allow Foo to run the constructor
    friend struct Foo;
    explicit object(int v) noexcept : v(v) {}
  };

  // æ§‹ç¯‰ã•ã‚ŒãŸéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒãƒ³ãƒ‰ãƒ«å‹
  // ã“ã‚Œã¯éåŒæœŸæ§‹ç¯‰ï¼ˆasync_construct()ï¼‰ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹
  using handle = std::reference_wrapper<object>;

  // éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”¨ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’äºˆç´„ã™ã‚‹å‹
  // nothrowãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½ ã‹ã¤ ãƒ ãƒ¼ãƒ–ä¸å¯ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
  using storage = std::optional<object>;
  
  // async_construct()ã¯æ§‹ç¯‰ã•ã‚ŒãŸéåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒãƒ³ãƒ‰ãƒ«ã§å®Œäº†ã™ã‚‹senderã‚’è¿”ã™
  auto async_construct(storage& stg, int v) const noexcept {
    return then( just(std::ref(stg), v),
      [](storage& stg, int v) noexcept {
        auto construct = [&]() noexcept { return object{v}; };
        stg.emplace( __conv{construct});
        printf("foo constructed, %d\n", stg.value().v);

        return std::ref(stg.value());
      }
    );
  }

  // async_destruct() ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å†…ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç ´æ£„ã‚’å®Ÿè¡Œã—ã€éåŒæœŸç ´æ£„ãŒå®Œäº†ã—ãŸå¾Œã«å®Œäº†ã™ã‚‹senderã‚’è¿”ã™
  auto async_destruct(storage& stg) const noexcept {
    return then( just(std::ref(stg)),
      [](storage& stg) noexcept {
        printf("foo destructed %d\n", stg.value().v);
        stg.reset();
      }
    );
  }
};

// Fooã¯async_object
static_assert(async_object<Foo>);
// Fooã¯intã‹ã‚‰éåŒæœŸæ§‹ç¯‰å¯èƒ½
static_assert(async_object_constructible_from<Foo, int>);
```

2ã¤ã®`Foo`å‹ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€`sender`å¼ã§çŠ¶æ…‹ã‚’å¤‰æ›´ã™ã‚‹

```cpp
int main() {
  // 2ã¤ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã™ã‚‹sender
  auto inner = [](Foo::handle o0, Foo::handle o1) noexcept {
    return then( just(o0, o1),
      [](Foo::handle o0, Foo::handle o1) noexcept {
        auto& ro0 = o0.get();
        auto& ro1 = o1.get();
        ro0.v = ro0.v + ro0.v;
        ro1.v = ro1.v + ro1.v;
        printf("foo pack usage, %d, %d\n", ro0.v, ro1.v);
        fflush(stdout);
        return ro0.v + ro1.v;
      }
    );
  };

  // éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å¼•æ•°ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°
  packaged_async_object foo7{Foo{}, 7};
  packaged_async_object foo12{Foo{}, 12};

  // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’äºˆç´„ã—ã€2ã¤ã®éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’éåŒæœŸæ§‹ç¯‰ã—
  // ãã‚Œã‚‰ãŒå®Œäº†ã—ã¦ã‹ã‚‰innerã®å‡¦ç†ã«ãã‚Œã‚‰ã®ãƒãƒ³ãƒ‰ãƒ«ã‚’æ¸¡ã—
  // innerã®å‡¦ç†ãŒå®Œäº†ã—ãŸã‚‰éåŒæœŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’éåŒæœŸç ´æ£„ã™ã‚‹
  // ãã—ã¦ã€ãã‚Œã‚‰å…¨ã¦ãŒå®Œäº†ã™ã‚‹ã¨å®Œäº†ã™ã‚‹éåŒæœŸå‡¦ç†ã‚’è¡¨ã™sender
  auto use_s = async_using(inner, foo7, foo12);
  
  // éåŒæœŸå‡¦ç†é–‹å§‹ã¨å¾…æ©Ÿã€çµæœå–å¾—
  auto [v] = sync_wait(use_s).value();
  printf("foo pack result %d\n\n", v);
}
```

ã“ã®ææ¡ˆã®å†…å®¹ã¯ç´”ç²‹ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã§ã‚ã‚Šã€ä»®å®Ÿè£…ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ : https://godbolt.org/z/rrbW6veYd

- [P2849 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1899)

### [P2876R1 Proposal to extend std::simd with more constructors and accessors](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2876r1.html)
### [P2900R7 Contracts for C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2900r7.pdf)
### [P2963R2 Ordering of constraints involving fold expressions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2963r2.pdf)
### [P2964R1 Allowing user-defined types in std::simd](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2964r1.html)
### [P2967R1 Relocation Is A Library Interface](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2967r1.pdf)
### [P2971R2 Implication for C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2971r2.pdf)
### [P2976R1 Freestanding Library: algorithm, numeric, and random](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2976r1.html)
### [P2988R5 std::optional<T&>](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2988r5.pdf)
### [P2996R3 Reflection for C++26](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2996r3.html)
### [P3045R1 Quantities and units library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3045r1.html)
### [P3051R1 Structured Response Files](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3051r1.html)
### [P3059R1 Making user-defined constructors of view iterators/sentinels private](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3059r1.html)
### [P3064R1 How to Avoid OOTA Without Really Trying](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3064r1.pdf)
### [P3067R0 Provide predefined simd permute generator functions for common operations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3067r0.html)

P2664ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã€`std::simd`ã®æ±ç”¨permute APIã‚’è¨­è¨ˆã—ç›´ã™ææ¡ˆã€‚

SIMDã«ãŠã‘ã‚‹permuteå‘½ä»¤ã¨ã¯ã€SIMDãƒ¬ã‚¸ã‚¹ã‚¿å†…ã§è¦ç´ ã‚’ä¸¦ã³æ›¿ãˆã‚‹å‘½ä»¤ã®1ã¤ã§ã™ã€‚ã‚ã‚‹è¨ˆç®—ã®éš›ã«åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ã®ä¸¦ã³ã¨ãã®å¾Œã®åˆ¥ã®è¨ˆç®—ã®éš›ã«åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ã®ä¸¦ã³ãŒç•°ãªã‚‹å ´åˆãªã©ã€SIMDãƒ¬ã‚¸ã‚¹ã‚¿å†…ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¼‰ã›ãŸã¾ã¾ä¸¦ã¹æ›¿ãˆãŒå¿…è¦ã«ãªã‚‹ã“ã¨ã¯ã‚ˆãã‚ã‚Šã€ãã®éš›ã«permuteå‘½ä»¤ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

P2664ã§ã¯`std::simd`ã«å¯¾ã—ã¦permuteå‘½ä»¤ã«å¯¾å¿œã™ã‚‹ä¸¦ã¹æ›¿ãˆã‚’è¡Œã†ãŸã‚ã®`std::permute()`ã‚’ææ¡ˆã—ã¦ã„ã¾ã—ãŸãŒã€P2664ã®`std::permute()`APIã¯ã»ã¨ã‚“ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœ€ã‚‚ä¸€èˆ¬çš„ãªè¦æ±‚ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«æ±ç”¨çš„ã«è¨­è¨ˆã•ã‚Œã¦ã„ãŸãŸã‚ã€å¿…è¦ãªã“ã¨ã¯ä½•ã§ã‚‚ã§ãã‚‹ã‚‚ã®ã®ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹ç‰¹å®šã®ä¸¦ã¹æ›¿ãˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ããšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå€‹åˆ¥ã«ãã®æ“ä½œã‚’è¡Œã†é–¢æ•°ã‚’å®šç¾©ã™ã‚‹å¿…è¦æ€§ãŒé »ç™ºã™ã‚‹ã“ã¨ãŒæƒ³å®šã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ãã®ã‚ˆã†ãªä¸¦ã¹æ›¿ãˆæ“ä½œã®ç›®çš„ã‚„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã¾ã¨ã‚ã¦ã€ã“ã®æµ®ã‹ã³ä¸ŠãŒã£ãŸè¦æ±‚ã‚’å…ƒã«ã—ã¦`std::simd`ã®è¦ç´ ä¸¦ã¹æ›¿ãˆã‚’è¡Œã†ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚»ãƒƒãƒˆã‚’ç‰¹å®šã—ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ä»Šã®ã¨ã“ã‚æŒ™ã’ã‚‰ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯æ¬¡ã®ã‚‚ã®ã§ã™

|é–¢æ•°|èª¬æ˜|
|---|---|
|`take<int>(simd)`|`simd`ã®å…ˆé ­ã‹ã‚‰`N`è¦ç´ ã‚’å«ã‚€æ–°ã—ã„`simd`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™|
|`grow<int>(simd, value={})`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã‚ˆã‚Šã‚‚å¤§ãã„ã‚µã‚¤ã‚ºã§ã€æŒ‡å®šã•ã‚ŒãŸ`value`ã§åˆæœŸåŒ–ã•ã‚ŒãŸæ–°ã—ã„è¦ç´ ã‚’å«ã‚“ã `simd`ã‚’è¿”ã™|
|`stride<int N>(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã®`N`ç•ªç›®ã®è¦ç´ ã®ã¿ã‚’å«ã‚€æ–°ã—ã„`simd`ã‚’è¿”ã™|
|`chunk<int>(simd)`|æ—¢å­˜ã®`simd::split`ã‚’åå‰å¤‰æ›´ãŠã‚ˆã³ç§»å‹•ã—ãŸã‚‚ã®|
|`reverse(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã¨åŒã˜ã‚µã‚¤ã‚ºã§ã€è¦ç´ ã‚’é€†é †ã«ã—ãŸæ–°ã—ã„`simd`ã‚’è¿”ã™|
|`repeat_all<int>(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã‚’`N`å›ç¹°ã‚Šè¿”ã—ãŸæ–°ã—ã„`simd`ã‚’è¿”ã™ï¼ˆä¾‹ï¼š `repeat_all<3>([a, b])`ã¯`[a, b, a, b, a, b]`ã«ãªã‚‹ï¼‰|
|`repeat_each<int>(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã®å„è¦ç´ ã‚’`N`å›ç¹°ã‚Šè¿”ã—ãŸæ–°ã—ã„`simd`ã‚’è¿”ã™ã‚‹ï¼ˆä¾‹ï¼š `repeat_each<3>([a, b])`ã¯`[a, a, a, b, b, b ]`ã«ãªã‚‹ï¼‰|
|`transpose<ROWS, COLS>(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã‚’ã€`ROWS`è¡Œã¨`COLS`åˆ—ã®è¡Œå„ªå…ˆã®è¡Œåˆ—ã¨ã—ã¦æ‰±ã„ã€è»¢ç½®ã—ãŸçµæœï¼ˆã¤ã¾ã‚Šåˆ—å„ªå…ˆã«ã—ãŸï¼‰ã‚’è¿”ã™|
|`zip(simd...)`|å…¥åŠ›ã•ã‚ŒãŸè¤‡æ•°ã®`simd`ã®å¯¾å¿œã™ã‚‹è¦ç´ ã‚’äº¤äº’ã«ä¸¦ã¹ã¦æ–°ã—ã„`simd`ã‚’ç”Ÿæˆã™ã‚‹ã€‚ï¼ˆä¾‹ï¼š `zip([a, b, c], [0, 1, 2])`ã¯`[a, 0, b, 1, c, 2]`ã‚’è¿”ã™|
|`unzip<N>(simd...)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã‚’`N`å€‹ã®`simd`ã«åˆ†å‰²ã™ã‚‹ã€‚ï¼ˆä¾‹ï¼š `unzip<2>([a, 0, b, 1, c, 2])`ã¯`make_tuple([a, b, c], [0, 1, 2])`ã‚’è¿”ã™|
|`cat(simd...)`|`simd_cat`ã®åå‰å¤‰æ›´ç‰ˆ|
|`extract<N, M>(simd)`|`[N...M)`ã®ç¯„å›²å†…ã®è¦ç´ ã‚’å«ã‚€æ–°ã—ã„`simd`ã‚’æŠ½å‡ºã™ã‚‹|
|`rotate<MIDDLE>(simd)`|`simd`ã®è¦ç´ ã‚’å·¦ã«å›è»¢ã—ã€`MIDDLE` ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¦ç´ ãŒæœ€åˆã®è¦ç´ ã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹|
|`shift_left<N>(simd)/shift_right<N>(simd)`|å…¥åŠ›ã•ã‚ŒãŸ`simd`ã¨åŒã˜ã‚µã‚¤ã‚ºã§ã€è¦ç´ ã‚’å·¦ã¾ãŸã¯å³ã«ã‚·ãƒ•ãƒˆã—ã€å€¤åˆæœŸåŒ–ã•ã‚ŒãŸè¦ç´ ã‚’æŒ¿å…¥ã—ãŸæ–°ã—ã„`simd`ã‚’è¿”ã™|
|`align<N>(simd a, simd b)`|2ã¤ã®`simd`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€`cat(a, b)`ã‹ã‚‰`simd`ã‚’æŠ½å‡ºã—ã¾ã™|

ã“ã‚Œã‚‰ã®è‰¯ãä½¿ç”¨ã™ã‚‹ä¸¦ã¹æ›¿ãˆæ“ä½œï¼ˆé †åˆ—ã®ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼é–¢æ•°ï¼‰ã‚’ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠãã“ã¨ã§

- åŒã˜ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼é–¢æ•°ã‚’ç¹°ã‚Šè¿”ã—ä½•åº¦ã‚‚é‡è¤‡å®šç¾©ã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã‚’å›é¿ã™ã‚‹
- ã‚ˆãä½¿ç”¨ã™ã‚‹æ“ä½œã«ã¤ã„ã¦ã€åˆ†ã‹ã‚Šã‚„ã™ã„åå‰ä»˜ãé–¢æ•°ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã‚‹
- ã‚ˆãä½¿ç”¨ã™ã‚‹æ“ä½œã«ã¤ã„ã¦ã€ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠãã“ã¨ã§ãƒã‚°ã®æ··å…¥ã‚’å›é¿ã™ã‚‹

ç­‰ã®åˆ©ç‚¹ãŒã‚ã‚‹ã¨ã—ã¦ã„ã¾ã™ã€‚

- [P2664R6 Proposal to extend std::simd with permutation API - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/03/10/170322#P2664R6-Proposal-to-extend-stdsimd-with-permutation-API)
- [P2638R0 Intel's response to P1915R0 for std::simd parallelism in TS 2 - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/10/09/021557#P2638R0-Intels-response-to-P1915R0-for-stdsimd-parallelism-in-TS-2)
- [P3067 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1900)

### [P3068R2 Allowing exception throwing in constant-evaluation](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3068r2.html)
### [P3085R2 `noexcept` policy for SD-9 (throws nothing)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3085r2.html)
### [P3091R2 Better lookups for `map` and `unordered_map`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3091r2.html)
### [P3094R2 std::basic_fixed_string](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3094r2.html)
### [P3096R1 Function Parameter Reflection in Reflection for C++26](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3096r1.pdf)
### [P3100R0 Undefined and erroneous behaviour are contract violations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3100r0.pdf)

UBï¼ˆåŠã³EBï¼‰ã‚’å¥‘ç´„é•åã¨ã—ã¦æ‰±ã†ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

C++è¨€èªã‚’å®‰å…¨ã§ã¯ãªãã—ã¦ã„ã‚‹è¦å› ã¯å®Ÿè¡Œæ™‚ã®æœªå®šç¾©å‹•ä½œã«ã‚ã‚Šã¾ã™ã€‚æ­£ã—ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸWell-definedãªC++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚‚ã€å®Ÿè¡Œæ™‚ã«ä»»æ„ã®æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€æœªå®šç¾©å‹•ä½œã‚’å›é¿ã§ããªã„å ´åˆãã‚Œã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚°ã¨ã—ã¦å®‰å…¨æ€§/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å•é¡Œã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚ç‰¹ã«ã€ç„¡åŠ¹ãªãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ã«ã‚ˆã‚‹æœªå®šç¾©å‹•ä½œã¯ç‰¹ã«å¤§ããªå•é¡Œã§ã€Googleã‚„Microsoftã®èª¿æŸ»ã«ã‚ˆã‚Œã°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è„†å¼±æ€§ã®7å‰²ãŒç„¡åŠ¹ãªãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ã«ã‚ˆã‚‹æœªå®šç¾©å‹•ä½œã«ã‚ˆã£ã¦ç™ºç”Ÿã—ã¦ã„ã‚‹ã¨ã•ã‚Œã¾ã™ã€‚

è¿‘å¹´ã®å®‰å…¨æ€§ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é‡è¦æ€§ã®é«˜ã¾ã‚Šã‚’å—ã‘ã¦ã€C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæœªå®šç¾©å‹•ä½œã‚’èµ·ã“ã™å¯èƒ½æ€§ã‚’æ¸›ã‚‰ã™ãŸã‚ã®æ§˜ã€…ãªå–ã‚Šçµ„ã¿ãŒãªã•ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°

- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
- ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã®é©ç”¨
- ã‚³ãƒ¼ãƒ‰ã®æ§˜ã€…å ´å´é¢ã‚’å¯¾è±¡ã«ã—ãŸè‡ªå‹•ãƒ†ã‚¹ãƒˆ
- é™çš„è§£æãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨
- å®Ÿè¡Œæ™‚ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã®ä½¿ç”¨

ãªã©ã€ã“ã‚Œã‚‰ã®æ‰‹æ³•ã‚’æ­£ã—ãé©ç”¨ã™ã‚‹ã“ã¨ã§ã€å®Ÿè¡Œæ™‚ã«ç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹æœªå®šç¾©å‹•ä½œã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ã¯ç•°ãªã‚Šã€C++æ¨™æº–åŒ–å§”å“¡ä¼šã¯C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æœªå®šç¾©å‹•ä½œãƒªã‚¹ã‚¯ã‚’ä½æ¸›ã™ã‚‹ãŸã‚ã«ã€è¨€èªãã®ã‚‚ã®ã‚’é€²åŒ–ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹å”¯ä¸€ã®ç«‹å ´ã«ã‚ã‚Šã¾ã™ã€‚C++ã«ãŠã‘ã‚‹æœªå®šç¾©å‹•ä½œã¯åŸºæœ¬çš„ã«å®Ÿè¡Œæ™‚ã®æ€§è³ªã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ä¸»ã«2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå¯èƒ½ã§ã™ã€‚

1. æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ã‚’é™çš„ã«æ¤œå‡ºã§ãã‚‹å ´åˆã€ãã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ill-formedã«ã§ãã‚‹
2. æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ã«å®Ÿè¡Œæ™‚ã«åˆ°é”ã—ãŸå ´åˆã«å–ã‚Šå¾—ã‚‹å‹•ä½œã®ç¯„å›²ã‚’æŒ‡å®šã—ã€å®Ÿè¡Œæ™‚ã«ãã®å‹•ä½œã‚’ç·©å’Œã™ã‚‹

ã“ã®2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯æ’ä»–çš„ãªã‚‚ã®ã§ã¯ãªãã€ç›¸äº’ã«è£œå®Œã—åˆã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¸€æ–¹ã€ç¾åœ¨C++26ã‚’ç›®æŒ‡ã—ã¦å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ææ¡ˆï¼ˆP2900ï¼‰ãŒé€²è¡Œã—ã¦ã„ã¾ã™ã€‚å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯C++è¨€èªã®å®‰å…¨æ€§ã‚’é«˜ã‚ã‚‹æ©Ÿèƒ½ã§ã¯ã‚ã‚‹ã‚‚ã®ã®ã€ä¸‡èƒ½è–¬ã§ã¯ãªãã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯ã™ã¹ã¦ã®æœªå®šç¾©å‹•ä½œã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«é™çš„ã«æ¤œå‡ºå¯èƒ½ã«ã™ã‚‹ã‚ˆã†ãªã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ¤œå‡ºã•ã‚Œãªã‹ã£ãŸã™ã¹ã¦ã®æœªå®šç¾©å‹•ä½œã«å¯¾ã—ã¦å®Ÿè¡Œæ™‚ã«ãã‚Œã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦å‡¦ç†ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¯æä¾›ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’æ‹¡å¼µã—ã¦ã€æœªå®šç¾©å‹•ä½œã‚’å¥‘ç´„é•åã¨ã—ã¦ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€æ˜ç¤ºçš„ãªå¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã«å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã®ã§ã¯ãªãã€å®Ÿè¡Œæ™‚ã«æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ã‚³ã‚¢è¨€èªæ§‹æˆè¦ç´ ã«å¯¾ã—ã¦æš—é»™çš„ã«å¥‘ç´„ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€æœªå®šç¾©å‹•ä½œã«é™¥ã‚‹å ´åˆã‚’å¥‘ç´„é•åã¨ã—ã¦æ‰±ãˆã‚‹ã‚ˆã†ã«ã—ã€ãã‚Œã«ã‚ˆã£ã¦å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ä¸­ã§æœªå®šç¾©å‹•ä½œã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã™ã‚‚ã®ã§ã™ã€‚

ä¾‹ãˆã°ç¬¦å·ä»˜æ•´æ•°ã®åŠ ç®—ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚2ã¤ã®`int`å‹ã®å€¤`a, b`ã‚’åŠ ç®—ã™ã‚‹å ´åˆã€çµæœãŒ`int`ã®æœ€å¤§å€¤ã‚’è¶…ãˆã‚‹ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã™ã‚‹ï¼‰å ´åˆã¯ç¾åœ¨æœªå®šç¾©å‹•ä½œã¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚’å†è§£é‡ˆã—ã¦ã€ç¬¦å·ä»˜æ•´æ•°å‹ã®åŠ ç®—ã«ã¯åŠ ç®—çµæœãŒã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ãªã„ã¨ã„ã†æš—é»™ã®äº‹å‰æ¡ä»¶ã‚ã‚‹ã€ã¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ç¬¦å·ä»˜æ•´æ•°å‹ã®åŠ ç®—ãŒçµ„ã¿è¾¼ã¿ã®`operator+(int, int)`ã‚’å‘¼ã³å‡ºã—ã¦è¡Œã‚ã‚Œã‚‹ã¨è€ƒãˆã‚‹ã¨ã€ãã®çµ„ã¿è¾¼ã¿æ¼”ç®—å­ã¯æ¬¡ã®ã‚ˆã†ã«å®£è¨€ã•ã‚Œã¦ã„ã‚‹ã‹ã®ã‚ˆã†ã«æ‰±ã‚ã‚Œã¾ã™

```cpp
int operator+(int a, int b)
  pre ((b >= 0 && a <= INT_MAX - b) // æš—é»™ã®äº‹å‰æ¡ä»¶ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
   || (b < 0 && a >= INT_MIN - b));
```

ã“ã®äº‹å‰æ¡ä»¶ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€Œæš—é»™çš„ã€ã¨ã—ã¦ã„ã‚‹ã®ã¯ã€é€šå¸¸ã®å¥‘ç´„æ³¨é‡ˆãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰‹ã«ã‚ˆã£ã¦æ˜ç¤ºçš„ã«ä»˜åŠ ã•ã‚Œã‚‹ã®ã«å¯¾ã—ã¦ã€ã“ã®äº‹å‰æ¡ä»¶ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæš—é»™çš„ã«ç”Ÿæˆã—ã¦ä»˜åŠ ã™ã‚‹ã‚‚ã®ã ã‹ã‚‰ã§ã™ã€‚

ã“ã®ç¬¦å·ä»˜æ•´æ•°å‹ã®åŠ ç®—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã¨åŒæ§˜ã«ã€ã€Œæ“ä½œXã«ã¤ã„ã¦ã€YãŒå½ï¼ˆ`false`ï¼‰ã®å ´åˆã€å‹•ä½œã¯æœªå®šç¾©ã€ã¨ã„ã†ã‚ˆã†ãªC++æ¨™æº–ã«ãŠã‘ã‚‹æœªå®šç¾©å‹•ä½œã®å‡ºç¾ã‚’ã€ã€Œæ“ä½œXã¯ã€YãŒçœŸï¼ˆ`true`ï¼‰ã§ã‚ã‚‹ã¨ã„ã†äº‹å‰æ¡ä»¶ã‚’æŒã¤ã€ã¨ã„ã†ã‚ˆã†ã«ç½®ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¦ã€æ˜ç¤ºçš„ãªï¼ˆé€šå¸¸ã®ï¼‰å¥‘ç´„æ³¨é‡ˆåŒæ§˜ã«ã“ã®æš—é»™ã®å¥‘ç´„æ³¨é‡ˆã‚‚ã¾ã¨ã‚ã¦å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä¸Šã§æ‰±ã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã†ã—ã¦å®Ÿè¡Œæ™‚ã«ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã†ã‚‹æœªå®šç¾©å‹•ä½œã«ã¯2ã¤ã®ç¨®é¡ãŒã‚ã‚Šã€ãã‚Œã¯ã€å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’å®šç¾©ã§ãã‚‹ã‚‚ã®ã¨ã§ããªã„ã‚‚ã®ã§ã™ã€‚ä¾‹ãˆã°ã€ç¬¦å·ä»˜æ•´æ•°å‹ã®åŠ ç®—ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¯ãã®çµæœã®å€¤ãŒæœ‰åŠ¹ãªæ•°å€¤ã«ãªã‚‹ã“ã¨ã§ã™ã€‚ãã®å…·ä½“çš„ãªæ•°å€¤ã®æ€§è³ªï¼ˆé£½å’Œæ¼”ç®—ã€ãƒ©ãƒƒãƒ—ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ãªã©ï¼‰ã‚’æŒ‡å®šã™ã‚‹ä»£ã‚ã‚Šã«ã€è¦æ ¼ã®ãƒ¬ãƒ™ãƒ«ã§æœªå®šç¾©å‹•ä½œã‚’è§£é™¤ã™ã‚‹ã«ã¯ã€æœ‰åŠ¹ã ãŒæœªè¦å®šãªå€¤ã«ãªã‚‹ã¨è¦å®šã™ã‚‹ã ã‘ã§ååˆ†ã§ã™ã€‚ã“ã®æ•°å€¤ã‚’è¨ˆç®—ã§ä½¿ç”¨ã™ã‚‹ã¨ãŠãã‚‰ãé–“é•ã„ï¼ˆãƒã‚°ï¼‰ã§ã¯ã‚ã‚‹ã‚‚ã®ã®æœªå®šç¾©ã§ã¯ãªããªã‚Šã¾ã™ã€‚æ•´æ•°ã®åŠ ç®—ã‚’ä¸Šè¨˜ã®ã‚ˆã†ã«çµ„ã¿è¾¼ã¿æ¼”ç®—å­ã¨ã¿ãªã™ã¨ã€ã“ã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¯ãã®æœ¬ä½“ãŒå®Ÿè¡Œã™ã‚‹å‹•ä½œãã®ã‚‚ã®ã§ã™ã€‚

åˆ¥ã®ä¾‹ã¨ã—ã¦ã€æœªåˆæœŸåŒ–å¤‰æ•°ã‚’èª­ã¿å–ã‚‹å ´åˆã€æœªå®šç¾©å‹•ä½œã®ä»£ã‚ã‚Šã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¨ã—ã¦ä»£ã‚ã‚Šã«æœªè¦å®šã ãŒæœ‰åŠ¹ãªå€¤ï¼ˆä¾‹ãˆã°ã‚¼ãƒ­ï¼‰ã‚’èª­ã¿å–ã‚‹ã€ã¨ã™ã‚‹ã“ã¨ã§æœªå®šç¾©å‹•ä½œã‚’å®‰å…¨ã«è§£é™¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®è©±ã‚’ã©ã“ã‹ã§èã„ãŸã“ã¨ãŒã‚ã‚‹äººã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€ã“ã‚Œã¯P2795R5ã«ã‚ˆã£ã¦ææ¡ˆã•ã‚ŒC++26ã«æ—¢ã«å°å…¥ã•ã‚Œã¦ã„ã‚‹ã€Erroneous Behaviourï¼ˆEBï¼‰ãã®ã‚‚ã®ã§ã™ã€‚

EBã¯UBæ™‚ã®å‹•ä½œã¨ã—ã¦å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’å®Ÿè£…å®šç¾©ã§æŒ‡å®šã—ã€åŒæ™‚ã«è¨ºæ–­ã‚’æ¨å¥¨ã™ã‚‹ã“ã¨ã§UBã‚’è§£æ¶ˆã—ã‚ˆã†ã¨ã™ã‚‹å–ã‚Šçµ„ã¿ã§ã™ã€‚P2795R5ã§èª¤ã£ãŸã‚³ãƒ¼ãƒ‰ã®çµæœã¨ã—ã¦å‹•ä½œXã‚’å–ã‚‹ã€ã¨ã—ã¦ã„ã‚‹ã¨ã“ã‚ã¯ã€ã“ã®ææ¡ˆã«ãŠã„ã¦ã€æš—é»™ã®äº‹å‰æ¡ä»¶ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒç ´ã‚‰ã‚ŒãŸå ´åˆã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œãŒXã§ã‚ã‚‹ã€ã¨ã„ã†ã®ã¨å…¨ãåŒã˜ã“ã¨ã§ã™ã€‚æš—é»™ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‹ã©ã†ã‹ã¨ã¯é–¢ä¿‚ãªãã€ã©ã¡ã‚‰ã®å ´åˆã‚‚èª¤ã£ãŸçŠ¶æ…‹ã«ã‚ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œã«ã¤ã„ã¦è¿°ã¹ã¦ãŠã‚Šã€ãªãŠã‹ã¤ãã®å‹•ä½œã¯æœªå®šç¾©ã§ã¯ãªãWell-definedã¨ãªã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ã€P2795R5ã®ã€ŒErroneous Behaviourã€ã¨ã“ã®ææ¡ˆã®ã€Œæš—é»™ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³é•åã€ã¨ã„ã†2ã¤ã®è¨€è‘‰ã«ã¯äº’æ›æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ãã—ã¦ã€P2795R5ã«ã‚ˆã‚Œã°Erroneous BehaviourãŒç™ºç”Ÿã—ãŸå ´åˆã€å®Ÿè£…ã¯æ¬¡ã®ã„ãšã‚Œã‹ã‚’è¡Œã†ã“ã¨ãŒè¨±å¯ã•ã‚Œã¾ã™

- å•é¡Œã®å ±å‘Š
- ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®çµ‚äº†
- ä½•ã‚‚ã—ãªã„
    - ãŸã ã—UBã§ã¯ãªã„

EBæ™‚ã®å¯èƒ½ãªå‹•ä½œã®ã“ã®ãƒªã‚¹ãƒˆã¯ã€å¥‘ç´„é•åãŒèµ·ããŸå ´åˆã®4ï¼ˆ+1ï¼‰ã¤ã®å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®ã‚µãƒ–ã‚»ãƒƒãƒˆã§ã™ï¼ˆquick_enforce, enforce, observe, ignore, assumeï¼‰ã€‚

- è¨ºæ–­ã‚’ç™ºè¡Œ -> observe
- ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº† -> quick_enforce/enforce
- ä½•ã‚‚ã—ãªã„ -> ignore
    - å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’å®Ÿè¡Œã™ã‚‹

é€†ã«ã€EBã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¯ã“ã®ã‚ˆã†ãªæ¬ é™¥ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«å½¹ç«‹ã¤æ©Ÿèƒ½ãŒæ¬ ã‘ã¦ã„ã¾ã™ã€‚å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã§ã¯ã€å¥‘ç´„é•åæ™‚ã«é•åãƒãƒ³ãƒ‰ãƒ©ãŒå‘¼ã³ã•ã‚Œã€ãªãŠã‹ã¤ã“ã®é•åãƒãƒ³ãƒ‰ãƒ©ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚EBã§ã¯å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã®ãªã„æœªå®šç¾©å‹•ä½œã‚’å‡¦ç†ã§ãã¾ã›ã‚“ãŒã€å¥‘ç´„ã®å ´åˆã¯å¯èƒ½ã§ã™ã€‚

ãã—ã¦ã€ã“ã®ææ¡ˆã§ã¯C++23ä»¥å‰ï¼ˆå¥‘ç´„ã‚‚EBã‚‚ãªã„æ™‚ä»£ï¼‰ã¨ã®å®Œå…¨ãªä¸‹ä½äº’æ›ã‚’ä¿ã¤ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã€å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«assumeã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯`[[assume]]`å±æ€§åŒæ§˜ã«å¥‘ç´„æ³¨é‡ˆã‚’ã‚³ãƒ¼ãƒ‰ã®ä»®å®šã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒè¨±å¯ã•ã‚Œã¦ãŠã‚Šã€ãªãŠã‹ã¤å¥‘ç´„æ¡ä»¶ã¯ãƒã‚§ãƒƒã‚¯ã•ã‚Œãšé•åãƒãƒ³ãƒ‰ãƒ©ã¯å‘¼ã³å‡ºã•ã‚Œã¾ã›ã‚“ã€‚å¥‘ç´„é•åãŒèµ·ã“ã‚‹ã¨æœªå®šç¾©å‹•ä½œã«ãªã‚Šã¾ã™ã€‚

assumeã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯å¾“æ¥ï¼ˆç¾åœ¨ï¼‰ã®C++ã¨åŒã˜æŒ™å‹•ã§ã‚ã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ã¨ã«ã‹ãé‡è¦–ã™ã‚‹å ´åˆã«é¸æŠã§ãã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã¯å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å–ã‚Šé™¤ãã€å‹•ä½œã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ä¸¡é¢ã§ç¾åœ¨ã®C++23ä»¥å‰ã®å‹•ä½œã¨ã®å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¤ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚EBã®å ´åˆã€éå»ã®å‹•ä½œã«æˆ»ã™ãŸã‚ã«EBå€‹åˆ¥ã«ã‚ªãƒ—ãƒˆã‚¢ã‚¦ãƒˆãƒ¡ã‚«ãƒ‹ã‚ºãƒ ï¼ˆä¾‹ãˆã°`[[indeterminate]]`ï¼‰ãŒå¿…è¦ã¨ãªã‚Šã€è¦æ ¼ã®è¤‡é›‘ã•ã®é¢ã§ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼è² æ‹…ã®é¢ã§ã‚‚ã‚¹ã‚±ãƒ¼ãƒ«ã—ã¾ã›ã‚“ã€‚

ãã®æ¦‚å¿µã«äº’æ›æ€§ãŒã‚ã‚Šã€å‹•ä½œçŠ¶æ…‹ã‚’åŒ…å«ã—ã¦ãŠã‚Šã€C++23ä»¥å‰ã¨ã®å¾Œæ–¹äº’æ›æ€§ã®ä¸€æ‹¬ç¢ºä¿ã‚‚å‚™ãˆã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€ã“ã®ææ¡ˆã¯Erroneous Behaviourã‚’å®Œå…¨ã«åŒ…å«ã—ã¦ã„ã‚‹ã¨ã„ãˆã¾ã™ã€‚ãã®ãŸã‚ã“ã®ææ¡ˆã§ã¯ã€EBã‚‚ã¾ãŸUBåŒæ§˜ã«æš—é»™ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚‚ã¤ã‚‚ã®ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

2ç¨®é¡ã®æœªå®šç¾©å‹•ä½œã®ã‚‚ã†ä¸€ã¤ã€å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’å®šç¾©ã§ããªã„ã‚¿ã‚¤ãƒ—ã®æœªå®šç¾©å‹•ä½œã«å¯¾ã—ã¦æš—é»™çš„ã«ä»˜åŠ ã•ã‚ŒãŸå¥‘ç´„ã®äº‹ã‚’ã“ã®ææ¡ˆã§ã¯ã€ç„¡è¦–ã§ããªã„å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆNon-ignorable implicit contract assertionsï¼‰ã¨å‘¼ã‚“ã§ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã€é…åˆ—ã®æ·»ãˆå­—ã‚¢ã‚¯ã‚»ã‚¹ã‚’å…ˆç¨‹ã¨åŒæ§˜ã«çµ„ã¿è¾¼ã¿æ¼”ç®—å­ã¨ã—ã¦ã¿ã¦ã¿ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

```cpp
template <typename T, size_t N>
T& subscript(T(&array)[N], size_t index)
  pre(index < N) // æš—é»™ã®äº‹å‰æ¡ä»¶ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
{
  return array[index];
}
```

ã“ã®å ´åˆã€ã“ã®æš—é»™ã®å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒç ´ã‚‰ã‚ŒãŸã¨ãã«ãã®æœ¬ä½“ã®å‹•ä½œã‚’å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¨ã—ã¦æ‰±ã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãƒ¡ãƒ¢ãƒªã®å®‰å…¨æ€§ã‚„å‹ã®å®‰å…¨æ€§ã«é•åã™ã‚‹æ“ä½œã¯ã“ã®ã‚«ãƒ†ã‚´ãƒªã«åˆ†é¡ã•ã‚Œã¾ã™ã€‚

ç„¡è¦–ã§ããªã„å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯åˆ¶é™ã•ã‚Œã€ignore/observeã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã§è©•ä¾¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚æŒ‡å®šå¯èƒ½ãªã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯quick_enforce/enforce/assumeã®ã¿ã§ã™ã€‚ã“ã‚Œã‚‰ã®è©•ä¾¡ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ãªå®Ÿè£…æˆ¦ç•¥ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã¾ã™

- quick_enforce : ç¯„å›²å¤–ã‚¢ã‚¯ã‚»ã‚¹ã‚’å®Ÿè¡Œæ™‚ã«ãƒˆãƒ©ãƒƒãƒ—ã™ã‚‹clangã®-fbounds-safety
- enforce : ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã«ã‚ˆã‚‹å®Ÿè¡Œæ™‚ã®æ¤œå‡ºã¨è¨ºæ–­ç™ºè¡Œã€ãŠã‚ˆã³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸­æ–­
- assume : C++23ä»¥å‰ï¼ˆç¾åœ¨ï¼‰ã®å®‰å…¨ã§ã¯ãªã„ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œ

å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’æŒãŸãªã„C++ã®æœªå®šç¾©å‹•ä½œã«å¯¾ã—ã¦ã‚‚ã€åŒæ§˜ã«ç„¡è¦–ã§ããªã„å¥‘ç´„ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒã¤ã‚‚ã®ã¨ã—ã¦å†è§£é‡ˆã™ã‚‹ã“ã¨ã§ã€åŒæ§˜ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒå­˜åœ¨ã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã®1ã¤ã¨ã—ã¦ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã®ã‚ˆã†ãªå¤–éƒ¨ãƒ„ãƒ¼ãƒ«ãŒã‚ã’ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãŸã‚ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã¯ã„ãã¤ã‹ã®å®Ÿè£…ãŒã™ã§ã«æä¾›ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã„ãšã‚Œã®å®Ÿè£…ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨å¯¾è©±ã™ã‚‹ãŸã‚ã®APIï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ãŒéå¸¸ã«è²§å¼±ã§ã‚ã‚Šã€ãã®çµ±ä¸€çš„ãªæŒ‡é‡ã®ã‚ˆã†ãªã‚‚ã®ã‚‚å­˜åœ¨ã—ã¦ã„ã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã‚‚å«ã‚ãŸå¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã®å¯¾è©±APIã¨ã—ã¦ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®é•åãƒãƒ³ãƒ‰ãƒ©ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æŒ™ã’ã¦ã„ã¾ã™ã€‚ç¾æ™‚ç‚¹ã®å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã¯ç¾åœ¨ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ãŒå‚™ãˆã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯APIã‚ˆã‚Šã‚‚å……å®Ÿï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç½®æ›å¯èƒ½ã€å¼•æ•°ã§è©³ç´°ãªæƒ…å ±ã‚’å–å¾—å¯èƒ½ï¼‰ã—ã¦ãŠã‚Šã€ã“ã®åŒ…æ‹¬çš„ãªAPIã«ã‚ˆã£ã¦ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã‚’C++æ¨™æº–ã®ç¯„å›²å†…ã«é…ç½®ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€ã“ã®APIã®ã‚µãƒãƒ¼ãƒˆã¯æ—¢å­˜ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã«å¯¾ã—ã¦å¤‰æ›´ã‚’å¼·ã„ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆãã†ã™ã‚‹ã‹ã¯å®Œå…¨ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ï¼‰ã€‚ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã®å‹•ä½œã¯å®Ÿè£…å®šç¾©ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé•åãƒãƒ³ãƒ‰ãƒ©ã‚’ã‚«ã‚¹ã‚¿ãƒ ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ãªãã¦ã‚‚è‰¯ã„ã¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€æ—¢å­˜ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã¯ã™ã§ã«ãã®ã‚ˆã†ãªAPIã«æº–æ‹ ã—ã¦ã„ã‚‹ã¨è¨€ãˆã¾ã™ã€‚

- [P3100 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1901)

### [P3103R2 More bitset operations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3103r2.html)
### [P3111R0 Atomic Reduction Operations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3111r0.html)

`std::atomic`ã«ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã¨ã¯ã€ã‚¢ãƒˆãƒŸãƒƒã‚¯ãªRMWæ“ä½œï¼ˆ`fetch_add()`ã®ã‚ˆã†ãªæ“ä½œï¼‰ã§ã¯ã‚ã‚Šã¾ã™ãŒå¤ã„å€¤ã‚’å®Ÿéš›ã«ã¯ãƒ•ã‚§ãƒƒãƒã›ãšã€ãƒ¡ãƒ¢ãƒªãƒ¢ãƒ‡ãƒ«ã®è¦³ç‚¹ã‹ã‚‰ã‚‚èª­ã¿å–ã‚Šã‚’ç²‰ã‚ãªã„ã‚ˆã†ãªRMWæ“ä½œã®äº‹ã§ã™ã€‚

ãã®ã‚ˆã†ãªã€ãƒ•ã‚§ãƒƒãƒã•ã‚ŒãŸå¤ã„å€¤ã‚’ç ´æ£„ã™ã‚‹ã‚ˆã†ãªã‚¢ãƒˆãƒŸãƒƒã‚¯RMWæ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ä¸¦è¡Œã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯é«˜æ€§èƒ½ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ã¯ä¸€èˆ¬çš„ã§ã‚ã‚Šã€ç¾ä»£ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¯ãã®ã‚ˆã†ãªæ“ä½œã«å¯¾ã—ã¦åŠ¹ç‡çš„ãªå‘½ä»¤ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã¯ä¸¦åˆ—ã«ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’æ±‚ã‚ã‚‹ã‚‚ã®ã§ã™

```cpp
std::span<unsigned> data;

std::array<std::atomic<unsigned>, N> buckets;

constexpr T bucket_sz = std::numeric_limits<T>::max() / (T)N;

unsigned nthreads = std::thread::hardware_concurrency();

std::for_each_n(std::execution::par_unseq, std::views::iota(0).begin(), nthreads, 
 [&](int thread) {
  unsigned data_per_thread = data.size() / nthreads;
  T* data_thread = data.data() + data_per_thread * thread;

  for (auto e : span<T>(data_thread, data_per_thread)) {
    // ã“ã“ã§ã‚¢ãƒˆãƒŸãƒƒã‚¯å€¤ã«å¯¾ã—ã¦è¶³ã—ã“ã¿ï¼ˆfetch_add()ï¼‰ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹
    buckets[e / bucket_sz].fetch_add(1, std::memory_order_relaxed);
  }
});
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã«ã¯æ¬¡ã®2ã¤ã®å•é¡Œç‚¹ãŒã‚ã‚Šã¾ã™

- æ­£ã—ã•ï¼ˆUBï¼‰
  - ã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œãŒæ¬¡ã®ã„ãšã‚Œã‚‚æº€ãŸã—ã¦ã„ãªã„ãŸã‚ã€ã“ã®ä¸¦åˆ—ç‰ˆ`for_each_n`ã§ã¯`execution::par`ã‚’ä½¿ç”¨ã™ã‚‹ã¹ãã ã£ãŸï¼ˆ`par_unseq`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã«UBï¼‰
    - æ½œåœ¨çš„ã«åŒæ™‚å®Ÿè¡Œã•ã‚Œã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹åŒ–ã•ã‚Œã¦ã„ãªã„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ãƒ‡ãƒ¼ã‚¿ç«¶åˆãŒç™ºç”Ÿã™ã‚‹
    - ä»–ã®é–¢æ•°å‘¼ã³å‡ºã—ã¨åŒæœŸã™ã‚‹ãŸã‚ã€ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚»ãƒ¼ãƒ•
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
  - ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã¯ã€é«˜åº¦ãªã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®åˆ†æãŒå¿…è¦

`std::atomic`ã§ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã§ã“ã®2ã¤ã®å•é¡Œã‚’è§£æ±ºã§ãã€ã“ã®ææ¡ˆã¯ãã‚Œã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€æ—¢å­˜ã®`std::atomic`ãŠã‚ˆã³`std::atomic_ref`ã®ãƒ¡ãƒ³ãƒé–¢æ•°ã§ã‚ã‚‹`.fetch_xxx()`ã«å¯¾ã—ã¦`void`æˆ»ã‚Šå€¤å‹ã®`xxx()`ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ææ¡ˆæ–‡æ›¸ã‚ˆã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

<table>
<tr>
<th>ç¾åœ¨</th>
<th>ã“ã®ææ¡ˆ</th>
</tr>
<tr>
<td valign="top">

```cpp
#include <algorithm>
#include <atomic>
#include <execution>
using namespace std;
using execution::par_unseq;

int main() {
  size_t N = 10000;
  vector<int> v(N, 0);
  atomic<int> atom = 0;
  for_each_n(par_unseq, 
     v.begin(), N,
    [&](auto& e) {
      // UB+SLOW:
      atom.fetch_add(e);
  }); 
  return atom.load();
}
```

</td>
<td valign="top">

```cpp
#include <algorithm>
#include <atomic>
#include <execution>
using namespace std;
using execution::par_unseq;

int main() {
  size_t N = 10000;
  vector<int> v(N, 0);
  atomic<int> atom = 0;
  for_each_n(par_unseq, 
     v.begin(), N,
    [&](auto& e) {
      // OK+FAST
      atom.add(e);  // ğŸ‘ˆ
  }); 
  return atom.load();
}
```

</td>
</tr>
</table>

ã¾ãŸã€ã“ã®å»¶é•·ã¨ã—ã¦ã€é †åºä»˜ã‘ã•ã‚Œã¦ã„ãªã„ã¨ãã®ï¼ˆä¸¦åˆ—å®Ÿè¡Œæ™‚ã®ï¼‰èª­ã¿å–ã‚Šã§ãªã„ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒ¡ãƒ¢ãƒªæ“ä½œã‚’è¨±å¯ã—ã€æµ®å‹•å°æ•°ç‚¹æ¼”ç®—ãŒçµåˆçš„ã§ã‚ã‚‹ã¨ä»®å®šã—ã¦æµ®å‹•å°æ•°ç‚¹æ•°å‹ã®ç®—è¡“ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã‚’æ‹¡å¼µã™ã‚‹ã“ã¨ã‚‚è¿½åŠ ã§ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

æµ®å‹•å°æ•°ç‚¹æ•°ã®æ¼”ç®—ã®ã‚ˆã†ã«éçµåˆçš„ãªæ¼”ç®—ã§ã¯ã€ä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚Œã‚‹æ¼”ç®—ã®é †åºãŒçµæœã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã®åŠ¹æœãŒåˆ¶é™ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€`x = a + (b + c)`ã¨ã„ã†è¨ˆç®—ã‚’ä¸¦åˆ—ã«å®Ÿè¡Œã™ã‚‹å ´åˆã€ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã§ã¯`(a + b) + c`ã‚„`a + (c + b)`ãªã©ã®ç•°ãªã‚‹é †åºã§è¨ˆç®—ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€æµ®å‹•å°æ•°ç‚¹æ¼”ç®—ãŒçµåˆçš„ã§ã¯ãªã„ã“ã¨ã‹ã‚‰çµæœãŒä¸€è‡´ã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ææ¡ˆã®ä¸€èˆ¬åŒ–ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã§ã¯ã€æµ®å‹•å°æ•°ç‚¹æ•°å‹ã®ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã«ãŠã„ã¦æµ®å‹•å°æ•°ç‚¹æ¼”ç®—ãŒçµåˆçš„ã§ã‚ã‚‹ã¨ä»®å®šã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ã“ã¨ã§ã€å®Ÿè£…ã¯ã“ã®åˆ¶é™ã‚’å—ã‘ãšã«æœ€é©åŒ–ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ä¸€èˆ¬åŒ–ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã¯æµ®å‹•å°æ•°ç‚¹æ•°å‹ã®ç‰¹æ®ŠåŒ–ã®ã¿ã®ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦ã€ä¸Šè¨˜ã®ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã¨ã¯åˆ¥åã®ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

```cpp
template <floating-point>
class atomic {
  ...

  // ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œ
  void add(floating-point, memory_order);
  // ä¸€èˆ¬åŒ–ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œ
  void add_generalizedg(floating-point, memory_order);

  ...
};
```

- [P3111 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1902)

### [P3119R1 Tokyo Technical Fixes to Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3119r1.pdf)
### [P3125R0 Pointer tagging](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3125r0.pdf)

ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã®ææ¡ˆã€‚

ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã¨ã¯ã€ãƒã‚¤ãƒ³ã‚¿ã®ãƒ“ãƒƒãƒˆã®ã†ã¡ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„éƒ¨åˆ†ã«æƒ…å ±ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã‚“ã§åˆ©ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ä¸»ã«ã€ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ã®å‘ä¸Šã®ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚’åˆ©ç”¨ã—ãŸç‰¹æ®Šãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚‚ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

ç¾ä»£ã®C++ã®ç’°å¢ƒã®å¤šãã¯ãƒã‚¤ãƒ³ã‚¿ã®ã‚µã‚¤ã‚ºã¯64bitã§ã™ãŒã€ç¾çŠ¶ã®ãƒ¡ãƒ¢ãƒªå®¹é‡ã®å ´åˆãã®ãƒ¡ãƒ¢ãƒªç©ºé–“ã‚’ã™ã¹ã¦è¡¨ç¾ã™ã‚‹ã®ã«64bitã‚‚ã®é•·ã•ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚‹ã‚ˆã†ã§ã™ãŒã€48bitç›®ãã‚‰ã„ã¾ã§ã—ã‹ä½¿ã‚ã‚Œã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚ã™ã‚‹ã¨ã€ä½™ã£ãŸä¸Šä½16bitã‚’ç„¡è¦–ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã‚‚ã‚‰ãˆã°ã€ãã®éƒ¨åˆ†ã‚’ä½•ã‹ã—ã‚‰åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚x64/armå…±ã«ã“ã®ãŸã‚ã®CPUæ‹¡å¼µã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚

ã•ã‚‰ã«ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒNãƒã‚¤ãƒˆã«ã‚¢ãƒ©ã‚¤ãƒ³ã•ã‚Œã¦ã„ã‚‹æ™‚ãã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯Nã®å€æ•°ã«ãªã‚‹ãŸã‚ã€ãã®åˆ†ã®ä¸‹ä½æ•°ãƒ“ãƒƒãƒˆï¼ˆ`log2(N)`ãƒ“ãƒƒãƒˆï¼‰ã‚‚åŒæ§˜ã«åˆ©ç”¨ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€`int`å‹ãŒ4ãƒã‚¤ãƒˆã®å ´åˆ`int`å‹å¤‰æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯é€šå¸¸4ã®å€æ•°ã®å€¤ã«ãªã‚‹ãŸã‚ã€ä¸‹ä½2ãƒ“ãƒƒãƒˆã¯ãƒã‚¤ãƒ³ã‚¿å€¤ã«å‚åŠ ã—ã¦ã„ã¾ã›ã‚“ã€‚

ã—ã‹ã—ã€C++ã®è¦æ ¼ã¨ã—ã¦ã¯æœ‰åŠ¹ãªãƒã‚¤ãƒ³ã‚¿ã®ä¸€éƒ¨ã®ãƒ“ãƒƒãƒˆã‚’æ“ä½œã™ã‚‹ã“ã¨ã¯æœªå®šç¾©å‹•ä½œã§ã‚ã‚Šã€ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã®ææ¡ˆã¯ã€ç‰¹æ®Šãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–¢æ•°ã‚’é€šã—ã¦ã®ã¿ãã®ã‚ˆã†ãªæ“ä½œã‚’èªã‚ã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã—ã¦ã„ã‚‹ã®ã¯ã¾ãšã€ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰ã‚¿ã‚°éƒ¨åˆ†ã‚’å–ã‚Šå‡ºã™ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ã‚’è¿”ã™é–¢æ•°ã§ã™ã€‚

```cpp
namespace std {
  template <typename Pointee, size_t Alignment = alignof(Pointee)>
  constexpr auto tag_bit_mask() noexcept -> uintptr_t;
}
```

ã“ã®`tag_bit_mask()`ã¯ãƒã‚¤ãƒ³ã‚¿å‹`Pointee`ã¨ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ`Alignment`ã«å¯¾ã—ã¦ã€ãã®ãƒã‚¤ãƒ³ã‚¿å‹ã®ãƒã‚¤ãƒ³ã‚¿å€¤ã®ã†ã¡ã‚¿ã‚°ã¨ã—ã¦ä½¿ç”¨å¯èƒ½ãªéƒ¨åˆ†ã®ãƒ“ãƒƒãƒˆãŒ1ã«ãªã£ãŸãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ã‚’è¿”ã—ã¾ã™ã€‚ä¸‹ä½ã®ãƒ“ãƒƒãƒˆã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚‰ãšå…±é€šï¼ˆã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã§æ±ºã¾ã‚‹ï¼‰ã§ã™ãŒã€ä¸Šä½ãƒ“ãƒƒãƒˆãŒã©ã“ã¾ã§åˆ©ç”¨å¯èƒ½ã‹ã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŠã‚ˆã³ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã®å­˜åœ¨ã«ã‚ˆã£ã¦å¤‰åŒ–ã—ã¾ã™ã€‚

æ¬¡ã«ã€ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã‚’è¡¨ã™å‹`std::tagged_pointer<T, Alignment>`ã‚’ç”¨æ„ã—ã¦ã€ã“ã‚Œã«å¯¾ã—ã¦ã‚¿ã‚°ä»˜ã‘ã€ã‚¿ã‚°ã®ã‚¯ãƒªã‚¢ã€ã‚¿ã‚°ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å€¤ã®å–ã‚Šå‡ºã—ã‚’è¡Œã†é–¢æ•°ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

```cpp
namespace std {
  // ãƒã‚¤ãƒ³ã‚¿ã«ã‚¿ã‚°ä»˜ã‘ã‚’è¡Œã†
  template <typename T, size_t Alignment = alignof(T)>
  constexpr auto tag_pointer(T* original, uintptr_t value) noexcept -> tagged_pointer<T, Alignment>;

  // ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã‚’å…ƒã®ãƒã‚¤ãƒ³ã‚¿ã«æˆ»ã™
  template <typename T, size_t Alignment = alignof(T)>
  constexpr auto untag_pointer(tagged_pointer<T, Alignment> ptr) noexcept -> T*;

  // ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã‹ã‚‰ã‚¿ã‚°ã®å€¤ã‚’å–ã‚Šå‡ºã™
  template <typename T, size_t Alignment = alignof(T)>
  constexpr auto tag_value(tagged_pointer<T, Alignment> ptr) noexcept -> uintptr_t;
}
```

ã“ã®ææ¡ˆã®ã‚¿ã‚°ä»˜ããƒã‚¤ãƒ³ã‚¿ã‚µãƒãƒ¼ãƒˆã¯ç‰¹æ®Šãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆHash-Array-Mapped-Trie (HAMT)ãªã©ï¼‰ã®ä½œæˆã‚’è¨±å¯ã™ã‚‹ã“ã¨ã«é‡ãã‚’ç½®ã„ã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã‚‰ã®é–¢æ•°ã¯`constexpr`ãŒä»˜åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

`std::tagged_pointer<T, alignment>`ã¯`void*`ã¨åŒã˜ã‚µã‚¤ã‚ºã§`void*`ã«å¤‰æ›ã§ãã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã„ã†è¦ä»¶ã¯å®šã¾ã£ã¦ã„ã‚‹ã‚‚ã®ã®ã€ãã‚Œã‚’ä½•ã«ã™ã‚‹ã‹ï¼ˆ`void*`ã€`T*`ã€ã‚¯ãƒ©ã‚¹å‹ãªã©ï¼‰ã¯ã¾ã æ±ºã¾ã£ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚

- [Memory Tagging Extension: Enhancing memory safety through architecture](https://community.arm.com/arm-community-blogs/b/architectures-and-processors-blog/posts/enhancing-memory-safety)
- [64bitç’°å¢ƒã«ãŠã‘ã‚‹Objective-Cã®ãƒã‚¤ãƒ³ã‚¿ | GREE Engineering](https://labs.gree.jp/blog/2015/01/13437/)
- [HWAddressSanitizer Â |Â  Android Open Source Project](https://source.android.com/docs/security/test/hwasan?hl=ja)
- [57-bits ã®ä»®æƒ³ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã¨æ–°æ©Ÿèƒ½ UAI ãŒå®Ÿè£…ã•ã‚Œã‚‹å°†æ¥ã® AMD ãƒ—ãƒ­ã‚»ãƒƒã‚µ | Coelacanth's Dream](https://www.coelacanth-dream.com/posts/2022/03/12/amd-57bit-addr-uai/)
- [P3125 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1903)

### [P3126R1 Graph Library: Overview](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3126r1.pdf)
### [P3130R1 Graph Library: Graph Container Interface](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3130r1.pdf)
### [P3131R1 Graph Library: Containers](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3131r1.pdf)
### [P3137R1 views::to_input](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3137r1.html)
### [P3138R1 views::cache_last](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3138r1.html)
### [P3139R0 Pointer cast for unique_ptr](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3139r0.html)

`std::const_pointer_cast`ã¨`std::dynamic_pointer_cast`ã«`std::unique_ptr`ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

`std::uniqur_ptr`ã«å¯¾ã—ã¦ãƒã‚¤ãƒ³ã‚¿ã®ã‚­ãƒ£ã‚¹ãƒˆæ“ä½œã‚’è¡Œã†ã“ã¨ã¯ãã®ã¾ã¾ã§ã¯ã§ããšã€ç¾åœ¨ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯ã€ä¸€æ—¦`.release()`ã—ã¦ãƒã‚¤ãƒ³ã‚¿ã‚’å–ã‚Šå‡ºã—ãŸå¾Œã€ãã®ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã—ã¦ãƒã‚¤ãƒ³ã‚¿ã‚­ãƒ£ã‚¹ãƒˆã‚’é©ç”¨ã—ã¦ã‹ã‚‰ã€çµæœã®ãƒã‚¤ãƒ³ã‚¿ã‚’å†ã³`unique_ptr`ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã€ã¨ã„ã†æ‰‹é †ã§ã™ã€‚

ã—ã‹ã—ã€ã“ã®æ‰‹é †ã¯ä¸€æ—¦ãƒªã‚½ãƒ¼ã‚¹ã®æ‰€æœ‰æ¨©ã‚’æ‰‹æ”¾ã™å¿…è¦ãŒã‚ã‚‹ãªã©ã€ãƒªã‚½ãƒ¼ã‚¹å®‰å…¨ãªæ–¹æ³•ã¨ã¯ã„ãˆã¾ã›ã‚“ã€‚

```cpp
auto GetClient() -> std::unique_ptr<const Client>;

// constã‚’å¤–ã—ãŸã„
voif example() {
  std::unique_ptr<Client> client;
  // ç”Ÿãƒã‚¤ãƒ³ã‚¿ãŒéœ²å‡ºã™ã‚‹
  client.reset(const_cast<Client*>(GetClient().release()));

  ..
}

// dynamic_castã‚’é©ç”¨ã—ãŸã„
void UseV2Client(std::unique_ptr<Client>&& client) {
  std::unique_ptr<ClientV2> v2;
  ...
  // dynamic_castãŒå¤±æ•—ã™ã‚‹ã¨ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ã™ã‚‹
  v2.reset(dynamic_cast<ClientV2*>(client.release()));

  ...
}
```

ä¸€æ–¹ã§ã€`std::shared_ptr`ã«ã¯ãã®ã‚­ãƒ£ã‚¹ãƒˆã®ãŸã‚ã®ãƒ•ãƒªãƒ¼é–¢æ•°ã§ã‚ã‚‹`std::const_pointer_cast`ã¨`std::dynamic_pointer_cast`ãŒç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã‚’ç”¨ã„ã‚‹ã¨ã“ã®ã‚ˆã†ãªå±é™ºæ€§ã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€Boostã«ã¯`unique_ptr`ã«å¯¾ã™ã‚‹`std::const_pointer_cast`ã¨`std::dynamic_pointer_cast`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

`std::uniqur_ptr`ã®ãƒã‚¤ãƒ³ã‚¿ã‚­ãƒ£ã‚¹ãƒˆã¨ã„ã†æ“ä½œã‚’ã‚ˆã‚Šå®‰å…¨ã«ã™ã‚‹ãŸã‚ã«ã€`std::uniqur_ptr`ã§ã‚‚`std::const_pointer_cast`ã¨`std::dynamic_pointer_cast`ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã§ã™ã€‚

æ–¹æ³•ã¨ã—ã¦ã¯å˜ç´”ã«ã€`std::const_pointer_cast`ã¨`std::dynamic_pointer_cast`ã«`std::uniqur_ptr`ã‚’å—ã‘å–ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚’è¡ŒãŠã†ã¨ã—ã¦ã„ã¾ã™ãŒã€`std::unique_ptr`ç‰¹æœ‰ã®äº‹æƒ…ã«ã‚ˆã‚Šå°‘ã—è¨­è¨ˆãŒç•°ãªã‚‹éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚

1ã¤ã¯ææ¡ˆã™ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯`std::uniqur_ptr`ã®å³è¾ºå€¤ã«å¯¾ã—ã¦ã®ã¿ä½œç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚‚ã†1ã¤ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒªãƒ¼ã‚¿ã®è€ƒæ…®ã§ã™ã€‚`std::shared_ptr`ã®å ´åˆã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒªãƒ¼ã‚¿ã¯å‹æ¶ˆå»ã•ã‚Œã¦ä¿æŒã•ã‚Œã¦ãŠã‚Šã€ã‚­ãƒ£ã‚¹ãƒˆã®å‰å¾Œã§ã‚‚ä¸€è²«ã—ã¦å…ƒã®ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã—ã¦ä½œç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒªãƒ¼ã‚¿ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ã€`std::unique_ptr`ã®å ´åˆã¯ãƒ‡ãƒªãƒ¼ã‚¿ã¯å‹ã®ä¸€éƒ¨ã§ã‚ã‚Šã€ã‚­ãƒ£ã‚¹ãƒˆã«ã‚ãŸã£ã¦ãƒ‡ãƒªãƒ¼ã‚¿ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

`std::unique_ptr<T, D>`ã‚’`std::unique_ptr<U>`ã«ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹å ´åˆã€`D`ãŒã‚­ãƒ£ã‚¹ãƒˆå¾Œã®ãƒã‚¤ãƒ³ã‚¿ã‚’å‰Šé™¤ã§ãã‚‹ã‹ã©ã†ã‹ã‚’è€ƒãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯å˜ç´”ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‡ãƒªãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã«ã®ã¿ãã®ä»®å®šãŒæˆã‚Šç«‹ã¡ã¾ã™ã€‚ä¸€æ–¹ã€`std::unique_ptr<T, D>`ã¯`D`ã‚’é€šã—ã¦ãƒã‚¤ãƒ³ã‚¿å‹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒã§ãã€ä¿æŒã™ã‚‹ã‚‚ã®ã¯å®Ÿéš›ã«ã¯ãƒã‚¤ãƒ³ã‚¿ã§ã¯ãªã„å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã—ãŸ`D`ã¯ã‚­ãƒ£ã‚¹ãƒˆå¾Œã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æ­£ã—ãé–‹æ”¾ã§ãã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ï¼ˆã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçŸ¥ã£ã¦ã„ã¾ã™ï¼‰ã€‚

ãã®ãŸã‚ã€ã“ã®ææ¡ˆã§ã¯ã“ã®2ã¤ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚ã™ãªã‚ã¡ã€ã‚­ãƒ£ã‚¹ãƒˆã¯æ¬¡ã®2ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¯èƒ½ã§ã™

1. `std::unique_ptr<T>` -> `std::unique_ptr<U>`ã®å¤‰æ›
2. `std::unique_ptr<T, D>` -> `std::unique_ptr<U, D>`ã®å¤‰æ›

ææ¡ˆã•ã‚Œã¦ã„ã‚‹é–¢æ•°

```cpp
namespace std {
  // dynamic_cast
  template<class T, class U>
  constexpr unique_ptr<T> dynamic_pointer_cast(unique_ptr<U>&& r) noexcept;

  template<class T, class D, class U>
  constexpr unique_ptr<T, D> dynamic_pointer_cast(unique_ptr<U, D>&& r) noexcept;

  // const_cast
  template<class T, class U>
  constexpr unique_ptr<T> const_pointer_cast(unique_ptr<U>&& r) noexcept;

  template<class T, class D, class U>
  constexpr unique_ptr<T, D> const_pointer_cast(unique_ptr<U, D>&& r) noexcept;
}
```

ã“ã®ææ¡ˆã®ã‚­ãƒ£ã‚¹ãƒˆè¨­è¨ˆã«ãŠã„ã¦ã¯ã€å®‰å…¨ã§ã‚ã‚‹ã“ã¨ã‚’é‡è¦–ã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã®2ç¨®é¡ä»¥å¤–ã®ãƒã‚¤ãƒ³ã‚¿ã‚­ãƒ£ã‚¹ãƒˆï¼ˆ`static_cast`ã¨`reinterpret_cast`ï¼‰ã«å¯¾å¿œã™ã‚‹é–¢æ•°ã¯å°‚é–€çŸ¥è­˜ãŒå¿…è¦ã§ã‚ã‚Šæ°—è»½ã«ä½¿ç”¨ã§ãã‚‹ã‚‚ã®ã§ã¯ãªã„ã¨ã—ã¦ææ¡ˆã—ã¦ã„ã¾ã›ã‚“ã€‚

ã¾ãŸã€ã‚­ãƒ£ã‚¹ãƒˆã«å½“ãŸã£ã¦ã¯é™çš„ã«ãã®å±é™ºæ€§ã‚’æ¤œå‡ºã§ãã‚‹ã‚‚ã®ã«ã¤ã„ã¦ã¯ãƒã‚§ãƒƒã‚¯ã—ã¦å¼¾ãã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚æ¬¡ã®è¡¨ã¯ã€ã“ã®ææ¡ˆã®APIã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«ã‚’è¡¨ã—ãŸã‚‚ã®ã§ã™

|API|1ã®å¤‰æ›|2ã®å¤‰æ›|
|:--|---|---|
|`const_pointer_cast`|`T* -> U*`ã¸ã®`const_cast`ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨|å¤‰æ›å…ƒã®`::pointer`ã‹ã‚‰å¤‰æ›å…ˆã®`::pointer`ã¸ã®`const_cast`ãŒæœ‰åŠ¹ã§ã‚ã‚Šã€`T, U`ã¯ã©ã¡ã‚‰ã‚‚é…åˆ—å‹ã§ã‚ã‚‹ã‹ã©ã¡ã‚‰ã‚‚ç•°ãªã£ã¦ã„ã‚‹|
|`dynamic_pointer_cast`|`T* -> U*`ã¸ã®`dynamic_cast`ãŒæœ‰åŠ¹ã§ã‚ã‚Šã€`U`ã¯ä»®æƒ³ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’æŒã¤|å¤‰æ›å…ƒã®`::pointer`ã‹ã‚‰å¤‰æ›å…ˆã®`::pointer`ã¸ã®`dynamic_cast`ãŒæœ‰åŠ¹ã§ã‚ã‚Šã€`T, U`ã¯ã©ã¡ã‚‰ã‚‚é…åˆ—å‹ã§ã¯ãªã„|

è¡¨ã®å³åˆ—ã®ã€Œå¤‰æ›å…ƒã®`::pointer`ã€ã¨ã¯`std::unique_ptr<T, D>::pointer`ã®ã“ã¨ã§ã€ã€Œå¤‰æ›å…ˆã®`::pointer`ã€ã¨ã¯`std::unique_ptr<U, D>::pointer`ã®ã“ã¨ã§ã™ã€‚

- [`std::const_pointer_cast` - cpprefjp](https://cpprefjp.github.io/reference/memory/shared_ptr/const_pointer_cast.html)
- [`std::dynamic_pointer_cast` - cpprefjp](https://cpprefjp.github.io/reference/memory/shared_ptr/dynamic_pointer_cast.html)
- [P3139 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1904)

### [P3149R3 async_scope -- Creating scopes for non-sequential concurrency](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3149r3.html)
### [P3154R1 Deprecating signed character types in iostreams](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3154r1.html)
### [P3157R1 Generative Extensions for Reflection](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3157r1.html)
### [P3175R1 Reconsidering the `std::execution::on` algorithm](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3175r1.html)
### [P3175R2 Reconsidering the `std::execution::on` algorithm](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3175r2.html)
### [P3179R1 C++ parallel range algorithms](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3179r1.html)
### [P3183R1 Contract testing support](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3183r1.pdf)
### [P3210R1 A Postcondition *is* a Pattern Match](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3210r1.pdf)
### [P3214R0 2024-04 Library Evolution Poll Outcomes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3214r0.html)

2024å¹´4æœˆã«è¡Œã‚ã‚ŒãŸã€LEWGã«ãŠã‘ã‚‹æŠ•ç¥¨ã®çµæœ

æ¬¡ã®9ã¤ã®ææ¡ˆãŒæŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã€ãƒªã‚¸ã‚§ã‚¯ãƒˆã•ã‚ŒãŸã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“

- [P2985R0 A type trait for detecting virtual base classes](https://wg21.link/P2985R0)
- [P2019R5 Thread Attributes](https://wg21.link/P2019R5)
- [P2855R1 Member customization points for Senders and Receivers](https://wg21.link/P2855R1)
- [P3168R1 Give std::optional range support](https://wg21.link/P3168R1)
- [P2075R5 Philox as an extension of the C++ RNG engines](https://wg21.link/P2075R5)
- [P2927R2 Observing exceptions stored in exception_ptr](https://wg21.link/P2927R2)
- [P2997R1 Removing the common reference requirement from the indirectly invocable concepts](https://wg21.link/P2997R1)
- [P2389R1 dextents Index Type Parameter](https://wg21.link/P2389R1)
- [P3201R1 LEWG nodiscard policy](https://wg21.link/P3201R1)

P3201R1ã¨P3201R1ä»¥å¤–ã¯ã€C++26ã«å‘ã‘ã¦LWGã«è»¢é€ã™ã‚‹ãŸã‚ã®æŠ•ç¥¨ã§ã™ã€‚

ã¾ãŸã€æŠ•ç¥¨ã«å½“ãŸã£ã¦å¯„ã›ã‚‰ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P3228R1 Contracts for C++: Revisiting contract check elision and duplication](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3228r1.pdf)
### [P3234R1 Utility to check if a pointer is in a given range](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3234r1.html)
### [P3235R0 `std::print` more types faster with less memory](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3235r0.html)

`std::print`ã®åŠ¹ç‡çš„ãªå®Ÿè£…ã‚’ã‚ˆã‚Šæ‹¡å¤§ã—ã¦é©ç”¨ã™ã‚‹ææ¡ˆã€‚

P3107ã§ã¯`std::print`ã«å¯¾ã—ã¦ã€`std::format()`ã‚’ä½¿ç”¨ã—ã¦ä¸€æ—¦`std::string`ã‚’å¾—ã¦ã‹ã‚‰å‡ºåŠ›ã™ã‚‹ã®ã§ã¯ãªãã€åŸºåº•ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ã‚’ãƒ­ãƒƒã‚¯ã—ã¦ç›´æ¥æ›¸ãè¾¼ã‚€ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§`std::print`ã®å‡ºåŠ›å‹•ä½œã‚’åŠ¹ç‡åŒ–ã—ã¾ã—ãŸã€‚ãŸã ã—ã€ã“ã‚Œã¯ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿å†…ã§ãƒ­ãƒƒã‚¯ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹å ´åˆã«ãã®å‹ã®å€¤ã«å¯¾ã—ã¦`std::print`ã‚’åŒã˜ãƒ­ãƒƒã‚¯ã®ä¸‹ã§å‘¼ã³å‡ºã™å ´åˆã«ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã£ãŸãŸã‚ã€`std::enable_nonlocking_formatter_optimization`å¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç‰¹æ®ŠåŒ–ã‚’`true`ã§å®šç¾©ã™ã‚‹å ´åˆã«ã®ã¿æœ‰åŠ¹ã«ãªã‚‹ã‚ˆã†ã«ã•ã‚Œã¦ã„ã¾ã™ã€‚

```cpp
// ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ãŸã„å‹
struct foo {};

// fooã®ãŸã‚ã®formatterç‰¹æ®ŠåŒ–
template <>
struct std::formatter<foo> {
  ...
};

// P3107ã®åŠ¹ç‡çš„ãªå®Ÿè£…ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹
template <>
constexpr bool std::enable_nonlocking_formatter_optimization<foo> = true;
```

P3107ã§ã¯ã€ã“ã®ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã‚’åŸºæœ¬å‹ï¼ˆ`int`ç­‰çµ„ã¿è¾¼ã¿ã®å‹ï¼‰ã¨æ–‡å­—åˆ—å‹ï¼ˆ`std::string/std::string_view`ï¼‰ã«å¯¾ã—ã¦ã®ã¿ç”¨æ„ã—ã¦ãŠã‚Šã€ä»–ã®æ¨™æº–å‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã«å¯¾ã—ã¦ã¯æœ‰åŠ¹åŒ–ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã‚Œã‚‰ä»¥å¤–ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿æä¾›æ¸ˆã¿ã®æ¨™æº–å‹ã«å¯¾ã—ã¦ã‚‚ã“ã®ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

è¿½åŠ ã‚’ææ¡ˆã—ã¦ã„ã‚‹ã‚‚ã®ã¯æ¬¡ã®ã‚‚ã®ã§ã™

- `<chrono>`é–¢é€£å‹
    - ãŸã ã—ã€`std::zoned_time`ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`TimeZonePtr`ã«å¯¾ã—ã¦ã®ã¿æä¾›
- `std::thread::id`
- `<stack_trace>`é–¢é€£
- `std::filesystem::path`
- `std::pair/std::tuple`
    - è¦ç´ å‹ã®ã™ã¹ã¦ãŒã‚ªãƒ—ãƒˆã‚¤ãƒ³æ¸ˆã¿ã§ã‚ã‚‹å ´åˆã«æœ‰åŠ¹åŒ–
- `range`é–¢é€£
    - `std::vector<bool>`ã¨ã‚³ãƒ³ãƒ†ãƒŠã‚¢ãƒ€ãƒ—ã‚¿ã‚’å«ã‚€
    - è¦ç´ å‹ã«ã‚ˆã‚‰ãšã«æœ‰åŠ¹åŒ–
        - åå¾©å‡¦ç†ã®å ´åˆã¯ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç™ºç”Ÿã®å¯èƒ½æ€§ãŒä½ã„ã¨è€ƒãˆã‚‰ã‚Œã‚‹ãŸã‚

ã¾ãŸè¿½åŠ ã®ææ¡ˆã¨ã—ã¦ã€ç¾åœ¨ã®`std::vprint_(non)unicode`ã‚’`std::vprint_(non)unicode_buffered`ã«ã€`std::vprint_(non)unicode_locking`ã‚’`std::vprint_(non)unicode`ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€éãƒ­ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ï¼ˆç¾åœ¨ã®`std::vprint_(non)unicode`ï¼‰ãŒæœ€çµ‚çš„ãªæ›¸ãè¾¼ã¿æ™‚ã«`std::vprint_(non)unicode_locking`ã‚’å‘¼ã³å‡ºã™ãŸã‚ã€å‘½åãŒèª¤è§£ã‚’æ‹›ãã¨ã„ã†ã“ã¨ã§ä¿®æ­£ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚ä¿®æ­£å¾Œã®åå‰ã¯ã€ã“ã®2ã¤ã®é–¢æ•°ã®é•ã„ãŒå‡ºåŠ›ã‚’ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ï¼ˆå…¨ä½“ã‚’æ–‡å­—åˆ—åŒ–ã—ã¦ã‹ã‚‰å‡ºåŠ›ã‚’è¡Œã†ï¼‰ã—ã¦è¡Œã†ã‹ã©ã†ã‹ã¨ã„ã†ç‚¹ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆC++23ã¸ã®DRã¨ã—ã¦ã€2024å¹´6æœˆã®å…¨ä½“ä¼šè­°ã§æ¡æŠã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P3107R0 Permit an efficient implementation of `std::print`](https://onihusube.hatenablog.com/entry/2024/05/18/235613#P3107R0-Permit-an-efficient-implementation-of-stdprint)
- [P3107R5 Permit an efficient implementation of `std::print`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3107r5.html)
- [P3235 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1906)

### [P3236R1 Please reject P2786 and adopt P1144](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3236r1.html)
### [P3238R0 An alternate proposal for naming contract semantics](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3238r0.html)

é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã•ãšã«çµ‚äº†ã™ã‚‹å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆquick_enforceï¼‰ã‚’ã€Erroneous Behaviorã¨ã—ã¦æ‰±ã†ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ã“ã“ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã®ã¯æ¬¡ã®2ã¤ã®äº‹ã§ã™

1. å¥‘ç´„é•åæ™‚ã«é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã•ãšå³æ™‚çµ‚äº†ã™ã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆquick_enforceï¼‰ã‚’æŒã¤å¥‘ç´„æ³¨é‡ˆã®å¥‘ç´„é•åæ™‚ã®å‹•ä½œã¯ã€Erroneous Behaviorã§ã‚ã‚‹ã¨æŒ‡å®šã™ã‚‹
    - ãã®å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¨ã—ã¦ã€é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã™
2. å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®åå‰ã‚’å¤‰æ›´ã™ã‚‹
    - ignore -> ignored
    - enforce -> enforced
    - observe -> observed
    - quick_enforce -> erroneous

å¥‘ç´„é•åæ™‚ã«å³æ™‚çµ‚äº†ã™ã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«ãŠã„ã¦ã¯å¥‘ç´„é•åã¯è‡´å‘½çš„ãªå¤±æ•—ã§ã‚ã‚Šã€ä»–ã®æ–¹æ³•ã§ã“ã®å‹•ä½œã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ã“ã‚Œã‚’EBã¨ã—ã¦æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ãã®ã¾ã¾å³æ™‚çµ‚äº†ã™ã‚‹ã“ã¨ã¨ã€å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¨ã—ã¦é•åãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã—ã¦ç°¡å˜ãªè¨ºæ–­ã‚’ç™ºè¡Œã—ã¦çµ‚äº†ã™ã‚‹ã“ã¨ã®ä¸¡æ–¹ã‚’å®Ÿè£…ã«å¯¾ã—ã¦è¨±å¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ¬¡ã«ã“ã®ã“ã¨ã‚’è¸ã¾ãˆãŸã†ãˆã§quick_enforceã«å¯¾ã™ã‚‹é©åˆ‡ãªåå‰ã‚’è€ƒãˆã¾ã™ã€‚ä»–ã®3ã¤ã®å¥‘ç´„ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã®åå‰ã¯æ¦‚ã­ã€Œï½ the trueness of a predicateã€ï¼ˆã€Œè¿°èªã®çœŸå½ã‚’ï½ã™ã‚‹ã€ï¼‰ã®ï½ã®éƒ¨åˆ†ã«å½“ã¦ã¯ã¾ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ãŒã€quick_enforceã¯ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ææ¡ˆã§ã¯ãã“ã«å½“ã¦ã¯ã¾ã‚‹ã‚ˆã†ãªåå‰ã‚’è€ƒãˆã‚‹ã®ã§ã¯ãªãã€æ„å‘³ä¸Šã®erroneousã¨ã„ã†å˜èªã‚’ä»–ã®åå‰ã«ãªã£ã¦ã„ã‚‹å‹•è©ã®éå»å½¢ã¨åŒã˜æ–‡æ³•çš„ä½ç½®ã«ç½®ãã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã™ãªã‚ã¡ã€ã€ŒA contract violation is treated as ï½ã€ï¼ˆå¥‘ç´„é•åã¯ã€ï½ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ï¼‰ã®ï½ã«å…¥ã‚‹ã‚ˆã†ã«ä»–ã®3ã¤ã®åå‰ã‚’å¤‰æ›´ã—ã€å‹•è©ã®éå»å½¢ã«ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã®å†…å®¹ã¯SG21ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ãŠã„ã¦å¥½ã¾ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚

- [P3238 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1906)

### [P3239R0 A Relocating Swap](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3239r0.pdf)

ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„ãŸ`swap`ã‚’è¡Œã†ã€`swap_representations`ã®ææ¡ˆã€‚

`swap`ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã‚’äº¤æ›ã™ã‚‹ã“ã¨ã§ã™ã€‚ãã®æ“ä½œã¯å®Ÿéš›ã«ã¯ã€ãƒ ãƒ¼ãƒ–ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ãƒ ãƒ¼ãƒ–ä»£å…¥æ¼”ç®—å­ï¼ˆã¨ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼‰ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã®äº¤æ›ã¨ã„ã†éƒ¨åˆ†ã«æ³¨ç›®ã™ã‚‹ã¨`swap`ã®è¡Œã†ã“ã¨ã¯ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¡Œã†ã“ã¨ã¨ã‚ˆãä¼¼ã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ãã¾ã™ã€‚ç‰¹ã«ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ãªå‹ãªã‚‰`swap`ã¯å˜ç´”ãª`memcpy`ã«ã‚ˆã£ã¦å®Ÿè¡Œã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€`swap`ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã—ã‹ã—ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãªãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚ˆã†ãªæ“ä½œã«ã‚ˆã£ã¦2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¡¨ç¾ã‚’å…¥ã‚Œæ›¿ãˆã‚‹ã“ã¨ã¯ã€C++ã®éãƒˆãƒªãƒ“ã‚¢ãƒ«ãªå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ã®ç”Ÿå­˜æœŸé–“ã®ã®ãƒ«ãƒ¼ãƒ«ã«æŠµè§¦ã—ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å°å…¥å¾Œã«ãŠã„ã¦ã‚‚è¨±å¯ã•ã‚Œã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã¯ã€ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹`swap`ã‚’è¡Œã†å°‚ç”¨ã®é–¢æ•°ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«è¿½åŠ ã—ã€ãã‚Œã‚’é€šã—ã¦ã®ã¿ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹`swap`ã‚’åˆæ³•åŒ–ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã®ã¯ã€`std::swap_representations()`ã¨ã„ã†é–¢æ•°ã§ã™ã€‚åŒã˜å‹ã®2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å‚ç…§ã‚’å—ã‘å–ã£ã¦ã€ãã‚Œã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å€¤è¡¨ç¾ã‚’äº¤æ›ã—ã¾ã™ãŒã€ã©ã¡ã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿå­˜æœŸé–“ã‚‚çµ‚äº†ã—ã¾ã›ã‚“ã€‚ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ“ä½œã‚’ç”¨ã„ã‚‹ã¨ã‚½ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯æ¶ˆãˆã¦ã—ã¾ã†ãŸã‚é€šå¸¸ãã‚Œã¯ä¸å¯èƒ½ã§ã™ã€‚ãã®ãŸã‚ã€ã“ã®é–¢æ•°ã¯ä¸€ç¨®ã®é­”æ³•ã®ã‚ˆã†ã«å‹•ä½œã™ã‚‹ç‰¹åˆ¥ãªé–¢æ•°ã§ã™ã€‚ãŸã ã—ã€å®‰å…¨ã®ãŸã‚ã€å…¥åŠ›ã®å‹`T`ã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ï¼ˆ`is_trivially_relocatable_v<T>`ãŒ`true`ï¼‰ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

```cpp
namespace std {
  // ææ¡ˆã™ã‚‹swap_representationsã®å®£è¨€
  template <bool force, class T>
  void swap_representations(T& a, T& b); 
}
```

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®`force`ã¯`T`ãŒãƒãƒªãƒ¢ãƒ«ãƒ•ã‚£ãƒƒã‚¯ãªå‹ã®å ´åˆã«ã®ã¿æ„å‘³ã‚’æŒã¡ã¾ã™ã€‚ã“ã“ã§ã®å¼•æ•°ã¯å‚ç…§ã§ã‚ã‚‹ãŸã‚ã€`T`ã‚’åŸºåº•ã‚¯ãƒ©ã‚¹ã¨ã—ãŸæ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å‚ç…§ãŒå…¥åŠ›ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚‚ã—ã€`a`ã¨`b`ãŒåŒã˜åŸºåº•ã‚¯ãƒ©ã‚¹`T`ã‹ã‚‰æ´¾ç”Ÿã™ã‚‹åˆ¥ã®æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®å‚ç…§ã§ã‚ã‚‹å ´åˆã€ã“ã‚Œã¯æœªå®šç¾©å‹•ä½œã«ãªã‚Šã¾ã™ï¼ˆ`a`ã¨`b`ã®ä»®æƒ³é–¢æ•°ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç•°ãªã£ã¦ã„ã‚‹ãŸã‚ï¼‰ã€‚

ã“ã®é–¢æ•°å†…ã‹ã‚‰ã¯å‚ç…§ã§æ¸¡ã•ã‚ŒãŸã‚‚ã®ã—ã‹è¦‹ãˆãªã„ãŸã‚ãã‚Œã‚’é™çš„ã«æ¤œå‡ºã§ãã¾ã›ã‚“ãŒã€`swap_representations`åˆ©ç”¨è€…ãŒäºˆã‚ã“ã®å±é™ºæ€§ãŒãªã„å‚ç…§ã‚’æ¸¡ã™ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã‚‹å ´åˆï¼ˆä¾‹ãˆã°ã€`std::vector`å†…éƒ¨ã§è¦ç´ å‹ãŒ`T`ãã®ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆãªã©ï¼‰ã«ã€`force`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’`true`ã«ã—ã¦å‘¼ã³å‡ºã™ã“ã¨ã§ãƒãƒªãƒ¢ãƒ«ãƒ•ã‚£ãƒƒã‚¯ãªå‹ã®å€¤è¡¨ç¾ã‚’äº¤æ›ã§ãã¾ã™ã€‚é€†ã«ã€`is_polymorphic_v<T>`ãŒ`true`ã®å ´åˆã«`force`ãŒ`false`ã¨æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã¨ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€`std::swap`ãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®è¦³æ¸¬å¯èƒ½ãªå‹•ä½œã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãªãã“ã‚Œã‚’ç”¨ã„ã¦å®Ÿè£…å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™å‹ç‰¹æ€§`std::swap_uses_value_representations_v`ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã‚‚ææ¡ˆã—ã¦ã„ã¾ã™ã€‚å‹`T`ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ã®`std::swap`ã¯`std::swap_uses_value_representations_v<T>`ãŒ`true`ã¨ãªã‚‹å ´åˆã«`swap_representations`ã‚’ç”¨ã„ã¦æœ€é©åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ææ¡ˆã®å†…å®¹ã¯ã‚³ã‚¢è¨€èªã®å¤‰æ›´ã‚’ä¼´ã‚ãªã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ‹¡å¼µã®ã¿ã§ã‚ã‚Šã€ãªãŠã‹ã¤ä»–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã«å½±éŸ¿ã‚’åŠã¼ã•ãªã„ã‚‚ã®ã§ã™ã€‚ã—ã‹ã—ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ãƒªãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨å…±ã«å°å…¥ã•ã‚Œã‚Œã°ã€ãã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä¸Šã®æ©æµã‚’æœ€å¤§åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- [P2786R0 Trivial relocatability options - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/03/19/184146#P2786R0-Trivial-relocatability-options)
- [P3239 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1908)

### [P3247R1 Deprecate the notion of trivial types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3247r1.html)
### [P3248R0 Require [u]intptr_t](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3248r0.html)

`(u)intptr_t`ã‚’å¿…é ˆã«ã™ã‚‹ææ¡ˆã€‚

`(u)intptr_t`ã¯ãƒã‚¤ãƒ³ã‚¿å€¤ã‚’æ•´æ•°ã¨ã—ã¦ä¿æŒã—ãŸã„å ´åˆã«ä½¿ç”¨ã§ãã€å¤‰æ›å‰å¾Œã§ãƒã‚¤ãƒ³ã‚¿å€¤ãŒå¤‰åŒ–ã—ãªã„ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹æ•´æ•°å‹ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§ã™ã€‚ã—ã‹ã—ã€ã“ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€å®Ÿè£…ã¯å¿…ãšã—ã‚‚å®šç¾©ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

`(u)intptr_t`ãŒå­˜åœ¨ã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã„ã†äº‹å®Ÿã«ã‚ˆã£ã¦ã€ç§»æ¤æ€§ã‚’é‡è¦–ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã¯ã“ã®ä½¿ç”¨ã‚’å›é¿ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãã®ãŸã‚ã«ä½™è¨ˆãªä½œæ¥­ã¨æ½œåœ¨çš„ãªãƒã‚°ã‚’åŸ‹ã‚è¾¼ã‚€å¯èƒ½æ€§ãŒç™ºç”Ÿã—ã¾ã™ã€‚

ã“ã®ã“ã¨ã¯æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚‚å•é¡Œã«ãªã‚Šã€P2835ï¼ˆ`std::atomic_ref`ã«ãƒã‚¤ãƒ³ã‚¿å€¤ã‚’å–å¾—å¯èƒ½ãªé–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ï¼‰ã‚„P3125ï¼ˆãƒã‚¤ãƒ³ã‚¿ã®æœªä½¿ç”¨ãƒ“ãƒƒãƒˆä½¿ç”¨ã®ãŸã‚ã®é–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ï¼‰ãªã©ã§ã¯ãƒã‚¤ãƒ³ã‚¿å€¤ã®ã‚„ã‚Šå–ã‚Šã®ãŸã‚ã«`(u)intptr_t`ã‚’ä½¿ç”¨ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã‚‚ã®ã®ã€ãã‚ŒãŒã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã§ã‚ã‚‹ã“ã¨ãŒå•é¡Œã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€`(u)intptr_t`ã‚’å¿…é ˆã®å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã§ã‚ã‚‹ã¨ã¯ã„ãˆå®Ÿéš›ã«ã¯ä¸»è¦3ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯å…¨ã¦ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå‘ã‘ã«ã“ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’æä¾›ã—ã¦ãŠã‚Šã€ãã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®Ÿè£…ã‚‚`(u)intptr_t`ã®å­˜åœ¨ã‚’ä»®å®šã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ã¾ãŸã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ABIã§ã‚‚`(u)intptr_t`ç›¸å½“ã®æ•´æ•°å‹ã®å­˜åœ¨ãŒãƒã‚¤ãƒ³ã‚¿å‹ã®æŒ‡å®šã¨å…±ã«ä»„ã‚ã‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

å¾“ã£ã¦ã€`(u)intptr_t`ã‚’å¿…é ˆã«ã—ãŸã¨ã—ã¦ã‚‚C++ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚µãƒãƒ¼ãƒˆã¯ä½ä¸‹ã—ãªã„ã€ã¨ã“ã®ææ¡ˆã§ã¯çµè«–ä»˜ã‘ã¦ã„ã¾ã™ã€‚

ææ¡ˆã—ã¦ã„ã‚‹è¦æ ¼ã®å¤‰æ›´ã¯ã€`(u)intptr_t`ã‹ã‚‰optionalã§ã‚ã‚‹ã¨ã„ã†æŒ‡å®šã‚’å–ã‚Šé™¤ãã ã‘ã§ã™ã€‚

- [`std::intptr_t` - cpprefjp](https://cpprefjp.github.io/reference/cstdint/intptr_t.html)
- [P3248 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1909)

### [P3249R0 A unified syntax for Pattern Matching and Contracts when introducing a new name](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3249r0.pdf)

ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã¨å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®é–“ã§çµ±ä¸€çš„ãªæ§‹æ–‡ã®ææ¡ˆã€‚

ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°æ§‹æ–‡ã«ãŠã„ã¦ã¯ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¨˜è¿°å†…ã§ï¼ˆãƒãƒƒãƒã—ãŸã‚‚ã®ã‚’è¡¨ã™ï¼‰æ–°ã—ã„åå‰ã‚’å°å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€P2688ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ææ¡ˆã«ãŠã„ã¦ã¯`let x => expr;`ã®æ§˜ã«è¨˜è¿°ã—ã¾ã™ã€‚ã¾ãŸã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®äº‹å¾Œæ¡ä»¶ã«ãŠã„ã¦ã¯ã€æˆ»ã‚Šå€¤ã‚’å‚ç…§ã™ã‚‹åå‰ã‚’å°å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€`post(r : expr)`ã®æ§˜ã«è¨˜è¿°ã—ã¾ã™ã€‚

```cpp
int f();

// ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã®ä¾‹
void g() {
  int i = f();

  i match {
    42 let val => print(val); // valã‚’å°å…¥ï¼ˆval == 42ï¼‰
    let x => print(x); // xã‚’å°å…¥ï¼ˆx != 42ï¼‰
  }
}

// å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä¾‹
int foo()
  post(ret : ret > 0) // retã‚’å°å…¥
```

ãã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§å¿…è¦ãªå¤‰æ•°åã‚’å°å…¥ã™ã‚‹ã¨ã„ã†å´é¢ã‹ã‚‰ã¯ã“ã®2ã¤ã¯åŒã˜ã“ã¨ã‚’ã—ã¦ã„ã‚‹ã¨è¦‹ã‚‹ã“ã¨ãŒã§ãã€åŒã˜ã“ã¨ã‚’ã™ã‚‹ã®ã«ç•°ãªã‚‹æ§‹æ–‡ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã¯ä¸€è²«æ€§ãŒç„¡ãåˆå­¦è€…ãŒè¦šãˆã¥ã‚‰ãã€è¨€èªã‚’è¤‡é›‘ã«ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã®2ã¤ã®åå‰å°å…¥ã®æ§‹æ–‡ã‚’çµ±ä¸€ã™ã‚‹ã“ã¨ã§ã€ç¿’å¾—ã®ã—ã‚„ã™ã•ã®å‘ä¸Šã¨è¨€èªã®è¤‡é›‘ã•ã®ä½æ¸›ã‚’å›³ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã§ã¯ã€ã“ã‚Œã‚‰ã®æ§‹æ–‡ã‚’ä¸€è²«ã—ã¦`let name => expr`ã®ã‚ˆã†ã«çµ±ä¸€ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

```cpp
int foo()
  post( let r => r > 0) // rã‚’å°å…¥
```

ã™ãªã‚ã¡ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®æ§‹æ–‡ã‚’ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã«åˆã‚ã›ã‚‹ã‚‚ã®ã§ã™ã€‚

ãŸã ã—ã€äº‹å¾Œæ¡ä»¶ï¼ˆ`post()`ï¼‰å†…ã§ã®`let ~`ã¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã§ã¯ãªã„ãŸã‚ã€ãã“ã§ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã‚’æ›¸ããŸã„å ´åˆã¯å³è¾ºã®å¼å†…ã«è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

äº‹å¾Œæ¡ä»¶ã¨ã—ã¦`(ret == 1 or ret == 2 or ret > 100)`ã¨ã„ã†æ¡ä»¶ã‚’æŒ‡å®šã—ãŸã„å ´åˆã®ä¾‹

```cpp
// P3210ã®ææ¡ˆ
int foo()
  post (
    1 => true;
    2 => true;
    let ret => ret > 100
  );

// ã“ã®ææ¡ˆã®å ´åˆ
int foo()
  post ( let ret =>
    ret match {
      1 => true;
      2 => true;
    } or
    ret > 100
  );
```

ã“ã‚ŒãŒã€å…ˆè¡Œã™ã‚‹åŒç¨®ã®ææ¡ˆP3210ã¨ã®é•ã„ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã®å•é¡Œç‚¹ã¯ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒC++26ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ã®ã«å¯¾ã—ã¦ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°æ©Ÿèƒ½ã¯ã¾ã ãã®æ®µéšã«ãªã„ã“ã¨ã§ã™ã€‚ãŠãã‚‰ãã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®æ–¹ãŒå…ˆã«å®Œæˆã—æ¨™æº–ã«å–ã‚Šè¾¼ã¾ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚ã¤ã¾ã‚Šã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã®æ§‹æ–‡ã¯ã¾ã æµå‹•çš„ã§ã€æœ€æ‚ªã®å ´åˆã“ã®ææ¡ˆãŒæ¡æŠã•ã‚ŒãŸã†ãˆã§ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã ã‘ç•°ãªã‚‹æ§‹æ–‡ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ãŸã ã€ã“ã®ææ¡ˆã‚’æ¡æŠã—ãªã‘ã‚Œã°åŒã˜ã“ã¨ã‚’è¡Œã†ã®ã«ç•°ãªã‚‹2ã¤ã®æ§‹æ–‡ãŒç¢ºå®Ÿã«å°å…¥ã•ã‚Œã‚‹ã®ã«å¯¾ã—ã¦ã€ã“ã®ææ¡ˆã‚’æ¡æŠã—ãŸãŠã‘ã°ãã‚Œã‚’ç•°ãªã‚‹2ã¤ã®æ§‹æ–‡ãŒå°å…¥ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€ã¾ã§ç·©å’Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ãŒå…ˆã«æ¡æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã“ã®ææ¡ˆãŒæ¡æŠã•ã‚Œã¦ã„ã‚‹ã¨ã™ã‚‹ã¨ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã®æ§‹æ–‡ã¨ã—ã¦åˆ¥ã®ã‚‚ã®ãŒææ¡ˆã•ã‚Œã‚‹å ´åˆã«ãã‚Œã«å¯¾ã—ã¦ä½™åˆ†ãªåˆ¶ç´„ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ãã®å ´åˆã“ã®ææ¡ˆã§ã¯ã€çµ±ä¸€æ§‹æ–‡ã‹ã‚‰é€¸è„±ã™ã‚‹ã«ã›ã‚ˆæ•´åˆæ€§ã‚’é‡è¦–ã™ã‚‹ã«ã›ã‚ˆã€ãã‚Œã¯å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã¨ã¯ç„¡é–¢ä¿‚ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ãŒï¼ˆã‚’è­°è«–ã™ã‚‹EWGãŒï¼‰æ±ºå®šã™ã‚‹ã¹ãã€ã¨ã—ã¦ã„ã¾ã™ã€‚

- [P3210R0 A Postcondition is a Pattern Match - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3210r0.pdf)
- [P3249 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1910)

### [P3250R0 C++ contracts with regards to function pointers](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3250r0.html)

å¥‘ç´„æ³¨é‡ˆã‚’æŒã¤é–¢æ•°ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸ã®æš—é»™å¤‰æ›ã‚’ç¦æ­¢ã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ï¼ˆP2900ï¼‰ã§ã¯ã€ç¾æ™‚ç‚¹ã§å¥‘ç´„ãƒã‚§ãƒƒã‚¯ãŒé–¢æ•°ã®å‘¼ã³å‡ºã—å´ã§ãªã•ã‚Œã‚‹ã®ã‹ã€å‘¼ã³å‡ºã—å…ˆã§ãªã•ã‚Œã‚‹ã®ã‹ãŒæœªè§£æ±ºã®ã¾ã¾ã§ã™ã€‚ã¨ã¯ã„ãˆã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®å ´åˆã‚’é™¤ã„ã¦ã“ã‚Œã¯ã»ã¼å•é¡Œã«ãªã‚‰ãªã„ã‚ˆã†ã§ã™ã€‚

ã¾ãŸç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ä»•æ§˜ã§ã¯ã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã™ã‚‹å¥‘ç´„ã®æŒ‡å®šã¯è¡Œãˆã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ãŒãã®ã‚·ã‚°ãƒãƒãƒ£ã ã‘ä¼šã£ã¦å±…ã‚Œã°å¤‰æ›ã§ãã¦ã—ã¾ã†ãŸã‚ã§ã€ç•°ãªã‚‹å¥‘ç´„æ¡ä»¶ã®å¤‰æ›ã‚’ã©ã†ã™ã‚‹ã‹ã¨ã„ã†å„ä»‹ãªå•é¡Œã®è­°è«–ã‚’å…ˆé€ã‚Šã«ã™ã‚‹ãŸã‚ã®åˆ¶é™ã§ã™ã€‚ãŸã ã—ã€å°†æ¥çš„ã«ãã‚Œã‚’æœ‰åŠ¹åŒ–ã—ãŸå ´åˆã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’é€šã—ã¦é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚ŒãŸå ´åˆã«å¥‘ç´„ãƒã‚§ãƒƒã‚¯ã‚’æ­£ã—ãè¡Œã†ã«ã¯å¿…ãšå‘¼ã³å‡ºã—å…ˆã§ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ã‚’æ„å‘³ã—ã¦
ã„ã¾ã™ã€‚

ãŸã ã—ã€ç¾åœ¨ã®ä»•æ§˜ï¼ˆP2900ï¼‰ã§ã¯ã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã‚’ç¦æ­¢ã—ã¦ã„ã‚‹ã‚‚ã®ã®ã€å¥‘ç´„æ³¨é‡ˆã‚’æŒã¤é–¢æ•°ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸ã®å¤‰æ›ã¯ç¦æ­¢ã—ã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€å°†æ¥çš„ã«é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã¸ã®æ‹¡å¼µãŒè¡Œã‚ã‚ŒãŸå ´åˆã«å•é¡ŒãŒèµ·ã“ã‚Šã¾ã™ã€‚

```cpp
// å¥‘ç´„ã‚’æŒã¤é–¢æ•°
void fun(A& a) pre (a.ok());

// é–¢æ•°å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹
using F = void(A& a);
using G = void(A& a) pre(a.ok()); // å°†æ¥å¯èƒ½ã«ãªã£ãŸã¨ã—ã¦

// é–¢æ•°ãƒã‚¤ãƒ³ã‚¿å¤‰æ•°ã®å®£è¨€
F* f = fun; // okã€å±é™ºã€ç¾åœ¨ã‹ã‚‰å¯èƒ½
G* g = fun; // okã€å®‰å…¨
```

ã“ã®ã‚ˆã†ã«åŒã˜é–¢æ•°ã«å¯¾ã™ã‚‹é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã§ã‚‚ã€å¥‘ç´„æ³¨é‡ˆã®æƒ…å ±ã‚’ä¿æŒã—ãŸã‚‚ã®ã¨ã™ã¹ã¦å‰Šé™¤ã•ã‚ŒãŸã‚‚ã®ã®2ç¨®é¡ãŒå…±å­˜ã—ã¦ã—ã¾ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€å°†æ¥ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã®æŒ‡å®šã‚’å¯èƒ½ã«ã—ã¦ãŠããŸã‚ã«ã€å¥‘ç´„ã‚’æŒã¤é–¢æ•°ã‹ã‚‰ã‚·ã‚°ãƒãƒãƒ£ãŒãƒãƒƒãƒã™ã‚‹é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ãƒ˜ã®æš—é»™å¤‰æ›ã‚’ç¦æ­¢ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«å¥‘ç´„æ³¨é‡ˆã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ã™ã‚‹å ´åˆ

- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯å‘¼ã³å‡ºã—å…ˆã§ã®ãƒã‚§ãƒƒã‚¯ã‚’çœç•¥ã—ã¦ã€å‘¼ã³å‡ºã—å´ã®ï¼ˆå ´åˆã«ã‚ˆã£ã¦ã¯çœç•¥å¯èƒ½ãªï¼‰å¥‘ç´„æ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯ã‚’æŠ±ã‘ã‚’è¡Œãˆã‚‹
    - ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®è¨¼æ˜ã«ã‚ˆã£ã¦ã€å¥‘ç´„æ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯ãŒçœç•¥å¯èƒ½ãªæ©Ÿä¼šãŒå¢—ãˆã‚‹
- ç•°ãªã‚‹å¥‘ç´„æ³¨é‡ˆã‚»ãƒƒãƒˆé–“ã§ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®å¤‰æ›
    - ã‚ˆã‚Šå¼·ã„å¥‘ç´„ã‹ã‚‰ã‚ˆã‚Šå¼±ã„å¥‘ç´„ã¸ã€ã¾ãŸã¯ãã®é€†ã€ã®å¤‰æ›ãªã©

ç­‰ã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

å°†æ¥ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®ãŸã‚ã«è¨­è¨ˆã‚’äºˆç´„ã—ã¦ãŠãå ´åˆã€ã“ã‚Œã‚‰ã®ãƒ¡ãƒªãƒƒãƒˆã‚’å°†æ¥çš„ã«å°å…¥ã™ã‚‹æ™‚ã®ãŸã‚ã«è¨­è¨ˆã‚’é–‹ã„ã¦ãŠãã€ãªãŠã‹ã¤ã€ç¾åœ¨ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®ä½¿ç”¨æ–¹æ³•ã‚’å°†æ¥ã®å¤‰æ›´ã‹ã‚‰ä¿è­·ã™ã‚‹äº‹ã«ã‚‚ã¤ãªãŒã‚Šã¾ã™ã€‚

ä¸€æ–¹ã€é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®å¥‘ç´„æ³¨é‡ˆã®ãŸã‚ã«è¨­è¨ˆç©ºé–“ã‚’äºˆç´„ã—ã¦ãŠãå ´åˆ

- é–¢æ•°åã«å¯¾ã—ã¦ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–ã‚‹æ“ä½œã¯ã€æ˜ç¤ºçš„ãªå¤‰æ›ã®ã¿ãŒè¨±å¯ã•ã‚Œã‚‹
- å‹æ¨è«–ã•ã‚Œã‚‹å ´æ‰€ã§é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’ä½¿ç”¨ã§ããªã„
  - `auto*`ã‚„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- P2900ã¯å¥‘ç´„æ³¨é‡ˆã¯ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ä¸å¯è¦–ã§ã‚ã‚‹ã“ã¨ã‚’æ±ºå®šã—ãŸãŒã€ã“ã‚Œã«ã‚ˆã£ã¦ãã‚Œã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ¤œå‡ºå‡ºæ¥ã†ã‚‹

ç­‰ã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

ææ¡ˆã‚ˆã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

```cpp
int f(int x) post (r: r != 0);

using function_type = int(*)(int);
auto *fp2 = f; // ERROR
auto *fp3 = (function_type)f; // OK

template <typename FT>
void g(FT func);
g(f); // ERROR
g((function_type)f); // OK
```

å¥‘ç´„ã‚’æŒãŸãªã„é–¢æ•°ã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸ã®å¤‰æ›ã€ãŠã‚ˆã³ï¼ˆå¥‘ç´„æœ‰ç„¡ã«é–¢ã‚ã‚‰ãšï¼‰é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸ã®æ˜ç¤ºçš„å¤‰æ›ã¯ã€ã“ã‚Œã¾ã§é€šã‚Šã«è¨±å¯ã•ã‚Œã¾ã™ã€‚

ã“ã®ææ¡ˆã¯SG21ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å¥½ã¾ã‚Œãšã€å¦æ±ºã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P3221R0 Disable pointers to contracted functions - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2024å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2024/08/31/233056#P3221R0-Disable-pointers-to-contracted-functions)
- [P3250 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1911)

### [P3251R0 C++ contracts and coroutines](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3251r0.html)

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹å¥‘ç´„æ³¨é‡ˆã‚’è¨±å¯ã™ã‚‹ææ¡ˆã€‚

C++26ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã«ãŠã„ã¦ã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹å¥‘ç´„ã¯`contract_assert`ã®ã¿ãŒè¨±å¯ã•ã‚Œã¦ãŠã‚Šã€äº‹å‰ãƒ»äº‹å¾Œæ¡ä»¶ã®æŒ‡å®šã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒä¸­æ–­å¯èƒ½ãªé–¢æ•°ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€ãã‚Œã‚‰ã®å¥‘ç´„ãŒã©ã®ã‚ˆã†ã«æŒ¯èˆã†ã¹ãã‹ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’ç¢ºç«‹ã§ãã¦ã„ãªã„ãŸã‚ã€ãã®è­°è«–ã¨æ±ºå®šã‚’æ€¥ãŒãªã„ãŸã‚ã®æªç½®ã§ã™ã€‚

é€šå¸¸ã®é–¢æ•°ã«å¯¾ã™ã‚‹äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã¯ã€é–¢æ•°ã«å…¥ã‚‹æ™‚ã¨é–¢æ•°ã‹ã‚‰æˆ»ã‚‹æ™‚ã®ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿/æˆ»ã‚Šå€¤ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®çŠ¶æ…‹ã«ã¤ã„ã¦ã®æ¡ä»¶ã‚’æŒ‡å®šã—ã¾ã™ã€‚

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ãã®å‘¼ã³å‡ºã—ã®ä»»æ„ã®æ™‚ç‚¹ã§ä¸­æ–­ã—ã¦å‘¼ã³å‡ºã—å…ƒã«ãƒªã‚¿ãƒ¼ãƒ³ã™ã‚‹ã“ã¨ãŒã§ãã€ã¾ãŸãã®å¾Œã®ä»»æ„ã®æ™‚ç‚¹ã§å†é–‹ã—å†ã³é–¢æ•°å†…ã«å…¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚C++ã«ãŠã‘ã‚‹ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯é–¢æ•°å®£è¨€ã§åŒºåˆ¥ã•ã‚Œã¦ãŠã‚‰ãšã€ãã®å®šç¾©ã‚’è¦‹ã«è¡Œã‹ãªã„ã¨ãã®é–¢æ•°ãŒã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã‚ã‚‹ã‹ã©ã†ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚å¾“ã£ã¦ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã§å¥‘ç´„å¯èƒ½ãªã®ã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®é–‹å§‹æ™‚ç‚¹ã®çŠ¶æ…‹ã¨ã€ä¸­æ–­æ™‚ç‚¹ã®çŠ¶æ…‹ã«ã¤ã„ã¦ã®ã‚‚ã®ã ã‘ã§ã™ã€‚

ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å‰ãƒ»äº‹å¾Œæ¡ä»¶æŒ‡å®šãŒç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ã¨ã¯ã„ã£ã¦ã‚‚ã€ãã‚Œã¯å®Ÿéš›ã«ã¯ç°¡å˜ã«å›é¿ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã‚³ãƒ«ãƒ¼ãƒãƒ³`f()`ãŒã‚ã‚‹ã¨ãã€`auto g() { return f(); }`ã®ã‚ˆã†ã«ã™ã‚Œã°ã“ã®`g()`ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã¯ãªããªã‚Šã€`g()`ã«ã¯é€šå¸¸ã®é–¢æ•°åŒæ§˜ã®å¥‘ç´„æ³¨é‡ˆã‚’æŒ‡å®šã§ãã¾ã™ã€‚ã“ã®ã‚ˆã†ã«ã—ãŸæ™‚ã®`g()`ã«ãªã•ã‚Œã‚‹äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã¨ã¯ã€ã¡ã‚‡ã†ã©ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®é–‹å§‹æ™‚ç‚¹ã®çŠ¶æ…‹ã¨ä¸­æ–­æ™‚ç‚¹ã®çŠ¶æ…‹ã«å¯¾ã™ã‚‹å¥‘ç´„ã¨ã—ã¦æ©Ÿèƒ½ã—ã€ãã‚Œã¯ã“ã®ã‚ˆã†ãªãƒ©ãƒƒãƒ”ãƒ³ã‚°ã‚’è¡Œã†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã™ã‚‹ã¨ã“ã‚ã¨ä¸€è‡´ã™ã‚‹ã¯ãšã§ã™ã€‚

ãŸã ã—é€šå¸¸ã®é–¢æ•°ã¨ç•°ãªã‚‹ã¨ã“ã‚ãŒä¸€ç‚¹ã ã‘ã‚ã‚Šã€ãã‚Œã¯äº‹å¾Œæ¡ä»¶ã‹ã‚‰ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³å¼•æ•°ã‚’ä¸€åˆ‡å‚ç…§ã§ããªã„ã¨ã„ã†ã“ã¨ã§ã™ï¼ˆãƒ ãƒ¼ãƒ–ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼‰ã€‚ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã®ã“ã®ã‚³ãƒ¼ãƒŠãƒ¼ã‚±ãƒ¼ã‚¹ã‚’é™¤å¤–ï¼ˆã‚³ãƒ«ãƒ¼ãƒãƒ³äº‹å¾Œæ¡ä»¶ã«ãŠã‘ã‚‹å¼•æ•°å‚ç…§ã®ç¦æ­¢ï¼‰ã—ã¦ã¾ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ï¼ˆã®ç›´æ¥ã®æˆ»ã‚Šå€¤ã§ã‚ã‚‹`awaitable`å‹ï¼‰ã«å¯¾ã—ã¦äº‹å¾Œæ¡ä»¶ã‚’æŒ‡å®šå¯èƒ½ã«ã™ã‚‹ã“ã¨ãŒã€äº‹å¾Œæ¡ä»¶ã®ä¸€è²«æ€§ã‚’æãªã†ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’ä¸Šå›ã‚‹ã‹ã©ã†ã‹ã¯è¦æ¤œè¨ã§ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒŠãƒ¼ã‚±ãƒ¼ã‚¹ã‚’å›é¿ã—ã¦ä¸€è²«æ€§ã®ãŸã‚ã«ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã‚’ç¦æ­¢ã—ãŸã¨ã—ã¦ã‚‚å¤§ããªå•é¡Œã¯ãªã„ã¨æ€ã‚ã‚Œã¾ã™ã€‚

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã—ã¦äº‹å¾Œæ¡ä»¶ã®æŒ‡å®šã‚’è¨±å¯ã™ã‚‹å ´åˆã®äº‹ã‚’è€ƒãˆã¾ã™ã€‚å‰è¿°ã®ã‚ˆã†ã«ã€ãã®å ´åˆã®äº‹å¾Œæ¡ä»¶ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒä¸­æ–­ã—ãŸæ™‚ç‚¹ã§ã®çŠ¶æ…‹ã«å¯¾ã™ã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚ã—ã‹ã—ã“ã®å ´åˆã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ã¾ã å®Ÿè¡Œã‚’é–‹å§‹ã—ã¦ã•ãˆã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã®ã‚ˆã†ãªçŠ¶æ…‹ã«ã¤ã„ã¦ã‚¢ã‚µãƒ¼ãƒˆã§ãã‚‹ã“ã¨ã¯ã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ã€‚

ã—ã‹ã—ã€ãã®ã‚ˆã†ãªç‰©ç†çš„ãªã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã¯ãªãã€è«–ç†çš„ãªã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¦‹ãŸæ™‚ã«ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã¨ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒç”Ÿæˆãƒ»ã¾ãŸã¯è¿”ã™å€¤ï¼ˆã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ç›´æ¥ã®æˆ»ã‚Šå€¤ã§ã¯ãªã„ï¼‰ã«å¯¾ã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ã®ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœŸå¾…ã¨åˆã£ã¦ãŠã‚Šæœ›ã¾ã—ã„ã§ã—ã‚‡ã†ã€‚ãŸã ã—ã“ã‚Œã¯ã€å¥‘ç´„æ³¨é‡ˆãŒã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã‚ã‚‹ã“ã¨ã‚’ã»ã®ã‚ã‹ã™ã“ã¨ãªãã€é–¢æ•°ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã‚ˆã£ã¦è‡ªç„¶ã«ä¼æ’­ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã®æŒ‡å®šã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒç›´æ¥è¿”ã™å€¤ã«å¯¾ã—ã¦é©ç”¨ã™ã‚‹ã®ã§ã¯ãªãã€ãã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®`awaitable`å‹ã¨`promise`å‹ã«å¯¾ã—ã¦é©ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®`promise`å‹ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆä¸Šã«å­˜åœ¨ã—ã¦å‘¼ã³å‡ºã—å´ã¨ã‚³ãƒ«ãƒ¼ãƒãƒ³å´ã‚’ã¤ãªãå½¹å‰²ã‚’æŒã£ã¦ã„ã¾ã™ã€‚`promise`å‹ã®`yield_value()`ï¼ˆ`co_yield`ã«å¯¾ã—ã¦å‘¼ã°ã‚Œã‚‹ï¼‰ã¨`return_value()`ï¼ˆ`co_return`ã«å¯¾ã—ã¦å‘¼ã°ã‚Œã‚‹ï¼‰ã¯ã€ç”Ÿæˆ/è¿”ã•ã‚Œã‚‹å€¤ã‚’å—ã‘å–ã£ã¦ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã‚’äº‹å‰æ¡ä»¶ã¨ã—ã¦ãã®å€¤ã«å¯¾ã—ã¦é©ç”¨ã™ã‚‹ã“ã¨ã®ã§ãã‚‹ç†æƒ³çš„ãªå ´æ‰€ã«ä½ç½®ã—ã¦ã„ã¾ã™ã€‚ä¸€æ–¹ã€`awaitable`ãªå‹ã®`await_resume`ãªã©ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã‚’ãã®ã¾ã¾è‡ªèº«ã®äº‹å¾Œæ¡ä»¶ã¨ã—ã¦æŒãŸã•ã‚‰ã‚Œã‚‹å ´æ‰€ã«ä½ç½®ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã“ã‚Œã‚‰ã®é–¢æ•°ã«ã¯ç¾åœ¨ã®å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ã«ãŠã„ã¦ã‚‚å¥‘ç´„æ³¨é‡ˆã‚’åˆ¶é™ãªãè¡Œãˆã‚‹ãŸã‚ã€ã“ã®ãŸã‚ã«ç‰¹åˆ¥ãªè¦å®šã‚’å¢—ã‚„ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ç”Ÿæˆ/è¿”ã™å€¤ã«å¯¾ã™ã‚‹æ¡ä»¶ã¨æŒ‡å®šã•ã‚ŒãŸï¼ˆã¨åˆ†ã‹ã£ã¦ã„ã‚‹ï¼‰ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã®æ³¨é‡ˆã‚’ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®è¿”ã™ç›´æ¥ã®æˆ»ã‚Šå€¤å‹ï¼ˆ`awaitable`ï¼‰ã®ä¸€éƒ¨ï¼ˆãã®ãƒ¡ãƒ³ãƒé–¢æ•°ã«å¯¾ã™ã‚‹ã‚‚ã®ï¼‰ã¨ã—ã¦æ‰±ã†äº‹ã§ã™ã€‚ä¾‹ãˆã°ä½•ã‹ã—ãƒ©ãƒƒãƒ—ã‚’è¡Œã†å‹ã‚’ç”¨æ„ã™ã‚‹ãªã©ã®æ–¹æ³•ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ãŒã€ã“ã‚Œã‚’è¨±å¯ã™ã‚‹ãŸã‚ã«ç¾åœ¨ã®è¦å®šã‚’å¼„ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆãã“ã¯å®Ÿè£…è©³ç´°ãªã®ã§ï¼‰ã€‚

ç¾åœ¨ã®ï¼ˆãã—ã¦ãŠãã‚‰ãC++26ã®ï¼‰å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®ä»•æ§˜ã«å¯¾ã—ã¦å¤‰æ›´ãŒå¿…è¦ãªã®ã¯ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã‚ã‚‹é–¢æ•°ã«å¯¾ã™ã‚‹äº‹å‰ãƒ»äº‹å¾Œæ¡ä»¶ã®å¥‘ç´„æ³¨é‡ˆã‚’ç¦æ­¢ã—ã¦ã„ã‚‹æ–‡è¨€ã«å¯¾ã—ã¦ã ã‘ã§ã™ã€‚ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å¾Œæ¡ä»¶ã¯ä¸Šè¨˜ã®ã‚ˆã†ã«è¤‡é›‘ã«ãªã‚Šä»–ã®é–¢æ•°ã¨å°‘ã—ç•°ãªã£ã¦ã—ã¾ã†ãŸã‚æœ‰ç”¨ã‹ã©ã†ã‹ã¯ä¸æ˜ã§ã™ãŒã€äº‹å‰æ¡ä»¶æŒ‡å®šã«é–¢ã—ã¦ã¯é–“é•ã„ãªãå½¹ã«ç«‹ã¤ã¯ãšã€ã¨ä¸»å¼µã—ã¦ã„ã¾ã™ã€‚

çµå±€ã“ã®ææ¡ˆã§ã¯

- ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å‰æ¡ä»¶ï¼ˆã¨äº‹å¾Œæ¡ä»¶ï¼‰ã®å¥‘ç´„æ³¨é‡ˆã‚’è¨±å¯ã™ã‚‹
- ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹äº‹å‰æ¡ä»¶ï¼ˆã¨äº‹å¾Œæ¡ä»¶ï¼‰ã¯ã€`promise`å‹ï¼ˆãŠã‚ˆã³`awaitable`å‹ï¼‰ã®  äº‹å‰æ¡ä»¶ã¨äº‹å¾Œæ¡ä»¶ã¨ã—ã¦æ‰±ã†ã‚ˆã†ã«ã™ã‚‹

ã®2ã¤ã®äº‹ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

- [P2957R0 Contracts and coroutines - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2023å¹´08æœˆï¼‰](https://onihusube.hatenablog.com/entry/2023/10/14/223052#P2957R0-Contracts-and-coroutines)
- [P3251 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1912)

### [P3253R0 Distinguishing between member and free coroutines](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3253r0.html)

åŒã˜ã‚·ã‚°ãƒãƒãƒ£ã‚’æŒã¤ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’åŒºåˆ¥ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ãƒ—ãƒ­ãƒŸã‚¹å‹ã¯`std::coroutine_traits<>`ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®æˆ»ã‚Šå€¤å‹åŠã³å‘¼ã³å‡ºã—æ™‚ã®å¼•æ•°å‹ã‚’å…¥ã‚Œã¦ç‰¹æ®ŠåŒ–ã—ãŸã‚‚ã®ï¼ˆ`std::coroutine_traits<R, Args...>`ï¼‰ãŒä½¿ç”¨ã•ã‚Œã€ãã‚Œã«å¯¾å¿œã™ã‚‹ã‚‚ã®ã‚’ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠãã¨ï¼ˆã™ãªã‚ã¡ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³æˆ»ã‚Šå€¤å‹ã«å¯¾ã—ã¦ç‰¹æ®ŠåŒ–ã—ã¦ãŠã‘ã°ï¼‰ã€ãã®ãƒ¡ãƒ³ãƒå‹ï¼ˆ`std::coroutine_traits<R, Args...>::promise_type`ï¼‰ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒŸã‚¹å‹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚

ã¨ã“ã‚ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦ã‚‚å®šç¾©ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚Šã€ãƒ¡ãƒ³ãƒé–¢æ•°ã¯æœ€åˆã®å¼•æ•°ã«æš—é»™ã«`this`å¼•æ•°ã‚’å—ã‘ã¦ãŠã‚Šã€ãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³ã®å ´åˆ`std::coroutine_traits<R, Args...>`ã®`Args`ã®æœ€åˆã«ã¯æš—é»™ã®`this`å¼•æ•°ã«å¯¾å¿œã™ã‚‹å‹ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚

ã“ã®ãŸã‚ã€åŒã˜æˆ»ã‚Šå€¤å‹ã‚’å…±æœ‰ã™ã‚‹ãƒ¡ãƒ³ãƒé–¢æ•°ã¨éãƒ¡ãƒ³ãƒé–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã€éãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³ã®æ–¹ãŒãƒ¡ãƒ³ãƒé–¢æ•°ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®å±ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’æœ€åˆã®å¼•æ•°ã«å–ã‚‹å ´åˆã€`coroutine_traits`ã‹ã‚‰ãã®åŒºåˆ¥ãŒã¤ã‹ãªããªã‚Šã¾ã™ã€‚

```cpp
struct S {
  // ãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³
  R member_coro1(int x, std::string y) const;
  R member_coro2(const S&, int x, std::string y) const;
};

// ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³
R free_coro(const S&, int x, std::string y);
```

ã“ã®`member_coro1()`ã¨`free_coro()`ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ã€ãƒ—ãƒ­ãƒŸã‚¹å‹ã®å°å‡ºã®ãŸã‚ã«`std::coroutine_traits`ã®ç‰¹æ®ŠåŒ–ã‚’ã€`std::coroutine_traits<R, const S&, int, std::string>`ã¨ã—ã¦ã‚¯ã‚¨ãƒªã—ã¾ã™ã€‚ã“ã‚Œã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³æˆ»ã‚Šå€¤å‹`R`ã‹ã‚‰è¦‹ã‚‹ã¨`member_coro1()`ã¨`free_coro()`ã‚’åŒºåˆ¥ã™ã‚‹ã“ã¨ãŒã§ããšã€ã“ã®2ã¤ã®é–¢æ•°ã¯åŒã˜ãƒ—ãƒ­ãƒŸã‚¹å‹ã‚’å–å¾—ã—ã¾ã™ã€‚

ã“ã®ã‚ˆã†ãª`R`ã«ã¯ä¾‹ãˆã°`std::generator`ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ã“ã¨ãŒå•é¡Œã¨ãªã‚‹ã®ã¯ã€`std::generator`ã®ã‚ˆã†ã«ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ã«ã—ã‚ˆã†ã¨ã™ã‚‹å ´åˆã§ã™ã€‚

ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ã®ç¢ºä¿ã®ãŸã‚ã«å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿ã‚’è¡Œã„ã¾ã™ãŒã€ã“ã‚Œã¯ã¾ãšãƒ—ãƒ­ãƒŸã‚¹å‹ã®ã‚¹ã‚³ãƒ¼ãƒ—ã§`operator new()`ãŒæ¢ç´¢ã•ã‚Œã¾ã™ã€‚ã™ãªã‚ã¡ã€ãƒ—ãƒ­ãƒŸã‚¹å‹ã§`operator new()`ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿æ–¹æ³•ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã€`std::generator`ã§ã¯3ç•ªç›®ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨åˆã‚ã›ã¦ä»»æ„ã®ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®`operator new()`ã®æ¢ç´¢ã¯ã€`promise_type::operator new(std::size_t, Args...)`ã®æ§˜ãªã‚·ã‚°ãƒãƒãƒ£ã§è¡Œã‚ã‚Œã€å¾ŒåŠã®å¼•æ•°ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³å¼•æ•°ãŒãã®é †ç•ªã®ã¾ã¾æ¸¡ã•ã‚Œã¾ã™ã€‚

`std::generator<T, V, Alloc>`ã®å ´åˆã€æœ€ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¨ã—ã¦3ç•ªç›®ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿å‹ã‚’æŒ‡å®šã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã€ã“ã®å ´åˆã«ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã™ã‚‹ãŸã‚ã«ã¯`std::allocator_arg_t`ã®ã‚¿ã‚°å€¤ã®å¾Œã«ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã€ã“ã‚Œã‚’ã‚³ãƒ«ãƒ¼ãƒãƒ³å¼•æ•°åˆ—ã®å…ˆé ­ã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```cpp
using Generator = std::generator<int, void, std::pmr::polymorphic_allocator<>>;

struct S {
  // ãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚ã†ã¨ã—ã¦ã„ã‚‹
  Generator member_coro1(std::allocator_arg_t,
                         std::pmr::polymorphic_allocator<> alloc,
                         int x) const;
};

// ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³1ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
Generator free_coro1(std::allocator_arg_t,
                     std::pmr::polymorphic_allocator<> alloc,
                     int x);

// ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³2ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚ã†ã¨ã—ã¦ã„ã‚‹
Generator free_coro2(const S&,
                     std::allocator_arg_t,
                     std::pmr::polymorphic_allocator<> alloc,
                     int x);
                     
// ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³3ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚ã†ã¨ã—ã¦ã„ã‚‹
Generator free_coro3(const S&,
                     const std::vector<int>&,
                     std::allocator_arg_t,
                     std::pmr::polymorphic_allocator<> alloc,
                     int x);
```

ã±ã£ã¨è¦‹ã‚‹ã¨ã€`member_coro1()`ã¨`free_coro1()`ã¯æ­£ã—ãã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’è¡Œãˆã¦ãŠã‚Šã€æ¸¡ã—ãŸã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ãŒä½¿ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚ä¸€æ–¹ã§ã€`free_coro2()`ã¨`free_coro3()`ã¯æ¸¡ã™å¼•æ•°é †ãŒé–“é•ã£ã¦ã„ã‚‹ï¼ˆ`std::allocator_arg_t`ãŒ2ç•ªç›®ä»¥é™ã®å¼•æ•°ã§æ¸¡ã•ã‚Œã¦ã„ã‚‹ï¼‰ãŸã‚ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¯ä¸Šæ‰‹ãã„ã‹ãªã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

å®Ÿéš›ã«ã¯ã€`member_coro1()`ã¨`free_coro1()`ã€ãã—ã¦`free_coro2()`ã¯æ¸¡ã•ã‚ŒãŸã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™ãŒã€`free_coro3()`ã§ã¯ä½¿ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã€`member_coro1()`ã®æ¸¡ã—æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®å‰¯ä½œç”¨ã§ã™ã€‚

å‰è¿°ã®ã‚ˆã†ã«ã€`member_coro1()`ã¨`free_coro2()`ã§ã¯åŒã˜ãƒ—ãƒ­ãƒŸã‚¹å‹ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã™ãªã‚ã¡ã€ã“ã®2ã¤ã®é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã¯ãƒ—ãƒ­ãƒŸã‚¹å‹ã‹ã‚‰è¦‹ã‚‹ã¨åŒã˜ã§ã™ï¼ˆ`std::coroutine_traits<Generator, const S&, std::allocator_arg_t, std::pmr::polymorphic_allocator<>, int>::promise_type`ï¼‰ã€‚ã—ãŸãŒã£ã¦ã€æ¢ç´¢ã•ã‚Œã‚‹`new`æ¼”ç®—å­ã®ã‚·ã‚°ãƒãƒãƒ£ã¯`promise_type::operator new(std::size_t, const S&, std::allocator_arg_t, std::pmr::polymorphic_allocator<>, int)`ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯`std::allocator_arg_t`ãŒç¬¬ä¸€å¼•æ•°ã«ã‚ãŸã£ã¦ã„ãªã„ãŸã‚æœ¬æ¥ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯¾è±¡ã§ã¯ãªã„ï¼ˆæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ã«ãŠã‘ã‚‹uses-allocator constructionã¨ä¸€è²«ã—ã¦ã„ãªã„ï¼‰ã®ã§ã™ãŒã€`std::generator`ãŒã“ã®å•é¡Œã‚’è€ƒæ…®ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã‚’ç‰¹åˆ¥æ‰±ã„ã—ã¦ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã«ã“ã®ã‚·ã‚°ãƒãƒãƒ£ã§ã‚‚`operator new()`ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’ç”¨æ„ã—ã¦ãŠã‚Šã€ãã‚Œã«ã‚ˆã£ã¦ã‚«ã‚¹ã‚¿ãƒ ã®`new`æ¼”ç®—å­ãŒå‘¼ã°ã‚Œã¦ãã®ä¸­ã§æ¸¡ã•ã‚ŒãŸã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ã“ã®ç‰¹åˆ¥æ‰±ã„ã¯`member_coro1()`ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ãŒã€`member_coro1()`ã¨`free_coro2()`ã§ã¯åŒã˜ãƒ—ãƒ­ãƒŸã‚¹å‹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€`free_coro2()`ã«å¯¾ã—ã¦ã‚‚ä½¿ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€æ„å›³ã›ãšã«`free_coro2()`ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚å°å‡ºã•ã‚Œã‚‹ãƒ—ãƒ­ãƒŸã‚¹å‹ãŒåŒä¸€ã«ãªã‚‹ãŸã‚ã€`member_coro1()`ã ã‘ã‚’å—ã‘å…¥ã‚Œã¦`free_coro2()`ã‚’å¼¾ãã¨ã„ã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

ã“ã®å•é¡Œã®ãŸã‚ã«ã€`std::generator`ã®ã‚ˆã†ãªã‚³ãƒ«ãƒ¼ãƒãƒ³æˆ»ã‚Šå€¤å‹ã®åˆ¶ä½œè€…ã¯ã€`free_coro1()`ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ï¼ˆã“ã‚Œã¯å…¨ãæ­£å½“ãªã‚‚ã®ï¼‰ãŸã‚ã«`std::size_t, std::allocator_arg_t, Alloc`ã®ã‚ˆã†ã«3ç•ªç›®ã®å¼•æ•°ã§ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹`operator new`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¨ã€`member_coro1()`ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã«`std::size_t, const S&, std::allocator_arg_t, Alloc`ã®ã‚ˆã†ã«4ç•ªç›®ã®å¼•æ•°ã§ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹`operator new`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã®2ç¨®é¡ã‚’ç”¨æ„ã—ãªã‘ã‚Œã°ãªã‚‰ãªããªã‚Šã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã£ã¦ã€ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿å¼•æ•°ã«é–¢ã—ã¦ãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³ã¨ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®é–“ã€ã¾ãŸ`std::generator`ï¼ˆåŠã³åŒç¨®ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³æˆ»ã‚Šå€¤å‹ï¼‰ã¨ä»–ã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã®é–“ã§ã€ä¸å¿…è¦ãªçŸ›ç›¾ãŒç”Ÿã˜ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã“ã®å•é¡Œã®è§£æ±ºã®ãŸã‚ã«ã€æœ€åˆã®ãƒ—ãƒ­ãƒŸã‚¹å‹ã®æ¢ç´¢éç¨‹ã‚’ä¿®æ­£ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ãƒ¡ãƒ³ãƒé–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒ`std::coroutine_traits`ã‹ã‚‰ãƒ¡ãƒ³ãƒå‹ã¨ã—ã¦ãƒ—ãƒ­ãƒŸã‚¹å‹ã‚’å–å¾—ã™ã‚‹å ´åˆã€ã¾ãšæœ€åˆã«`std::coroutine_traits<R, Args...>::promise_type_for_nonstatic_member`ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãªã‚‰ã“ã‚Œã‚’ãƒ—ãƒ­ãƒŸã‚¹å‹ã¨ã—ã¦ä½¿ç”¨ã—ã€å®šç¾©ã•ã‚Œã¦ã„ãªã„å ´åˆã¯å¾“æ¥é€šã‚Š`std::coroutine_traits<R, Args...>::promise_type`ã‚’ä½¿ç”¨ã™ã‚‹ã€ã¨ã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

ãƒ—ãƒ­ãƒŸã‚¹å‹ã®å®šç¾©æ–¹æ³•åŠã³ãã®å¾Œã®çµŒè·¯ã«é–¢ã—ã¦ã¯ä¸€åˆ‡å¤‰æ›´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®å…¥ã‚Œå¾Œã®`promise_type_for_nonstatic_member`å‹ã¨ã—ã¦æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ãƒŸã‚¹å‹ã‹ã‚‰ã¯ã€ãã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ãŸã‚ã€ã“ã“ã ã‘ã§4ç•ªç›®ã®å¼•æ•°ã§ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹`operator new`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’ç”¨æ„ã™ã‚Œã°ãƒ¡ãƒ³ãƒã‚³ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾ã—ã¦ã‚‚ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’æä¾›ã§ãã¾ã™ã€‚ãªãŠã‹ã¤ã€`promise_type_for_nonstatic_member`ãŒãƒ—ãƒ­ãƒŸã‚¹å‹ã¨ã—ã¦å–å¾—ã•ã‚Œã‚‹ã®ã¯éé™çš„ãƒ¡ãƒ³ãƒã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‹ã‚‰ã ã‘ãªã®ã§ã€ãƒ•ãƒªãƒ¼é–¢æ•°ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒå­ã®ãƒ—ãƒ­ãƒŸã‚¹å‹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€å…ˆç¨‹ã®ä¾‹ã®`member_coro1()`ã¨`free_coro1()`ã®æ¸¡ã—æ–¹ã ã‘ãŒæœ‰åŠ¹ã§ï¼ˆã‚µãƒãƒ¼ãƒˆã•ã‚Œï¼‰ã€`free_coro2()`ï¼ˆåŠã³`free_coro3()`ï¼‰ã®æ¸¡ã—æ–¹ã¯æœ‰åŠ¹ã§ã¯ãªã„ï¼ˆã‚µãƒãƒ¼ãƒˆå¤–ï¼‰ã¨ã„ã†å¼åˆ¥ãŒå¯èƒ½ã«ãªã‚Šã€å•é¡Œã«ãªã£ã¦ã„ãŸéä¸€è²«æ€§ãŒè§£æ¶ˆã•ã‚Œã¾ã™ã€‚

ã“ã®æ–¹æ³•ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«`std::coroutine_traits`ã®ç‰¹æ®ŠåŒ–ã«`promise_type_for_nonstatic_member`ã‚’å®šç¾©ã—ãªã„é™ã‚Šã€ç¾åœ¨ã®å‹•ä½œãŒæãªã‚ã‚Œã‚‹ã“ã¨ã¯ãªãã€ä¸‹ä½äº’æ›æ€§ã‚’æ‹…ä¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€EWGã®åˆæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å¥½ã¾ã‚Œãªã‹ã£ãŸã‚ˆã†ã§ã€å¦æ±ºã•ã‚Œã¦ã„ã¾ã™ã€‚

- [C++20 ã‚³ãƒ«ãƒ¼ãƒãƒ³ - cpprefjp](https://cpprefjp.github.io/lang/cpp20/coroutines.html)
- [P3253 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1912)

### [P3254R0 Reserve identifiers preceded by @ for non-ignorable annotation tokens](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3254r0.html)
### [P3255R0 Expose whether atomic notifying operations are lock-free](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3255r0.html)

`std::atomic`ã®é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ãŒãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã¨ã¯é™ã‚‰ãªã„å ´åˆãŒã‚ã‚‹å•é¡Œã«ã¤ã„ã¦ä¿®æ­£ã™ã‚‹ææ¡ˆã€‚

`std::atomic`ï¼ˆä»¥ä¸‹`std::atomic_flag`ãŠã‚ˆã³`std::atomic_ref`ã‚’å«ã‚€ï¼‰ã«å¯¾ã—ã¦C++20ã§è¿½åŠ ã•ã‚ŒãŸé€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ï¼ˆ`.wait()`ã€`.notify_~()`ï¼‰ã«å¯¾ã—ã¦ã¯ã€ãã®å‹ãã®ã‚‚ã®ã«å¯¾ã—ã¦ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã§ã‚ã‚‹ã¨æŒ‡å®šã•ã‚Œã‚‹å ´åˆã«ï¼ˆ`std::atomic_flag`ã®å ´åˆã«å¸¸ã«ï¼‰å½“ç„¶ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã§ã‚ã‚Šã€ã‚·ã‚°ãƒŠãƒ«ã‚»ãƒ¼ãƒ•ã§ã‚ã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚

ã—ã‹ã—å®Ÿéš›ã«ã¯ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã§ã¯ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šãã®å ´åˆã‚·ã‚°ãƒŠãƒ«ã‚»ãƒ¼ãƒ•ã§ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚`.wait()`é–¢æ•°ã¯ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ãŸã‚æ˜ã‚‰ã‹ã§ã™ãŒã€é€šçŸ¥é–¢æ•°ã«ã¤ã„ã¦ã‚‚ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ãªå®Ÿè£…ã‚’å–ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã®ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚ºã‚„ç’°å¢ƒã«ã‚ˆã£ã¦ã¯ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã¨ãªã‚‰ãªã„å ´åˆãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

ã“ã‚Œã‚‰ã®å•é¡Œã®è§£æ±ºã®ãŸã‚ã€ã“ã®ææ¡ˆã§ã¯æ¬¡ã®äº‹ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

- `std::atomic_flag`ã®é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ã¯ã€ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã§ã‚ã‚‹å¿…è¦ãŒç„¡ã„ã“ã¨ãŒæ˜ç¢ºã«ãªã‚‹ã‚ˆã†ã«è¦å®šã‚’ä¿®æ­£
- `std::atomic`ã®`is_lock_free`ã€`is_always_lock_free`ã€`std::atomic_is_lock_free`ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã‚¢ãƒˆãƒŸãƒƒã‚¯ã®é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ã«é–¢ã—ã¦ã®ã‚‚ã®ã§ã¯ãªã„ã“ã¨ã‚’æ˜ç¢ºã«ãªã‚‹ã‚ˆã†ã«è¦å®šã‚’ä¿®æ­£
    - ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ç¯„å›²ã‹ã‚‰ã€é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ã‚’é™¤å¤–ã™ã‚‹
- `std::atomic_flag`ã€`std::atomic`ã€`std::atomic_ref`ã«ãƒ¡ãƒ³ãƒé–¢æ•°`.notify_is_lock_free()`ã¨ãƒ•ãƒªãƒ¼é–¢æ•°ã®`std::atomic_notify_is_lock_free`ã€ãŠã‚ˆã³ãƒ¡ãƒ³ãƒå®šæ•°ã®`notify_is_always_lock_free`ã‚’è¿½åŠ ã—ã€ã‚¢ãƒˆãƒŸãƒƒã‚¯ã®é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ãŒãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã‹ã©ã†ã‹ã¯ãã‚Œã‚‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒè¡¨æ˜ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹

ã“ã‚Œã«ã‚ˆã£ã¦ã€é€šçŸ¥ãƒ»å¾…æ©Ÿç³»é–¢æ•°ãŒãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ï¼ˆã§ã‚ã‚Šã‚·ã‚°ãƒŠãƒ«ã‚»ãƒ¼ãƒ•ï¼‰ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’æ­£ã—ãåˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

- [P3251 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1912)

### [P3257R0 Make the predicate of contract_assert more regular](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3257r0.html)
### [P3258R0 Formatting charN_t](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3258r0.pdf)
### [P3259R0 const by default](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3259r0.html)
### [P3263R0 Encoded annotated char](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3263r0.html)
### [P3264R0 Double-evaluation of preconditions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3264r0.html)
### [P3264R1 Double-evaluation of preconditions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3264r1.html)
### [P3265R0 Ship Contracts in a TS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3265r0.html)
### [P3265R1 Ship Contracts in a TS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3265r1.html)
### [P3266R0 non referenceable types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3266r0.html)
### [P3267R0 C++ contracts implementation strategies](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3267r0.html)
### [P3267R1 Approaches to C++ Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3267r1.html)
### [P3268R0 C++ Contracts Constification Challenges Concerning Current Code](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3268r0.html)
### [P3269R0 Do Not Ship Contracts as a TS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3269r0.pdf)
### [P3270R0 Repetition, Elision, and Constification w.r.t. contract_assert](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3270r0.p)
### [P3271R0 Function Usage Types (Contracts for Function Pointers)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3271r0.pdf)
### [P3273R0 Introspection of Closure Types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3273r0.html)
### [P3274R0 A framework for Profiles development](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3274r0.pdf)
### [P3275R0 Replace simd operator[] with getter and setter functions - or not](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3275r0.pdf)
### [P3276R0 P2900 Is Superior to a Contracts TS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3276r0.pdf)
### [P3278R0 Analysis of interaction between relocation, assignment, and swap](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3278r0.pdf)
### [P3279R0 CWG2463: What 'trivially fooable' should mean](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3279r0.html)
### [P3281R0 Contact checks should be regular C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3281r0.pdf)
### [P3282R0 Static Storage for C++ Concurrent bounded_queue](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3282r0.html)
### [P3283R0 Adding .first() and .last() to strings](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3283r0.html)
### [P3284R0 `finally`, `write_env`, and `unstoppable` Sender Adaptors](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3284r0.html)
### [P3285R0 Contracts: Protecting The Protector](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3285r0.pdf)
### [P3286R0 Module Metadata Format for Distribution with Pre-Built Libraries](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3286r0.pdf)
### [P3287R0 Exploration of namespaces for std::simd](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3287r0.pdf)
### [P3288R0 std::elide](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3288r0.html)
### [P3289R0 Consteval blocks](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3289r0.html)
### [P3290R0 Integrating Existing Assertions With Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3290r0.pdf)
### [P3292R0 Provenance and Concurrency](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3292r0.html)
### [P3293R0 Splicing a base class subobject](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3293r0.html)
### [P3294R0 Code Injection with Token Sequences](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3294r0.html)
### [P3295R0 Freestanding constexpr containers and constexpr exception types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3295r0.html)
### [P3296R0 let_with_async_scope](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3296r0.html)
### [P3297R0 C++26 Needs Contract Checking](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3297r0.pdf)
### [P3298R0 Implicit user-defined conversion functions as operator.()](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3298r0.pdf)
### [P3299R0 Range constructors for std::simd](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3299r0.html)
### [P3301R0 inplace_stoppable_base](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3301r0.html)
### [P3302R0 SG16: Unicode meeting summaries 2024-03-13 through 2024-05-08](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3302r0.html)
### [P3303R0 Fixing Lazy Sender Algorithm Customization](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3303r0.html)
### [P3304R0 SG14: Low Latency/Games/Embedded/Financial Trading virtual Meeting Minutes 2024/04/10](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3304r0.pdf)
### [P3305R0 SG19: Machine Learning virtual Meeting Minutes to 2024/04/11-2024/05/09](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3305r0.pdf)
### [P3306R0 Atomic Read-Modify-Write Improvements](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3306r0.html)
### [P3307R0 Floating-Point Maximum/Minimum Function Objects](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3307r0.html)
### [P3308R0 mdarray design questions and answers](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3308r0.html)
### [P3309R0 constexpr atomic and atomic_ref](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3309r0.html)
### [P3310R0 Solving partial ordering issues introduced by P0522R0](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3310r0.html)
### [P3311R0 An opt-in approach for integration of traditional assert facilities in C++ contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3311r0.html)
### [P3312R0 Overload Set Types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3312r0.pdf)
### [P3313R0 Impacts of noexept on ARM table based exception metadata](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3313r0.html)
### [P3316R0 A more predictable unchecked semantic](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3316r0.pdf)
### [P3317R0 Compile time resolved contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3317r0.pdf)
### [P3318R0 Throwing violation handlers, from an application programming perspective](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3318r0.html)
### [P3319R0 Add an iota object for simd (and more)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3319r0.pdf)
### [P3320R0 EWG slides for P3144 "Delete if Incomplete"](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3320r0.pdf)
### [P4000R0 To TS or not to TS: that is the question](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p4000r0.pdf)
