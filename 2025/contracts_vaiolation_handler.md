# ［C++］契約プログラミング機能の違反ハンドラ

Contracts提案がC++26に向けて採択され、C++26では契約プログラミング機能を言語サポートの下で実践できるようになります。契約プログラミング機能の一部として導入されている違反ハンドラというものについてのお話です。

[:contents]

### 契約プログラミング機能における違反ハンドラの概要

C++26の契約プログラミング機能は、関数の事前条件と事後条件（と中間の条件）を契約注釈（契約アサーション）として記述できるようにするとともに、それを実行時にチェックできるようにするものです。実行時チェックについては契約注釈の評価のセマンティクスによってその動作が規定されており、4種類のセマンティクスが定義されています。

4つのセマンティクス（ignore, observe, enforce, quick_enforce）のうち、observeとenforceセマンティクスでは契約が破られた（条件式が`false`に評価された）時に、違反ハンドラと呼ばれる言語組み込みのコールバック関数が呼ばれます。

違反ハンドラは契約違反が起きた場合の処理を担うもので、実装によってデフォルトのハンドラが用意されており、通常契約違反時にはそれが呼び出されます。デフォルトの違反ハンドラの動作については実装定義ですが、契約違反に関する診断メッセージを出力することが推奨されてはいます。

```cpp
// 違反ハンドラのシグネチャ
void handle_contract_violation(const std::contracts::contract_violation&);
```

デフォルトの、と言っていることからわかるように、この違反ハンドラはユーザーが置き換えてカスタマイズすることを想定されています（ただしそのサポートは実装定義とされています）。

### 外部ツールの共通コールバック機構として

### 実行時エラーハンドリングのコールバック機能として

### プロファイルの実行時検査におけるコールバックとして

### 未定義動作の実行時ハンドリング機能として


### 参考文献

- [P2900R14 Contracts for C++](https://open-std.org/jtc1/sc22/wg21/docs/papers/2025/p2900r14.pdf)
