# ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´06æœˆï¼‰

æ–‡æ›¸ã®ä¸€è¦§

- [JTC1/SC22/WG21 - Papers 2021 mailing2021-06](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/#mailing2021-06)

å…¨éƒ¨ã§49æœ¬ã‚ã‚Šã€SG22ï¼ˆC/C++ç›¸äº’äº’æ›æ€§ã«é–¢ã™ã‚‹ç ”ç©¶ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰ã®Cã®ææ¡ˆã‚’é™¤ãã¨48æœ¬ã«ãªã‚Šã¾ã™ã€‚

[:contents]

### [N4887 PL22.16/WG21 agenda: 7 June 2021, Virtual Meeting](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/n4887.html)

2021å¹´6æœˆ7æ—¥ 11:00 (åŒ—ç±³æ™‚é–“)ã«è¡Œã‚ã‚ŒãŸWG21æœ¬ä¼šè­°ã®ã‚¢ã‚¸ã‚§ãƒ³ãƒ€ã§ã™ã€‚

C++23ã®ãŸã‚ã®3å›ç›®ã®å…¨ä½“ä¼šè­°ã§ã™ã€‚

### [N4888 WG21 virtual meetings: 2021-06, and -10](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/n4888.pdf)

ä»Šå¹´ã®WG21å…¨ä½“ä¼šè­°ã®äºˆå®šè¡¨ã€‚

æ¬¡ã¯10æœˆã«äºˆå®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§è¡Œã‚ã‚Œã‚‹ã“ã¨ãŒæ±ºå®šã—ã¦ã„ã¾ã™ã€‚

### [N4889 WG21 admin telecon meeting: 2021-09](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/n4889.pdf)

10æœˆã®å…¨ä½“ä¼šè­°ã®ç›´å‰ã«è¡Œã‚ã‚Œã‚‹ç®¡ç†è€…ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®äºˆå®šè¡¨ã€‚

### [N4890 WG21 2021-05 Admin telecon minutes](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/n4890.pdf)

2021å¹´5æœˆ24æ—¥ã«è¡Œã‚ã‚ŒãŸã€ç®¡ç†è€…ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è­°äº‹éŒ²ã€‚

### [N4891 WG21 2021-06 Virtual Meeting Minutes of Meeting](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/n4891.pdf)

2021å¹´2æœˆ22æ—¥ï¼ˆç±³å›½æ™‚é–“ï¼‰ã«è¡Œã‚ã‚ŒãŸã€WG21å…¨ä½“ä¼šè­°ã®è­°äº‹éŒ²ã€‚

CWG/LWGã®æŠ•ç¥¨ã®æ§˜å­ãªã©ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [N4892 Working Draft, Standard for Programming Language C++](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/n4892.pdf)

C++23ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‰ãƒ©ãƒ•ãƒˆç¬¬5å¼¾ã€‚

### [N4893 Editors' Report - Programming Languages - C++](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/n4893.html)

â†‘ã®å¤‰æ›´ç‚¹ã‚’ã¾ã¨ã‚ãŸæ–‡æ›¸ã€‚

6æœˆã®ä¼šè­°ã§æ¡æŠã•ã‚ŒãŸææ¡ˆã¨ã‚³ã‚¢è¨€èª/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®Issueè§£æ±ºãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P0205R1 Efficient Seeding of Random Number Engines](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p0205r1.html)

ä¹±æ•°ã‚·ãƒ¼ãƒ‰ã®ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼ã§ã‚ã‚‹`std::seed_adapter`ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

`<random>`ã®ä¹±æ•°ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹éš›ã€æ¬¡ã®æ§˜ã«åˆæœŸåŒ–ã‚’è¡Œã†ã®ãŒéå¸¸ã«ä¸€èˆ¬çš„ã§ã™ã€‚

```cpp
template <typename EngineT>
void seed_non_deterministically_1st(EngineT& engine) {
  std::random_device device{};
  engine.seed(device());
}
```

ã—ã‹ã—ã€`EngineT`ã®å†…éƒ¨çŠ¶æ…‹ãŒå¤§ãã„å ´åˆã€ã“ã®åˆæœŸåŒ–ã¯é©åˆ‡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚ˆã‚Šè‰¯ã„ä¹±æ•°ã®ç”Ÿæˆã®ãŸã‚ã«ã¯å†…éƒ¨çŠ¶æ…‹ã®åˆæœŸå€¤ãŒå…¨ã¦åã‚ŠãªãåˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ãŸã¨ãˆã°`std::mt19937`ã®å ´åˆãã®å†…éƒ¨çŠ¶æ…‹ã¯19968bitã‚ã‚‹ä¸€æ–¹ã§ã€`random_device`ã®æˆ»ã‚Šå€¤å‹ã¯`unsigned int`ã§ã‚ã‚Šå¤šãã®ç’°å¢ƒã§32bitã®å¤§ãã•ã—ã‹ãªãã€åˆæœŸçŠ¶æ…‹ã®é¸æŠã«åã‚ŠãŒç”Ÿã˜ã¾ã™ã€‚ãã‚Œã«ã‚ˆã£ã¦ã€ã‚¨ãƒ³ã‚¸ãƒ³ãŒç”Ÿæˆã™ã‚‹ä¹±æ•°å€¤ã«ã‚‚åã‚ŠãŒç”Ÿã˜ã‚‹äº‹ãŒã‚ãƒªã¾ã™ã€‚

ã“ã®æ§˜ãªå•é¡Œã«å¯¾å‡¦ã™ã‚‹ãŸã‚ã«ã€[`std::seed_seq`](https://cpprefjp.github.io/reference/random/seed_seq.html)ã‚’åˆ©ç”¨ã™ã‚‹äº‹ãŒã§ãã¾ã™ã€‚`std::seed_seq`ã¯ã‚·ãƒ¼ãƒ‰åˆ—ã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã®å‹ã§ã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ç¯„å›²ãªã©ã«ã‚ˆã£ã¦ä»»æ„ã®æ•°ã®æ•´æ•°å€¤ã‹ã‚‰åˆæœŸåŒ–ã—ã€ãã‚Œã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹32bitæ•´æ•°ã«ã‚ˆã‚‹ã‚·ãƒ¼ãƒ‰åˆ—ã‚’`.generate()`ãƒ¡ãƒ³ãƒé–¢æ•°ã‹ã‚‰å–å¾—ã™ã‚‹äº‹ãŒã§ãã¾ã™ã€‚ã‚ã‚‹ã„ã¯ã€ã‚¨ãƒ³ã‚¸ãƒ³ã®`.seed()`ãƒ¡ãƒ³ãƒé–¢æ•°ã«æ¸¡ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```cpp
template <typename EngineT, std::size_t StateSize = EngineT::state_size>
void seed_non_deterministically_2nd(EngineT& engine) {
  using engine_type = typename EngineT::result_type;
  using device_type = std::random_device::result_type;
  using seedseq_type = std::seed_seq::result_type;

  constexpr auto bytes_needed = StateSize * sizeof(engine_type);
  constexpr auto numbers_needed = (sizeof(device_type) < sizeof(seedseq_type))
      ? (bytes_needed / sizeof(device_type))
      : (bytes_needed / sizeof(seedseq_type));

  // ã‚·ãƒ¼ãƒ‰åˆ—ã®ã‚·ãƒ¼ãƒ‰ï¼Ÿã‚’ç”Ÿæˆ
  std::array<device_type, numbers_needed> numbers{};
  std::random_device device{};
  std::generate(std::begin(numbers), std::end(numbers), std::ref(device));

  // ã‚·ãƒ¼ãƒ‰åˆ—ã«ã‚ˆã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆæœŸåŒ–
  std::seed_seq seedseq(std::cbegin(numbers), std::cend(numbers));
  engine.seed(seedseq);
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã«ã¯ã„ãã¤ã‹å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

- è¤‡é›‘
- ä¹±æ•°ã‚¨ãƒ³ã‚¸ãƒ³ã¯ãã®çŠ¶æ…‹ã‚µã‚¤ã‚ºã‚’å…¬é–‹ã—ã¦ã„ãªã„ï¼ˆã‚ã‚‹ã„ã¯ã€ãã†è¦å®šã—ã¦ã„ãªã„ï¼‰
- æ­£ç¢ºã§ã¯ãªã„ï¼ˆ`std::seed_seq`ã¯åã‚Šã‚’ã‚‚ãŸã‚‰ã—ã†ã‚‹ï¼‰
- éåŠ¹ç‡
    - `std::random_device` -> `std::array`ï¼ˆã‚¹ã‚¿ãƒƒã‚¯ï¼‰ -> `std::seed_seq`ï¼ˆãƒ’ãƒ¼ãƒ—ï¼‰ã¨ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹
    - `std::random_device`ã¯å¿…è¦ã¨ãªã‚‹ä¹±æ•°ã®ã‚µã‚¤ã‚ºã‚’å–ã‚‰ãªã„ãŸã‚ã€å®Ÿè£…ã«ã‚ˆã£ã¦ã¯ä¹±æ•°å–å¾—ãŒéåŠ¹ç‡ã«ãªã‚‹

ã“ã®ææ¡ˆã¯ã€ã“ã®æ§˜ãªã‚·ãƒ¼ãƒ‰åˆ—ã«ã‚ˆã‚‹ä¹±æ•°ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆæœŸåŒ–ã¨ã„ã†ä½œæ¥­ã‚’åŠ¹ç‡çš„ã‹ã¤ç°¡æ˜“ã«è¡Œã†ãŸã‚ã®`std::seed_adapter`ã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

```cpp
template <typename EngineT>
void seed_non_deterministically_3rd(EngineT& engine) {
  std::random_device device{};
  std::seed_adapter adapter{device};
  engine.seed(adapter);
}
```

`std::seed_adapter`ã¯ä½™åˆ†ãªã‚³ãƒ”ãƒ¼ã‚„ä¸€æ™‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä¸è¦ã§ã€å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿ã‚’å¿…è¦ã¨ã›ãšã€åã‚Šã‚’å°å…¥ã—ãªã„ã‚·ãƒ¼ãƒ‰åˆ—ã‚’è¡¨ç¾ã™ã‚‹å‹ã§ã™ã€‚

`std::seed_adapter`ã¯ä»»æ„ã®*Uniform Random Bit Generator*ã‚¯ãƒ©ã‚¹ï¼ˆä¾‹ãˆã°`std::random_device`ï¼‰ã®å‚ç…§ã‚’ãƒ©ãƒƒãƒ—ã—ã€ãã®é–¢æ•°å‘¼ã³å‡ºã—æ¼”ç®—å­ã‚’å‘¼ã³å‡ºã™`.generate()`ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’æä¾›ã™ã‚‹ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚

[P1068R4](https://wg21.link/P1068R4)ãŒæ¡æŠã•ã‚ŒãŸå ´åˆã€ãƒ©ãƒƒãƒ—ã—ã¦ã„ã‚‹*Generator*ã‚¯ãƒ©ã‚¹ã®é–¢æ•°å‘¼ã³å‡ºã—æ¼”ç®—å­ã¯ä¸€åº¦ã ã‘å‘¼ã³å‡ºã›ã°è‰¯ããªã‚Šã¾ã™ã€‚æ¡æŠã•ã‚Œãªã„å ´åˆã§ã‚‚ã€ä¾‹ãˆã°`std::seed_adapter`ã®å®Ÿè£…ã«åˆã‚ã›ãŸæœ€é©ãªå‘¼ã³å‡ºã—ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹äº‹ãŒå¯èƒ½ã§ã™ã€‚

`std::seed_adapter`ã¯ä¾‹ãˆã°æ¬¡ã®æ§˜ãªå°ã•ãªã‚¯ãƒ©ã‚¹å‹ã«ãªã‚Šã¾ã™ã€‚

```cpp
template <uniform_random_bit_generator U>
class seed_adapter {
public:
  // types
  using result_type = typename U::result_type;

  // constructors
  explicit constexpr seed_adapter(U& gen) noexcept;

  // generating functions
  template <random_access_iterator It>
    void constexpr generate(const It f, const It l)
    requires __unsigned_integral_least32<typename iterator_traits<It>::value_type>;

private:
  U* m_gen;  // exposition only
};
```

- [P0205 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/325)

ã“ã®éƒ¨åˆ†ã¯ä»¥ä¸‹ã®æ–¹ã«ã‚ˆã‚‹ã”æŒ‡æ‘˜ã«ã‚ˆã£ã¦æˆã‚Šç«‹ã£ã¦ã„ã¾ã™ã€‚

- [@cpp_akiraã•ã‚“](https://twitter.com/cpp_akira/status/1409377816668372998)

### [P0447R15 Introduction of std::hive to the standard library](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p0447r15.html)


è¦ç´ ãŒå‰Šé™¤ã•ã‚Œãªã„é™ã‚Šãã®ãƒ¡ãƒ¢ãƒªä½ç½®ãŒå®‰å®šãªã‚³ãƒ³ãƒ†ãƒŠã§ã‚ã‚‹`std::colony`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0447R11 Introduction of std::colony to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/12/06/015108#P0447R11-Introduction-of-stdcolony-to-the-standard-library)
- [P0447R12 Introduction of std::colony to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/02/11/153333#P0447R12-Introduction-of-stdcolony-to-the-standard-library)
- [P0447R13 Introduction of std::colony to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P0447R13-Introduction-of-stdcolony-to-the-standard-library)
- [P0447R14 Introduction of std::colony to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/06/13/165215#P0447R14-Introduction-of-stdcolony-to-the-standard-library)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€`splice()`ãŒä¾‹å¤–ã‚’æŠ•ã’ã‚‹å ´åˆã®è©³ç´°ã‚’è¿½è¨˜ã—ãŸã“ã¨ã€`reshape(), splice()`ã®è¨­è¨ˆã®é¸æŠã«ã¤ã„ã¦ã®è¿½è¨˜ã€ï¼ˆ`common_range`ã§ã¯ãªã„å ´åˆã®ï¼‰ç•ªå…µã‚’ç”¨ã„ãŸ`assign()`ã®è¿½åŠ ç­‰ã§ã™ã€‚

ãã—ã¦ã€ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚ˆã‚Šã€åå‰ãŒ`std::colony`ã‹ã‚‰`std::hive`ã¸å¤‰æ›´ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯[P2332R0](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2332r0.html)ã‚’å—ã‘ã¦ã®ã‚‚ã®ã§ã™ã€‚

- [P2332R0 Establishing std::hive as replacement name for the proposed std::colony container - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´03æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/04/10/222356#P2332R0-Establishing-stdhive-as-replacement-name-for-the-proposed-stdcolony-container)
- [P0447 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/328)

### [P0533R7 constexpr for cmath and cstdlib](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p0533r7.pdf)
â†“
### [P0533R8 constexpr for cmath and cstdlib](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p0533r8.pdf)

`<cmath>`ã¨`<cstdlib>`ã®ä¸€éƒ¨ã®é–¢æ•°ã‚’`constexpr`å¯¾å¿œã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0533R6 : constexpr for `<cmath>` and `<cstdlib>` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´4æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/05/01/194425#P0533R6--constexpr-for-cmath-and-cstdlib)

R7ã§ã®å¤‰æ›´ã¯ã€ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹è¦æ ¼ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‰ãƒ©ãƒ•ãƒˆã‚’N4878ã«å¤‰æ›´ã—ãŸäº‹ã¨ã€`std::lerp`ãŒ`constexpr`ã¨ã—ã¦`<cmath>`ã«è¿½åŠ ã•ã‚ŒãŸã“ã¨ã«ã¤ã„ã¦ã®ãƒ¡ãƒ¢ã‚’è¿½è¨˜ã—ã€LEWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘ã¦æ–‡è¨€ã‚’ä¿®æ­£ã—ãŸäº‹ã§ã™ã€‚

R8ã§ã®å¤‰æ›´ã¯ã€è¨˜è¼‰ã‚µãƒ³ãƒ—ãƒ«ã‚’ã„ãã¤ã‹æ”¹å–„ãƒ»ä¿®æ­£ã—ã€`constexpr`ã«ã™ã‚‹é–¢æ•°é¸æŠåŸºæº–ã®ä¿®æ­£ã—ãŸã“ã¨ã¨ã€LEWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘ã¦æ–‡è¨€ã‚’ä¿®æ­£ã—ãŸäº‹ã§ã™ã€‚

ã“ã®ææ¡ˆã¯2021å¹´2æœˆã®å…¨ä½“ä¼šè­°ã§æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã¾ã—ãŸãŒã€åå¯¾ãŒå¤šãå¦æ±ºã•ã‚Œã¾ã—ãŸã€‚ãã“ã§ã®ä¸»ãªåå¯¾æ„è¦‹ã¯å®Ÿè£…çµŒé¨“ã®å°‘ãªã•ã¨å®Ÿè£…å¯èƒ½æ€§ã«ã¤ã„ã¦ã®ã‚‚ã®ã§ã—ãŸã€‚ãã‚Œã‚’å—ã‘ã¦æ¬¡ã®2ã¤ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’æ¡æŠã—ã¾ã—ãŸã€‚

- `<cmath>`é–¢æ•°ã®`cosntexpr`è©•ä¾¡ã«ãŠã„ã¦ã€`math_errhandling & MATH_ERRNO == true`ã¨ãªã‚‹å ´åˆã«`errno`ã‚’è¨­å®šã™ã‚‹ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã—ãŸå ´åˆã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã¨ã™ã‚‹
- ææ¡ˆã—ã¦ã„ã‚‹`<cmath>`é–¢æ•°ã®`constexpr`è©•ä¾¡ã‚’ã€é©ç”¨å¯èƒ½ãªã™ã¹ã¦ã®æµ®å‹•å°æ•°ç‚¹æ•°å‹ã«ã¤ã„ã¦Cã®AnnexFã«å¾“ã†ã‚ˆã†ã«ã™ã‚‹

ã“ã‚Œã‚‰ã®äº‹ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€å†ã³C++23å°å…¥ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

- [P0533 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/104)

### [P1018R11 C++ Language Evolution status ğŸ¦  pandemic edition ğŸ¦  2021/05](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1018r11.html)

EWGï¼ˆã‚³ã‚¢è¨€èªã¸ã®æ–°æ©Ÿèƒ½è¿½åŠ ã«ã¤ã„ã¦ã®ä½œæ¥­éƒ¨ä¼šï¼‰ãŒ2021/05ã«è­°è«–ã—ãŸææ¡ˆã‚„Issueã®ãƒªã‚¹ãƒˆã‚„å°†æ¥ã®è¨ˆç”»ã€ãƒ†ãƒ¬ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã®çŠ¶æ³ãªã©ã‚’ã¾ã¨ã‚ãŸæ–‡æ›¸ã€‚

### [P1072R8 basic_string::resize_and_overwrite](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1072r8.html)

`std:string`ã«é ˜åŸŸï¼ˆæ–‡å­—é•·ï¼‰ã‚’æ‹¡å¼µã—ã¤ã¤ãã®éƒ¨åˆ†ã‚’åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹ç‚ºã®ãƒ¡ãƒ³ãƒé–¢æ•°`resize_and_overwrite()`ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1072R6 basic_string::resize_and_overwrite - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/01/17/005823#P1072R6-basic_stringresize_and_overwrite)
- [P1072R7 basic_string::resize_and_overwrite - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/03/12/225547#P1072R7-basic_stringresize_and_overwrite)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒã‚¯ãƒ­ã‚’è¿½åŠ ã—ã€`string::resize()`ã®åŠ¹æœã«ã¤ã„ã¦æ›–æ˜§ãªç‚¹ã‚’ä¿®æ­£ã—ãŸäº‹ã€ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹è¦æ ¼ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‰ãƒ©ãƒ•ãƒˆã‚’N4885ã«ã—ãŸã“ã¨ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯C++23å°å…¥ã‚’ç›®æŒ‡ã—ã¦LEWGã‹ã‚‰LWGã¸è»¢é€ã•ã‚Œã¾ã—ãŸã€‚

- [P1072 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/31)

### [P1132R8 `out_ptr` - a scalable output pointer abstraction](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1132r8.html)

ã‚¹ãƒãƒ¼ãƒˆãƒã‚¤ãƒ³ã‚¿ã¨ãƒã‚¤ãƒ³ã‚¿ã®ãƒã‚¤ãƒ³ã‚¿ã‚’å–ã‚‹ã‚¿ã‚¤ãƒ—ã®C APIã¨ã®æ©‹æ¸¡ã—ã‚’è¡Œã†ã€`std::out_ptr`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1132R7 out_ptr - a scalable output pointer abstraction - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P1132R7-out_ptr---a-scalable-output-pointer-abstraction)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯typoä¿®æ­£ãŒãƒ¡ã‚¤ãƒ³ã§ã™ã€‚

ã“ã®ææ¡ˆã¯2021å¹´6æœˆã®å…¨ä½“ä¼šè­°ã§æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã€C++23å…¥ã‚ŠãŒæ±ºå®šã—ã¦ã„ã¾ã™ã€‚

- [P1132 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/41)

### [P1202R3 Asymmetric Fences](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1202r3.pdf)

éå¯¾ç§°ãªãƒ•ã‚§ãƒ³ã‚¹ã®ææ¡ˆã€‚

ä¸¦è¡Œå‡¦ç†ã«ãŠã‘ã‚‹å¤šãã®åŒæœŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆãƒã‚¶ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ã‚¿ã€RCUãªã©ãªã©ï¼‰ã§ã¯é…ã„ãŒç¨€ã«ã—ã‹å®Ÿè¡Œã•ã‚Œãªã„å®Ÿè¡Œãƒ‘ã‚¹ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã«ã€é€šå¸¸ã®å®Ÿè¡Œãƒ‘ã‚¹ã«å¯¾ã—ã¦ãƒ•ã‚§ãƒ³ã‚¹ã®æŒ¿å…¥ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚ãã®ãƒ•ã‚§ãƒ³ã‚¹ã¯ã‚ã¾ã‚Šå®Ÿè¡Œã•ã‚Œãªã„ãƒ‘ã‚¹ãŒå®Ÿè¡Œã•ã‚ŒãŸéš›ã«ã‚‚ãƒ‡ãƒ¼ã‚¿ãƒ¬ãƒ¼ã‚¹ã‚’èµ·ã“ã•ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã‚ã‚Šã€ãã‚Œã«ã‚ˆã£ã¦é€šå¸¸ã®å®Ÿè¡Œãƒ‘ã‚¹ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä½ä¸‹ã—ã¾ã™ã€‚ç¾åœ¨ã®ã¨ã“ã‚C++ã«ã¯ã€ã“ã‚Œã‚’å›é¿ã™ã‚‹ãŸã‚ã®ç°¡æ˜“ãªï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰‹é–“ã‚’å¿…è¦ã¨ã—ãªã„ï¼‰ä»£æ›¿æ¡ˆãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ä¾‹ãˆã°ãƒ‡ãƒƒã‚«ãƒ¼ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä¾‹ã§è¦‹ã¦ã¿ã‚‹ã¨

```cpp
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
std::atomic_intâ€‹ x{â€‹0â€‹}, y{â€‹0â€‹};
intâ€‹ r1, r2;

// thread1ï¼ˆã„ã¤ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
x.store(â€‹1â€‹, std::memory_order_relaxed);
std::atomic_thread_fence(std::memory_order_seq_cst);
r1 = y.load(std::memory_order_relaxed);

// thread2ï¼ˆãŸã¾ã«ã—ã‹å®Ÿè¡Œã•ã‚Œãªã„ï¼‰
y.store(â€‹1â€‹, std::memory_order_relaxed);
std::atomic_thread_fence(std::memory_order_seq_cst);
r2 = x.load(std::memory_order_relaxed);

// 2ã¤ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒçµ‚äº†ã—ãŸå¾Œã§ã€ã“ã®ã‚¢ã‚µãƒ¼ãƒˆãŒç™ºå‹•ã™ã‚‹ã“ã¨ã¯ãªã„
assert(!(r1 == â€‹0â€‹ && r2 == â€‹0â€‹));
```

ã“ã®å ´åˆã®ã‚¹ãƒ¬ãƒƒãƒ‰1ã¨ã‚¹ãƒ¬ãƒƒãƒ‰2ã®å®Ÿè¡Œã®é »åº¦ãŒå¤§ããç•°ãªã‚‹å ´åˆã€é »ç¹ã«å®Ÿè¡Œã•ã‚Œã‚‹æ–¹ã®å‡¦ç†ã ã‘ã‚’è¦‹ã‚Œã°ãƒ•ã‚§ãƒ³ã‚¹ã¯å¿…è¦ãªã„ã¯ãšã§ã™ãŒã€ã‚ã¾ã‚Šå®Ÿè¡Œã•ã‚Œãªã„å‡¦ç†ã¨ã®é–“ã§åŒæœŸã‚’å–ã‚‹ãŸã‚ã«ã€ä¸¡æ–¹ã«ãƒ•ã‚§ãƒ³ã‚¹ã®æŒ¿å…¥ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€é »ç¹ã«å®Ÿè¡Œã•ã‚Œã‚‹æ–¹ã®å‡¦ç†ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä½ä¸‹ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®å ´åˆã«ã€é »ç¹ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã§ã¯è»½ã„ãƒ•ã‚§ãƒ³ã‚¹ã‚’ã€ã‚ã¾ã‚Šå®Ÿè¡Œã•ã‚Œãªã„å‡¦ç†ã§ã¯é‡ã„ï¼ˆæ™®é€šã®ï¼‰ãƒ•ã‚§ãƒ³ã‚¹ã‚’ä½¿ç”¨ã—ã¦åŒæœŸã‚’å–ã‚‹ã“ã¨ãŒã§ãã‚Œã°ã€é »ç¹ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã«ãŠã‘ã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ãã®æ„å‘³ã§éå¯¾ç§°ãªãƒ•ã‚§ãƒ³ã‚¹ã§ã‚ã‚‹`std::asymmetric_thread_fence_light()`ã¨`std::asymmetric_thread_fence_heavy()`ã®å°å…¥ã‚’ç›®æŒ‡ã™ã‚‚ã®ã§ã™ã€‚

å…ˆã»ã©ã®ä¾‹ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

```cpp
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
std::atomic_intâ€‹ x{â€‹0â€‹}, y{â€‹0â€‹};
intâ€‹ r1, r2;

// thread1ï¼ˆã„ã¤ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
x.store(â€‹1â€‹, std::memory_order_relaxed);
std::asymmetric_thread_fence_light(std::memory_order_seq_cst);   // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚ˆã‚‹ã‚¹ãƒˆã‚¢/ãƒ­ãƒ¼ãƒ‰ã®å…¥ã‚Œæ›¿ãˆã‚’é˜²æ­¢ã™ã‚‹
r1 = y.load(std::memory_order_relaxed);

// thread2ï¼ˆãŸã¾ã«ã—ã‹å®Ÿè¡Œã•ã‚Œãªã„ï¼‰
y.store(â€‹1â€‹, std::memory_order_relaxed);
std::asymmetric_thread_fence_heavy(std::memory_order_seq_cst);   // é€šå¸¸ã®ãƒ•ã‚§ãƒ³ã‚¹
r2 =  x.load(std::memory_order_relaxed);

// 2ã¤ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒçµ‚äº†ã—ãŸå¾Œã§ã€ã“ã®ã‚¢ã‚µãƒ¼ãƒˆãŒç™ºå‹•ã™ã‚‹ã“ã¨ã¯ãªã„
assert(!(r1 == â€‹0â€‹ && r2 == â€‹0â€‹));
```

`std::asymmetric_thread_fence_heavy()`ã¯`std::atomic_thread_fence()`ã¨ã»ã¼åŒç­‰ã§ã€ãƒ•ã‚§ãƒ³ã‚¹ã¨ã—ã¦ã®ãƒ•ãƒ«æ©Ÿèƒ½ã‚’æŒã¡ã¾ã™ãŒã€`std::asymmetric_thread_fence_light()`ã¯`atomic`å¤‰æ•°ã®èª­ã¿æ›¸ããŒå‰å¾Œã—ãŸã‚Šçµ±ä¸€ã—ãŸã‚Šã™ã‚‹äº‹ã‚’é˜²æ­¢ã™ã‚‹ç¨‹åº¦ã®äº‹ã—ã‹ã—ãªã„ãŸã‚è»½é‡ã¨ãªã‚Šã¾ã™ã€‚ãã—ã¦ã“ã®æ™‚ã§ã‚‚ã€ã“ã®2ã¤ã®ãƒ•ã‚§ãƒ³ã‚¹ã‚’ä»‹ã—ã¦`atomic`å¤‰æ•°ã®èª­ã¿æ›¸ãã«é †åºä»˜ã‘ã‚’è¡Œã†ï¼ˆ*strongly happens before*é–¢ä¿‚ã‚’ä¸ãˆã‚‹ï¼‰ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚’ç”¨ã„ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ã“ã®ã‚ˆã†ãªå•é¡Œã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å†…éƒ¨ã§è§£æ±ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã“ã®ã“ã¨ã«ã¤ã„ã¦ä½•ã‚‚æ°—ã«ã—ãªãã¦ã‚‚è‰¯ããªã‚Šã¾ã™ã€‚

- [P1202R0 Asymmetric Fences](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p1202r0.pdf)
- [C++ã®ãƒ•ã‚§ãƒ³ã‚¹ is ä½• - yohhoyã®æ—¥è¨˜](https://yohhoy.hatenadiary.jp/entry/20130427/p1)
- [æ¬¡æœŸC++ã«å°å…¥ã•ã‚Œã‚‹ãƒ¡ãƒ¢ãƒªãƒãƒªã‚¢ã«ã¤ã„ã¦è§£èª¬ã—ã¦ã¿ã‚‹ - yamasaã®ãƒã‚¿å¸³](https://yamasa.hatenablog.jp/entry/20090816/1250446250)
- [ãƒ‡ãƒƒã‚«ãƒ¼ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  - Wikipedia](https://ja.wikipedia.org/wiki/ãƒ‡ãƒƒã‚«ãƒ¼ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ )
- [P1202 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/144)

### [P1642R6 Freestanding Library: Easy [utilities], [ranges], and [iterators]](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1642r6.html)

[[utility]](https://timsong-cpp.github.io/cppwp/n4861/#utilities)ã€`<ranges>`ã€`<iterator>`ã‹ã‚‰ä¸€éƒ¨ã®ã‚‚ã®ã‚’ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

å‰å›ã®è¨˜äº‹ã‚’å‚ç…§

- [P1642R3 Freestanding Library: Easy [utilities], [ranges], and [iterators] - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´6æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/07/05/003248#P1642R3--Freestanding-Library-Easy-utilities-ranges-and-iterators)
- [P1642R4 Freestanding Library: Easy [utilities], [ranges], and [iterators] - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´7æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/08/12/014639#P1642R4--Freestanding-Library-Easy-utilities-ranges-and-iterators)
- [P1642R5 Freestanding Library: Easy [utilities], [ranges], and [iterators] - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/01/17/005823#P1642R5-Freestanding-Library-Easy-utilities-ranges-and-iterators)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€æ„å›³ã›ãšæŠœã‘è½ã¡ã¦ã„ãŸ`std::addressof`ã‚’å¯¾è±¡ã«è¿½åŠ ã—ãŸã“ã¨ã§ã™ã€‚

ã“ã®ææ¡ˆã¯LEWGã‹ã‚‰LWGã«è»¢é€ã•ã‚Œã€è­°è«–ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P1642 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/429)

### [P1664R4 reconstructible_range - a concept for putting ranges back together](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1664r4.html)

`view`ã«ã‚ˆã£ã¦åˆ¥ã®`range`ã«å¤‰æ›ã•ã‚Œã¦ã—ã¾ã£ãŸç¯„å›²ã‚’ã€å…ƒã®`range`ï¼ˆã¨åŒã˜å‹ï¼‰ã«æˆ»ã™æ“ä½œã€`std::ranges::reconstruct`ã¨é–¢é€£ã™ã‚‹ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§
- [P1664R3 reconstructible_range - a concept for putting ranges back together - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ202!å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P1664R3-reconstructible_range---a-concept-for-putting-ranges-back-together)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€ææ¡ˆã™ã‚‹æ–‡è¨€ã‚’ä¿®æ­£ã—ãŸäº‹ã¨ã€å¸¸ã«ADLã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã‚’å¤‰æ›´ã—ãŸäº‹ãªã©ã§ã™ã€‚

- [P1664 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/578)

### [P1675R2 `rethrow_exception` must be allowed to copy](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1675r2.pdf)

`std::rethrow_exception`ã®åŒã˜ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å†ã‚¹ãƒ­ãƒ¼ã™ã‚‹ã¨ã„ã†è¦å®šã‚’å¤‰æ›´ã™ã‚‹ææ¡ˆã€‚

`std::current_exception`ã®è¦å®šã¯æ³¨æ„æ·±ãæ›¸ã‹ã‚Œã¦ãŠã‚Šã€ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¹ã‚¿ãƒƒã‚¯ä¸Šã«æ§‹ç¯‰ã™ã‚‹å®Ÿè£…ï¼ˆMSVC ABIï¼‰ã¨ãƒ’ãƒ¼ãƒ—ä¸Šã«æ§‹ç¯‰ã—ã¦å–ã‚Šå›ã™å®Ÿè£…ï¼ˆItanium C++ ABIï¼‰ã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’`std::exception_ptr`ã®ä¿æŒã™ã‚‹ãƒ¡ãƒ¢ãƒªé ˜åŸŸã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ãªã©ã®å®Ÿè£…ã®è‡ªç”±ã‚’ä¸ãˆã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã§ã€`std::rethrow_exception`ã¯ãã†ã§ã¯ãªãã€å¼•æ•°ã®`std::exception_ptr`ã®å‚ç…§ã—ã¦ã„ã‚‹ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å†ã‚¹ãƒ­ãƒ¼ã™ã‚‹ã€ã¨è¦å®šã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¹ã‚¿ãƒƒã‚¯ä¸Šã«ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹MSVC ABIã§ã¯å®Ÿè£…ä¸å¯èƒ½ã§ã™ï¼ˆä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©æ¯ã«ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‘¼ã¶ãŸã‚ï¼‰ã€‚

MSVCã®ç¾åœ¨ã®å®Ÿè£…ã¯ã€`std::rethrow_exception`ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒ¡ãƒ¢ãƒªé ˜åŸŸã«å¼•æ•°ã§æŒ‡å®šã•ã‚ŒãŸ`std::exception_ptr`ã®å‚ç…§ã™ã‚‹ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã€ç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªä¾‹å¤–ã‚’æŒ‡ã™TLSã®å€¤ã‚’ãã®å ´æ‰€ã«æ›´æ–°ã—ã¦ã‹ã‚‰`throw`ã™ã‚‹ã“ã¨ã§ã€ã‚ãŸã‹ã‚‚ãã‚Œã‚’å†ã‚¹ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ã‹ã®ã‚ˆã†ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å†ã‚¹ãƒ­ãƒ¼ã—ã¦ã„ãªã„ãŸã‚è¦æ ¼é•åã¨ãªã£ã¦ã„ã¾ã™ãƒ»ãƒ»ãƒ»

ã“ã®ææ¡ˆã¯ã€MSVCã‚’å«ã‚ãŸå†ã‚¹ãƒ­ãƒ¼æ™‚ã«ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åŒºåˆ¥ã™ã‚‹å¿…è¦ã®ã‚ã‚‹ABIã®ãŸã‚ã«`std::rethrow_exception`ã®è¦å®šã‚’ã€ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ”ãƒ¼ã¨ãã®ãŸã‚ã®è¿½åŠ ã®ãƒ¡ãƒ¢ãƒªé ˜åŸŸã®ä½¿ç”¨ã‚’è¨±å¯ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€ã“ã®å•é¡Œã‚’è§£æ±ºã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«ãŠã„ã¦

```cpp
struct X : std::exception {
  // ã‚³ãƒ”ãƒ¼ãŒä¾‹å¤–ã‚’æŠ•ã’ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ãƒ¡ãƒ³ãƒã‚’æŒã¤ã¨ã™ã‚‹

  X() { }

  X(X const&) { 
    if(oh_no()) throw 42;
    /* else success */
  }
};

int main() {
  try {
    std::exception_ptr eptr;

    try { 
      throw X();
    }
    catch(X& x) {
      std::cout << "caught X with address " << (void*)&x;
      eptr = std::current_exception(); 
    }

    std::rethrow_exception(eptr);
  }
  catch(X& x) {
    std::cout << " caught X with address " << (void*)&x;
  } catch(int) {
    std::cout << " caught int";
  }
}
```

ã“ã®ææ¡ˆã®ä¸»å¼µã¯æ¬¡ã®3ã¤ã®å ´åˆã®ã„ãšã‚Œã‚‚èµ·ã“ã‚Šã†ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ã“ã¨ã§ã™

1. caught X with address xxxx caught X with address xxxx
2. caught X with address xxxx caught X with address yyyy
3. caught X with address  caught int

MSVCã¯1ã®ã‚±ãƒ¼ã‚¹ã‚’å®Ÿè£…ã§ããªã„ãŸã‚ã€2ã‹3ã‚’é¸ã¶ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€ã‚³ãƒ”ãƒ¼ãŒä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã“ã¨ãŒè¨±å¯ã•ã‚Œãªã„ãŸã‚ã«2ã¨3ã®å®Ÿè£…ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã®ææ¡ˆã®ç›®çš„ã¯ã€ã“ã®å ´åˆã®2,3ã‚’è¨±å¯ã™ã‚‹ã“ã¨ã§ã™ã€‚

- [`std::current_exception` - cpprefjp](https://cpprefjp.github.io/reference/exception/current_exception.html)
- [`std::rethrow_exception` - cpprefjp](https://cpprefjp.github.io/reference/exception/rethrow_exception.html)
- [P1675 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/453)

### [P1689R4 Format for describing dependencies of source files](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1689r4.html)

C++ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è§£ããã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ãƒ„ãƒ¼ãƒ«ãŒå‡ºåŠ›ã™ã‚‹ä¾å­˜é–¢ä¿‚æƒ…å ±ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®šã‚ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1689R3 Format for describing dependencies of source files - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/01/17/005823#P1689R3-Format-for-describing-dependencies-of-source-files)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã„ãã¤ã‹ã®ã‚­ãƒ¼ã®è¿½åŠ ãƒ»å‰Šé™¤ãªã©ä¿®æ­£ã¨ã€ã‚µãƒ³ãƒ—ãƒ«ã®æ›´æ–°ãªã©ã§ã™ã€‚

- [P1689 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/466)

### [P1708R5 Simple Statistical Functions](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1708r5.pdf)

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã„ãã¤ã‹ã®çµ±è¨ˆé–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1708R3 Simple Statistical Functions - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/02/11/153333#P1708R3-Simple-Statistical-Functions)
- [P1708R4 Simple Statistical Functions - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P1708R4-Simple-Statistical-Functions)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€åˆ†ä½æ•°ï¼ˆä¸­å¤®å€¤ï¼‰ãƒ»æœ€é »å€¤ã«ã¤ã„ã¦çµ±è¨ˆçš„ãªå•é¡ŒãŒæèµ·ã•ã‚Œã¦ãŠã‚Šåˆ¥ã®ææ¡ˆã«åˆ†é›¢ã•ã‚Œã‚‹ã“ã¨ã«ãªã£ãŸã“ã¨ã€`stats_error`ä¾‹å¤–ãŒå‰Šé™¤ã•ã‚ŒãŸã“ã¨ã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®è¦ç´ ï¼ˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼‰å‹ã«å¿œã˜ã¦æˆ»ã‚Šå€¤å‹ã‚’é¸æŠã™ã‚‹`stats_result_t`ã®å°å…¥ã€ã„ãã¤ã‹ã®çµ±è¨ˆå¼ã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£ã€é–¢æ•°ã‚„ã‚¯ãƒ©ã‚¹åã€å¼•æ•°åã‚’æ„å‘³ã®ã‚ã‚‹ã‚‚ã®ã¸å¤‰æ›´ã€`range`ã¨`execution_policy`ã«ã¾ã¤ã‚ã‚‹ã„ãã¤ã‹ã®ã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£ã€ãªã©ã§ã™ã€‚

- [P1708 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/475)

### [P1967R4 `#embed` - a simple, scannable preprocessor-based resource acquisition method](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1967r4.html)

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ï¼ˆãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹æ™‚ï¼‰ã«ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚·ãƒ³ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–`#embed`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1967R3 #embed - a simple, scannable preprocessor-based resource acquisition method - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P1967R3-embed---a-simple-scannable-preprocessor-based-resource-acquisition-method)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€ææ¡ˆã™ã‚‹æ–‡è¨€ã®æ”¹å–„ã€ä¾å­˜é–¢ä¿‚ã‚¹ã‚­ãƒ£ãƒŠãƒ¼å®Ÿè£…è€…ã‚„`#embed`å®Ÿè£…è€…ã‹ã‚‰ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å—ã‘ã¦ã®æ§‹æ–‡ã®å¤‰æ›´ã€åå‰ä»˜å¼•æ•°ã®å®Ÿè£…æ‹¡å¼µæ©Ÿèƒ½ã®ã‚µãƒãƒ¼ãƒˆã®è¿½åŠ ãªã©ã§ã™ã€‚

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã¯ã€`#embed`ãŒè¿½åŠ ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆåŠã³å±æ€§æŒ‡å®šï¼‰ã‚’å–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€é•·ã•ã®æŒ‡å®šæ–¹æ³•ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚

`#embed`ã®è¿½åŠ ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯èª­ã¿è¾¼ã‚€ãƒ•ã‚¡ã‚¤ãƒ«åã®å¾Œã«æŒ‡å®šã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€‚`limit, prefix, suffix,empty`ã®4ã¤ãŒææ¡ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```cpp
// limitå¼•æ•°ã€èª­ã¿è¾¼ã¿ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã™ã‚‹
const int please_dont_oom_kill_me[] = {
	#embed "/dev/urandom" limit(512)
};
// sizeof(please_dont_oom_kill_me) == 16

// prefixå¼•æ•°ã€suffixå¼•æ•°
// ãƒªã‚½ãƒ¼ã‚¹ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ãŒç©ºã§ãªã„å ´åˆã«æŒ‡å®šã—ãŸãƒ—ãƒªãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¨ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜åŠ ã™ã‚‹
const unsigned char null_terminated_file_data[] = {
	#embed "might_be_empty.txt" \
		prefix(0xEF, 0xBB, 0xBF, ) /* UTF-8 BOM */ \
		suffix(,)
	0 // always null-terminated
};

// emptyå¼•æ•°
// ãƒªã‚½ãƒ¼ã‚¹ãŒç©ºã®å ´åˆã«æŒ‡å®šã•ã‚ŒãŸpp-tokenã®ãƒªã‚¹ãƒˆã‚’å±•é–‹ã™ã‚‹
constexpr const char x[] = {
#embed "empty_file.dat" \
	empty((char)-1)
};
// sizeof(x) == 1
// x[0] == -1 or 255
```

ä»¥å‰ã®ææ¡ˆã§ã¯èª­ã¿å–ã‚‹ã‚µã‚¤ã‚ºã‚’ãƒ•ã‚¡ã‚¤ãƒ«åã®å‰ã«æŒ‡å®šã—ã¦ã„ã¾ã—ãŸãŒã€ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‹ã‚‰ã¯`limit`å¼•æ•°ã«ã‚ˆã£ã¦ãã‚Œã‚’æŒ‡å®šã—ã¾ã™ã€‚`limit(n)`ã®ã‚ˆã†ã«æŒ‡å®šã—ã€`n`ã¯èª­ã¿å–ã‚‹é•·ã•ã®æœ€å¤§é•·ï¼ˆãƒã‚¤ãƒˆæ•°ï¼‰ã§ã‚ã£ã¦ã€åˆæœŸåŒ–ã—ã‚ˆã†ã¨ã™ã‚‹é…åˆ—ã®è¦ç´ æ•°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

`prefix`å¼•æ•°ã€`suffix`å¼•æ•°ã¯èª­ã¿è¾¼ã‚€ãƒªã‚½ãƒ¼ã‚¹ãŒç©ºã§ã‚ã‚‹ã“ã¨ã‚’æ¤œçŸ¥ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹ãŒç©ºã§ã¯ãªã„æ™‚èª­ã¿å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã®å…ˆé ­ã«`prefix`ã«æŒ‡å®šã•ã‚ŒãŸã‚‚ã®ã‚’å±•é–‹ã—ã€ãƒ‡ãƒ¼ã‚¿ã®æœ«å°¾ã«`suffix`ã§æŒ‡å®šã•ã‚ŒãŸã‚‚ã®ã‚’å±•é–‹ã—ã¾ã™ã€‚  
`empty`å¼•æ•°ã¯é€†ã«ã€ãƒªã‚½ãƒ¼ã‚¹ãŒç©ºã§ã‚ã‚‹ã¨ãã«æŒ‡å®šã•ã‚ŒãŸã‚‚ã®ã‚’å±•é–‹ã—ä»£ã‚ã‚Šã®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¾ã™ã€‚


- [P1967 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/700)

### [P2164R5 `views::enumerate`](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2164r5.pdf)

å…ƒã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®å„è¦ç´ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ç´ä»˜ã‘ãŸè¦ç´ ã‹ã‚‰ãªã‚‹æ–°ã—ã„ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹Rangeã‚¢ãƒ€ãƒ—ã‚¿`views::enumrate`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2164R0 views::enumerate - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´5æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/06/01/001003#P2164R0--viewsenumerate)
- [P2164R1 views::enumerate - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´6æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/07/05/003248#P2164R1--viewsenumerate)
- [P2164R2 views::enumerate - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´9æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/10/09/221025#P2164R2--viewsenumerate)
- [P2164R3 views::enumerate - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/12/06/015108#P2164R3-viewsenumerate)
- [P2164R4 views::enumerate - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/#P2164R4-viewsenumerate)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ä»¥ä¸‹ã®ã‚‚ã®ã§ã™

- `views::enumrate`ã®é–“æ¥å‚ç…§çµæœã®å‹ã§ã‚ã‚‹é›†æˆä½“`enumerate_result`ã«ã¤ã„ã¦ã€[P2165R2](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2165r2.pdf)ã®å¤‰æ›´ã‚’ä»®å®šã—å˜ç´”ãªé›†æˆä½“ã®ã¾ã¾ã¨ã™ã‚‹ã¨ã¨ã‚‚ã«ã‚¿ãƒ—ãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¿½åŠ ã—ãŸ
- â†‘ã«ä¼´ã£ã¦ã€`enumrate_view`ã®å‚ç…§å‹ï¼ˆ`reference`ï¼‰ã¯`enumerate_result`ã€å€¤å‹ï¼ˆ`value_type`ï¼‰ã¯`tuple`ã¨ã—ãŸï¼ˆ`zip`ã‚„`cartesian_prodcut`ã¨ã®ä¸€è²«æ€§å‘ä¸Šï¼‰
- P2165R2ã«ã‚ˆã‚Œã°ã€ã‚¿ãƒ—ãƒ«ãƒ©ã‚¤ã‚¯å‹ã®å„è¦ç´ é–“ã«`commmon_reference`ãŒå­˜åœ¨ã—ã¦ã„ã‚Œã°ã€ãã®ã‚¿ãƒ—ãƒ«ãƒ©ã‚¤ã‚¯å‹ã¨`std::tuple`ã®é–“ã«ã‚‚`common_reference`ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¦ã„ã‚‹
- ãƒ¡ãƒ³ãƒå‹`count_type`ã‚’`index_type`ã«å¤‰æ›´

P2165R2ã‚’å‰æã¨ã™ã‚‹ã“ã¨ã§ã€R3ã§å•é¡Œã¨ãªã£ãŸ`enumrate_view`ã®å‚ç…§å‹ï¼ˆ`reference`ï¼‰ã¨å€¤å‹ï¼ˆ`value_type`ï¼‰ã®`common_reference`ã«ã¤ã„ã¦ã®å•é¡Œã‚’è§£æ±ºã—ã¦ã„ã¾ã™ã€‚

- [P2164 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/875)

### [P2165R2 Compatibility between tuple, pair and tuple-like objects](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2165r2.pdf)

`std::pair`ã¨2è¦ç´ `std::tuple`åŠã³`tuple-like`ãªå‹ã®é–“ã®éäº’æ›ã‚’æ¸›ã‚‰ã—æ¯”è¼ƒã‚„ä»£å…¥ã‚’ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

å‰å›ã®è¨˜äº‹ã‚’å‚ç…§
- [P2165R0 Compatibility between tuple and tuple-like objects - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/06/01/001003#P2165R0--Comparing-pair-and-tuples)
- [P2165R1 Compatibility between tuple and tuple-like objects - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/08/12/014639#P2165R1--Compatibility-between-tuple-and-tuple-like-objects)

R1ã§ã¯ã€ææ¡ˆã®å¯¾è±¡ã¯`std::pair`ã¨2è¦ç´ `std::tuple`ã®é–“ã®éäº’æ›ã ã‘ã‚’å¯¾è±¡ã«ã—ã¦ã„ã¾ã—ãŸãŒã€ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‹ã‚‰ã¯ãã‚Œã‚‰ã¨ä»–ã®`tuple-like`ãªå‹ã¨ã®é–“ã®éäº’æ›ã‚‚å¯¾è±¡ã«ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

`tuple-like, pair-like`ã¨ã„ã†èª¬æ˜å°‚ç”¨ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’å°å…¥ã—ã€`std::tuple, std::pair`ã¯ãã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’æº€ãŸã™å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰æ§‹ç¯‰ãƒ»ä»£å…¥ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚`pair-like`ã¯2è¦ç´ ã®`tuple-like`ã§ã‚ã‚‹ãŸã‚ã€ã“ã“ã§`std::tuple`ã¨`std::pair`ã®äº’æ›æ€§ãŒè¡¨ç¾ã•ã‚Œã¾ã™ã€‚

ãã—ã¦ã€`tuple-like`å‹ã«å¯¾ã—ã¦`basic_common_reference`ã¨`common_type`ã®ç‰¹æ®ŠåŒ–ã‚’æä¾›ã—ã¦ãŠãã“ã¨ã§ã€`tuple-like`å‹ã¯`std::tuple, std::pair`ã‚‚å«ã‚ãŸåˆ¥ã®`tuple-like`ãªå‹ã¨ã®é–“ã«`common_reference`ã¨`common_type`ã‚’è‡ªç„¶ã«æŒã¤ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆå¯¾å¿œã™ã‚‹è¦ç´ å‹ã«ã¤ã„ã¦`common_reference`ã¨`common_type`ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

```cpp
constexpr std::pair p {1, 3.0};
constexpr std::tuple t {p}; // OKã€ç¾åœ¨ã§ããªã„

std::pair<int, double> pp{t}; //OKã€ç¾åœ¨ã§ããªã„

static_assert(std::tuple(p) == t);

// 2è¦ç´ tupleã¨pairã®é–“ã®æ¯”è¼ƒãŒå¯èƒ½ã«ãªã‚‹
static_assert(p == t);
static_assert(p <=> t == 0);

std::tuple<int,int> t = std::array {1, 2};  // OKã€ç¾åœ¨ã§ããªã„

std::tuple<int> t = std::array {1, 2};  // NGã€ã‚µã‚¤ã‚ºãŒç•°ãªã‚‹

std::map m{t, u};

static_assert(same_as<std::tuple<int>, range_value_t<decltype(views::zip(v))>>);
static_assert(same_as<std::tuple<int,int>, range_value_t<decltype(views::zip(v, v))>>);

auto x = true ? tuple{0,0} : pair{0,0}; // NGã€2ã¤ã®å‹ã¯éäº’æ›
```

ã“ã‚Œã‚‰ã®å¤‰æ›´ã¯ä¸»ã«ã€rangesãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ‹¡å¼µã«ãŠã„ã¦`pair`ã‚ã‚‹ã„ã¯`peir-like`ãªå‹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®å„è¦ç´ ã‚’`tuple`ã¨ã¿ãªã—ã¦æ‰±ã†ã“ã¨ãŒå®¹æ˜“ã«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’å¿µé ­ã«ç½®ã„ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°å…ˆç¨‹ã®`enumrate_view`ã‚„`zip_view`ãªã©ãŒã‚ã‚Šã¾ã™ã€‚

ãŸã ã—ã€ã“ã®å¤‰æ›´ã¯APIã®ç ´å£Šçš„å¤‰æ›´ã‚’ä¼´ã†éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚

- [P2165 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/876)

### [P2290R1 Delimited escape sequences](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2290r1.pdf)

æ–‡å­—ãƒ»æ–‡å­—åˆ—å®šæ•°ä¸­ã®8é€²ãƒ»16é€²ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŠã‚ˆã³ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«æ–‡å­—åã«ã¤ã„ã¦ã€ãã®åŒºåˆ‡ã‚ŠãŒæ˜ç¢ºã«ãªã‚‹ã‚ˆã†ãªå½¢å¼ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

å‰å›ã®è¨˜äº‹ã‚’å‚ç…§

- [P2290R0 Delimited escape sequences - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/03/12/225547#P2290R0-Delimited-escape-sequences)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€ææ¡ˆã™ã‚‹æ–‡è¨€ã®å¤ã„æ³¨æ„äº‹é …ã‚’å‰Šé™¤ã—ãŸäº‹ã§ã™ã€‚

EWGã®è­°è«–ã§ã¯ã€ææ¡ˆã™ã‚‹æ–‡è¨€ã«ã¤ã„ã¦æ”¹å–„ãŒå¿…è¦ã§ã‚ã‚‹ã‚‚ã®ã®C++23ã«å‘ã‘ã¦ã“ã®ææ¡ˆã‚’æ¡æŠã™ã‚‹æ–¹å‘ã§åˆæ„ãŒå–ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

- [P2290 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/983)

### [P2295R4 Support for UTF-8 as a portable source file encoding](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2295r4.pdf)

C++ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå°‘ãªãã¨ã‚‚UTF-8ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2295R0 Correct UTF-8 handling during phase 1 of translation - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/03/12/225547#P2295R0-Correct-UTF-8-handling-during-phase-1-of-translation)
- [P2295R3 P2295R3 Support for UTF-8 as a portable source file encoding - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P2295R3-Support-for-UTF-8-as-a-portable-source-file-encoding)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€SG16ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã«å¾“ã£ã¦ææ¡ˆã™ã‚‹æ–‡è¨€ã‚’æ”¹å–„ã—ãŸäº‹ã§ã™ã€‚

- [P2295 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/985)

### [P2299R3 `mdspan`s of All Dynamic Extents](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2299r3.html)

ææ¡ˆä¸­ã®`std::mdspan`ã®CTADå¯¾å¿œã«ã¤ã„ã¦ã®å•é¡Œã‚’å ±å‘Šã™ã‚‹æ–‡æ›¸ã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2299R0 `mdspan` and CTAD - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´3æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/04/10/222356#P2299R0-mdspan-and-CTAD)
- [P2299R2 `mdspan` and CTAD - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/06/13/165215#P2299R2-mdspan-and-CTAD)

ä»¥å‰ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ãŒå•é¡Œã®å‘¨çŸ¥ã¨è§£æ±ºæ¡ˆã‚’å‹Ÿã‚‹ã‚‚ã®ã§ã‚ã£ãŸã®ã«å¯¾ã—ã¦ã€ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‹ã‚‰ã¯ææ¡ˆã™ã‚‹æ–‡è¨€ã¨è¨­è¨ˆã‚„è€ƒæ…®äº‹é …ã‚’èª¬æ˜ã—ãŸææ¡ˆã«ãªã£ã¦ã„ã¾ã™ã€‚

ãã—ã¦ã“ã®ææ¡ˆã§ã¯ã€`mdspan`ãŒ`basic_mdspan`ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§ã‚ã‚‹ç¾çŠ¶ã‚’ä¿®æ­£ã—ã€`basic_mdspan`ã‚’`mdspan`ã«ãƒªãƒãƒ¼ãƒ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ãã‚ŒãŒåˆ†ã‹ã‚Œã¦ã„ã‚‹ã®ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ä½¿ã„ã‚„ã™ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã™ã‚‹ãŸã‚ã§ã—ãŸãŒã€ãã‚‚ãã‚‚ãã‚ŒãŒæ±ºå®šã•ã‚ŒãŸã®ã¯C++17ä»¥å‰ã®CTADãŒå­˜åœ¨ã—ã¦ã„ãªã„æ™‚ä»£ã§ã—ãŸã€‚`mdspan`ã®å„è¦ç´ ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®`dextent`ã®å°å…¥ã¨CTADã«ã‚ˆã£ã¦ã€`basic_mdspan`ã¨`mdspan`ã®åˆ†å‰²ã¯å¿…è¦ãªããªã£ãŸã¨ã„ã†ä¸»å¼µã§ã™ã€‚

ã“ã®ææ¡ˆã«ã‚ˆã‚‹å¤‰æ›´ã®ä¾‹ã€‚

```cpp
mdspan<T> m(data, 16, 64, 64);  // ç¾åœ¨
mdspan<T> m(data, 16, 64, 64);  // ã“ã®ææ¡ˆ

mdspan<T, dynamic_extent, dynamic_extent, dynamic_extent> f();  // ç¾åœ¨
mdspan<T, dextents<3>> f();  // ã“ã®ææ¡ˆ

mdspan<T, 3, 3> m;           // ç¾åœ¨
mdspan<T, extents<3, 3>> m;  // ã“ã®ææ¡ˆ

mdspan<T, 3, 3> f();           // ç¾åœ¨
mdspan<T, extents<3, 3>> f();  // ã“ã®ææ¡ˆ

mdspan<T, 16, dynamic_extent, 64> m;           // ç¾åœ¨
mdspan<T, extents<16, dynamic_extent, 64>> m;  // ã“ã®ææ¡ˆ

mdspan<T, 16, dynamic_extent, 64> f();           // ç¾åœ¨
mdspan<T, extents<16, dynamic_extent, 64>> f();  // ã“ã®ææ¡ˆ
```

- [P2299 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1009)

### [P2300R0 `std::execution`](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2300r0.html)

[P0443R14](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/p0443r14.html)ã®Executorææ¡ˆã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸã€ä»»æ„ã®å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ä»»æ„ã®éåŒæœŸå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ææ¡ˆã€‚

ã“ã‚Œã¯ã€Executorææ¡ˆã«ã‚ã‚‹`scheduler, sender, reciever`ã¨ã„ã†3ã¤ã®æŠ½è±¡ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ã€ãã®ã†ãˆã§ä»»æ„ã®éåŒæœŸå‡¦ç†ã‚’æ§‹æˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ææ¡ˆã§ã™ã€‚

éåŒæœŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è‡ªä½“ã¯P0443ã§ã‚‚ç´¹ä»‹ã•ã‚Œã¦ãŠã‚Šã€ãã‚Œã¯åˆ¥ã®ææ¡ˆï¼ˆ[P1897R3](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/p1897r3.html)ï¼‰ã«å§”ã­ã‚‰ã‚Œã¦ã„ã¾ã—ãŸãŒã€P0443R14ã®LEWGã«ãŠã‘ã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã‚ˆã£ã¦ã„ãã¤ã‹ã®è¨­è¨ˆå¤‰æ›´ãŒè¡Œã‚ã‚Œã¦ãŠã‚Šã€ãã‚Œã«ä¼´ã£ã¦`scheduler`ã‚„`sender`ã¨ã„ã£ãŸæŠ½è±¡ã®å½¹å‰²ãŒå¤‰åŒ–ã—ãŸãŸã‚ã€ãã‚Œã‚’åæ˜ ã—ãŸéåŒæœŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ææ¡ˆã™ã‚‹ã¨ã¨ã‚‚ã«ãã®è¨­è¨ˆè©³ç´°ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚

åŸºæœ¬çš„ãªã‚µãƒ³ãƒ—ãƒ«

```cpp
using namespace std::execution;

scheduler auto sch = get_thread_pool().scheduler();                           // 1

sender auto begin = schedule(sch);                                            // 2
sender auto hi_again = then(begin, []{                                        // 3
    std::cout << "Hello world! Have an int.";                                 // 3
    return 13;                                                                // 3
});                                                                           // 3
sender auto add_42 = then(hi_again, [](int arg) { return arg + 42; });        // 4

auto [i] = std::this_thread::sync_wait(add_42).value();                       // 5
```

1. ï¼ˆä¾‹ã§ã¯ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ã‹ã‚‰ï¼‰`scheduler`ã‚’å–å¾—ã™ã‚‹ã€‚`scheduler`ã¯å®Ÿè¡Œãƒªã‚½ãƒ¼ã‚¹ã‚’è¡¨ç¾ã™ã‚‹è»½é‡ãƒãƒ³ãƒ‰ãƒ«ã€‚
2. ã‚ã‚‹`scheduler`ã§ä¸€é€£ã®ä½œæ¥­ã‚’é–‹å§‹ã™ã‚‹ã«ã¯`std::execution::schedule()`ã‚’å‘¼ã³å‡ºã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€ãã®`scheduler`ä¸Šã§å‡¦ç†ã‚’å®Œäº†ã™ã‚‹`sender`ãŒå¾—ã‚‰ã‚Œã‚‹ã€‚
   - `sender`ã¯éåŒæœŸä½œæ¥­ã‚’è¨˜è¿°ã—ã€ãã®ä½œæ¥­å®Œäº†æ™‚ã«`reciever`ï¼ˆè¤‡æ•°å¯ï¼‰ã«ã‚·ã‚°ãƒŠãƒ«ï¼ˆå€¤ã€ã‚¨ãƒ©ãƒ¼ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰ã‚’é€šçŸ¥ã™ã‚‹
3. éåŒæœŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã£ã¦`sender`ã‚’ç”Ÿæˆã—ã€éåŒæœŸä½œæ¥­ã‚’æ§‹æˆã™ã‚‹ã€‚`std::execution::then`ã¯å…¥åŠ›`sender`ã¨`invocable`ãª`f`ã‚’å—ã‘å–ã‚Šã€å…¥åŠ›`sender`ã‹ã‚‰ã®ã‚·ã‚°ãƒŠãƒ«ã«ã‚ˆã£ã¦`f`ã‚’å‘¼ã³å‡ºã™`sender`ã‚¢ãƒ€ãƒ—ã‚¿ã€‚è¿”ã•ã‚Œã‚‹`sender`ã¯ãã®å‘¼ã³å‡ºã—ã®çµæœã‚’é€šçŸ¥ã™ã‚‹ã€‚
    - ä¾‹ã§ã®å…¥åŠ›`sender`ã¯`schedule()`ã‹ã‚‰ã®ç›´æ¥ã®ã‚‚ã®ãªã®ã§å€¤ã¯ãªãï¼ˆæˆ»ã‚Šå€¤`void`ï¼‰ã€å—ã‘å–ã‚‹`invocable`ã¯å¼•æ•°ã‚’å–ã‚‰ãªã„ã€‚ç”Ÿæˆã•ã‚ŒãŸ`sender`ã¯`int`ã‚’è¿”ã™ï¼ˆå®Œäº†æ™‚ã«`int`å€¤ã‚’é€šçŸ¥ã™ã‚‹ï¼‰ã€‚
4. ã“ã“ã§ã¯ã€ä½œæ¥­ãƒã‚§ãƒ¼ãƒ³ã«ã•ã‚‰ã«ä½œæ¥­ã‚’è¿½åŠ ã—ã¦ã„ã‚‹ã€‚ã“ã“ã®`invocable`ã«ã¯å‰ã®å‡¦ç†ãŒè¿”ã—ãŸ`int`å€¤ãŒé€ä¿¡ã•ã‚Œã€ã“ã“ã§ã¯ãã®å€¤ã«`42`ã‚’åŠ ãˆã¦ã‹ãˆã—ã¦ã„ã‚‹ã€‚çµæœã¯ã¾ãŸ`sender`ã¨ã—ã¦å¾—ã‚‰ã‚Œã‚‹ãŸã‚ã€ã•ã‚‰ã«ä»»æ„ã®å‡¦ç†ã‚’ä»»æ„ã®å€‹æ•°ãƒã‚§ãƒ¼ãƒ³ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
5. æ§‹æˆã—ãŸéåŒæœŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆéåŒæœŸä½œæ¥­ï¼‰å…¨ä½“ã‚’å®Ÿè¡Œãƒªã‚½ãƒ¼ã‚¹ã«é€ä¿¡ã—ã¦ã€ä½œæ¥­ã®å®Œäº†ã‚’å¾…ã¤æº–å‚™ãŒæ•´ã£ãŸã€‚ã“ã“ã¾ã§ã®å…¨ã¦ã®ä½œæ¥­ã¯éåŒæœŸã§ã‚ã‚Šã€ä½œæ¥­ã¯ã¾ã é–‹å§‹ã•ã‚Œã¦ã„ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚ä½œæ¥­ã‚’é–‹å§‹ã—å®Œäº†ã‚’ãã®å ´ã§å¾…æ©Ÿã™ã‚‹ãŸã‚ã«ã€`std::this_thread::sync_wait()`ã‚’ä½¿ç”¨ã™ã‚‹ã€‚ãã®çµæœã¯ã€`std::optional<std::tuple<...>>`ã§å¾—ã‚‰ã‚Œã€æœ€å¾Œã®`sender`ãŒå€¤ã‚’è¿”ã—ãŸå ´åˆã¯ãã‚Œã‚’æœ‰åŠ¹å€¤ã¨ã—ã¦ä¿æŒã—ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆã¯ç©ºã«ãªã‚Šã€ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ä¾‹å¤–ã‚’é€å‡ºã™ã‚‹ã€‚

ã“ã“ã®ä¾‹ã§ã¯`sender`ã‚’é–¢æ•°å‘¼ã³å‡ºã—ã«ã‚ˆã£ã¦ãƒã‚§ãƒ¼ãƒ³ã•ã›ã¦ã„ã¾ã™ãŒã€rangeãƒ©ã‚¤ãƒ–ãƒ©ãƒªlikeã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­ï¼ˆ`|`ï¼‰ã«ã‚ˆã£ã¦ä¸­é–“ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’çœç•¥ã—ã¤ã¤ç›´æ„Ÿçš„ã«ãƒã‚§ãƒ¼ãƒ³ã•ã›ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

éåŒæœŸ[`inclusive_scan`](https://cpprefjp.github.io/reference/numeric/inclusive_scan.html)ã®ã‚µãƒ³ãƒ—ãƒ«ã€‚

```cpp
using namespace std::execution;

sender auto async_inclusive_scan(scheduler auto sch,                          // 2
                                 std::span<const double> input,               // 1
                                 std::span<double> output,                    // 1
                                 double init,                                 // 1
                                 std::size_t tile_count)                      // 3
{
  std::size_t const tile_size = (input.size() + tile_count - 1) / tile_count;

  std::vector<double> partials(tile_count + 1);                               // 4
  partials[0] = init;                                                         // 4

  return transfer_just(sch, std::move(partials))                              // 5
       | bulk(tile_count,                                                     // 6
           [=](std::size_t i, std::vector<double>& partials) {                // 7
             auto start = i * tile_size;                                      // 8
             auto end   = std::min(input.size(), (i + 1) * tile_size);        // 8
             partials[i + 1] = *--std::inclusive_scan(begin(input) + start,   // 9
                                                      begin(input) + end,     // 9
                                                      begin(output) + start); // 9
           })                                                                 // 10
       | then(                                                                // 11
           [](std::vector<double>& partials) {
             std::inclusive_scan(begin(partials), end(partials),              // 12
                                 begin(partials));                            // 12
             return std::move(partials);                                      // 13
           })
       | bulk(tile_count,                                                     // 14
           [=](std::size_t i, std::vector<double>& partials) {                // 14
             auto start = i * tile_size;                                      // 14
             auto end   = std::min(input.size(), (i + 1) * tile_size);        // 14
             std::for_each(output + start, output + end,                      // 14
               [=] (double& e) { e = partials[i] + e; }                       // 14
             );
           })
       | then(                                                                // 15
           [=](std::vector<double>& partials) {                               // 15
             return output;                                                   // 15
           });                                                                // 15
}
```

1. ã“ã‚Œã¯ã€`double`ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’å…¥åŠ›ã¨ã—ã¦ã€çµæœã‚’`double`ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å‡ºåŠ›ã™ã‚‹ã‚‚ã®
2. å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ‡å®šã™ã‚‹`scheduler`ã‚’å—ã‘å–ã‚‹ã€‚`sch`ã®æŒ‡ã™å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¸Šã§å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
3. `tile_count`ã¯ç”Ÿæˆã•ã‚Œã‚‹å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ•°ã‚’åˆ¶å¾¡ã™ã‚‹ï¼ˆã™ãªã‚ã¡ã€ä¸¦åˆ—æ•°ï¼‰ã€‚
4. æœ€åˆã«ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å®Ÿè¡Œã«å¿…è¦ãªä½œæ¥­é ˜åŸŸã‚’ç¢ºä¿ã™ã‚‹ã€‚1ã¤ã®å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ¯ã«`double`1ã¤åˆ†ã®é ˜åŸŸãŒå¿…è¦ã€‚
5. `std::execution::transfer_just`ã«ã‚ˆã£ã¦æœ€åˆã®`sender`ã‚’ä½œæˆã™ã‚‹ã€‚ã“ã®`sender`ã¯å…ˆç¨‹ç¢ºä¿ã—ãŸä½œæ¥­é ˜åŸŸã‚’å¾Œç¶šã®ä½œæ¥­ã«è»¢é€ã—ã€å¾Œç¶šã®ä½œæ¥­ã‚’å—ã‘å–ã£ãŸ`scheduler`ï¼ˆå¼•æ•°ã§æ¸¡ã•ã‚ŒãŸ`sch`ï¼‰ã®æŒ‡ã™å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¸Šã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’æŒ‡å®šã™ã‚‹ã€‚
6. `sender`ã¨`sender`ã‚¢ãƒ€ãƒ—ã‚¿ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­ï¼ˆ`|`ï¼‰ã«ã‚ˆã‚‹æ§‹æˆã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ï¼ˆã»ã¨ã‚“ã©ã®`sender`ã‚¢ãƒ€ãƒ—ã‚¿ã¯`|`ã«ã‚ˆã£ã¦æ§‹æˆå¯èƒ½ï¼‰ã€‚`std::execution::bulk`ã«ã‚ˆã£ã¦`tile_count`ã§æŒ‡å®šã•ã‚ŒãŸæ•°ã®å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç”Ÿæˆã—æ¬¡ã®ä½œæ¥­ã‚’æ¥ç¶šã™ã‚‹ã€‚
7. ãã‚Œãã‚Œã®å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯1ã¤ã®ï¼ˆ2å¼•æ•°ï¼‰`invocable`ã‚’å®Ÿè¡Œã™ã‚‹ã€‚1ã¤ç›®ã®å¼•æ•°ã¯å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆä¾‹ãˆã°ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«å†…ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãªã©ã€ã“ã®ä¾‹ã§ã¯`[0, tile_count)`å†…ã®å˜ä¸€æ•´æ•°å€¤ï¼‰ã€2ã¤ç›®ã®å¼•æ•°ã¯å…ˆç¨‹ç¢ºä¿ã—è»¢é€ã•ã‚ŒãŸä½œæ¥­é ˜åŸŸã€‚
8. ã¾ãšã€å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«åŸºã¥ã„ã¦ã€ã“ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæ‹…å½“ã™ã‚‹å…¥åŠ›ã¨å‡ºåŠ›ã®ç¯„å›²ã‚’è¨ˆç®—ã™ã‚‹ã€‚
9. æ¬¡ã«ã€è¦ç´ ã«å¯¾ã—ã¦é †æ¬¡`std::inclusive_scan`ã‚’å®Ÿè¡Œã™ã‚‹ã€‚ã™ã¹ã¦ã®è¦ç´ ã®åˆè¨ˆã§ã‚ã‚‹æœ€å¾Œã®è¦ç´ ã‚’å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸä½œæ¥­é ˜åŸŸã«ä¿å­˜ã™ã‚‹ã€‚
10. 1ã¤ç›®ã®`bulk()`ã§ã®ã™ã¹ã¦ã®è¨ˆç®—ãŒå®Œäº†ã™ã‚‹ã¨ã€ç”Ÿæˆã•ã‚ŒãŸå®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãã‚Œãã‚ŒãŒæ‹…å½“ç¯„å›²ã®è¦ç´ ã®åˆè¨ˆã‚’ä½œæ¥­é ˜åŸŸã«ä¿å­˜ã—ã¦ã„ã‚‹ã€‚
11. æ¬¡ã«ä½œæ¥­é ˜åŸŸã®ç¯„å›²ã«å¯¾ã—ã¦`std::inclusive_scan`ã‚’å®Ÿè¡Œã™ã‚‹ã€‚ã“ã‚Œã¯å˜ä¸€ã®å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã€`std::execution::then`ã«ã‚ˆã£ã¦ãã®å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚
12. `then()`ã¯`sender`ï¼ˆ`|`ã«éš è”½ã•ã‚Œã¦ã„ã‚‹ï¼‰ã¨`invocable`ã‚’å—ã‘å–ã£ã¦ã€ãã®`sender`ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸå€¤ã‚’ç”¨ã„ã¦`invocable`ã‚’å®Ÿè¡Œã™ã‚‹ã€‚ã“ã“ã§ã¯ã€å‰æ®µã®å‡¦ç†çµæœã§ã‚ã‚‹ä½œæ¥­é ˜åŸŸã‚’è¡¨ã™`std::vector<double>`ãŒé€ä¿¡ã•ã‚Œã¦ãã‚‹ã€‚
13. ã“ã“ã§ã®å‡¦ç†ã®çµæœã¨ã—ã¦ã€æ¬¡ã®ä½œæ¥­ã«æ¸¡ã™ã‚‚ã®ã‚’è¿”ã™ã€‚ã“ã“ã§ã¯`std::inclusive_scan`å®Ÿè¡Œæ¸ˆã¿ã®ä½œæ¥­é ˜åŸŸã‚’æ¬¡ã«æ¸¡ã™ã€‚
14. 1ã¤ç›®ã®`bulk()`ã¨åŒã˜å½¢çŠ¶ï¼ˆå®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ•°ï¼‰ã§åˆ¥ã®å‡¦ç†ã‚’ãƒãƒ«ã‚¯å®Ÿè¡Œã™ã‚‹ã€‚ã“ã“ã§ã¯ã€ä»–ã®ã‚¿ã‚¤ãƒ«ï¼ˆåˆ¥ã®å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰ã«ã‚ˆã‚‹çµæœï¼ˆå’Œï¼‰ã‚’çµ±åˆã™ã‚‹ãŸã‚ã«éƒ¨åˆ†å’Œã®å€¤ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—`inclusive_scan`ã‚’å®Œäº†ã™ã‚‹ã€‚
15. æœ€å¾Œã«ã€`async_inclusive_scan()`ã¯å‡ºåŠ›ç¯„å›²ã§ã‚ã‚‹`std::span<double>`ã‚’é€ä¿¡ã™ã‚‹`sender`ã‚’è¿”ã™ã€‚ã“ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®åˆ©ç”¨è€…ã¯ã€å‘¼ã³å‡ºã—å´ã§ã•ã‚‰ã«åˆ¥ã®å‡¦ç†ã‚’ï¼ˆã“ã“ã§è¦‹ãŸã®ã¨åŒæ§˜ã®æ–¹æ³•ã§ï¼‰ãƒã‚§ãƒ¼ãƒ³ã•ã›ã‚‹ã“ã¨ãŒã§ãã€ã‚ã‚‹ã„ã¯ä»»æ„ã®`reciever`ã«ã‚ˆã£ã¦å‡¦ç†çµæœã‚’å¾—ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚ã“ã®é–¢æ•°ãŒå¸°ã£ãŸæ™‚ã€å‡¦ç†å…¨ä½“ã¯å®Œäº†ã—ã¦ã„ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã—ã€å§‹ã¾ã£ã¦ã™ã‚‰ã„ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚

ã“ã‚Œã‚‰ã®éåŒæœŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ç‰¹å®šã®å‹ã«ä¾å­˜ã™ã‚‹ã‚‚ã®ã§ã¯ãªã`scheduler, sender, reciever`ã¨ã„ã£ãŸæŠ½è±¡ã«ã®ã¿ä¾å­˜ã—ã¦ãŠã‚Šã€ãã‚Œã‚‰ã¯ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã‚ˆã£ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€å˜ç´”ãª1ã‚¹ãƒ¬ãƒƒãƒ‰ã‚„ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ã€GPUç­‰ã®å®Ÿè¡Œãƒªã‚½ãƒ¼ã‚¹ã‚’è¡¨ç¾ã™ã‚‹`scheduler`ã•ãˆç”¨æ„ã™ã‚Œã°ã€ã“ã‚Œã‚‰ã®ä¾‹ã®ã‚ˆã†ãªå…±é€šã®æ“ä½œã«ã‚ˆã£ã¦ä»»æ„ã®å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¸Šã§å®Ÿè¡Œå¯èƒ½ãªéåŒæœŸå‡¦ç†ã‚’æ§‹æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆGPUãªã©å¤–éƒ¨ã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚¿ä¸Šã§ã®å®Ÿè¡Œã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ç‰¹åˆ¥æ‰±ã„ãŒå¿…è¦ã§ã¯ã‚ã‚Šã¾ã™ãŒï¼‰ã€‚

- [ï¼»ç¿»è¨³ï¼½P0443R13 A Unified Executors Proposal for C++](https://onihusube.hatenablog.com/entry/2020/05/24/205222)
- [P2300 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1054)

### [P2301R1 Add a pmr alias for std::stacktrace](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2301r1.html)

`std::basic_stacktrace`ã®`std::pmr`ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆ`std::polymorphic_allocator`ã‚’ç”¨ã„ã‚‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼‰ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2301R0 Add a pmr alias for std::stacktrace - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/03/12/225547#P2301R0-Add-a-pmr-alias-for-stdstacktrace)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€ææ¡ˆã™ã‚‹æ–‡è¨€ã®ä¿®æ­£ã§ã™ã€‚

ã“ã®ææ¡ˆã¯æ—¢ã«è­°è«–ã‚’å®Œäº†ã—ã¦ãŠã‚Šã€æ¬¡ã®å…¨ä½“ä¼šè­°ã§æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã‚‹ã“ã¨ãŒæ±ºã¾ã£ã¦ã„ã¾ã™ã€‚

- [P2295 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/987)

### [P2321R2 `zip`](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2321r2.html)

`<ranges>`ã«`zip_view, adjacent_view, zip_transform_view, adjacent_transform_view`ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2321R0 zip - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/03/12/225547#P2321R0-zip)
- [P2321R1 zip - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P2321R1-zip)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€LEWGã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã¦è¨­è¨ˆã‚„æ–‡è¨€ã‚’æ”¹å–„ã—ãŸäº‹ã¨ã€`difference_type, size_type`ã§`integer-like-type`ã‚’è€ƒæ…®ã™ã‚‹ã‚ˆã†ã«ã—ãŸã“ã¨ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯LEWG/LWGã§ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµ‚ãˆã¦ã€æ¬¡ã®å…¨ä½“ä¼šè­°ã§æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã‚‹ã“ã¨ãŒæ±ºå®šã—ã¦ã„ã¾ã™ã€‚

- [P2321 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1003)

### [P2322R3 `ranges::fold`](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2322r3.html)

`range`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã‚ã‚‹`ranges::fold`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2322R0 ranges::fold - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/03/12/225547#P2322R0-rangesfold)
- [P2322R1 ranges::fold - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´03æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/04/10/222356#P2322R1-rangesfold)
- [P2322R2 ranges::fold - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P2322R2-rangesfold)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã¯ã€LEWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘ã¦é–¢æ•°åã¨æˆ»ã‚Šå€¤å‹ã«ã¤ã„ã¦ã®è­°è«–ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

é–¢æ•°åã«ã¤ã„ã¦ã¯ä»¥å‰ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ãŒ`fold_left/fold_right`ã¨ã—ã¦ã„ã¾ã—ãŸãŒã€LEWGã«ãŠã‘ã‚‹æŠ•ç¥¨ã§åˆæ„ãŒå–ã‚Œãªã‹ã£ãŸã‚ˆã†ã§ã€ã„ãã¤ã‹ã®å€™è£œã‚’æç¤ºã—ã¦ã„ã¾ã™ã€‚ç­†è€…ã®æ–¹ã¯ã€ãƒ¡ã‚¤ãƒ³ã®å·¦ç•³ã¿è¾¼ã¿ã¨å³ç•³ã¿è¾¼ã¿ã®é–¢æ•°ã‚’`foldl, foldr`ã€ãã‚Œã‚‰ã®åˆæœŸå€¤ã‚’å–ã‚‹é–¢æ•°ã‚’`foldl1, foldl2`ã¨ã™ã‚‹ã“ã¨ã‚’æ¨ã—ã¦ã„ã¾ã™ã€‚

æˆ»ã‚Šå€¤å‹ã«ã¤ã„ã¦ã€ä»¥å‰ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã¯è¨ˆç®—çµæœã®å€¤ã‚’ç›´æ¥è¿”ã—ã¦ã„ã¾ã—ãŸãŒã€è¨ˆç®—ã‚’çµ‚äº†ã—ãŸä½ç½®ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒæ¬²ã—ã„éœ€è¦ãŒæœ›ã¾ã‚ŒãŸã‚ˆã†ã§ã™ã€‚ææ¡ˆã§ã¯ã€ãã®ã‚ˆã†ãªé–¢æ•°ã‚’`fold_while`ã¨ã—ã¦åˆ¥é€”è¿½åŠ ã—ã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨è¨ˆç®—çµæœã®çµ„ï¼ˆã¨ãªã‚‹æ§‹é€ ä½“ï¼‰ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€åˆæœŸå€¤ã‚’ã¨ã‚‰ãªã„ã‚¿ã‚¤ãƒ—ã®é–¢æ•°ã§ã¯å…¥åŠ›ç¯„å›²ãŒç©ºã®å ´åˆã‚’è€ƒæ…®ã—ã¦`std::optional`ã‚’è¿”ã™ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

- [P2321 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1004)

### [P2340R1 Clarifying the status of the "C headers"](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2340r1.html)

ç¾åœ¨éæ¨å¥¨ã¨ã•ã‚Œã¦ã„ã‚‹Cãƒ˜ãƒƒãƒ€ã‚’ç›¸äº’é‹ç”¨ã®ç›®çš„ã§ä½¿ç”¨å¯èƒ½ãªã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2340R0 Clarifying the status of the â€˜C headersâ€™ - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/04/10/222356#P2340R0-Clarifying-the-status-of-the-C-headers)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€ææ¡ˆã™ã‚‹æ–‡è¨€ã®ä¿®æ­£ãŒãƒ¡ã‚¤ãƒ³ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã™ã§ã«LWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµ‚ãˆã¦ãŠã‚Šã€æ¬¡ã®å…¨ä½“ä¼šè­°ã§æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã‚‹ã“ã¨ãŒæ±ºå®šã—ã¦ã„ã¾ã™ã€‚

- [P2340 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1019)

### [P2347R0 Argument type deduction for non-trailing parameter packs](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2347r0.pdf)

é–¢æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å®Ÿå¼•æ•°å‹æ¨è«–æ™‚ã«ã€å¼•æ•°ãƒªã‚¹ãƒˆæœ«å°¾ã«ãªã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ‘ãƒƒã‚¯ã®å‹ã‚’æ¨è«–ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ã“ã®ææ¡ˆã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã¯[`source_location`](https://cpprefjp.github.io/reference/source_location/source_location.html)ã®ä½¿ã„å‹æ‰‹ã‚’æ”¹å–„ã•ã›ã‚‹ã“ã¨ã«ã‚ã‚Šã¾ã™ã€‚

ä¾‹ãˆã°ã€å¤šãã®å··ã®ãƒ­ã‚°é–¢æ•°ã¯ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã¨ãƒ­ã‚°å‡ºåŠ›ã—ãŸã„ã‚‚ã®ã‚’å—ã‘ã¦ã€æ¬¡ã®ã‚ˆã†ãªå½¢å¼ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚

```cpp
void log(string_view formatString, auto&&...args);
```

C++20ä»¥é™ã€ã“ã‚Œã‚’è‡ªç„¶ã«æ‹¡å¼µã—ã¦`source_location`ã‚’å–ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€æ¬¡ã®ã‚ˆã†ã«æ›¸ããŸããªã‚Šã¾ã™ã€‚

```cpp
void log(string_view formatString, auto&&...args, source_location loc = source_location::current());
```

ã—ã‹ã—ã€ç¾åœ¨ã®C++ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ‘ãƒƒã‚¯ãŒã‚ã‚‹å ´åˆã¯å¼•æ•°ãƒªã‚¹ãƒˆã®æœ«å°¾ã«ãªã‘ã‚Œã°ãªã‚‰ãšã€ãã†ã§ãªã„å ´åˆãƒ‘ãƒƒã‚¯ã®å‹ã‚’æ¨è«–ã§ããªã„ãŸã‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

ã“ã‚Œä»¥å¤–ã®æ‰€ã§ã‚‚ã€æ¬¡ã®ã‚ˆã†ãªãƒ¡ãƒªãƒƒãƒˆãŒæƒ³å®šã§ãã¾ã™

- `ragens::transform`ã‚„`ranges::marge`ã«Nå€‹ã®`range`ã‚’å—ã‘å–ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ã€æ—¢å­˜ã®1or2å€‹ã®`range`ã‚’å—ã‘å–ã‚‹ã‚‚ã®ã¨å¼•æ•°ã®é †åºã‚’ä¸€è‡´ã•ã›ã‚‰ã‚Œã‚‹
- [`std::visit`](https://cpprefjp.github.io/reference/variant/visit.html)ã«ãŠã„ã¦ã€ä»»æ„å€‹æ•°ã®`variant`ã‚’å—ã‘å–ã‚‹ã®ãŒå¼•æ•°ã®å…ˆé ­ã§ã‚ã‚‹ãªã‚‰ã°ã€ã‚ˆã‚Šç›´æ„Ÿçš„ã«ä½¿ç”¨ã§ãã‚‹

ãªã©ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ‘ãƒƒã‚¯ã‚’ç½®ã‘ã‚‹ä½ç½®ã®åˆ¶é™ã‚’å–ã‚Šæ‰•ã†ã¨ã€APIã®è¨­è¨ˆã¨ä½¿ç”¨ã®æŸ”è»Ÿæ€§å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã“ã®ã‚ˆã†ãªåˆ¶é™ã‚’æ’¤å»ƒã—ã€é–¢æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ‘ãƒƒã‚¯ãŒ1ã¤ï¼ˆ1ã¤ã ã‘ï¼‰ã‚ã‚‹å ´åˆã«ãã®ãƒ‘ãƒƒã‚¯ã®è¦ç´ æ•°ã¯ã€æ¨è«–ã•ã‚Œã¦ã„ãªã„é–¢æ•°å¼•æ•°ã®æ•°ã‹ã‚‰ãƒ‘ãƒƒã‚¯ã‚ˆã‚Šå¾Œã‚ã«ã‚ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã‚’æŒãŸãªã„å¼•æ•°ã®æ•°ã‚’å¼•ã„ãŸã‚‚ã®ã€ã¨æ¨è«–ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```cpp
void f(auto a, auto...b, auto c, auto d);
void g(auto a, auto...b, auto c, int d = 0);
void h(auto a, auto...b, int c = 0);

f(0, 0, 0, 0);    // bã®ã‚µã‚¤ã‚ºã¯1ã¨æ¨è«–
f(0, 0, 0, 0, 0); // bã®ã‚µã‚¤ã‚ºã¯2ã¨æ¨è«–
f(0, 0, 0);       // bã®ã‚µã‚¤ã‚ºã¯0ã¨æ¨è«–
g(0, 0);          // bã®ã‚µã‚¤ã‚ºã¯0ã¨æ¨è«–
g(0, 0, 0, 0);    // bã®ã‚µã‚¤ã‚ºã¯2ã¨æ¨è«–
h(0, 0);          // bã®ã‚µã‚¤ã‚ºã¯1ã¨æ¨è«–
h(0, 0, 0);       // bã®ã‚µã‚¤ã‚ºã¯2ã¨æ¨è«–
```

ã“ã®ææ¡ˆã«ã‚ˆã‚‹ã“ã®ã‚ˆã†ãªæ¨è«–è¦å‰‡ã®å¤‰æ›´ã¯ç´”ç²‹ã«åˆ¶é™ã®è§£é™¤ã§ã‚ã£ã¦ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã‚„é–¢æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®åŠé †åºã‚’å¤‰æ›´ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®æ¨è«–ã¯ç´”ç²‹ã«å®Ÿå¼•æ•°ã¨ä»®å¼•æ•°ã®æ•°ã ã‘ã‚’ä½¿ã£ã¦è¡Œã‚ã‚Œã¾ã™ã€‚

ã“ã®ææ¡ˆã®å•é¡Œç‚¹ã¯æ˜ã‚‰ã‹ã«ã€ãƒ‘ãƒƒã‚¯ã®å¾Œã«ã‚ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã‚’æŒã¤å¼•æ•°ã«å¯¾ã—ã¦å€¤ã‚’æä¾›ã§ããªã„ã“ã¨ã§ã™ãŒã€ãã“ã‚’ä½•ã¨ã‹ã—ã‚ˆã†ã¨ã—ã¦å¾—ã‚‰ã‚Œã‚‹ãƒ¡ãƒªãƒƒãƒˆã¯ãã‚Œã«ã‚ˆã£ã¦å°å…¥ã•ã‚Œã‚‹ãƒ‡ãƒ¡ãƒªãƒƒãƒˆï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚é–“ã®å¢—å¤§ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¼•æ•°æ¨è«–ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã®å¢ƒç•ŒãŒæ›–æ˜§ã«ãªã‚‹ï¼‰ã‚’ä¸‹å›ã‚‹ã‚ˆã†ã§ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã‚’æŒã¤å¼•æ•°ã«å€¤ã‚’æä¾›ã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç°¡æ˜“ãªã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```cpp
template <typename... T>
void f(T&&... args, source_location loc = {}) requires (!(std::same_as<T, source_location>||...));

void f(auto&&... args, source_location loc);
```

- [C++ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ‘ãƒƒã‚¯åŸºç¤&ãƒ‘ãƒƒã‚¯å±•é–‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ - Qita](https://qiita.com/_EnumHack/items/677363eec054d70b298d)
- [P2347 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1055)

### [P2361R1 Unevaluated string literals](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2361r1.pdf)

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã®ã¿ä½¿ç”¨ã•ã‚Œã€å®Ÿè¡Œæ™‚ã¾ã§æ®‹ã‚‰ãªã„æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã«ã¤ã„ã¦ã®æ‰±ã„ã‚’æ˜ç¢ºåŒ–ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2361R0 Unevaluated string literals - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P2361R0-Unevaluated-string-literals)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€å®Ÿè£…å¯èƒ½æ€§ã¨ä»¥å‰ã®åŒã˜ç›®çš„ã®ä½œæ¥­ã«ã¤ã„ã¦è¿½è¨˜ã—ãŸäº‹ã§ã™ã€‚

- [P2361 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1035)

### [P2368R1 2021 Spring Library Evolution Polls](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2368r1.html)

2021å¹´ã®æ˜¥ï¼ˆ4æœˆã‹ã‚‰6æœˆã«ã‹ã‘ã¦ï¼‰ã«äºˆå®šã•ã‚Œã¦ã„ã‚‹ã€LEWGã§ã®å…¨ä½“æŠ•ç¥¨ã®äºˆå®šè¡¨ã€‚

ä»¥ä¸‹ã®9ã¤ã®ææ¡ˆãŒæŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã‚‹äºˆå®šã§ã™ã€‚

- [P0323R10 `std::expected`](https://wg21.link/p0323r10)
- [P2325R2  Views should not be required to be default constructible](https://wg21.link/p2325r2)
- [P2328R0 `join_view` should join all views of ranges](https://wg21.link/p2328r0)
- [P2210R2 Superior String Splitting](https://wg21.link/p2210r2)
- [P2321R1 zip](https://wg21.link/p2321r1)
- [P2251R1 Require span & basic_string_view to be Trivially Copyable](https://wg21.link/p2251r1)
- [P1072R7 `basic_string::resize_and_overwrite`](https://wg21.link/p1072r7)
- [P2340R0 Clarifying the status of the â€˜C headersâ€™](https://wg21.link/p2340r0)
- [P2301R0 Add a pmr alias for `std::stacktrace`](https://wg21.link/p2301r0)

åŸºæœ¬çš„ã«ã¯LEWGã§ã®ä½œæ¥­ã‚’å®Œäº†ã—ã¦LWGã¸è»¢é€ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®æŠ•ç¥¨ã§ã™ã€‚

### [P2370R0 Stacktrace from exception](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2370r0.html)

ç¾åœ¨æŠ•ã’ã‚‰ã‚Œã¦ã„ã‚‹ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«åŸºã¥ãã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ã«ã€ä¸€ã¤ã®`try`ãƒ–ãƒ­ãƒƒã‚¯ã§è¤‡æ•°ã®ä¾‹å¤–ã‚’æŠ•ã’ã†ã‚‹é–¢æ•°ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã¨å¯¾å¿œã™ã‚‹`catch`ãƒ–ãƒ­ãƒƒã‚¯ã§ã¯ã©ã“ã§ä¾‹å¤–ãŒæŠ•ã’ã‚‰ã‚ŒãŸã®ã‹é€šå¸¸ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚

```cpp
#include <iostream>
#include <stdexcept>
#include <string_view>

// ä¾‹å¤–ã‚’æŠ•ã’ã†ã‚‹é–¢æ•°
void foo(std::string_view key);
void bar(std::string_view key);

int main() {
  try {
    // ã©ã¡ã‚‰ã‹ãŒä¾‹å¤–ã‚’æŠ•ã’ãŸã¨ã™ã‚‹ã¨
    foo("test1");
    bar("test2");
  } catch (const std::exception& exc) {
    std::cerr << "Caught exception: " << exc.what() << '\n';
    // å‡ºåŠ›ä¾‹
    // Caught exception: map::at
  }
}
```

C++23ã‚ˆã‚Šã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å°å…¥ã•ã‚Œã¦ã„ã¾ã™ãŒã€ç¾åœ¨ä½ç½®ã«å¯¾å¿œã™ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å–å¾—ã™ã‚‹ã“ã¨ã¯ã§ãã¦ã‚‚ã€ä¾‹å¤–ã«å¿œã˜ãŸã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã¯ã€ãã‚ŒãŒã§ãã‚‹ã‚ˆã†ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’`std::basic_stacktrace`ã«è¿½åŠ ã—ã¦ã€ç¾åœ¨ã®ä¾‹å¤–ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

```cpp
#include <iostream>
#include <stdexcept>
#include <string_view>
#include <stacktrace>   // <---

void foo(std::string_view key);
void bar(std::string_view key);

int main() {
  try {
    foo("test1");
    bar("test2");
  } catch (const std::exception& exc) {
    std::stacktrace trace = std::stacktrace::from_current_exception();  // <---
    std::cerr << "Caught exception: " << exc.what() << ", trace:\n" << trace;
    // å‡ºåŠ›ä¾‹
    // Caught exception: map::at, trace:
    //  0# get_data_from_config(std::string_view) at /home/axolm/basic.cpp:600
    //  1# bar(std::string_view) at /home/axolm/basic.cpp:6
    //  2# main at /home/axolm/basic.cpp:17
  }
}
```

`std::basic_stacktrace`ï¼ˆ`std::stacktrace`ï¼‰ã®é™çš„ãƒ¡ãƒ³ãƒé–¢æ•°ã¨ã—ã¦`from_current_exception()`ã‚’è¿½åŠ ã—ã€ãã‚Œã«ã‚ˆã£ã¦ç¾åœ¨æŠ•ã’ã‚‰ã‚Œã¦ã„ã‚‹ä¾‹å¤–ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚å¾Œã®æ‰±ã„ã¯é€šå¸¸ã®ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã¨å¤‰ã‚ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€ãƒ‡ãƒãƒƒã‚¬ã‚’èµ·å‹•ã›ãšã¨ã‚‚ã©ã“ã§è½ã¡ãŸã‹ãŒã‚ã‹ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€åˆ¥ã®ä¾‹ã¨ã—ã¦ã€`terminate()`ãŒå‘¼ã°ã‚ŒãŸéš›ã«ã©ã“ã§å‘¼ã°ã‚ŒãŸã®ã‹ã®è¨ºæ–­ã‚’å®¹æ˜“ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```cpp
void broken_function() noexcept {
  std::unordered_map<std::string, int> m;
  [[maybe_unused]] auto value = m.at("non-existing-key");
}

int main() {
  std::set_terminate([] {
    auto trace = std::stacktrace::from_current_exception();
    if (trace) {
        std::cerr << "Terminate was called with an active exception:\n"
                  << trace << std::endl;
    }
  });

  broken_function();
}
```

ç‰¹ã«ã€æ„å›³ã›ãšèª¤ã£ã¦å®Ÿè£…ã•ã‚ŒãŸ`noexcept`é–¢æ•°ã§ä¾‹å¤–ãŒæŠ•ã’ã‚‰ã‚ŒãŸæ™‚ãªã©ã€ä¸€è¦‹ã©ã“ã§æŠ•ã’ã‚‰ã‚Œã¦ã„ã‚‹ã‹ç™ºè¦‹ã™ã‚‹ã“ã¨ãŒé›£ã—ã„å ´åˆã§ã‚‚ã€ãƒ‡ãƒãƒƒã‚¬ãƒ¬ã‚¹ã§ãã‚Œã‚’çŸ¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®å¤‰æ›´ã¯ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ä»•è¾¼ã‚€å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ABIç ´å£Šã‚’ã›ã­ã°é”æˆã§ããªã„ã‚ˆã†ã«æ€ã‚ã‚Œã¾ã™ãŒã€ã©ã†ã‚„ã‚‰ABIã®å¤‰æ›´ã‚’ã›ãšã¨ã‚‚å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚ãã‚Œã‚’ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«[libsfe](https://github.com/axolm/libsfe)ãŒã‚ã‚Šã¾ã™ã€‚

ãŸã ã—ã€ã“ã®å¤‰æ›´ã«ã‚ˆã£ã¦ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚µã‚¤ã‚ºã¯å¢—å¤§ã™ã‚‹ãŸã‚ã€ä¾‹å¤–ç™ºç”Ÿæ™‚ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¢—å¤§ã—ã¾ã™ã€‚ãã®ãŸã‚ã€ã“ã‚Œã‚’ä½¿ç”¨ã™ã‚‹/ã—ãªã„ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«`capture_stacktraces_at_throw(bool enable = true);`ã¨ã„ã†é–¢æ•°ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [`<stacktrace>` - cpprefjp](https://cpprefjp.github.io/reference/stacktrace.html)
- [P2370 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1056)

### [P2380R1 reference_wrapper Associations](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2380r1.pdf)

Networking TSã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€`associated_allocator`ã¨`associated_executor`ã«å¯¾ã—ã¦ã€`reference_wrapper<T>`ã®ç‰¹æ®ŠåŒ–ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2380R0 reference_wrapper Associations - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/06/13/165215#P2380R0-reference_wrapper-Associations)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€`associated_allocator`ã¨`associated_executor`ã‚’æŒ‡å®šã™ã‚‹éš›ã®èª¤ã‚Šã‚’ä¿®æ­£ã—ãŸäº‹ã€`associated_allocator`ã¨`associated_executor`ã®`type`ãƒ¡ãƒ³ãƒã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹`associated_allocator_t, associated_executor_t`ã‚’è¿½åŠ ã—ãŸäº‹ãªã©ã§ã™ã€‚

- [P2380 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1049)

### [P2384R0 2021 Spring Library Evolution Poll Outcomes](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2384r0.html)

2021å¹´ã®æ˜¥ï¼ˆ4æœˆã‹ã‚‰6æœˆã«ã‹ã‘ã¦ï¼‰ã«è¡Œã‚ã‚ŒãŸã€LEWGã®å…¨ä½“æŠ•ç¥¨ã®çµæœã€‚

ä»¥ä¸‹ã®9ã¤ã®ææ¡ˆãŒæŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã€ã©ã‚Œã‚‚LWGã«è»¢é€ã•ã‚Œã‚‹ã“ã¨ãŒå¯æ±ºã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸã€ãã®éš›ã«å¯„ã›ã‚‰ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P0323R10 `std::expected`](https://wg21.link/p0323r10)
- [P2325R2  Views should not be required to be default constructible](https://wg21.link/p2325r2)
- [P2328R0 `join_view` should join all views of ranges](https://wg21.link/p2328r0)
- [P2210R2 Superior String Splitting](https://wg21.link/p2210r2)
- [P2321R1 zip](https://wg21.link/p2321r1)
- [P2251R1 Require span & basic_string_view to be Trivially Copyable](https://wg21.link/p2251r1)
- [P1072R7 `basic_string::resize_and_overwrite`](https://wg21.link/p1072r7)
- [P2340R0 Clarifying the status of the â€˜C headersâ€™](https://wg21.link/p2340r0)
- [P2301R0 Add a pmr alias for `std::stacktrace`](https://wg21.link/p2301r0)

### [P2385R0 C++ Standard Library Issues to be moved in Virtual Plenary, June 2021](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2385r0.html)

6æœˆã®ä¼šè­°ã§æ¡æŠã•ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®Issueè§£æ±ºã®ä¸€è¦§ã€‚

è§£æ±ºã•ã‚ŒãŸIssueã¯36ä»¶ã§ã™ã€‚

1.  [2774. `std::function` construction vs assignment](https://cplusplus.github.io/LWG/lwg-defects.html#2774)
2.  [2818. "::std::" everywhere rule needs tweaking](https://cplusplus.github.io/LWG/lwg-defects.html#2818)
3.  [2997. LWG 491 and the specification of {forward_,}list::unique](https://cplusplus.github.io/LWG/lwg-defects.html#2997)
4.  [3410. `lexicographical_compare_three_way` is overspecified](https://cplusplus.github.io/LWG/lwg-defects.html#3410)
5.  [3430. `std::fstream &` co. should be constructible from `string_view`](https://cplusplus.github.io/LWG/lwg-defects.html#3430)
6.  [3462. Â§[formatter.requirements]: Formatter requirements forbid use of `fc.arg()`](https://cplusplus.github.io/LWG/lwg-defects.html#3462)
7.  [3481. `viewable_range` mishandles lvalue move-only views](https://cplusplus.github.io/LWG/lwg-defects.html#3481)
8.  [3506. Missing allocator-extended constructors for `priority_queue`](https://cplusplus.github.io/LWG/lwg-defects.html#3506)
9.  [3517. `join_view::iterator`'s iter_swap is underconstrained](https://cplusplus.github.io/LWG/lwg-defects.html#3517)
10. [3518. Exception requirements on char trait operations unclear](https://cplusplus.github.io/LWG/lwg-defects.html#3518)
11. [3519. Incomplete synopses for `<random>` classes](https://cplusplus.github.io/LWG/lwg-defects.html#3519)
12. [3520. `iter_move` and `iter_swap` are inconsistent for `transform_view::iterator`](https://cplusplus.github.io/LWG/lwg-defects.html#3520)
13. [3521. Overly strict requirements on `qsort` and `bsearch`](https://cplusplus.github.io/LWG/lwg-defects.html#3521)
14. [3522. Missing requirement on InputIterator template parameter for `priority_queue` constructors](https://cplusplus.github.io/LWG/lwg-defects.html#3522)
15. [3523. `iota_view::sentinel` is not always `iota_view`'s sentinel](https://cplusplus.github.io/LWG/lwg-defects.html#3523)
16. [3526. Return types of `uses_allocator_construction_args` unspecified](https://cplusplus.github.io/LWG/lwg-defects.html#3526)
17. [3527. `uses_allocator_construction_args` handles rvalue pairs of rvalue references incorrectly](https://cplusplus.github.io/LWG/lwg-defects.html#3527)
18. [3528. `make_from_tuple` can perform (the equivalent of) a C-style cast](https://cplusplus.github.io/LWG/lwg-defects.html#3528)
19. [3529. `priority_queue(first, last)` should construct `c` with `(first, last)`](https://cplusplus.github.io/LWG/lwg-defects.html#3529)
20. [3530. `BUILTIN-PTR-MEOW` should not opt the type out of syntactic checks](https://cplusplus.github.io/LWG/lwg-defects.html#3530)
21. [3532. `split_view<V, P>::inner-iterator<true>::operator++(int)` should depend on `Base`](https://cplusplus.github.io/LWG/lwg-defects.html#3532)
22. [3533. Make `base() const &` consistent across iterator wrappers that supports `input_iterators`](https://cplusplus.github.io/LWG/lwg-defects.html#3533)
23. [3536. Should `chrono::from_stream()` assign zero to duration for failure?](https://cplusplus.github.io/LWG/lwg-defects.html#3536)
24. [3539. `format_to` must not copy models of `output_iterator<const charT&>`](https://cplusplus.github.io/LWG/lwg-defects.html#3539)
25. [3540. Â§[format.arg] There should be no const in `basic_format_arg(const T* p)`](https://cplusplus.github.io/LWG/lwg-defects.html#3540)
26. [3541. `indirectly_readable_traits` should be SFINAE-friendly for all types](https://cplusplus.github.io/LWG/lwg-defects.html#3541)
27. [3542. `basic_format_arg` mis-handles `basic_string_view` with custom traits](https://cplusplus.github.io/LWG/lwg-defects.html#3542)
28. [3543. Definition of when counted_iterators refer to the same sequence isn't quite right](https://cplusplus.github.io/LWG/lwg-defects.html#3543)
29. [3544. `format-arg-store::args` is unintentionally not exposition-only](https://cplusplus.github.io/LWG/lwg-defects.html#3544)
30. [3546. `common_iterator`'s postfix-proxy is not quite right](https://cplusplus.github.io/LWG/lwg-defects.html#3546)
31. [3548. `shared_ptr` construction from unique_ptr should move (not copy) the deleter](https://cplusplus.github.io/LWG/lwg-defects.html#3548)
32. [3549. `view_interface` is overspecified to derive from `view_base`](https://cplusplus.github.io/LWG/lwg-defects.html#3549)
33. [3551. `borrowed_{iterator,subrange}_t` are overspecified](https://cplusplus.github.io/LWG/lwg-defects.html#3551)
34. [3552. Parallel specialized memory algorithms should require forward iterators](https://cplusplus.github.io/LWG/lwg-defects.html#3552)
35. [3553. Useless constraint in `split_view::outer-iterator::value_type::begin()`](https://cplusplus.github.io/LWG/lwg-defects.html#3553)
36. [3555. `{transform,elements}_view::iterator::iterator_concept` should consider const-qualification of the underlying range](https://cplusplus.github.io/LWG/lwg-defects.html#3555)

### [P2386R0 Core Language Working Group "ready" Issues for the June, 2021 meeting](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2386r0.html)

6æœˆã®ä¼šè­°ã§æ¡æŠã•ã‚ŒãŸã‚³ã‚¢è¨€èªã®Issueè§£æ±ºã®ä¸€è¦§ã€‚

è§£æ±ºã•ã‚ŒãŸIssueã¯9ä»¶ã§ã™ã€‚

1. [2397. auto specifier for pointers and references to arrays](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#2397)
      - é…åˆ—ã®ãƒã‚¤ãƒ³ã‚¿/å‚ç…§ã®å®£è¨€ã«ãŠã„ã¦ã€`auto`ã«ã‚ˆã‚‹æ¨è«–ãŒåŠ¹ãã‚ˆã†ã«ã—ãŸã€‚
      ```cpp
      int a[3];
      auto (*p)[3] = &a;  // OKã€ä¸€éƒ¨ã®å®Ÿè£…ã§ã¯å®Ÿè£…æ¸ˆ
      auto (&r)[3] = &a;  // OKã€ä¸€éƒ¨ã®å®Ÿè£…ã§ã¯å®Ÿè£…æ¸ˆ
      ```
2. [2448. Cv-qualification of arithmetic types and deprecation of volatile](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#2448)
      - ç®—è¡“å‹ï¼ˆ*arithmetic types*ï¼‰ã¨ã„ã†ç”¨èªãŒã€æ•´æ•°å‹ã‚„æµ®å‹•å°æ•°ç‚¹æ•°å‹ã®CVä¿®é£¾ã‚‚å«ã‚€ã‚ˆã†ã«ã—ãŸã€‚
      - ä»¥å‰ã¯å«ã‚“ã§ã„ãªã‹ã£ãŸãŸã‚ã€çŸ›ç›¾ãŒç”Ÿã˜ã¦ã„ãŸã€‚
3. [2458. Value category of expressions denoting non-static member functions](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#2458)
      - éé™çš„ãƒ¡ãƒ³ãƒé–¢æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹å¼ã®çµæœï¼ˆ`&X::f`ï¼‰ãŒå·¦è¾ºå€¤ã¨ãªã‚‹ã‚ˆã†ã«ã—ãŸã€‚
      - ä»¥å‰ã¯å³è¾ºå€¤ã¨ã•ã‚Œã¦ã„ãŸã€‚
4. [2465. Coroutine parameters passed to a promise constructor](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#2465)
      - ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«æ¸¡ã•ã‚ŒãŸå¼•æ•°ã‚’ã‚³ãƒ«ãƒ¼ãƒãƒ³å†…éƒ¨ãŠã‚ˆã³Promiseå‹ã®åˆæœŸåŒ–ã§ä½¿ã†éš›ã€ã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ˜ç¢ºåŒ–ã—ãŸ
      - ä»¥å‰ã‹ã‚‰ãªã£ã¦ã„ãŸãŒã€Promiseå‹ã®åˆæœŸåŒ–ã«ã¤ã„ã¦ã‚«ãƒãƒ¼ã—ãã‚Œã¦ã„ãªã‹ã£ãŸã®ã‚’ä¿®æ­£
5. [2466. co_await should be a single evaluation](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#2466)
      - `co_await`ã®å‘¼ã³å‡ºã—ã‚’ä¸¦ã¹æ›¿ãˆãŸã‚Šçœç•¥ã—ãŸã‚Šã™ã‚‹ã“ã¨ã‚’ç¦æ­¢ã—ãŸã€‚
      - ä¸€ã¤ã®`co_await`å¼ã¯æ­£ç¢ºã«ä¸€åº¦è©•ä¾¡ã•ã‚Œã‚‹
6. [2474. Cv-qualification and deletion](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#2474)
      - `delete`å¼ã«ãŠã„ã¦ã€ãã®é™çš„å‹ã¨å‹•çš„å‹ãŒ*similar*ã®é–¢ä¿‚ã§ã‚ã‚Œã°æœªå®šç¾©å‹•ä½œã‚’èµ·ã“ã•ãªããªã£ãŸ
      - ä»¥å‰ã®è¨˜è¿°ã§ã¯ã€CVä¿®é£¾ã®é•ã„ã‚‚æœªå®šç¾©ã¨ãªã£ã¦ã„ãŸã€‚
7. [2477. Defaulted vs deleted copy constructors/assignment operators](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#2477)
      - ã‚³ãƒ”ãƒ¼/ãƒ ãƒ¼ãƒ–ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒ`default`å®šç¾©ã•ã‚Œã‚‹æ™‚ã¨ã€`delete`å®šç¾©ã•ã‚Œã‚‹æ™‚ã®è¦å®šã®çŸ›ç›¾ã®è§£æ¶ˆ
8. [2479. Missing specifications for consteval and constinit](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#2479)
      - `consteval/constinit`ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã€è¨€åŠã•ã‚Œã‚‹ã¹ãæ‰€ã§è¨€åŠã•ã‚Œã¦ã„ãªã‹ã£ãŸã®ã‚’æ­£ã—ãŸ
9.  [2481. Cv-qualification of temporary to which a reference is bound](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#2481)
      - ã‚³ãƒ”ãƒ¼çœç•¥ã®ãŸã‚ã®*temporary materialization conversion*ã«ä¼´ã£ã¦ã€æ„å›³ã›ãšCVä¿®é£¾ãŒè½ã¨ã•ã‚Œã¦ã„ãŸã®ã‚’ä¿®æ­£

### [P2387R0 Pipe support for user-defined range adaptors](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2387r0.html)

ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®Rangeã‚¢ãƒ€ãƒ—ã‚¿ã«å¯¾ã—ã¦ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­ï¼ˆ`|`ï¼‰ã‚µãƒãƒ¼ãƒˆã‚’ç°¡å˜ã«è¡Œãˆã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’æä¾›ã™ã‚‹ææ¡ˆã€‚

æ¨™æº–ã®Rangeã‚¢ãƒ€ãƒ—ã‚¿ã¯é–¢æ•°å‘¼ã³å‡ºã—ã«ã‚ˆã£ã¦ã‚‚ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­ã«ã‚ˆã£ã¦ã‚‚å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã€ãã®äºŒã¤ã®å‘¼ã³å‡ºã—ã¯å…¥åŠ›ã¨ãªã‚‹`range`ã®å—ã‘å–ã‚Šæ–¹ä»¥å¤–ã¯åŒã˜åŠ¹æœã¨ãªã‚‹ã“ã¨ãŒè¦å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

```cpp
// R, R1, R2ã‚’ä»»æ„ã®Rangeã‚¢ãƒ€ãƒ—ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã™ã‚‹

// å…¥åŠ›ã®range(viewable_range)
viewable_range auto vr = views::iota(1);

// ã“ã®2ã¤ã®å‘¼ã³å‡ºã—ã¯åŒã˜åŠ¹æœã¨ãªã‚‹
view auto v1 = R(vr);
view auto v2 = vr | R ;

// Rangeã‚¢ãƒ€ãƒ—ã‚¿ãŒå¢—ãˆãŸæ™‚ã§ã‚‚åŒæ§˜ï¼ˆä»¥ä¸‹3ã¤ã¯åŒã˜åŠ¹æœï¼‰
// é©ç”¨é †ã¯å³çµåˆ
view auto v3 = R2(R1(vr));
view auto v4 = vr | R1 | R2;
view auto v5 = vr | (R1 | R2);
```

ã“ã‚Œã‚‰ã®`R, R1, R2`ã®ã‚ˆã†ãªã€1å¼•æ•°ã®Rangeã‚¢ãƒ€ãƒ—ã‚¿ã®ã“ã¨ã‚’*range adaptor closure object*ã¨å‘¼ã³ã¾ã™ã€‚

Rangeã‚¢ãƒ€ãƒ—ã‚¿ã¯ã•ã‚‰ã«è¿½åŠ ã®å¼•æ•°ã‚’ã¨ã‚‹ã“ã¨ãŒã§ãã€ãã®æ™‚ã§ã‚‚å…ˆã»ã©ã®ä¾‹ã¨åŒæ§˜ã®ä¿è¨¼ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æ™‚ã€è¿½åŠ ã®å¼•æ•°ã ã‘ã‚’å…ˆã«å—ã‘å–ã£ã¦å‘¼ã³å‡ºã™ã“ã¨ã‚‚ã§ãï¼ˆ`range`ã‚’å—ã‘å–ã‚‰ãªã„ã§å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãï¼‰ã€ãã®çµæœã¯*range adaptor closure object*ã¨ãªã‚Šã¾ã™ã€‚

```cpp
// Rangeã‚¢ãƒ€ãƒ—ã‚¿ãŒè¿½åŠ ã®å¼•æ•°ã‚’å–ã‚‹ã¨ãã‚‚åŒæ§˜ã«æ›¸ãäº‹ãŒã§ãã‚‹
// ãã®æ™‚ã§ã‚‚ã€ã“ã®3ã¤ã¯åŒã˜åŠ¹æœã¨ãªã‚‹
view auto v6 = R(vr, args...);
view auto v7 = R(args...)(vr);
view auto v8 = vr | R(args...)
```

*range adaptor closure object*ã¨ã“ã‚Œã‚‰è¿½åŠ ã®å¼•æ•°ã‚’å—ã‘å–ã‚‹ã‚‚ã®ã‚’åˆã‚ã›ã¦ã€*range adaptor object*ã¨å‘¼ã³ã¾ã™ã€‚*range adaptor object*ã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚Šã€1å¼•æ•°ã—ã‹å–ã‚‰ãªã„å ´åˆã¯*range adaptor closure object*ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ä¿è¨¼ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ç”¨ã™ã‚‹æ™‚ã‚’è€ƒãˆã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦ã¯ä¾¿åˆ©ãªã‚‚ã®ã§ã™ãŒã€å®Ÿéš›ã«å®Ÿè£…ã—ã‚ˆã†ã¨ã™ã‚‹ã¨å¤§å¤‰ã§ã™ã€‚ç‰¹ã«ã€*range adaptor closure object*ãŒå³çµåˆã™ã‚‹æ‰€ï¼ˆ`R1 | R2`ãŒ*range adaptor closure object*ã‚’è¿”ã™ï¼‰ã¨ã‹ã€è¿½åŠ ã®å¼•æ•°ã‚’ã¨ã‚‹*range adaptor object*ã«è¿½åŠ ã®å¼•æ•°ã ã‘ã‚’æ¸¡ã—ã¦ã‚‚*range adaptor closure object*ã‚’è¿”ã•ã­ã°ãªã‚‰ãªã„æ‰€ãªã©ãŒå„ä»‹ã§ã™ã€‚

å®Ÿéš›ã«ã¯ã“ã‚Œã‚‰ã®ã“ã¨ã¯*range adaptor object*å…¨ã¦ã«å…±é€šã—ã¦ã„ã‚‹ãŸã‚ã€å®Ÿè£…ã®å¤§éƒ¨åˆ†ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Range-v3ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹æ—¢å­˜å®Ÿè£…ã‚„GCC/MSVCãªã©ã®æ¨™æº–å®Ÿè£…ã¯ã€å¤šå°‘ã®å·®ã¯ã‚ã‚Œã©å†…éƒ¨ã§ãã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ãã®ã‚ˆã†ãªå…±é€šå®Ÿè£…ã®ä»•çµ„ã¿ã‚’æ¨™æº–åŒ–ã—ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æä¾›ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã•ã‚ŒãŸRangeã‚¢ãƒ€ãƒ—ã‚¿ã«å¯¾ã—ã¦ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚µãƒãƒ¼ãƒˆã¨ãã‚Œã«çºã‚ã‚‹ä¿è¨¼ã‚’ç°¡æ˜“ã«å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

å•é¡Œã¯ã€*range adaptor closure object*ã‚’å®Ÿè£…ã™ã‚‹éƒ¨åˆ†ã¨*range adaptor object*ï¼ˆã‹ã‚‰*range adaptor closure object*ã‚’é™¤ã„ãŸéƒ¨åˆ†ï¼‰ã‚’å®Ÿè£…ã™ã‚‹éƒ¨åˆ†ã®2ã¤ã«åˆ†å‰²ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

*range adaptor closure object*ã®å®Ÿè£…ã§ã¯ã€`range`ã‚’å—ã‘å–ã£ãŸæ™‚ã®é–¢æ•°å‘¼ã³å‡ºã—ã¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­é©ç”¨ãŒåŒã˜åŠ¹æœã«ãªã‚Šã€ã‹ã¤*range adaptor closure object*ã‚’å—ã‘å–ã£ãŸæ™‚ã«ã€ãã‚Œã¨è‡ªèº«ã‚’å†…åŒ…ã—ãŸ*range adaptor closure object*ã¨ãªã‚‹ãƒ—ãƒ­ã‚¯ã‚·ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

æ®‹ã‚Šã®*range adaptor object*ã®å®Ÿè£…ã§ã¯ã€è¿½åŠ ã®å¼•æ•°ã ã‘ã‚’å—ã‘å–ã£ãŸæ™‚ã«ãã‚Œã‚‰å¼•æ•°ã¨è‡ªèº«ã‚’ãƒ©ãƒƒãƒ—ã—ãŸ*range adaptor closure object*ã¨ãªã‚‹ãƒ—ãƒ­ã‚¯ã‚·ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã€ãã‚Œã«å¯¾ã—ã¦é–¢æ•°å‘¼ã³å‡ºã—ã§`range`ã‚’æ¸¡ã—ãŸæ™‚ã¨ã€æœ€åˆã«`range`ã¨è¿½åŠ ã®å¼•æ•°ã‚’ã¾ã¨ã‚ã¦å—ã‘å–ã£ãŸæ™‚ã§åŒã˜åŠ¹æœã¨ãªã‚‹ã‚ˆã†ã«ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã§ã¯ã¾ãšã€*range adaptor closure object*ã®å®Ÿè£…ã®ãŸã‚ã«`std::ranges::range_adaptor_closure<T>`ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¾ã™ã€‚ã“ã‚Œã¯CRTPã«ã‚ˆã£ã¦åˆ©ç”¨ã—ã€*range adaptor closure object*å‹ã¯ã“ã‚Œã‚’ç¶™æ‰¿ã™ã‚‹ã“ã¨ã§ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­ã‚µãƒãƒ¼ãƒˆã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆé–¢æ•°å‘¼ã³å‡ºã—æ¼”ç®—å­ã¯å®Ÿè£…ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

```cpp
namespace std::ranges {
  template<class D>
    requires is_class_v<D> && same_as<D, remove_cv_t<D>>
  class range_adaptor_closure { 

    // R | C == C(R) ã®ã‚µãƒãƒ¼ãƒˆ
    template <typename Range>
      requires /**/
    friend constexpr auto operator|(Range&& r, D& self) {
      return self(std::forward(r)); // Dã®é–¢æ•°å‘¼ã³å‡ºã—æ¼”ç®—å­ã‚’ä½¿ã£ã¦å®Ÿè£…
    }
    
    // C | D ã§range adaptor closure objectã‚’ç”Ÿæˆã™ã‚‹ã‚µãƒãƒ¼ãƒˆ
    template <typename Lhs, typename Rhs>
        requires /**/
    constexpr auto operator|(Lhs lhs, Rhs rhs) {
      // range adaptor closure objectãƒ©ãƒƒãƒ‘ã§åŒ…ã‚“ã§è¿”ã™
      return raco_proxy<Lhs, Rhs>(std::move(lhs), std::move(rhs));
    }
  };
}
```

ä¾‹ãˆã°ã“ã‚“ãªæ„Ÿã˜ã®å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚

æ¬¡ã«ã€*range adaptor object*ã®å®Ÿè£…ã®ãŸã‚ã«`std::bind_back()`ã‚’ç”¨æ„ã—ã¾ã™ã€‚`std::bind_back(f, ys...)(xs...)`ã®ã‚ˆã†ãªå‘¼ã³å‡ºã—ã¯ã€`f(xs..., ys...)`ã¨ç­‰ä¾¡ã«ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã‚‰ã‚’ä½¿ç”¨ã—ã¦ã€è‡ªå‰ã®Rangeã‚¢ãƒ€ãƒ—ã‚¿ã‚’ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ã«å®Ÿè£…ã§ãã¾ã™ã€‚

```cpp
namespace myns {

  // ã‚ªãƒ¬ã‚ªãƒ¬join_View
  template<std::ranges::view V>
  class join_view;

  // ã‚ªãƒ¬ã‚ªãƒ¬transform_View
  template<std::ranges::view V, typename F>
  class transform_view;

  // ã‚ªãƒ¬ã‚ªãƒ¬join_Viewã«å¯¾ã™ã‚‹range adaptor closure object
  struct join_closure : std::ranges::range_adaptor_closure<join_closure> {

    template<std::ranges::viewable_range R>
    constexpr auto operator()(R&& r) const {
      return join_view{std::forward<R>(r)};
    }
  };

  // ã‚ªãƒ¬ã‚ªãƒ¬transform_Viewã«å¯¾ã™ã‚‹range adaptor object
  struct transform_adopter : std::ranges::range_adaptor_closure<transform_adopter> {

    template<std::ranges::viewable_range R, typename F>
      requires std::invocble<F&, std::ranges::range_reference_t<R>>
    constexpr auto operator()(R&& r, F&& f) const {
      return transform_view{std::forward<R>(r), std::forward<F>(f)};
    }

    template<typename F>
    constexpr auto operator()(F&& f) const {
      return std::bind_back(*this, std::forward<F>(f));
    }
  };

  // range adaptor objectå®šç¾©
  namespace views {
    inline constexpr join_closure join{};

    inline constexpr transform_adopter transform{};
  }
}
```

ã“ã®ææ¡ˆã§ã¯ã€*range adaptor object*ã®å®Ÿè£…ã‚’ç°¡æ˜“åŒ–ã™ã‚‹ãŸã‚ã«æœ€å¤§é™ã®ã“ã¨ã‚’ã—ã¦ã„ã¾ã›ã‚“ã€‚ä¾‹ãˆã°ã€åˆ¥ã®ãƒ©ãƒƒãƒ‘å‹ã‚’ç”¨æ„ã—ã¦ã•ã‚‰ã«ç°¡æ˜“åŒ–ã™ã‚‹ã“ã¨ã¯ã§ãã‚‹ã¯ãšã§ã™ã€‚ã“ã‚Œã¯å°†æ¥çš„ã«è¨€èªæ©Ÿèƒ½ã‚„ä»–ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã£ã¦è§£æ±ºã§ãã‚‹ã¯ãšãªã®ã§ã“ã“ã§å°å…¥ã—ã¦ã‚‚å°†æ¥çš„ã«ä¸è¦ã¨ãªã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã€ã¨ã„ã†åˆ¤æ–­ã®ã‚ˆã†ã§ã™ã€‚

- [P2387 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1060)

### [P2388R0 Abort-only contract support](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2388r0.html)

å¥‘ç´„ãŒç ´ã‚‰ã‚ŒãŸæ™‚ã§ã‚‚ç¶™ç¶šã—ãªã„ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

C++20ã«å°å…¥ãŒæ±ºå®šã—ã¦ã„ãŸå¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ï¼ˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆï¼‰ã‚µãƒãƒ¼ãƒˆã¯ã€æ§˜ã€…ãªå•é¡ŒãŒã‚ã£ãŸãŸã‚å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ãã®å¾Œã€å•é¡Œç‚¹ã‚’æ•´ç†ã—æ©Ÿèƒ½ã‚’çµã£ãŸ[MVP (P2182R1)](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/p2182r1.html)ã¨å‘¼ã°ã‚Œã‚‹éƒ¨åˆ†ã‚’å…ˆã‚“ã˜ã¦å°å…¥ã™ã‚‹äº‹ãŒææ¡ˆã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

ç¾åœ¨ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚µãƒãƒ¼ãƒˆã®è­°è«–ã®æ–¹å‘æ€§ã¯ã€è«–äº‰ã‚’å¼•ãèµ·ã“ã—ã¦ã„ã‚‹éƒ¨åˆ†ã®å¤šãã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®2æ¬¡çš„ãªæ©Ÿèƒ½ã®éƒ¨åˆ†ã§ã‚ã‚Šã€ãã®ã‚ˆã†ãªéƒ¨åˆ†ãŒ1æ¬¡çš„ãªæ©Ÿèƒ½ã§ã‚ã‚‹ã€Œãƒ—ãƒ­ã‚°ãƒ©ãƒãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚°ã¨æ€ã‚ã‚Œã‚‹ã‚‚ã®ã‚’ä¼ãˆã‚‹æ©Ÿèƒ½ã€ã®è¿½åŠ ã‚’å¦¨ã’ãŸã‚Šå¦¨ã’ã‚‰ã‚Œã‚‹äº‹ãŒãªã„ã‚ˆã†ã«ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®æœ€å°ã®æ©Ÿèƒ½ã‚»ãƒƒãƒˆã‹ã‚‰å°å…¥ã‚’å§‹ã‚ã¦ã„ã“ã†ã¨ã—ã¦ã„ã¾ã™ã€‚

ãŸã ã€ãã‚Œã‚’é¸åˆ¥ã—ãŸã¯ãšã®P2182R1ã®éƒ¨åˆ†ã•ãˆè«–äº‰ã‚’å¼•ãèµ·ã“ã—åˆæ„ãŒå–ã‚Œãªã‹ã£ãŸã‚ˆã†ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã€P2182R1ã‹ã‚‰ã•ã‚‰ã«æ©Ÿèƒ½ã‚’çµã‚Šè¾¼ã¿ã€å¥‘ç´„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æœ€å°ã®æ©Ÿèƒ½ã‚’æ—©æœŸã«C++ã«å°å…¥ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã™ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆãŒå°å…¥ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹æ©Ÿèƒ½ã¯æ¬¡ã®ã‚‚ã®ã§ã™ã€‚

1. `[[pre: condition]]`ã«ã‚ˆã‚‹äº‹å‰æ¡ä»¶
2. `[[post: condition]]`ã«ã‚ˆã‚‹äº‹å¾Œæ¡ä»¶
3. `[[assert: condition]]`ã«ã‚ˆã‚‹é–¢æ•°å†…ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
4. 2ã¤ã®ãƒ¢ãƒ¼ãƒ‰
   - å…¨ç„¡è¦– : ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯å¥‘ç´„ã®å¼ã®æœ‰åŠ¹æ€§ã ã‘ã‚’æ¤œè¨¼ã—ã€å®Ÿè¡Œæ™‚ã«å½±éŸ¿ã‚’ä¸ãˆãªã„
   - å®Ÿè¡Œæ™‚ãƒã‚§ãƒƒã‚¯ã¨ã‚¢ãƒœãƒ¼ãƒˆ : å…¨ã¦ã®å¥‘ç´„ã‚’å®Ÿè¡Œæ™‚ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã€‚é•åã—ãŸå ´åˆå¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ãŒå‘¼ã³å‡ºã•ã‚Œã€ãã®å¾Œ`std::abort()`ã™ã‚‹
   - ã“ã‚Œã‚‰ã‚’ç¿»è¨³å˜ä½ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆã‚‹å®Ÿè£…ãŒè¨±å¯ã•ã‚Œã‚‹

ã“ã®ææ¡ˆã«ã¯ä»¥å‰ã«ã‚ã£ãŸã€*assertion level*ã‚„*continuation mode*ã€å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒ©ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãªã©ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆã“ã‚Œã‚‰ãŒã¾ã•ã«ç‰©è­°ã‚’é†¸ã—ã¦ã„ãŸéƒ¨åˆ†ã§ã™ï¼‰ã€‚

ææ¡ˆæ–‡æ›¸ã‚ˆã‚Šã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã€‚

```cpp
int select(int i, int j)   // æœ€åˆã®å®£è¨€
  [[pre: i >= 0]]
  [[pre: j >= 0]]
  [[post r: r >= 0]];      // `r`ã¯æˆ»ã‚Šå€¤
  
int select(int i, int j);  // å†å®£è¨€ã§ã¯ã€åŒã˜å¥‘ç´„ã‚’æŒ‡å®šã™ã‚‹ã‹ã€ä½•ã‚‚æŒ‡å®šã—ãªã„
                          
int select(int i, int j)   // å®šç¾©
{
  [[assert: _state >= 0]];
  
  if (_state == 0) return i;
  else             return j;
} 
```

- [å¥‘ç´„ã«åŸºã¥ããƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° - cpprefjp](https://cpprefjp.github.io/lang/cpp23/contract-based_programming.html)
- [P2182R1 Contract Support: Defining the Minimum Viable Feature Set](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/p2182r1.html)
- [P2388 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1061)

### [P2391R0 C23 Update Report](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2391r0.pdf)

C23ã®å¤‰æ›´ç‚¹ï¼ˆã¨ä»Šå¾Œæ¡æŠã•ã‚Œã†ã‚‹å¤‰æ›´ï¼‰ã‚’ã¾ã¨ã‚ãŸæ–‡ç« ã€‚

SG22ãŒè¨­ç«‹ã•ã‚Œã‚‹ãªã©ã€Cã¨C++ã®ç›¸äº’äº’æ›æ€§ã«ã¯WG21ã¨WG14åŒæ–¹ãŒæ³¨æ„ã‚’æ‰•ã£ã¦ãŠã‚Šã€ãã‚Œã‚’å—ã‘ã¦C23ã®å¤‰æ›´ç‚¹ã‚’WG21ã§å‘¨çŸ¥ã™ã‚‹ãŸã‚ã®ææ¡ˆã§ã™ã€‚

C23ã®å¤‰æ›´ç‚¹ãŒã‚ã‹ã‚Šã‚„ã™ãã¾ã¨ã¾ã£ã¦ã„ã‚‹ã®ã§ã€C23ã«èˆˆå‘³ã®ã‚ã‚‹äººã¯è¦—ã„ã¦ã¿ã‚‹ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### [P2392R0 Pattern matching using â€œisâ€ and â€œasâ€](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2392r0.pdf)

ç¾åœ¨ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã€ä½¿ç”¨å¯èƒ½ãªæ‰€ã‚’åºƒã’ã‚‹ææ¡ˆã€‚

ã“ã®ææ¡ˆã¯[P1371R3](https://wg21.link/p1371r3)ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ç¾åœ¨ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°æ§‹æ–‡ãŒå±€æ‰€çš„ãªè¨€èªã‚µãƒ–ã‚»ãƒƒãƒˆã«ãªã‚‰ãªã„ã‚ˆã†ã«`is`ã€`as`ã¨`[]`ã‚’ç”¨ã„ãŸæ§‹æ–‡ã¸ã®å¤‰æ›´ã¨ãã‚Œã‚’ä»–ã®ã¨ã“ã‚ï¼ˆ`if`ã‚„`requires`ãªã©ï¼‰ã§ã‚‚ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

```cpp
constexpr bool even (auto const& x) { return x%2 == 0; } // given this example predicate

// xã¯ä½•ã§ã‚‚ã„ã„
void f(auto const& x) {
  inspect (x) {
    i as int             => std::cout << "int " << i;
    is std::integral     => std::cout << "non-int integral " << x;
    [a, b] is [int, int] => std::cout << "2-int tuple " << a << " " << b;
    [_, y] is [0, even]  => std::cout << "point on x-axis and even y" << y;
    s as string          => std::cout << "string \"" + s + "\"";
    is _                 => std::cout << "((no matching value))";
  }
}
```

`inspect`å¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã¨ã“ã‚ãªã©åŸºæœ¬çš„ãªã¨ã“ã‚ã«å¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€å‹ã«å¯¾ã™ã‚‹ãƒãƒƒãƒãƒ³ã‚°ã‚’`is, as`ã‚’ç”¨ã„ã¦ç›´æ„Ÿçš„ã«æ›¸ãäº‹ãŒã§ãã‚‹ä»–ã€`[]`ã‚’ç”¨ã„ã¦æ§‹é€ åŒ–æŸç¸›ã«ã‚ˆã‚‹åˆ†è§£ã¨ãƒãƒƒãƒãƒ³ã‚°ã‚’åŒæ™‚ã«è¡Œã†äº‹ãŒã§ãã¾ã™ã€‚`_`ã¯ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¡¨ã—ã¾ã™ã€‚

- `x is C` : å‹ã‚„å€¤ã‚’å•ã‚ãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¡¨ç¾ã«ä½¿ç”¨ã§ãã‚‹æ§‹æ–‡ã€‚`C`ã¯ç‰¹å®šã®å‹ã‚„å€¤ã€å‹ã®è¿°èªï¼ˆã‚³ãƒ³ã‚»ãƒ—ãƒˆï¼‰ã‚„å€¤ã®è¿°èªã‚’ä½¿ç”¨å¯èƒ½ã€‚
- `x as T` : `T`ã¸ã®ã‚­ãƒ£ã‚¹ãƒˆå¯èƒ½ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¡¨ç¾ã«ä½¿ç”¨ã§ãã‚‹æ§‹æ–‡ã€‚`T`ã¯ç‰¹å®šã®å‹ã‹å‹ã®è¿°èªã®ã„ãšã‚Œã‹ã€‚

ãã—ã¦ã€ã“ã®`is, as`ã«ã‚ˆã‚‹ãƒãƒƒãƒãƒ³ã‚°æ§‹æ–‡ã¯`inspect`å¼ã®å¤–å´ã§ã‚‚ä½¿ç”¨å¯èƒ½ã¨ã•ã‚Œã¾ã™ã€‚

```cpp
void f(auto const& x) {
  if (auto i as int = x)                  { std::cout<<"int"<<x;}
  else if (x is std::integral)            { std::cout << "non-int integral " << x; }
  else if (auto [a, b] is [int, int] = x) { std::cout << "2-int tuple " << a << " " << b; }
  else if (auto [_, y] is [0, even] = x)  { std::cout << "point on x-axis and even y " << y; }
  else if (auto s as string = x)          { std::cout<<"string\""+s+"\"";}
  else                                    { std::cout << "((no matching value))"; }
}
```

ã‚ã‚‹ã„ã¯`requires`å¼ï¼ˆç¯€ï¼‰

```cpp
void g(auto const& x) requires requires{x as int;}
                      { std::cout << "int " << x; }

void g(auto const& x) requires (x is std::integral)
                      { std::cout << "non-int integral " << x; }

void g(auto const& x) requires (x is [int, int])
                      { auto [a, b] = x; std::cout << "2-int tuple " << a << " " << b; }

void g(auto const& x) requires (x is [0, even])
                      { auto [_, y] = x; std::cout << "point on x-axis and even y " << y;

void g(auto const& x) requires requires{x as string;}
                      { auto s = x as string; std::cout << "string \"" + s + "\""; }

void g(auto const& x) { std::cout << "((no matching value))"; }
```

å¤‰æ•°å®£è¨€

```cpp
std::pair<int, std::pair<int,int>> data;

// åˆ†è§£ã¨ãƒãƒƒãƒãƒ³ã‚°
auto [a, [_, c]] = data;
if (data is [_, [1, _]] ) {...}

// ä¸Šè¨˜ã®è¤‡åˆæ§‹æ–‡
if (auto&& [a, [_, c]] is [_, [1, _]] = data) {...}
// is ã«ã‚ˆã‚‹ãƒãƒƒãƒãŒtrueã¨ãªã‚Œã°ã€ifã«ã‚ˆã‚‹åˆ¤å®šã‚‚trueã¨ãªã‚‹


// C++20ã®å¤‰æ•°å®£è¨€
int a  = f();
std::integral auto b = g();

// isã‚’ç”¨ã„ãŸå¤‰æ•°å®£è¨€
auto a is int = f();  // f()ã®æˆ»ã‚Šå€¤å‹ãŒintã§ã‚ã‚‹æ™‚æœ‰åŠ¹
auto b is std::integral = g();


std::variant<std::pair<int,int>, std::string> v;

// vãŒ1ã¤ç›®ã®è¦ç´ ï¼ˆstd::pair<int,int>ï¼‰ã‚’æœ‰ã—ã¦ã„ã‚‹å ´åˆã«ã‚­ãƒ£ã‚¹ãƒˆå¯èƒ½
// ãã†ã§ãªã„å ´åˆã€å®Ÿè¡Œæ™‚ä¾‹å¤–
auto&& [a, b] as std::pair<int,int> = v;
// ã‚‚ã†ç‰‡å´
auto&& s as std::string = v;

if (auto&& [a, b] as pair<int,int> = v) {...}
// as ã«ã‚ˆã‚‹ãƒãƒƒãƒãŒtrueã¨ãªã‚Œã°ã€ifã«ã‚ˆã‚‹åˆ¤å®šã‚‚true

// isã‚’ç”¨ã„ãŸå¤‰æ•°å®£è¨€
auto a as int = f();  // f()ã®æˆ»ã‚Šå€¤å‹ãŒintã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹æ™‚æœ‰åŠ¹

// ã“ã†ã‹ãã¨
auto [a, b] = v as std::pair<int,int>;
// ã“ã‚Œã¨ç­‰ä¾¡
auto [a, b] = std::get<0>(v);
```

ã“ã®ææ¡ˆã§ã¯ã€ã“ã®ã‚ˆã†ãªãƒã‚¹ãƒˆã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³æŒ‡å®šã‚’å¯èƒ½ã«ã—æ§‹é€ åŒ–æŸç¸›ã¨ä¸€è²«ã•ã›ã‚‹ãŸã‚ã«ã€åŒæ§˜ã®æ§‹æ–‡ã‚’æ§‹é€ åŒ–æŸç¸›ã«ãŠã„ã¦ã‚‚è¨±å¯ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

ã“ã®`is`ã¨`as`ã¯æ¼”ç®—å­ã§ã‚‚ã‚ã‚Šã€ä»»æ„ã®ã‚¯ãƒ©ã‚¹å‹ã«å¯¾ã—ã¦æ¼”ç®—å­ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ãã®å‹•ä½œã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹äº‹ãŒã§ãã¾ã™ã€‚

```cpp
// std::variantã§ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ä¾‹

template<typename... Ts>
constexpr auto operator is(std::variant<Ts...> const& x ) {
  return x.index();
}

template<size_t I, typename... Ts>
constexpr auto operator as(std::variant<Ts...> const& x ) -> auto&& {
  return std::get<I>( x );
}
```

ã“ã‚Œã‚‰ã®`is`ã¨`as`ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«äºˆç´„ã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ã¯ãªãæ–‡è„ˆä¾å­˜ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ã™ã€‚

ç­†è€…ã®æ–¹ã¯æ—¢å­˜ã®æ–‡æ³•ãªã©ã‚’èª¿æŸ»ã—ãŸä¸Šã§ã“ã‚Œã‚‰ã®æ§‹æ–‡ã‚’ææ¡ˆã—ã¦ã„ã‚‹ãŸã‚ã€å®Ÿç¾å¯èƒ½æ€§ã¯é«˜ãã†ã§ã™ã€‚

- [P1371R3 Pattern Matching](https://wg21.link/p1371r3)
- [P2392 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1064)

### [P2393R0 Cleaning up integer-class types](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2393r0.html)

æ•´æ•°å‹ã¨ã¿ãªã›ã‚‹å‹ã‚’æŒ‡ã™`integer-class`ã®å®šç¾©ã‚’ä¿®æ­£ã™ã‚‹ææ¡ˆã€‚

`integer-class`å‹ã¯æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿/rangeã®æ–‡è„ˆã§æ•´æ•°å‹ã¨ã—ã¦ä½¿ç”¨å¯èƒ½ãªå‹ã‚’æŒ‡ã™ã‚‚ã®ã§ã™ãŒã€ãã®è¦å®šã«ã¯ã¾ã ã„ãã¤ã‹ã®å•é¡ŒãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

- `zip_view, join_view`ãªã©2ã¤ã®`range`ã‚’åˆæˆã™ã‚‹ã‚¿ã‚¤ãƒ—ã®`difference_type`ã¯ã€2ã¤ã®`range`ã®`difference_type`ã®`common_type`ã«ã‚ˆã£ã¦æ±ºå®šã•ã‚Œã‚‹ã€`integer-class`å‹åŒå£«ã¯`common_type`ã‚’æŒã¤ã“ã¨ã‚’è¦æ±‚ã•ã‚Œã¦ã„ãªã„ã€‚
- `integer-class`å‹åŒå£«ã¯ç›¸äº’ã«å¤‰æ›å¯èƒ½ã§ã¯ãªãã€æ¯”è¼ƒå¯èƒ½ã§ã‚‚ãªã„ã€‚
    - `ranges::equal`ãªã©ã€2ã¤ã®`range`ã‹ã‚‰å–å¾—ã—ãŸè·é›¢ã‚’æ¯”è¼ƒã™ã‚‹å¿…è¦ãŒã‚ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã§ããªã„
- `integer-class`å‹ã®è¡¨ç¾å¯èƒ½ãªå€¤ã®ç¯„å›²ã€ãŠã‚ˆã³æ•´æ•°å‹ã¸ã®/ã‹ã‚‰ã®å¤‰æ›ã¯å®šç¾©ã•ã‚Œã¦ã„ãªã„
- `<ranges>/<iterator>/<algorithm>`ã®å¤šãã®æ‰€ã§ã¯`random_access_iterator`ã®æ“ä½œãŒ`difference_type`ã§ã®ã¿å‹•ä½œã™ã‚‹ã‚ˆã†ã«è¦å®šã•ã‚Œã¦ãŠã‚Šã€`integer-class`å‹ã‚’è€ƒæ…®ã—ã¦ã„ãªã„
    - ãã®ã‚ˆã†ãªã¨ã“ã‚ã§ã¯ã€`ranges::range_difference_t/iter_difference_t`ãŒä½¿ç”¨ã•ã‚Œã‚‹ãŸã‚ã«ã€`integer-class`å‹ã‹ã‚‰ãã‚Œã‚‰ã®æ•´æ•°å‹ã¸ã®å¤‰æ›ãŒå¿…è¦ã«ãªã‚‹ï¼ˆãŒãã‚Œã¯å®šç¾©ã•ã‚Œã¦ã„ãªã„ï¼‰ã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã‚Œã‚‰ã®å•é¡Œã®è§£æ±ºã‚’å›³ã‚‹ã‚‚ã®ã§ã™ã€‚

- `integer-class`ã¯2ã®è£œæ•°ã§ã‚ã‚Šã©ã®çµ„ã¿è¾¼ã¿å‹ã‚ˆã‚Šã‚‚è¡¨ç¾å¯èƒ½ãªå€¤ã®å¹…ãŒåºƒã„ã€ã¨è¦å®š
- `integer-class`ã¯éã‚¯ãƒ©ã‚¹å‹ã¨ãªã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹
- 2ã¤ã®`integer-class`å‹ã®é–“ã«ã¯å¸¸ã«`common_type`ãŒã‚‹ã“ã¨ã‚’è¦å®šã—ã€å…ƒã®`integer-class`ãŒä¸¡æ–¹ã¨ã‚‚ç¬¦å·ä»˜æ•´æ•°å‹ã®å ´åˆã¯ãã®`common_type`ã‚‚ã¾ãŸç¬¦å·ä»˜ã¨ãªã‚‹ã“ã¨ã‚’è¦å®š
- `integer-class`å‹ã¯åŒã˜ç¬¦å·æ€§ã‚’æŒã¡ã‚ˆã‚Šå¤§ããªå¹…ã®`integer-class`å‹ã«æš—é»™å¤‰æ›å¯èƒ½ã§ã‚ã‚Šã€å…¨ã¦ã®`integer-class`å‹ã«æ˜ç¤ºçš„å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’è¦å®šã™ã‚‹
- ä¸€æ–¹ãŒä»–æ–¹ã«æš—é»™å¤‰æ›å¯èƒ½ãª`integer-class`å‹ã®é–“ã§ã®äºŒé …æ¼”ç®—ã‚’è¨±å¯ã™ã‚‹ã€‚

ã“ã‚Œã‚‰ã®ã“ã¨ã‚’ãƒ™ãƒ¼ã‚¹ã«`<ranges>/<algorithm>`ã®è¦å®šã«å¤‰æ›´ã‚’åŠ ãˆã€`difference_type`ã¨`integer-class`å‹ãŒç›¸äº’ã«å¤‰æ›ã—ã¤ã¤è‡ªç„¶ã«ä½¿ç”¨å¯èƒ½ã§ã‚ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®å¤‰æ›´ã«ã‚ˆã£ã¦ã€å•é¡Œã®è§£æ±ºã‚’å›³ã‚Šã¾ã™ã€‚

- [LWG Issue 3366. Narrowing conversions between integer and integer-class types](https://wg21.link/lwg3366)
- [LWG Issue 3376. "integer-like class type" is too restrictive](https://wg21.link/lwg3376)
- [`is-integer-like` - cpprefjp](https://cpprefjp.github.io/reference/iterator/is_integer_like.html)
- [P2393 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1065)

### [P2395R0 WG21 2021-06 Virtual Meeting Record of Discussion](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2395r0.pdf)

6æœˆã®å…¨ä½“ä¼šè­°ã®è­°äº‹éŒ²ã€‚

æŠ•ç¥¨ã®éš›ã«ã©ã®ã‚ˆã†ãªæ„è¦‹ã‚’ã ã‚ŒãŒç™ºè¨€ã—ãŸã‹ãªã©ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P2396R0 Concurrency TS 2 fixes](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2396r0.pdf)

COncurrency TSv2ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ã„ãã¤ã‹ã®ææ¡ˆã«ã¤ã„ã¦ã€æœ¬é¡Œã¨é–¢ä¿‚ã®è–„ã„å¾®ä¿®æ­£ã®ææ¡ˆã€‚

- é…ç½®ã™ã‚‹ãƒ˜ãƒƒãƒ€ã®å¤‰æ›´
    - ç‰¹ã«ã€[P1202R3 Asymmetric Fences](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p1202r3.pdf)ã«ã¤ã„ã¦ã€`<experimental/asymmetric_fence>`ã«é…ç½®ã™ã‚‹ã“ã¨ã‚’ææ¡ˆ
- æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒã‚¯ãƒ­ã®è¿½åŠ 

ã„ãšã‚Œã‚‚ã¾ã experimentalãªã‚‚ã®ã§ã™ã€‚

- [P2396 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1067)

### [P2397R0 SG16: Unicode meeting summaries 2021-04-14 through 2021-05-26](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2397r0.html)

SG16(*Unicode and text study group*)ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è­°äº‹éŒ²ã€‚

ã©ã®ã‚ˆã†ãªè­°è«–ã«ãŠã„ã¦ã ã‚ŒãŒã©ã‚“ãªç™ºè¨€ã‚’ã—ãŸã‹ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P2400R1 Library Evolution Report: 2021-02-23 to 2021-05-25](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2400r1.html)

2021å¹´2æœˆå¾ŒåŠã‹ã‚‰5æœˆå¾ŒåŠã«ã‹ã‘ã¦ã®ã€LEWGã§ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã¤ã„ã¦ã®ã¾ã¨ã‚ã€‚

ã©ã‚Œãã‚‰ã„ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã£ãŸã®ã‹ã€ãŠãŠã¾ã‹ãªæ©Ÿèƒ½å˜ä½ã«ã¤ã„ã¦ã®é€²è¡ŒçŠ¶æ³ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã£ãŸææ¡ˆã«ã¤ã„ã¦ã®è­°è«–ã®æ–½è¡ŒçŠ¶æ³ãªã©ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚