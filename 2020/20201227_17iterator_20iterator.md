# ï¼»C++ï¼½ C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ <=> C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ != 0

ã“ã‚Œã¯[C++ Advent Calendar 2020](https://qiita.com/advent-calendar/2020/cxx)ã®24æ—¥ã‚ã®è¨˜äº‹ã§ã™ï¼ˆå¤§é…åˆ»ã§ã™ã€ã™ã„ã¾ã›ã‚“ï¼‰ã€‚

[å‰å›](https://onihusube.hatenablog.com/entry/2020/12/14/002822)ã¨[å‰ã€…å›](https://onihusube.hatenablog.com/entry/2020/12/11/000123)ã§C++20ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯ä¸€å‘³ã‚‚äºŒå‘³ã‚‚é•ã†ãœï¼ã¨ã„ã†äº‹ã‚’èªã£ãŸã‚ã‘ã§ã™ãŒã€å…·ä½“çš„ã«ã©ã†é•ã†ã®ã‹ã‚’è¦‹ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

[:contents]

ä»¥ä¸‹ã€ç‰¹ã«æ–­ã‚ŠãŒç„¡ã‘ã‚Œã°`I`ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿å‹ã€`i`ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã ã¨æ€ã£ã¦ãã ã•ã„ã€‚

### iterator

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::input_or_output_iterator`](https://cpprefjp.github.io/reference/iterator/input_or_output_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17Iterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/Iterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17

ã¾ãšã€æ¬¡ã®è¦ä»¶ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™

- `iterator_Â­traits<I>`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå­˜åœ¨ã™ã‚‹
- ã‚³ãƒ”ãƒ¼æ§‹ç¯‰å¯èƒ½
- ã‚³ãƒ”ãƒ¼ä»£å…¥å¯èƒ½
- ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ãƒˆå¯èƒ½
- *lvalue*ã«ã¤ã„ã¦ã€ã‚¹ãƒ¯ãƒƒãƒ—å¯èƒ½
- `iterator_Â­traits<I>â€‹::â€‹difference_Â­type`ã¯ç¬¦å·ä»˜ãæ•´æ•°å‹ã‚‚ã—ãã¯`void`

ã“ã‚Œã‚‰ã®ï½å¯èƒ½ã¨ã„ã†ã®ã¯ãã‚Œã¯ãã‚Œã§ä¸€ã¤ã®åå‰ä»˜ãè¦ä»¶ã«ãªã£ã¦ã„ã‚‹ã®ã§ã™ãŒã“ã“ã§ã¯æ·±å €ã—ã¾ã›ã‚“ã€‚ãŠãã‚‰ãè¨€è‘‰ã‹ã‚‰åˆ†ã‹ã‚‹ã®ã¨ãã†ç•°ãªã‚‹æ„å‘³ã§ã¯ãªã„ã¯ãšã§ã™ã€‚

ãã—ã¦ã€æ¬¡ã®å¼ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¾ã™

|å¼|æˆ»ã‚Šå€¤|
|---|---|
|`*i`|æœªè¦å®š|
|`++i`|`I&`|

é–“æ¥å‚ç…§ã¨å‰ç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹é€²è¡ŒãŒå¯èƒ½ã§ã‚ã‚Œã€ã¨ã„ã†äº‹ã§ã™ã€‚

#### C++20

C++20ã¯è¨€è‘‰ã§é•·ã€…èªã£ãŸã‚Šã—ã¾ã›ã‚“ã€‚ã‚³ãƒ³ã‚»ãƒ—ãƒˆã§èªã‚Šã¾ã™ã€‚

```cpp
template<class I>
concept input_or_output_iterator =
  requires(I i) {
    { *i } -> can-reference;
  } &&
  weakly_incrementable<I>;
```

`can-reference`ã¯æˆ»ã‚Šå€¤å‹ãŒ`void`ã§ã¯ãªã„äº‹ã‚’è¡¨ã™ã‚³ãƒ³ã‚»ãƒ—ãƒˆã§ã™ã€‚  
ã“ã“ã§ç›´æ¥è¦‹ã‚‹ã“ã¨ã®å‡ºæ¥ã‚‹ã®ã¯é–“æ¥å‚ç…§ã®è¦æ±‚ã§ã™ã€‚ã“ã‚Œã¯C++17ã®è¦æ±‚ã¨åŒã˜ã“ã¨ã‚’æ„å‘³ã—ã¦ã„ã¾ã™ã€‚

`std::weakly_incrementable`ã¯`++`ã«ã‚ˆã£ã¦ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆå¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’è¡¨ã™ã‚³ãƒ³ã‚»ãƒ—ãƒˆã§ã™ã€‚

```cpp
template<class I>
concept weakly_incrementable =
  default_initializable<I> && movable<I> &&
  requires(I i) {
    typename iter_difference_t<I>;
    requires is-signed-integer-like<iter_difference_t<I>>;
    { ++i } -> same_as<I&>;
    i++;
  };
```

- [`std::weakly_incrementable` - cpprefjp](https://cpprefjp.github.io/reference/iterator/weakly_incrementable.html)
- [`std::is-integer-like` - cpprefjp](https://cpprefjp.github.io/reference/iterator/is_integer_like.html)

ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’æ·±ã•å„ªå…ˆæ¢ç´¢ã—ã¦ã„ãã¨ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã§è„³å†…ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒã—ã¬ã®ã§é©å®œcpprefjpã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

â€‹`requires`å¼ã®ä¸­ã§ã¯ã€`difference_Â­type`ãŒå–å¾—å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã¨ã€å‰ç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã«å¯¾ã—ã¦ã¯å…ˆã»ã©ã®C++17ã¨åŒã˜ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™ã€‚

å¤§ããç•°ãªã‚‹ç‚¹ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã¨ã€ã‚³ãƒ”ãƒ¼å¯èƒ½ã§ã¯ãªããƒ ãƒ¼ãƒ–å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã§ã™ã€‚ã¾ãŸã€`difference_Â­type`ã¯`void`ãŒèªã‚ã‚‰ã‚Œãªã„ä»£ã‚ã‚Šã«ç¬¦å·ä»˜ãæ•´æ•°å‹ã¨åŒç­‰ãªä»»æ„ã®å‹ãŒè¨±å¯ã•ã‚Œã¦ãŠã‚Šã€å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™ã€‚

C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯`iterator_traits`ã§ä½¿ç”¨å¯èƒ½ã§ã‚ã‚‹äº‹ã‚’è¦æ±‚ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€C++20ã®`iterator_traits`ã¯C++17äº’æ›çª“å£ã¨ã—ã¦ãªã‚“ã¨ã‹ã—ã¦æƒ…å ±ã‚’ã‹ãé›†ã‚ã¦ãã¦ãã‚Œã‚‹ã®ã§ã»ã¼è‡ªå‹•ã§ä½¿ç”¨å¯èƒ½ã¨ãªã‚‹ã¯ãšã§ã™ã€‚ã¾ãŸã€å‰ã€…å›ã«èª¬æ˜ã—ãŸ`iterator_traits`ã«ä»£ã‚ã‚‹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿æƒ…å ±å–å¾—æ‰‹æ®µã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®æ€§è³ªã‹ã‚‰ãã®æƒ…å ±ã‚’å–ã£ã¦ãã‚‹ã®ã§`iterator_traits`ã®ã‚ˆã†ãªã‚‚ã®ã¯ã»ã¼å¿…è¦ãªããªã£ã¦ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€`iterator_traits`ã§ä½¿ç”¨å¯èƒ½ã‹ã©ã†ã‹ã¯å·®ç•°ã¨ã¯ã¿ãªã•ãªã„ã“ã¨ã«ã—ã¾ã™ã€‚


#### å·®ç•°

çµå±€ã€C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®å·®ç•°ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

|è¦æ±‚|C++20|C++17|
|---|---|---|
|ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|
|ãƒ ãƒ¼ãƒ–å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|è¦æ±‚ã•ã‚Œã‚‹|
|ã‚³ãƒ”ãƒ¼å¯èƒ½æ€§|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|`difference_Â­type`|ç¬¦å·ä»˜æ•´æ•°å‹ or ãã‚Œã¨åŒç­‰ãªå‹|ç¬¦å·ä»˜æ•´æ•°å‹ or `void`|
|å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|

ã‚³ãƒ”ãƒ¼å¯èƒ½ -> ãƒ ãƒ¼ãƒ–å¯èƒ½ã§ã™ãŒã€ãƒ ãƒ¼ãƒ–å¯èƒ½ -> ã‚³ãƒ”ãƒ¼å¯èƒ½ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`difference_Â­type`ã‚’é™¤ã„ã¦ã€C++20ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17ã‹ã‚‰åˆ¶ç´„ãŒå³ã—ããªã£ã¦ã„ã¾ã™ã€‚

æ®†ã©ã®è¦ä»¶ãŒå³ã—ããªã£ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã§ã—ã‹ãªã„ã‚‚ã®ã‚’C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦æ‰±ã†ã“ã¨ã¯å‡ºæ¥ã¾ã›ã‚“ãŒã€`difference_Â­type`ã®å·®ç•°ã‚’ç„¡è¦–ã™ã‚Œã°C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦æ‰±ã†ã“ã¨ã¯å‡ºæ¥ãã†ã§ã™ã€‚

`is-integer-like`ãŒæ±‚ã‚ã¦ã„ã‚‹ã‚‚ã®ã¯æ•´æ•°å‹ã¨ã»ã¼åŒæ§˜ã«ãµã‚‹ã¾ã†ã‚¯ãƒ©ã‚¹å‹ã§ã‚ã‚Šã€é€šå¸¸ã®æ¼”ç®—ã‚„çµ„ã¿è¾¼ã¿æ•´æ•°å‹ã¨ã®ç›¸äº’ã®å¤‰æ›ãŒå¯èƒ½ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã™ãªã‚ã¡ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãªã‚³ãƒ¼ãƒ‰ã«ãŠã„ã¦ã¯ä½•ã‹ã‚±ã‚¢ã®å¿…è¦ãªãæ•´æ•°å‹ã¨ã—ã¦å‹•ä½œã™ã‚‹ã‚‚ã®ãªã®ã§ã€ã“ã®`difference_Â­type`ã®å·®ç•°ã¯ã»ã¨ã‚“ã©æ°—ã«ã™ã‚‹å¿…è¦ã¯ç„¡ã„ã§ã—ã‚‡ã†ã€‚

### input iteratorr

å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã¯ä½•ãï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::input_iterator`](https://cpprefjp.github.io/reference/iterator/input_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17InputIterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/InputIterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17

ã¾ãšã€æ¬¡ã®è¦ä»¶ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™

- *Cpp17Iterator*è¦ä»¶ã‚’æº€ãŸã™
- åŒå€¤æ¯”è¼ƒå¯èƒ½

ãã—ã¦ã€æ¬¡ã®å¼ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¾ã™ï¼ˆã“ã“ã§ã¯*Cpp17Iterator*è¦ä»¶ã§è¦æ±‚ã•ã‚Œã¦ã„ãŸã‚‚ã®ã‚’ä¸Šæ›¸ãã™ã‚‹å½¢ã§å«ã‚“ã§ã„ã¾ã™ï¼‰

|å¼|æˆ»ã‚Šå€¤|
|---|---|
|`i1 != i2`|*contextually convertible to* `bool`|
|`*i`|`referencce`ã€è¦ç´ å‹`T`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`i->m`||
|`++i`|`I&`|
|`(void)i++`||
|`*i++`|è¦ç´ å‹`T`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|

`== !=`ã«ã‚ˆã‚‹åŒå€¤æ¯”è¼ƒã¨`->`ã€å¾Œç½®`++`ãŒä½¿ç”¨å¯èƒ½ã§ã‚ã‚‹äº‹ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚

#### C++20

C++20ã¯ã‚³ãƒ³ã‚»ãƒ—ãƒˆã§(ry

```cpp
template<class I>
concept input_iterator =
  input_or_output_iterator<I> &&
  indirectly_readable<I> &&
  requires { typename ITER_CONCEPT(I); } &&
  derived_from<ITER_CONCEPT(I), input_iterator_tag>;
```

`ITER_CONCEPT`ã«ã¤ã„ã¦ã¯å‰å›ã®è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ã€‚è¦ã¯`iterator_category`ã‚’å–å¾—ã—ã¦ãã‚‹ã‚‚ã®ã§ã™ã€‚

`std::indirectly_readable`ã¯å°‘ã—è¤‡é›‘ã§ã™ãŒå®šç¾©ãã®ã‚‚ã®ã¯æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

```cpp
template<class In>
concept indirectly-readable-impl =
  requires(const In in) {
    typename iter_value_t<In>;
    typename iter_reference_t<In>;
    typename iter_rvalue_reference_t<In>;
    { *in } -> same_as<iter_reference_t<In>>;
    { ranges::iter_move(in) } -> same_as<iter_rvalue_reference_t<In>>;
  } &&
  common_reference_with<iter_reference_t<In>&&, iter_value_t<In>&> &&
  common_reference_with<iter_reference_t<In>&&, iter_rvalue_reference_t<In>&&> &&
  common_reference_with<iter_rvalue_reference_t<In>&&, const iter_value_t<In>&>;
```

- [`std::indirectly_readable` - cpprefjp](https://cpprefjp.github.io/reference/iterator/indirectly_readable.html)
- [`std::iter_rvalue_reference_t` - cpprefjp](https://cpprefjp.github.io/reference/iterator/iter_rvalue_reference_t.html)

`iter_value_t`ãªã©ãŒä½¿ç”¨å¯èƒ½ã§ã‚ã‚‹ã¨è¨€ã†ã“ã¨ã¯çª“å£ãŒé•ã†ã ã‘ã§ã€`iterator_traits`ã§å–å¾—å¯èƒ½ã¨è¨€ã†è¦ä»¶ã¨åŒã˜æ„å‘³ã§ã™ã€‚ã¾ãŸã€`std::iter_rvalue_reference_t`ã¯`std::ranges::iter_move`ã‚’ä½¿ç”¨ã—ã¦å³è¾ºå€¤å‚ç…§å‹ã‚’å–å¾—ã—ã¦ãŠã‚Šã€`std::ranges::iter_move`ã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ãœãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã‚‚ä½œç”¨ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã‚Œã‚‰ã¯å·®ç•°ã¨ã¯ã¿ãªã•ãªã„ã“ã¨ã«ã—ã¾ã™ã€‚

é–“æ¥å‚ç…§ã®æˆ»ã‚Šå€¤å‹ã«å¯¾ã™ã‚‹è¦ä»¶ã¯åŒã˜ã§ã™ã€‚å¤§ããé•ã†ã®ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®`reference`ã¨`value_type`ã®é–“ã«*common reference*ãŒè¦æ±‚ã•ã‚Œã¦ã„ã‚‹äº‹ã§ã™ã€‚ã¾ãŸã€å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã«é–¢ã—ã¦ã¯`input_or_output_iterator`ã‹ã‚‰å¼•ãç¶™ã„ã§ã„ã‚‹ã®ã¿ã§ã€C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒæˆ»ã‚Šå€¤å‹ã«è¦æ±‚ãŒã‚ã‚‹ã®ã«å¯¾ã—ã¦C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«ã¯ãã‚ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚

#### å·®ç•°

çµå±€ã€C++20å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®å·®ç•°ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆ*iterator*ã§ã®å·®ç•°ã‚’å«ã‚ã¦ã„ã¾ã™ã€è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã¯å…ˆé ­ã«+ã§è¡¨ç¤ºï¼‰ã€‚

|è¦æ±‚|C++20|C++17|
|---|---|---|
|ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|
|ãƒ ãƒ¼ãƒ–å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|è¦æ±‚ã•ã‚Œã‚‹|
|ã‚³ãƒ”ãƒ¼å¯èƒ½æ€§|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|`difference_Â­type`|ç¬¦å·ä»˜æ•´æ•°å‹ or ãã‚Œã¨åŒç­‰ãªå‹|ç¬¦å·ä»˜æ•´æ•°å‹ or `void`|
|+ `== !=`ã«ã‚ˆã‚‹åŒå€¤æ¯”è¼ƒ|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|+ `->`|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|+ å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã®æˆ»ã‚Šå€¤å‹|ä»»æ„ï¼ˆ`void`ã‚‚å¯ï¼‰|`value_type`ã«å¤‰æ›å¯èƒ½ãªå‹|
|+ `reference`ã¨`value_type`ã¨ã®*common reference*|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|

å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆãŒã§ãã‚‹äº‹ã€ã¨è¨€ã†ç‚¹ã«ãŠã„ã¦ã¯ä¸€è‡´ã—ãŸä»£ã‚ã‚Šã«å·®ç•°ãŒå¢—ãˆã¾ã—ãŸã€‚C++17 -> C++20ã§ç·©å’Œã•ã‚ŒãŸã‚‚ã®ã‚‚ã‚ã‚Œã°å³ã—ããªã£ãŸã‚‚ã®ã‚‚ã‚ã‚Šã€C++20å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®é–“ã«ã¯ç›¸äº’ã«äº’æ›æ€§ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

### ouptut iterator

å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã¯ä¸€ä½“ï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::output_iterator`](https://cpprefjp.github.io/reference/iterator/output_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17OutputIterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/OutputIterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17

ã¾ãšã€æ¬¡ã®è¦ä»¶ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™

- *Cpp17Iterator*è¦ä»¶ã‚’æº€ãŸã™

ãã—ã¦ã€æ¬¡ã®å¼ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¾ã™ï¼ˆã“ã“ã§ã¯*Cpp17Iterator*è¦ä»¶ã§è¦æ±‚ã•ã‚Œã¦ã„ãŸã‚‚ã®ã‚’ä¸Šæ›¸ãã™ã‚‹å½¢ã§å«ã‚“ã§ã„ã¾ã™ï¼‰

|å¼|æˆ»ã‚Šå€¤|
|---|---|
|`*i = o`|çµæœã¯ä½¿ç”¨ã•ã‚Œãªã„|
|`++i`|`I&`|
|`i++`|`const I&`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`*i++ = o`|çµæœã¯ä½¿ç”¨ã•ã‚Œãªã„|

å¾Œã§é–¢ä¿‚ã—ã¦ãã‚‹äº‹ã¨ã—ã¦ã€ã“ã®`i`ã¯å·¦è¾ºå€¤ï¼ˆ`I&`ï¼‰ã§ã™ã€‚

4ã¤å…¨ã¦ã®æ“ä½œã«ãŠã„ã¦ã€ãã‚Œãã‚Œã®æ“ä½œã®å¾Œã§ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿`i`ãŒé–“æ¥å‚ç…§å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã¯è¦æ±‚ã•ã‚Œã¾ã›ã‚“ã€‚

#### C++20

ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã‚ˆã£ã¦æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¾ã™ã€‚

```cpp
template<class I, class T>
concept output_iterator =
  input_or_output_iterator<I> &&
  indirectly_writable<I, T> &&
  requires(I i, T&& t) {
    *i++ = std::forward<T>(t);
  };
```

ã“ã“ã‚’è¦‹ã‚‹ã¶ã‚“ã«ã¯é•ã„ãŒãªã•ãã†ã§ã™ã­ã€‚

`std::indirectly_writable`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¯æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¾ã™

```cpp
template<class Out, class T>
concept indirectly_writable = 
  requires(Out&& o, T&& t) {
    *o = std::forward<T>(t);
    *std::forward<Out>(o) = std::forward<T>(t);
    const_cast<const iter_reference_t<Out>&&>(*o) = std::forward<T>(t);
    const_cast<const iter_reference_t<Out>&&>(*std::forward<Out>(o)) = std::forward<T>(t);
  };
```

- [`std::indirectly_writable` - cpprefjp](https://cpprefjp.github.io/reference/iterator/indirectly_writable.html)

`*i`ã«ã‚ˆã‚‹å‡ºåŠ›ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€åˆ¶ç´„å¼ãŒã‚„ãŸã‚‰è¤‡é›‘ã§ã™ã€‚ä¸Š2ã¤ã¯å·¦è¾ºå€¤ã‹ã‚‰ã§ã‚‚å³è¾ºå€¤ã‹ã‚‰ã§ã‚‚å‡ºåŠ›å¯èƒ½ã§ã‚ã‚‹äº‹ã¨è¨€ã†è¦ä»¶ã§ã—ã‚‡ã†ã€‚C++17ã¾ã§ã¯å³è¾ºå€¤ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‹ã‚‰ã®å‡ºåŠ›ã¯è¦æ±‚ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚  
ä¸‹äºŒã¤ã®`const_cast`ã‚’ã—ã¦ã„ã‚‹åˆ¶ç´„å¼ã¯ã€è¦æ ¼æ›¸ã®è¨€ã«ã‚ˆã‚Œã°é–“æ¥å‚ç…§ãŒ*prvalue*ã‚’è¿”ã™ã‚ˆã†ãªãƒ—ãƒ­ã‚¯ã‚·ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å¼¾ããŸã‚ã«ã‚ã‚‹ã‚‰ã—ã„ã§ã™ã€‚ã‚ˆãã‚ã‹ã‚“ãªã„ãƒ»ãƒ»ãƒ»

ã¾ãŸã€`std::indirectly_writable`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®æ„å‘³è«–çš„ãªåˆ¶ç´„ã«ç›®ã‚’å‘ã‘ã‚‹ã¨ã€å‡ºåŠ›æ“ä½œå¾Œã®å€¤ã®åŒä¸€æ€§ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸãã®ä¸€éƒ¨ã¨ã—ã¦ã€å‡ºåŠ›æ“ä½œã®å¾Œã§`i`ãŒé–“æ¥å‚ç…§å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã¯è¦æ±‚ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

#### å·®ç•°

çµå±€ã€C++20å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®å·®ç•°ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆ*iterator*ã§ã®å·®ç•°ã‚’å«ã‚ã¦ã„ã¾ã™ã€è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã¯å…ˆé ­ã«+ã§è¡¨ç¤ºï¼‰ã€‚

|è¦æ±‚|C++20|C++17|
|---|---|---|
|ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|
|ãƒ ãƒ¼ãƒ–å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|è¦æ±‚ã•ã‚Œã‚‹|
|ã‚³ãƒ”ãƒ¼å¯èƒ½æ€§|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|`difference_Â­type`|ç¬¦å·ä»˜æ•´æ•°å‹ or ãã‚Œã¨åŒç­‰ãªå‹|ç¬¦å·ä»˜æ•´æ•°å‹ or `void`|
|+ å³è¾ºå€¤ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‹ã‚‰ã®å‡ºåŠ›å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|
|+ *prvalue*ã¸ã®å‡ºåŠ›ã®ç¦æ­¢|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|

è¿½åŠ ã•ã‚ŒãŸäºŒã¤ã¯C++17 -> C++20ã§åˆ¶ç´„ãŒå³ã—ããªã£ã¦ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€C++17å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++20å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã—ã¦äº’æ›æ€§ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä¸€æ–¹ã€C++20å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã—ã¦`difference_Â­type`ä»¥å¤–ã®æ‰€ã§ã¯äº’æ›æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ç‰¹ã«ã€C++20å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒ`iterator_traits`ã‚’ä»‹ã—ã¦æ€§è³ªã‚’å–å¾—ã•ã‚Œã‚‹æ™‚ã€ç‰¹ã«ç‰¹æ®ŠåŒ–ãŒãªã‘ã‚Œã°`difference_Â­type`ã¯`void`ã«ãªã‚Šã¾ã™ã€‚ãã®å ´åˆã€C++20å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦å®Œç’§ã«æŒ¯ã‚‹èˆã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ã€å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚ˆã‚Šå¼·ã„C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹`iterator_traits`ã‹ã‚‰ã®å•ã„åˆã‚ã›ã«å¯¾ã—ã¦å¸¸ã«*output iterator*ã¨ã—ã¦å¿œç­”ã™ã‚‹ã“ã¨ã§å¾Œæ–¹äº’æ›æ€§ã‚’ç¢ºä¿ã™ã‚‹ã€ã¨è¨€ã†ã‚¢ã‚¤ãƒ‡ã‚¢ãŒã‚ã‚‹ãã†ã§ã™ã€‚ç„¡è«–ã€ã“ã‚Œã«æ„å‘³ãŒã‚ã‚‹ã®ã‹ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã‚‹ã§ã—ã‚‡ã†ã€‚

### forward iterator

å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã£ã¦ä½•ï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::forward_iterator`](https://cpprefjp.github.io/reference/iterator/forward_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17ForwardIterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/ForwardIterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17

ã¾ãšã€æ¬¡ã®è¦ä»¶ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™

- *Cpp17InputIterator*è¦ä»¶ã‚’æº€ãŸã™
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½
- `I`ãŒ*mutable iterator*ãªã‚‰ã°ã€`reference`ã¯`T`ã®å‚ç…§ï¼ˆ`T`ã¯`I`ã®è¦ç´ å‹ï¼‰
- `I`ãŒ*constant iterator*ãªã‚‰ã°ã€`reference`ã¯`const T`ã®å‚ç…§
- ãƒãƒ«ãƒãƒ‘ã‚¹ä¿è¨¼

ãã—ã¦ã€æ¬¡ã®å¼ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¾ã™ï¼ˆã“ã“ã§ã¯*Cpp17InputIterator*è¦ä»¶ã§è¦æ±‚ã•ã‚Œã¦ã„ãŸã‚‚ã®ã‚’ä¸Šæ›¸ãã™ã‚‹å½¢ã§å«ã‚“ã§ã„ã¾ã™ï¼‰

|å¼|æˆ»ã‚Šå€¤|
|---|---|
|`i1 != i2`|*contextually convertible to* `bool`|
|`*i`|`referencce`ã€è¦ç´ å‹`T`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`i->m`||
|`++i`|`I&`|
|`i++`|`const I&`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`*i++`|`referencce`|

#### C++20

ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã‚ˆã£ã¦æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¾ã™ã€‚

```cpp
template<class I>
concept forward_iterator =
  input_iterator<I> &&
  derived_from<ITER_CONCEPT(I), forward_iterator_tag> &&
  incrementable<I> &&
  sentinel_for<I, I>;
```

`std::incrementable`ã¯`std::weakly_incrementable`ã‚’å°‘ã—å¼·ãã—ãŸã‚‚ã®ã§ã™ã€‚

```cpp
template<class I>
concept incrementable =
  regular<I> &&
  weakly_incrementable<I> &&
  requires(I i) {
    { i++ } -> same_as<I>;
  };
```

- [`std::incrementable` - cpprefjp](https://cpprefjp.github.io/reference/iterator/incrementable.html)
- [`std::regular` - cpprefjp](https://cpprefjp.github.io/reference/concepts/regular.html)

ã“ã“ã§é‡è¦ãªã®ã¯ã€å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã®æˆ»ã‚Šå€¤å‹ãŒè‡ªåˆ†è‡ªèº«ã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚ŒãŸäº‹ã§ã™ã€‚

ã‚‚ã†ä¸€ã¤ã€`std::sentinel_for`ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿è‡ªèº«ãŒçµ‚ç«¯ã‚’ç¤ºã—ã†ã‚‹äº‹ã‚’è¡¨ã™ã‚³ãƒ³ã‚»ãƒ—ãƒˆã§ã€æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

```cpp
template<class S, class I>
concept sentinel_for =
  semiregular<S> &&
  input_or_output_iterator<I> &&
  weakly-equality-comparable-with<S, I>;
```

- [`std::sentinel_for` - cpprefjp](https://cpprefjp.github.io/reference/iterator/sentinel_for.html)

`std::regular`ã¯`std::semiregular`ã‚’åŒ…å«ã—ã¦ãŠã‚Šã€ç­‰å€¤æ¯”è¼ƒå¯èƒ½ã§ã‚ã‚‹äº‹ã¨ã‚³ãƒ”ãƒ¼å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’è¦æ±‚ã—ã¦ã„ã¾ã™ã€‚çµå±€ã€`std::sentinel_for<I, I>`ã¯è‡ªåˆ†è‡ªèº«ã¨ã®`== !=`ã«ã‚ˆã‚‹æ¯”è¼ƒãŒå¯èƒ½ã§ã‚ã‚‹äº‹ã‚’è¡¨ã—ã¾ã™ã€‚

ãƒãƒ«ãƒãƒ‘ã‚¹ä¿è¨¼ã¯`std::forward_iterator`ã®æ„å‘³è«–çš„ãªè¦ä»¶ã«ã‚ˆã£ã¦è¦æ±‚ã•ã‚Œã¦ã„ã¾ã™ã€‚

#### å·®ç•°

çµå±€ã€C++20å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®å·®ç•°ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆ*input iterator*ã§ã®å·®ç•°ã‚’å«ã‚ã¦ã„ã¾ã™ã€è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã¯å…ˆé ­ã«+ã§è¡¨ç¤ºï¼‰ã€‚

|è¦æ±‚|C++20|C++17|
|---|---|---|
|`difference_Â­type`|ç¬¦å·ä»˜æ•´æ•°å‹ or ãã‚Œã¨åŒç­‰ãªå‹|ç¬¦å·ä»˜æ•´æ•°å‹ or `void`|
|`->`|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã®æˆ»ã‚Šå€¤å‹| `I` |`const I&`ã«å¤‰æ›å¯èƒ½ãªå‹|
|`reference`ã¨`value_type`ã¨ã®*common reference*|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰ã€ã‚³ãƒ”ãƒ¼å¯èƒ½ã€ç­‰å€¤æ¯”è¼ƒå¯èƒ½ã€ãªã©ãŒå…±é€šã®æ€§è³ªã¨ãªã‚Šã¾ã—ãŸã€‚æ®‹ã£ãŸã‚‚ã®ã§å¤‰ã‚ã£ãŸã®ã¯å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã®æˆ»ã‚Šå€¤å‹ã§ã™ãŒã€ã“ã‚Œã¯C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®æ–¹ãŒC++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«æ¯”ã¹ã¦å³ã—ãæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã“ã§ã‚‚C++20å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«ã¯ç›¸äº’ã«äº’æ›æ€§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€`difference_type`ã¨`->`ã®å·®ã‚’ç„¡è¦–ã™ã‚Œã°ã€C++20å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### bidirectional iterator

åŒæ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã¯ï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::bidirectional_iterator`](https://cpprefjp.github.io/reference/iterator/bidirectional_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17BidirectionalIterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/BidirectionalIterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17

ã¾ãšã€æ¬¡ã®è¦ä»¶ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™

- *Cpp17ForwardIterator*è¦ä»¶ã‚’æº€ãŸã™

ãã—ã¦ã€æ¬¡ã®å¼ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¾ã™ï¼ˆã“ã“ã§ã¯*Cpp17ForwardIterator*è¦ä»¶ã§è¦æ±‚ã•ã‚Œã¦ã„ãŸã‚‚ã®ã‚’å«ã‚“ã§ã„ã¾ã™ï¼‰

|å¼|æˆ»ã‚Šå€¤|
|---|---|
|`i1 != i2`|*contextually convertible to* `bool`|
|`*i`|`referencce`ã€è¦ç´ å‹`T`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`i->m`||
|`++i`|`I&`|
|`i++`|`const I&`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`*i++`|`referencce`|
|`--I`|`I&`|
|`i--`|`const I&`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`*i--`|`referencce`|

#### C++20

ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã‚ˆã£ã¦æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¾ã™ã€‚

```cpp
template<class I>
concept bidirectional_iterator =
  forward_iterator<I> &&
  derived_from<ITER_CONCEPT(I), bidirectional_iterator_tag> &&
  requires(I i) {
    { --i } -> same_as<I&>;
    { i-- } -> same_as<I>;
  };
```

ã“ã“ã¯æ·±æ˜ã‚Šã™ã‚‹å¿…è¦ãŒãªã„ã§ã™ã­ã€C++17è¦ä»¶ã¨ã»ã¨ã‚“ã©åŒã˜äº‹ã‚’è¨€ã£ã¦ã„ã¾ã™ã€‚

#### å·®ç•°

çµå±€ã€C++20åŒæ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17åŒæ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®å·®ç•°ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆ*forward iterator*ã§ã®å·®ç•°ã‚’å«ã‚ã¦ã„ã¾ã™ã€è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã¯å…ˆé ­ã«+ã§è¡¨ç¤ºï¼‰ã€‚

|è¦æ±‚|C++20|C++17|
|---|---|---|
|`difference_Â­type`|ç¬¦å·ä»˜æ•´æ•°å‹ or ãã‚Œã¨åŒç­‰ãªå‹|ç¬¦å·ä»˜æ•´æ•°å‹ or `void`|
|`->`|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã®æˆ»ã‚Šå€¤å‹| `I` |`const I&`ã«å¤‰æ›å¯èƒ½ãªå‹|
|`reference`ã¨`value_type`ã¨ã®*common reference*|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|
|+ å¾Œç½®ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã®æˆ»ã‚Šå€¤å‹| `I` |`const I&`ã«å¤‰æ›å¯èƒ½ãªå‹|

è¿½åŠ ã•ã‚ŒãŸã®ã¯å¾Œç½®ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã®æˆ»ã‚Šå€¤å‹ã§ã™ãŒã€ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã¨åŒæ§˜ã«C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®æ–¹ãŒC++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«æ¯”ã¹ã¦å³ã—ãæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

äº’æ›æ€§ã«é–¢ã—ã¦ã¯å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨åŒæ§˜ã§ã™ã€‚`difference_type`ã¨`->`ã®å·®ã‚’ç„¡è¦–ã™ã‚Œã°ã€C++20åŒæ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17åŒæ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### random access iterator

ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã£ã¦ãƒ»ãƒ»ãƒ»ï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::random_access_iterator`](https://cpprefjp.github.io/reference/iterator/random_access_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17RandomAccessIterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/RandomAccessIterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17

ã¾ãšã€æ¬¡ã®è¦ä»¶ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™

- *Cpp17BidirectionalIterator*è¦ä»¶ã‚’æº€ãŸã™

ãã—ã¦ã€æ¬¡ã®å¼ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¾ã™ï¼ˆã“ã“ã§ã¯*Cpp17ForwardIterator*è¦ä»¶ã§è¦æ±‚ã•ã‚Œã¦ã„ãŸã‚‚ã®ã‚’å«ã‚“ã§ã„ã¾ã™ï¼‰

|å¼|æˆ»ã‚Šå€¤|
|---|---|
|`i1 != i2`|*contextually convertible to* `bool`|
|`*i`|`referencce`ã€è¦ç´ å‹`T`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`i->m`||
|`++i`|`I&`|
|`i++`|`const I&`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`*i++`|`referencce`|
|`--I`|`I&`|
|`i--`|`const I&`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`*i--`|`referencce`|
|`i += n`|`I&`|
|`i + n` <br/> `n + i`|`I`|
|`i -= n`|`I&`|
|`i - n`|`I`|
|`i1 - i2`|`deference_type`|
|`i[n]`|`reference`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`i1 < i2`|*contextually convertible to* `bool`|
|`i1 > i2`|*contextually convertible to* `bool`|
|`i1 <= i2`|*contextually convertible to* `bool`|
|`i1 >= i2`|*contextually convertible to* `bool`|

å‡ºã¦ãã‚‹`n`ã¯`I`ã®`deference_type`ã®å€¤ã§ã™ã€‚ã¤ã¾ã‚Šã€`deference_type`ã¯ç¬¦å·ä»˜æ•´æ•°å‹ã§ã‚ã‚‹äº‹ã‚’æš—ã«è¦æ±‚ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€4ã¤ã®é †åºä»˜ã‘æ¯”è¼ƒ`< > <= >=`ã¯å…¨é †åºã®ä¸Šã§ã®æ¯”è¼ƒã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™ã€‚

#### C++20

ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã‚ˆã£ã¦æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¾ã™ã€‚

```cpp
template<class I>
concept random_access_iterator =
  bidirectional_iterator<I> &&
  derived_from<ITER_CONCEPT(I), random_access_iterator_tag> &&
  totally_ordered<I> &&
  sized_sentinel_for<I, I> &&
  requires(I i, const I j, const iter_difference_t<I> n) {
    { i += n } -> same_as<I&>;
    { j +  n } -> same_as<I>;
    { n +  j } -> same_as<I>;
    { i -= n } -> same_as<I&>;
    { j -  n } -> same_as<I>;
    {  j[n]  } -> same_as<iter_reference_t<I>>;
  };
```

`std::totally_ordered<I>`ã¯å…¨é †åºã®ä¸Šã§ã®4ã¤ã®é †åºä»˜ã‘æ¯”è¼ƒãŒå¯èƒ½ã§ã‚ã‚‹äº‹ã‚’è¡¨ã—ã€`std::sized_sentinel_for<I, I>`ã¯2é …`-`ã«ã‚ˆã£ã¦è·é›¢ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã§ã‚ã‚‹äº‹ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

ãã®å¾Œã«ä¸¦ã¹ã‚‰ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚‚å«ã‚ã¦ã€ã»ã¼ã»ã¼C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹ã‚‚ã®ã¨åŒã˜è¦æ±‚ãŒãªã•ã‚Œã¦ã„ã¾ã™ã€‚

#### å·®ç•°

çµå±€ã€C++20ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®å·®ç•°ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆ*forward iterator*ã§ã®å·®ç•°ã‚’å«ã‚ã¦ã„ã¾ã™ã€è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã¯å…ˆé ­ã«+ã§è¡¨ç¤ºï¼‰ã€‚

|è¦æ±‚|C++20|C++17|
|---|---|---|
|`difference_Â­type`|ç¬¦å·ä»˜æ•´æ•°å‹ or ãã‚Œã¨åŒç­‰ãªå‹|ç¬¦å·ä»˜æ•´æ•°å‹|
|`->`|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã®æˆ»ã‚Šå€¤å‹| `I` |`const I&`ã«å¤‰æ›å¯èƒ½ãªå‹|
|`reference`ã¨`value_type`ã¨ã®*common reference*|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|
| å¾Œç½®ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã®æˆ»ã‚Šå€¤å‹| `I` |`const I&`ã«å¤‰æ›å¯èƒ½ãªå‹|
|+ `i[n]`ã®æˆ»ã‚Šå€¤å‹| `reference` |`reference`ã«å¤‰æ›å¯èƒ½ãªå‹|

æ·»å­—æ¼”ç®—å­ã®æˆ»ã‚Šå€¤å‹ã«é–¢ã—ã¦C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯ã‚ˆã‚Šå³ã—ãæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

çµå±€äº’æ›æ€§ã«é–¢ã—ã¦ã¯åŒæ–¹å‘ãƒ»å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨åŒæ§˜ã§ã™ã€‚`difference_type`ã¨`->`ã®å·®ã‚’ç„¡è¦–ã™ã‚Œã°ã€C++20ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### contiguous iterator

éš£æ¥ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ğŸ¤”ã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::contiguous_iterator`](https://cpprefjp.github.io/reference/iterator/contiguous_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚  
C++17ã§ã¯æ–‡ç« ã§ã²ã£ãã‚Šã¨æŒ‡å®šã•ã‚Œã¦ã„ãŸã®ã¿ã§ã€åå‰ä»˜ãè¦ä»¶ã«ãªã£ã¦ãŠã‚‰ãšC++20ã«ã‚‚å¯¾å¿œã™ã‚‹è¦ä»¶ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆcppreference.comã«ã¯[*LegacyContiguousIterator*](https://en.cppreference.com/w/cpp/named_req/ContiguousIterator)ã¨ã—ã¦è¨˜è¿°ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

#### C++17

C++17ã§ã²ã£ãã‚Šã¨æŒ‡å®šã•ã‚Œã¦ã„ãŸæ–‡ç« ã‚’èª­ã¿è§£ãã¨ã€æ¬¡ã®ã‚ˆã†ãªè¦ä»¶ã§ã™

- *Cpp17RandomAccessIterator*è¦ä»¶ã‚’æº€ãŸã™
- æ•´æ•°å€¤`n`ã€é–“æ¥å‚ç…§å¯èƒ½ãªã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿`i`ã¨`(i + n)`ã«ã¤ã„ã¦
    - `*(i + n)`ã¯`*(addresof(*i) + n)`ã¨ç­‰ä¾¡ï¼ˆ*equivalent*ï¼‰

è¦ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’`n`é€²ã‚ã¦ã‚‚ã€è¦ç´ ã®ãƒã‚¤ãƒ³ã‚¿ã‚’`n`é€²ã‚ã¦ã‚‚ã€åŒã˜è¦ç´ ã‚’æŒ‡ã—ã¦ã­ï¼Ÿã£ã¦ã„ã†ã“ã¨ã§ã™ã€‚ãªã‚‹ã»ã©ç¢ºã‹ã«*contiguous*ã€‚

C++17ã§ã¯*contiguous iterator*ã¨ã„ã†åˆ†é¡ã‚’å°å…¥ã—ã€`std::array`ã‚„`std::vector`ãªã©ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒ*contiguous iterator*ã§ã‚ã‚‹ã¨è¦å®šã¯ã—ã¾ã—ãŸãŒã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚«ãƒ†ã‚´ãƒªã¨ã—ã¦æ­£å¼ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å–ã‚Šå…¥ã‚ŒãŸã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

ãã®ãŸã‚ã€*contiguous iterator*ã§ã‚ã‚‹ã¨è¦å®šã—ãŸã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã•ãˆã‚‚ã€ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ä¸Šã§ã¯ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦ã—ã‹æ‰±ãˆã¾ã›ã‚“ã§ã—ãŸã€‚C++17éš£æ¥ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã„ã†ç¨®é¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯å®Ÿè³ªçš„ã«å­˜åœ¨ã—ã¦ã„ãªã„ã®ã§ã™ã€‚

#### C++20

C++20ã§ã¯æ­£å¼ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å–ã‚Šå…¥ã‚Œã‚‰ã‚Œã€ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã‚ˆã£ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

```cpp
template<class I>
concept contiguous_iterator =
  random_access_iterator<I> &&
  derived_from<ITER_CONCEPT(I), contiguous_iterator_tag> &&
  is_lvalue_reference_v<iter_reference_t<I>> &&
  same_as<iter_value_t<I>, remove_cvref_t<iter_reference_t<I>>> &&
  requires(const I& i) {
    { to_address(i) } -> same_as<add_pointer_t<iter_reference_t<I>>>;
  };
```

- [`std::to_address` - cpprefjp](https://cpprefjp.github.io/reference/memory/to_address.html)
- [`std::add_pointer` - cpprefjp](https://cpprefjp.github.io/reference/type_traits/add_pointer.html)

3ã¤ç›®ã®åˆ¶ç´„å¼ã¯é–“æ¥å‚ç…§ã®çµæœãŒ*lvalue*ã¨ãªã‚‹ã“ã¨ã‚’è¦æ±‚ã—ã¦ãŠã‚Šã€4ã¤ç›®ã®åˆ¶ç´„å¼ã¯`I`ã®`reference`ã‹ã‚‰`CV`ä¿®é£¾ã¨å‚ç…§ä¿®é£¾ã‚’å–ã‚Šé™¤ã„ãŸã‚‚ã®ãŒè¦ç´ å‹ã«ãªã‚‹ã“ã¨ã‚’è¦æ±‚ã—ã¦ã„ã¾ã™ã€‚

æœ€å¾Œã®`requires`å¼ã«ã‚ã‚‹`std::to_address`ã¨ã„ã†ã®ã¯C++20ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã§ã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å«ã‚ãŸãƒã‚¤ãƒ³ã‚¿çš„ãªå‹ã®å€¤ã‹ã‚‰ãã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ãã®çµŒè·¯ã¯`std::pointer_traits`ãŒåˆ©ç”¨å¯èƒ½ãªã‚‰ãã“ã‹ã‚‰ã€ãã†ã§ãªã„ãªã‚‰`operator->()`ã®æˆ»ã‚Šå€¤ã‚’å†ã³`std::to_address`ã«ã‹ã‘ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ã¾ã™ï¼ˆã¤ã¾ã‚Šã€`operator->()`ãŒã‚¹ãƒãƒ¼ãƒˆãƒã‚¤ãƒ³ã‚¿ã‚’è¿”ã—ã¦ã„ã¦ã‚‚ã„ã„ã‚ã‘ã§ã™ãƒ»ãƒ»ãƒ»ï¼‰ã€‚

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯`std::pointer_traits`ã‚’ç‰¹æ®ŠåŒ–ã™ã‚‹ã“ã¨ã‚’æ±‚ã‚ã‚‰ã‚Œã¦ã„ãªã„ãŸã‚ã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿å‹ã«å¯¾ã—ã¦ã®`std::to_address`ã¯å®Ÿè³ªçš„ã«ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®`operator->()`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ãã—ã¦ã€`std::add_pointer`ã¯å‚ç…§å‹ã«å¯¾ã—ã¦ã¯å‚ç…§ã‚’é™¤å»ã—ãŸã†ãˆã§ãƒã‚¤ãƒ³ã‚¿ã‚’è¶³ã—ã¾ã™ã€‚

æœ€å¾Œã®åˆ¶ç´„å¼ã¯å…¨ä½“ã¨ã—ã¦ã€`operator->`ãŒåˆ©ç”¨å¯èƒ½ã§ã‚ã‚Šã€ãã®æˆ»ã‚Šå€¤ã‹ã‚‰æœ€çµ‚çš„ã«å¾—ã‚‰ã‚Œã‚‹ç”Ÿã®ãƒã‚¤ãƒ³ã‚¿å‹ã¯ã€é–“æ¥å‚ç…§ã®çµæœã‹ã‚‰å–å¾—ã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒã‚¤ãƒ³ã‚¿å‹ã¨åŒã˜ã€ã§ã‚ã‚‹ã“ã¨ã‚’è¦æ±‚ã—ã¦ã„ã¾ã™ã€‚

ãã—ã¦ã€`std::contiguous_iterator`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®æ„å‘³è«–çš„ãªåˆ¶ç´„ã¨ã—ã¦ã€`std::to_address`ã«ã‚ˆã£ã¦å¾—ã‚‰ã‚Œã‚‹ãƒã‚¤ãƒ³ã‚¿ã¨ã€é–“æ¥å‚ç…§ã®çµæœå€¤ã‚’æŒ‡ã™ãƒã‚¤ãƒ³ã‚¿ãŒä¸€è‡´ã™ã‚‹ã“ã¨ã€åŠã³2ã¤ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®é–“ã®è·é›¢ã¨ãã®è¦ç´ ã‚’æŒ‡ã™ãƒã‚¤ãƒ³ã‚¿é–“è·é›¢ãŒç­‰ã—ããªã‚‹ã“ã¨ã‚’è¦æ±‚ã—ã¦ã„ã¾ã™ã€‚

ã‚ã‹ã‚Šã«ãã„åˆ¶ç´„ã§ã™ãŒã€*contiguous iterator*ã¨ã„ã†ã®ãŒå®Ÿè³ªçš„ã«ãƒã‚¤ãƒ³ã‚¿å‹ã‚’æŒ‡ã—ã¦ã„ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨å°‘ã—è¦‹ãˆã¦ãã‚‹ã‚‚ã®ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã‹ã€‚

ãƒã‚¤ãƒ³ã‚¿ã§ã¯ãªã„éš£æ¥ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯å­˜åœ¨æ„ç¾©ãŒè‰¯ãåˆ†ã‹ã‚Šã¾ã›ã‚“ãŒã€ã“ã‚Œã‚‰ã®åˆ¶ç´„ã¯ç›´æ¥ãƒã‚¤ãƒ³ã‚¿å‹ã‚’è¦æ±‚ã—ã¦ãŠã‚‰ãšã€ãƒ¡ãƒ¢ãƒªä¸Šã®é€£ç¶šé ˜åŸŸã‚’ãƒ©ãƒƒãƒ—ã—ãŸå½¢ã®ãƒã‚¤ãƒ³ã‚¿ã§ã¯ãªã„éš£æ¥ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã„ã†ã®ã‚’ä½œã‚ã†ã¨æ€ãˆã°ä½œã‚Œã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

#### å·®ç•°

C++17éš£æ¥ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯å±…ãªã„ã®ã§ã€å·®ç•°ã¯ã‚ã£ã¦ã‚‚æ°—ã«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚C++20éš£æ¥ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã¯C++17ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦ã—ã‹æ‰±ã‚ã‚Œã‚‹ã“ã¨ã¯ãªã„ã§ã—ã‚‡ã†ã€‚

C++20éš£æ¥ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯å®Ÿè³ªçš„ã«`->`ãŒè¦æ±‚ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸãŸã‚ã€C++17ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦æ‰±ã†æ™‚ã®éäº’æ›ãªéƒ¨åˆ†ã¯`deference_type`ã ã‘ã¨ãªã‚Šã¾ã™ã€‚ã¨ã¯ã„ãˆã€ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãªã‚³ãƒ¼ãƒ‰ã«ãŠã„ã¦ã¯ãã“ã¯ã‚ã¾ã‚Šæ°—ã«ã™ã‚‹å¿…è¦ã¯ãªã•ãã†ã§ã™ã®ã§ã€å®Ÿè³ªçš„ã«ã¯C++20éš£æ¥ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã—ã¦å¾Œæ–¹äº’æ›æ€§ãŒã‚ã‚‹ã¨ã¿ãªã—ã¦è‰¯ã„ã§ã—ã‚‡ã†ã€‚

### ã¾ã¨ã‚

æŒ¯ã‚Šè¿”ã‚‹ã¨çµå±€ã€å¤§ããªå·®ç•°ã¨ã„ã†ã®ã¯æ¬¡ã®ã‚‚ã®ã§ã—ãŸ

- C++20å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®ç›¸äº’éäº’æ›
- å…¨ã¦ã®C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚«ãƒ†ã‚´ãƒªã«ãŠã‘ã‚‹`->`ã®æ¬ å¦‚
    - éš£æ¥ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚‚ç›´æ¥`->`ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„ãƒ»ãƒ»ãƒ»

ã“ã®`->`ãŒæŠœã‘è½ã¡ã¦ã„ã‚‹ã®ã¯å¿˜ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªãã€æ„å›³çš„ãªã‚‚ã®ã®æ§˜ã§ã™ã€‚ãªãœã‹ã¯çŸ¥ã‚Šã¾ã›ã‚“ã€‚

`->`ã‚’ç„¡è¦–ã™ã‚‹ã¨ã€C++20å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ä»¥ä¸Šã®å¼·ã•ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯åŒã˜ã‚«ãƒ†ã‚´ãƒªã®C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã—ã¦å¾Œæ–¹äº’æ›æ€§ãŒã‚ã‚Šã€å¿…ç„¶çš„ã«C++17å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã—ã¦å¾Œæ–¹äº’æ›æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€C++20éš£æ¥ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯å…¨ã¦ã®C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã—ã¦å®Ÿè³ªçš„ã«å¾Œæ–¹äº’æ›æ€§ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

ä¸€æ–¹å…¨ã¦ã®ã‚«ãƒ†ã‚´ãƒªã§ã€C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹å‰æ–¹äº’æ›æ€§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¦ä»¶ãŒå³ã—ããªã£ã¦ã„ã‚‹ãŸã‚ã§ã€ä¸­ã«ã¯ä½¿ç”¨ã§ãã‚‹ã‚‚ã®ã‚‚ãªã„ã§ã¯ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å¤šãã®å ´åˆã¯C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã‚ˆã£ã¦å¼¾ã‹ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚

`<ranges>`ã®å„ç¨®`view`ã«ä»£è¡¨ã•ã‚Œã‚‹C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã§ã¯ã€ãƒ¡ãƒ³ãƒå‹ã¨ã—ã¦`iterator_concept`ã¨`iterator_category`ã‚’äºŒã¤å‚™ãˆã‚‹ã“ã¨ã§C++17äº’æ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦ã®æ€§è³ªã‚’è¡¨æ˜ã—ã¦ã„ã¾ã™ï¼ˆãã®è©³ç´°ã¯å‰å›å‚ç…§ï¼‰ã€‚ãã“ã§ã¯ã€`iterator_concept`ãŒãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ç­‰ã§ã‚ã£ã¦ã‚‚ã€`iterator_category`ã¯å¸¸ã«å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã™ã‚‹é‹ç”¨ãŒè‰¯ãè¡Œã‚ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚  
ã“ã‚Œã‚’è¦‹ã‚‹ã«ã€æ¨™æº–åŒ–å§”å“¡ä¼šçš„ã«ã¯C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®`->`ã®æ¬ å¦‚ã¯å¯¾C++17äº’æ›ã«ã¨ã£ã¦é‡è¦ãªäº‹ã¨ã¯ã¿ãªã•ã‚Œã¦ã¯ã„ãªã„ã‚ˆã†ã§ã™ã€‚

- [23.3.5 C++17 iterator requirements[iterator.cpp17] - N4861](https://timsong-cpp.github.io/cppwp/n4861/iterator.cpp17)
- [27.2 Iterator requirements[iterator.requirements] - N4659](https://timsong-cpp.github.io/cppwp/n4659/iterators#iterator.requirements.general-6)
- [`<iterator>` - cpprefjp](https://cpprefjp.github.io/reference/iterator.html)
- [Iterator library - cppreference](https://en.cppreference.com/w/cpp/iterator)
- [ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«->æ¼”ç®—å­ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯å¿…è¦ï¼Ÿ - yohhoyã®æ—¥è¨˜](https://yohhoy.hatenadiary.jp/entry/20191025/p1)

[ã“ã®è¨˜äº‹ã®Markdownã‚½ãƒ¼ã‚¹](https://github.com/onihusube/blog/blob/master/2020/20201227_17iterator_20iterator.md)