# ï¼»C++ï¼½ C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ <=> C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ != 0

ã“ã‚Œã¯[C++ Advent Calendar 2020](https://qiita.com/advent-calendar/2020/cxx)ã®24æ—¥ã‚ã®è¨˜äº‹ã§ã™ã€‚

[å‰å›](https://onihusube.hatenablog.com/entry/2020/12/14/002822)ã¨[å‰ã€…å›](https://onihusube.hatenablog.com/entry/2020/12/11/000123)ã§C++20ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯ä¸€å‘³ã‚‚äºŒå‘³ã‚‚é•ã†ãœï¼ã¨ã„ã†äº‹ã‚’èªã£ãŸã‚ã‘ã§ã™ãŒã€å…·ä½“çš„ã«ã©ã†é•ã†ã®ã‹ã‚’è¦‹ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

ä»¥ä¸‹ã€ç‰¹ã«æ–­ã‚ŠãŒç„¡ã‘ã‚Œã°`I`ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿å‹ã€`i`ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã ã¨æ€ã£ã¦ãã ã•ã„ã€‚

### iterator

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã¯ä½•ã‹ï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::input_or_output_iterator`](https://cpprefjp.github.io/reference/iterator/input_or_output_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17Iterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/Iterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17

ã¾ãšã€æ¬¡ã®è¦ä»¶ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™

- `iterator_Â­traits<I>`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå­˜åœ¨ã™ã‚‹
- ã‚³ãƒ”ãƒ¼æ§‹ç¯‰å¯èƒ½
- ã‚³ãƒ”ãƒ¼ä»£å…¥å¯èƒ½
- ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ãƒˆå¯èƒ½
- *lvalue*ã«ã¤ã„ã¦ã€ã‚¹ãƒ¯ãƒƒãƒ—å¯èƒ½
- `iterator_Â­traits<I>â€‹::â€‹difference_Â­type`ã¯ç¬¦å·ä»˜ãæ•´æ•°å‹ã‚‚ã—ãã¯`void`

ã“ã‚Œã‚‰ã®ï½å¯èƒ½ã¨ã„ã†ã®ã¯ãã‚Œã¯ãã‚Œã§ä¸€ã¤ã®åå‰ä»˜ãè¦ä»¶ã«ãªã£ã¦ã„ã‚‹ã®ã§ã™ãŒã“ã“ã§ã¯æ·±å €ã—ã¾ã›ã‚“ã€‚ãŠãã‚‰ãè¨€è‘‰ã‹ã‚‰åˆ†ã‹ã‚‹ã®ã¨ãã†ç•°ãªã‚‹æ„å‘³ã§ã¯ãªã„ã¯ãšã§ã™ã€‚

ãã—ã¦ã€æ¬¡ã®å¼ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¾ã™

|å¼|æˆ»ã‚Šå€¤|
|---|---|
|`*i`|æœªè¦å®š|
|`++i`|`I&`|

é–“æ¥å‚ç…§ã¨å‰ç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹é€²è¡ŒãŒå¯èƒ½ã§ã‚ã‚Œã€ã¨ã„ã†äº‹ã§ã™ã€‚

#### C++20

C++20ã¯è¨€è‘‰ã§é•·ã€…èªã£ãŸã‚Šã—ã¾ã›ã‚“ã€‚ã‚³ãƒ³ã‚»ãƒ—ãƒˆã§èªã‚Šã¾ã™ã€‚

```cpp
template<class I>
concept input_or_output_iterator =
  requires(I i) {
    { *i } -> can-reference;
  } &&
  weakly_incrementable<I>;
```

`can-reference`ã¯æˆ»ã‚Šå€¤å‹ãŒ`void`ã§ã¯ãªã„äº‹ã‚’è¡¨ã™ã‚³ãƒ³ã‚»ãƒ—ãƒˆã§ã™ã€‚  
ã“ã“ã§ç›´æ¥è¦‹ã‚‹ã“ã¨ã®å‡ºæ¥ã‚‹ã®ã¯é–“æ¥å‚ç…§ã®è¦æ±‚ã§ã™ã€‚ã“ã‚Œã¯C++17ã®è¦æ±‚ã¨åŒã˜ã“ã¨ã‚’æ„å‘³ã—ã¦ã„ã¾ã™ã€‚

`std::weakly_incrementable`ã¯`++`ã«ã‚ˆã£ã¦ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆå¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’è¡¨ã™ã‚³ãƒ³ã‚»ãƒ—ãƒˆã§ã™ã€‚

```cpp
template<class I>
concept weakly_incrementable =
  default_initializable<I> && movable<I> &&
  requires(I i) {
    typename iter_difference_t<I>;
    requires is-signed-integer-like<iter_difference_t<I>>;
    { ++i } -> same_as<I&>;
    i++;
  };
```

ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’æ·±ã•å„ªå…ˆæ¢ç´¢ã—ã¦ã„ãã¨ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã§è„³å†…ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒã—ã¬ã®ã§é©å®œcpprefjpã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

â€‹`requires`å¼ã®ä¸­ã§ã¯ã€`difference_Â­type`ãŒã§ã‚ã‚‹ã“ã¨ã¨ã€å‰ç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã«å¯¾ã—ã¦ã¯å…ˆã»ã©ã®C++17ã¨åŒã˜ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™ã€‚

å¤§ããç•°ãªã‚‹ç‚¹ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã¨ã€ã‚³ãƒ”ãƒ¼å¯èƒ½ã§ã¯ãªããƒ ãƒ¼ãƒ–å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã§ã™ã€‚ã¾ãŸã€`difference_Â­type`ã¯`void`ãŒèªã‚ã‚‰ã‚Œãªã„ä»£ã‚ã‚Šã«ç¬¦å·ä»˜ãæ•´æ•°å‹ã¨åŒç­‰ãªä»»æ„ã®å‹ãŒè¨±å¯ã•ã‚Œã¦ãŠã‚Šã€å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™ã€‚

C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯`iterator_traits`ã§ä½¿ç”¨å¯èƒ½ã§ã‚ã‚‹äº‹ã‚’è¦æ±‚ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€C++20ã®`iterator_traits`ã¯C++17äº’æ›çª“å£ã¨ã—ã¦ãªã‚“ã¨ã‹ã—ã¦æƒ…å ±ã‚’ã‹ãé›†ã‚ã¦ãã¦ãã‚Œã‚‹ã®ã§ã»ã¼è‡ªå‹•ã§ä½¿ç”¨å¯èƒ½ã¨ãªã‚‹ã¯ãšã§ã™ã€‚ã¾ãŸã€å‰ã€…å›ã«èª¬æ˜ã—ãŸ`iterator_traits`ã«ä»£ã‚ã‚‹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿æƒ…å ±å–å¾—æ‰‹æ®µã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®æ€§è³ªã‹ã‚‰ãã®æƒ…å ±ã‚’å–ã£ã¦ãã‚‹ã®ã§`iterator_traits`ã®ã‚ˆã†ãªã‚‚ã®ã¯ã»ã¼å¿…è¦ãªããªã£ã¦ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€`iterator_traits`ã§ä½¿ç”¨å¯èƒ½ã‹ã©ã†ã‹ã¯å·®ç•°ã¨ã¯ã¿ãªã•ãªã„ã“ã¨ã«ã—ã¾ã™ã€‚

- [`std::weakly_incrementable` - cpprefjp](https://cpprefjp.github.io/reference/iterator/weakly_incrementable.html)
- [`std::is-integer-like` - cpprefjp](https://cpprefjp.github.io/reference/iterator/is_integer_like.html)

#### å·®ç•°

çµå±€ã€C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®å·®ç•°ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

|è¦æ±‚|C++20|C++17|
|---|---|---|
|ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|
|ãƒ ãƒ¼ãƒ–å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|è¦æ±‚ã•ã‚Œã‚‹|
|ã‚³ãƒ”ãƒ¼å¯èƒ½æ€§|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|`difference_Â­type`|ç¬¦å·ä»˜æ•´æ•°å‹ or ãã‚Œã¨åŒç­‰ãªå‹|ç¬¦å·ä»˜æ•´æ•°å‹ or `void`|
|å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|

ã‚³ãƒ”ãƒ¼å¯èƒ½ -> ãƒ ãƒ¼ãƒ–å¯èƒ½ã§ã™ãŒã€ãƒ ãƒ¼ãƒ–å¯èƒ½ -> ã‚³ãƒ”ãƒ¼å¯èƒ½ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`difference_Â­type`ã‚’é™¤ã„ã¦ã€C++20ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17ã‹ã‚‰åˆ¶ç´„ãŒå³ã—ããªã£ã¦ã„ã¾ã™ã€‚

ã“ã®*iterator*ã¨ã¯å…¨ã¦ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹éƒ¨åˆ†ã®åˆ†é¡ã§ã™ã€‚ã™ãªã‚ã¡ã€ã“ã®æ™‚ç‚¹ã§ã™ã§ã«ãã“ãã“ã®é•ã„ãŒã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ãã—ã¦ã€æ®†ã©ã®è¦ä»¶ãŒå³ã—ããªã£ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã§ã—ã‹ãªã„ã‚‚ã®ã‚’C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦æ‰±ã†ã“ã¨ã¯å‡ºæ¥ãšã€`difference_Â­type`ã®å·®ç•°ã‹ã‚‰C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã§ã—ã‹ãªã„ã‚‚ã®ã‚’C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚‚ã§ãã¾ã›ã‚“ã€‚

ã™ãªã‚ã¡ã€*iterator*ã¨ã„ã†åˆ†é¡ã§ã¯C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«ã¯ç›¸äº’ã«äº’æ›æ€§ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

### input iteratorr

å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã¯ä½•ãï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::input_iterator`](https://cpprefjp.github.io/reference/iterator/input_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17InputIterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/InputIterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17

ã¾ãšã€æ¬¡ã®è¦ä»¶ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™

- *Cpp17Iterator*è¦ä»¶ã‚’æº€ãŸã™
- åŒå€¤æ¯”è¼ƒå¯èƒ½

ãã—ã¦ã€æ¬¡ã®å¼ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¾ã™ï¼ˆã“ã“ã§ã¯*Cpp17Iterator*è¦ä»¶ã§è¦æ±‚ã•ã‚Œã¦ã„ãŸã‚‚ã®ã‚’ä¸Šæ›¸ãã™ã‚‹å½¢ã§å«ã‚“ã§ã„ã¾ã™ï¼‰

|å¼|æˆ»ã‚Šå€¤|
|---|---|
|`i1 != i2`|*contextually convertible to* `bool`|
|`*i`|`referencce`ã€è¦ç´ å‹`T`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`i->m`||
|`++i`|`I&`|
|`(void)i++`||
|`*i++`|è¦ç´ å‹`T`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|

`== !=`ã«ã‚ˆã‚‹åŒå€¤æ¯”è¼ƒã¨`->`ã€å¾Œç½®`++`ãŒä½¿ç”¨å¯èƒ½ã§ã‚ã‚‹äº‹ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚

#### C++20

C++20ã¯ã‚³ãƒ³ã‚»ãƒ—ãƒˆã§(ry

```cpp
template<class I>
concept input_iterator =
  input_or_output_iterator<I> &&
  indirectly_readable<I> &&
  requires { typename ITER_CONCEPT(I); } &&
  derived_from<ITER_CONCEPT(I), input_iterator_tag>;
```

`ITER_CONCEPT`ã«ã¤ã„ã¦ã¯å‰å›ã®è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ã€‚è¦ã¯`iterator_category`ã‚’å–å¾—ã—ã¦ãã‚‹ã‚‚ã®ã§ã™ã€‚

`std::indirectly_readable`ã¯å°‘ã—è¤‡é›‘ã§ã™ãŒå®šç¾©ãã®ã‚‚ã®ã¯æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

```cpp
template<class In>
concept indirectly-readable-impl =
  requires(const In in) {
    typename iter_value_t<In>;
    typename iter_reference_t<In>;
    typename iter_rvalue_reference_t<In>;
    { *in } -> same_as<iter_reference_t<In>>;
    { ranges::iter_move(in) } -> same_as<iter_rvalue_reference_t<In>>;
  } &&
  common_reference_with<iter_reference_t<In>&&, iter_value_t<In>&> &&
  common_reference_with<iter_reference_t<In>&&, iter_rvalue_reference_t<In>&&> &&
  common_reference_with<iter_rvalue_reference_t<In>&&, const iter_value_t<In>&>;
```

`iter_value_t`ãªã©ãŒä½¿ç”¨å¯èƒ½ã§ã‚ã‚‹ã¨è¨€ã†ã“ã¨ã¯çª“å£ãŒé•ã†ã ã‘ã§ã€`iterator_traits`ã§å–å¾—å¯èƒ½ã¨è¨€ã†è¦ä»¶ã¨åŒã˜æ„å‘³ã§ã™ã€‚ã¾ãŸã€`std::iter_rvalue_reference_t`ã¯`std::ranges::iter_move`ã‚’ä½¿ç”¨ã—ã¦å³è¾ºå€¤å‚ç…§å‹ã‚’å–å¾—ã—ã¦ãŠã‚Šã€`std::ranges::iter_move`ã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ãœãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã‚‚ä½œç”¨ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã‚Œã‚‰ã¯å·®ç•°ã¨ã¯ã¿ãªã•ãªã„ã“ã¨ã«ã—ã¾ã™ã€‚

é–“æ¥å‚ç…§ã®æˆ»ã‚Šå€¤å‹ã«å¯¾ã™ã‚‹è¦ä»¶ã¯åŒã˜ã§ã™ã€‚å¤§ããé•ã†ã®ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®`reference`ã¨`value_type`ã®é–“ã«*common reference*ãŒè¦æ±‚ã•ã‚Œã¦ã„ã‚‹äº‹ã§ã™ã€‚ã¾ãŸã€å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã«é–¢ã—ã¯`input_or_output_iterator`ã‹ã‚‰å¼•ãç¶™ã„ã§ã„ã‚‹ã®ã¿ã§ã€C++17ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒæˆ»ã‚Šå€¤å‹ã«è¦æ±‚ãŒã‚ã‚‹ã®ã«å¯¾ã—ã¦C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«ã¯ãã‚ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚

- [`std::indirectly_readable` - cpprefjp](https://cpprefjp.github.io/reference/iterator/indirectly_readable.html)
- [`std::iter_rvalue_reference_t` - cpprefjp](https://cpprefjp.github.io/reference/iterator/iter_rvalue_reference_t.html)

#### å·®ç•°

çµå±€ã€C++20å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®å·®ç•°ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆ*iterator*ã§ã®å·®ç•°ã‚’å«ã‚ã¦ã„ã¾ã™ã€è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã¯å…ˆé ­ã«+ã§è¡¨ç¤ºï¼‰ã€‚

|è¦æ±‚|C++20|C++17|
|---|---|---|
|ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|
|ãƒ ãƒ¼ãƒ–å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|è¦æ±‚ã•ã‚Œã‚‹|
|ã‚³ãƒ”ãƒ¼å¯èƒ½æ€§|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|`difference_Â­type`|ç¬¦å·ä»˜æ•´æ•°å‹ or ãã‚Œã¨åŒç­‰ãªå‹|ç¬¦å·ä»˜æ•´æ•°å‹ or `void`|
|+ `== !=`ã«ã‚ˆã‚‹åŒå€¤æ¯”è¼ƒ|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|+ `->`|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|+ å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã®æˆ»ã‚Šå€¤å‹|ä»»æ„ï¼ˆ`void`ã‚‚å¯ï¼‰|`value_type`ã«å¤‰æ›å¯èƒ½ãªå‹|
|+ `reference`ã¨`value_type`ã¨ã®*common reference*|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|

å¾Œç½®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆãŒã§ãã‚‹äº‹ã€ã¨è¨€ã†ç‚¹ã«ãŠã„ã¦ã¯ä¸€è‡´ã—ãŸä»£ã‚ã‚Šã«å·®ç•°ãŒå¢—ãˆã¾ã—ãŸã€‚C++17 -> C++20ã§ç·©å’Œã•ã‚ŒãŸã‚‚ã®ã‚‚ã‚ã‚Œã°å³ã—ããªã£ãŸã‚‚ã®ã‚‚ã‚ã‚Šã€ã‚„ã¯ã‚Šã“ã“ã§ã‚‚C++20å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®é–“ã«äº’æ›æ€§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

### ouptut iterator

å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã¯ä¸€ä½“ï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::output_iterator`](https://cpprefjp.github.io/reference/iterator/output_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17OutputIterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/OutputIterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17

ã¾ãšã€æ¬¡ã®è¦ä»¶ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™

- *Cpp17Iterator*è¦ä»¶ã‚’æº€ãŸã™

ãã—ã¦ã€æ¬¡ã®å¼ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒè¦æ±‚ã•ã‚Œã¾ã™ï¼ˆã“ã“ã§ã¯*Cpp17Iterator*è¦ä»¶ã§è¦æ±‚ã•ã‚Œã¦ã„ãŸã‚‚ã®ã‚’ä¸Šæ›¸ãã™ã‚‹å½¢ã§å«ã‚“ã§ã„ã¾ã™ï¼‰

|å¼|æˆ»ã‚Šå€¤|
|---|---|
|`*i = o`|çµæœã¯ä½¿ç”¨ã•ã‚Œãªã„|
|`++i`|`I&`|
|`i++`|`const I&`ã«å¤‰æ›å¯èƒ½ã§ã‚ã‚‹ã“ã¨|
|`*i++ = o`|çµæœã¯ä½¿ç”¨ã•ã‚Œãªã„|

å¾Œã§é–¢ä¿‚ã—ã¦ãã‚‹äº‹ã¨ã—ã¦ã€ã“ã®`i`ã¯å·¦è¾ºå€¤ï¼ˆ`I&`ï¼‰ã§ã™ã€‚

4ã¤å…¨ã¦ã®æ“ä½œã«ãŠã„ã¦ã€ãã‚Œãã‚Œã®æ“ä½œã®å¾Œã§ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿`i`ãŒé–“æ¥å‚ç…§å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã¯è¦æ±‚ã•ã‚Œã¾ã›ã‚“ã€‚

#### C++20

ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã‚ˆã£ã¦æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¾ã™ã€‚

```cpp
template<class I, class T>
concept output_iterator =
  input_or_output_iterator<I> &&
  indirectly_writable<I, T> &&
  requires(I i, T&& t) {
    *i++ = std::forward<T>(t);
  };
```

ã“ã“ã‚’è¦‹ã‚‹ã¶ã‚“ã«ã¯é•ã„ãŒãªã•ãã†ã§ã™ã­ã€‚

`std::indirectly_writable`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¯æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¾ã™

```cpp
template<class Out, class T>
concept indirectly_writable = 
  requires(Out&& o, T&& t) {
    *o = std::forward<T>(t);
    *std::forward<Out>(o) = std::forward<T>(t);
    const_cast<const iter_reference_t<Out>&&>(*o) = std::forward<T>(t);
    const_cast<const iter_reference_t<Out>&&>(*std::forward<Out>(o)) = std::forward<T>(t);
  };
```

`*i`ã«ã‚ˆã‚‹å‡ºåŠ›ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€åˆ¶ç´„å¼ãŒã‚„ãŸã‚‰è¤‡é›‘ã§ã™ã€‚ä¸Š2ã¤ã¯å·¦è¾ºå€¤ã‹ã‚‰ã§ã‚‚å³è¾ºå€¤ã‹ã‚‰ã§ã‚‚å‡ºåŠ›å¯èƒ½ã§ã‚ã‚‹äº‹ã¨è¨€ã†è¦ä»¶ã§ã—ã‚‡ã†ã€‚C++17ã¾ã§ã¯å³è¾ºå€¤ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‹ã‚‰ã®å‡ºåŠ›ã¯è¦æ±‚ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚  
ä¸‹äºŒã¤ã®`const_cast`ã‚’ã—ã¦ã„ã‚‹åˆ¶ç´„å¼ã¯ã€è¦æ ¼æ›¸ã®è¨€ã«ã‚ˆã‚Œã°é–“æ¥å‚ç…§ãŒ*prvalue*ã‚’è¿”ã™ã‚ˆã†ãªãƒ—ãƒ­ã‚¯ã‚·ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å¼¾ããŸã‚ã«ã‚ã‚‹ã‚‰ã—ã„ã§ã™ã€‚ã‚ˆãã‚ã‹ã‚“ãªã„ãƒ»ãƒ»ãƒ»

ã¾ãŸã€`std::indirectly_writable`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®æ„å‘³è«–çš„ãªåˆ¶ç´„ã«ç›®ã‚’å‘ã‘ã‚‹ã¨ã€å‡ºåŠ›æ“ä½œå¾Œã®å€¤ã®åŒä¸€æ€§ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸãã®ä¸€éƒ¨ã¨ã—ã¦ã€å‡ºåŠ›æ“ä½œã®å¾Œã§`i`ãŒé–“æ¥å‚ç…§å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã¯è¦æ±‚ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

- [`std::indirectly_writable` - cpprefjp](https://cpprefjp.github.io/reference/iterator/indirectly_writable.html)

#### å·®ç•°

çµå±€ã€C++20å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨C++17å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®å·®ç•°ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆ*iterator*ã§ã®å·®ç•°ã‚’å«ã‚ã¦ã„ã¾ã™ã€è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã¯å…ˆé ­ã«+ã§è¡¨ç¤ºï¼‰ã€‚

|è¦æ±‚|C++20|C++17|
|---|---|---|
|ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|
|ãƒ ãƒ¼ãƒ–å¯èƒ½æ€§|è¦æ±‚ã•ã‚Œã‚‹|è¦æ±‚ã•ã‚Œã‚‹|
|ã‚³ãƒ”ãƒ¼å¯èƒ½æ€§|ä¸è¦|è¦æ±‚ã•ã‚Œã‚‹|
|`difference_Â­type`|ç¬¦å·ä»˜æ•´æ•°å‹ or ãã‚Œã¨åŒç­‰ãªå‹|ç¬¦å·ä»˜æ•´æ•°å‹ or `void`|
|+ å³è¾ºå€¤ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‹ã‚‰ã®å‡ºåŠ›|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|
|+ *pravlue*ã¸ã®å‡ºåŠ›ã®ç¦æ­¢|è¦æ±‚ã•ã‚Œã‚‹|ä¸è¦|

è¿½åŠ ã•ã‚ŒãŸäºŒã¤ã¯C++17 -> C++20ã§åˆ¶ç´„ãŒå³ã—ããªã£ã¦ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€C++17å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++20å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã—ã¦äº’æ›æ€§ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä¸€æ–¹ã€C++20å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã—ã¦`difference_Â­type`ä»¥å¤–ã®æ‰€ã§ã¯äº’æ›æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ç‰¹ã«ã€C++20å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒ`iterator_traits`ã‚’ä»‹ã—ã¦æ€§è³ªã‚’å–å¾—ã•ã‚Œã‚‹æ™‚ã€ç‰¹ã«ç‰¹æ®ŠåŒ–ãŒãªã‘ã‚Œã°`difference_Â­type`ã¯`void`ã«ãªã‚Šã¾ã™ã€‚ãã®å ´åˆã€C++20å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¯C++17å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦å®Œç’§ã«æŒ¯ã‚‹èˆã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ã€å‡ºåŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚ˆã‚Šå¼·ã„C++20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹`iterator_traits`ã‹ã‚‰ã®å•ã„åˆã‚ã›ã«å¯¾ã—ã¦å¸¸ã«*output iterator*ã¨ã—ã¦å¿œç­”ã™ã‚‹ã“ã¨ã§å¾Œæ–¹äº’æ›æ€§ã‚’ç¢ºä¿ã™ã‚‹ã€ã¨è¨€ã†ã‚¢ã‚¤ãƒ‡ã‚¢ãŒã‚ã‚‹ãã†ã§ã™ã€‚ç„¡è«–ã€ã“ã‚Œã«æ„å‘³ãŒã‚ã‚‹ã®ã‹ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã‚‹ã§ã—ã‚‡ã†ã€‚

### forward iterator

å‰æ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã£ã¦ä½•ï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::forward_iterator`](https://cpprefjp.github.io/reference/iterator/forward_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17ForwardIterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/ForwardIterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17

ã¾ãšã€æ¬¡ã®è¦ä»¶ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™

- *Cpp17InputIterator*è¦ä»¶ã‚’æº€ãŸã™
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰å¯èƒ½


#### C++20
#### å·®ç•°


### bidirectional iterator

åŒæ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã¯ï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::bidirectional_iterator`](https://cpprefjp.github.io/reference/iterator/bidirectional_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17BidirectionalIterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/BidirectionalIterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17
#### C++20
#### å·®ç•°

### random access iterator

ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãƒ»ãƒ»ãƒ»ï¼Ÿã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::random_access_iterator`](https://cpprefjp.github.io/reference/iterator/random_access_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€C++17ã§ã¯[*Cpp17RandomAccessIterator*è¦ä»¶](https://en.cppreference.com/w/cpp/named_req/RandomAccessIterator)ãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### C++17
#### C++20
#### å·®ç•°


### contiguous iterator

åŒæ–¹å‘ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ğŸ¤”ã¨ã„ã†äº‹ã¯ã€C++20ã§ã¯[`std::contiguous_iterator`](https://cpprefjp.github.io/reference/iterator/contiguous_iterator.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆãŒãã‚Œã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚  
C++17ã§ã¯æ–‡ç« ã§ã²ã£ãã‚Šã¨æŒ‡å®šã•ã‚Œã¦ã„ãŸã®ã¿ã§ã€åå‰ä»˜ãè¦ä»¶ã«ãªã£ã¦ãŠã‚‰ãšC++20ã«ã‚‚å¯¾å¿œã™ã‚‹è¦ä»¶ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆcppreference.comã«ã¯[*LegacyContiguousIterator*](https://en.cppreference.com/w/cpp/named_req/ContiguousIterator)ã¨ã—ã¦è¨˜è¿°ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

#### C++17
#### C++20
#### å·®ç•°



- [23.3.5 C++17 iterator requirements[iterator.cpp17] - N4861](https://timsong-cpp.github.io/cppwp/n4861/iterator.cpp17)
- [27.2 Iterator requirements[iterator.requirements] - N4659](https://timsong-cpp.github.io/cppwp/n4659/iterators#iterator.requirements.general-6)
- [`<iterator>` - cpprefjp](https://cpprefjp.github.io/reference/iterator.html)
- [Iterator library - cppreference](https://en.cppreference.com/w/cpp/iterator)