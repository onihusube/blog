# ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´08æœˆï¼‰

æ–‡æ›¸ã®ä¸€è¦§

- [JTC1/SC22/WG21 - Papers 2022 mailing2022-08](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/#mailing2022-08)

å…¨éƒ¨ã§27æœ¬ã‚ã‚Šã¾ã™ã€‚

[:contents]

### [N4914 WG21 2022-07 Admin telecon minutes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/n4914.pdf)

WG21ã®å„ä½œæ¥­éƒ¨ä¼šã®ç®¡ç†è€…ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è­°äº‹éŒ²ã€‚

å‰å›ã‹ã‚‰ä»Šå›ã®ä¼šè­°ã®é–“ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®å ±å‘ŠãŒã•ã‚Œã¦ã„ã¾ã™ã€‚

### [N4915 Business Plan and Convener's Report: ISO/IEC JTC1/SC22/WG21 (C++)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/n4915.pdf)

ãƒ“ã‚¸ãƒã‚¹ãƒ¦ãƒ¼ã‚¶å‘ã‘ã®C++ãŠã‚ˆã³WG21ã®ç¾çŠ¶å ±å‘Šæ›¸ã€‚

### [N4916 WG21 2022-07 Virtual Meeting Minutes of Meeting](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/n4916.pdf)

2022å¹´2æœˆ7æ—¥ï¼ˆåŒ—ç±³æ™‚é–“ï¼‰ã«è¡Œã‚ã‚ŒãŸã€WG21å…¨ä½“ä¼šè­°ã®è­°äº‹éŒ²ã€‚

CWG/LWG/LEWGã®æŠ•ç¥¨ã®æ§˜å­ãªã©ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P0843R5 `static_vector`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0843r5.html)

é™çš„ãªæœ€å¤§ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã‚’æŒã¡ãƒ’ãƒ¼ãƒ—é ˜åŸŸã‚’ä½¿ç”¨ã—ãªã„`std::vector`ã§ã‚ã‚‹`static_vector`ã®ææ¡ˆã€‚

`static_vector<T, N>`ã¯`std::vector`ã¨`std::array`ã®ã‚­ãƒ¡ãƒ©ã®ã‚ˆã†ãªã‚³ãƒ³ãƒ†ãƒŠã§ã€`N`ã«æŒ‡å®šã—ãŸå€¤ã‚’æœ€å¤§ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã¨ã—ã¦ã€ã‚¹ã‚¿ãƒƒã‚¯é ˜åŸŸï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹å ´åˆã¯é™çš„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰ã‚’ç”¨ã„ã¦`std::vector`ã®ã‚ˆã†ãªå¯å¤‰é•·é…åˆ—ã‚’å®Ÿç¾ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ä¸»ãŸã‚‹æ€§è³ªã¯

- å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿ã‚’å¿…è¦ã¨ã—ãªã„
- ã‚¹ã‚¿ãƒƒã‚¯oré™çš„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹
- ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£æœ€å¤§å€¤ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æŒ‡å®šã•ã‚Œã‚‹
- è¦ç´ ã¯å¾Œã‹ã‚‰æŒ¿å…¥/å‰Šé™¤å¯èƒ½
- è¦ç´ ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯`static_vector`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã«é…ç½®ã•ã‚Œã‚‹
- `contiguous_range`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’æº€ãŸã™
- è¦ç´ å‹`T`ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«ã§ã‚ã‚Œã°ã€å…¨ã¦ã®æ“ä½œãŒå®šæ•°å¼ã§å¯èƒ½

ãªã©ã§ã€`static_vector`ã¯æ¬¡ã®ã‚ˆã†ãªå ´åˆã«æœ‰ç”¨ã§ã™

- å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿ã‚’è¡Œãˆãªã„
    - ä¾‹ãˆã°ã€çµ„ã¿è¾¼ã¿ç’°å¢ƒãªã©
- å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿ã®ã‚³ã‚¹ãƒˆãŒé«˜ãã¤ã
    - ä¾‹ãˆã°ã€ãƒ¡ãƒ¢ãƒªç¢ºä¿ã«ä¼´ã†ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã«æ•æ„Ÿãªãƒ—ãƒ­ã‚°ãƒ©ãƒ 
- é™çš„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šã«ã€å¤‰å‰‡çš„ãªç”Ÿå­˜æœŸé–“ã‚’ã‚‚ã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰ã—ãŸã„
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹ç¯‰ã§ããªã„å‹ã®é…åˆ—ãªã©ã€`std::array`ãŒé¸æŠè‚¢ã«ãªã‚‰ãªã„
- `constexpr`é–¢æ•°å†…ã§å¯å¤‰é•·é…åˆ—ã‚’ä½¿ç”¨ã—ãŸã„
    - ã“ã‚Œã¯C++20ä»¥é™`std::vector`ã§ã‚‚å¯èƒ½
- `static_vector`ã®è¦ç´ ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯`static_vector`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè‡ªä½“ãŒå†…åŒ…ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹
    - ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã®ãŸã‚ã®`memcpy`ã‚µãƒãƒ¼ãƒˆã®ãŸã‚ãªã©

ã“ã®ææ¡ˆã®`static_vector`ã¯æ—¢å­˜å®Ÿè£…ã§ã‚ã‚‹`boost::container::static_vector`ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ãŠã‚Šã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚„æ€§è³ªã¯`std::vector`ã¨ã®å…±é€šåŒ–ãŒå›³ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

```cpp
#include <static_vector> // <vector>ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„

int main() {
  std::static_vector<int, 8> sv = {1, 2, 3, 4};

  std::println("{}", sv); // [1, 2, 3, 4]

  sv.push_back(5);
  sv.emplace_back(6);

  std::print("{}", sv); // [1, 2, 3, 4, 5, 6]
}
```

ãªãŠã€æœ€å¤§ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã‚’è¶…ãˆã¦è¦ç´ ã‚’æŒ¿å…¥ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã€å…¨ã¦ã®æ“ä½œã«ãŠã„ã¦äº‹å‰æ¡ä»¶é•åã¨ã—ã¦æœªå®šç¾©å‹•ä½œã¨ãªã‚Šã¾ã™ã€‚ä¾‹å¤–ã‚’æŠ•ã’ãŸãƒª`abort`ã—ãŸã‚Šã™ã‚‹ã®ã‹ã¯å®Ÿè£…ã®é¸æŠã¨ã•ã‚Œã¾ã™ã€‚

- [Boost.Container static_vector - Faith and Brave - C++ã§éŠã¼ã†](https://faithandbrave.hateblo.jp/entry/20130712/1373614497)
- [Class template static_vector - Boost](https://www.boost.org/doc/libs/1_80_0/doc/html/boost/container/static_vector.html)
- [P0843 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/114)

### [P1255R9 A view of 0 or 1 elements: views::maybe](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1255r9.pdf)
### [P2019R1 Usability improvements for `std::thread`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2019r1.pdf)

`std::thread/std::jthread`ã«ãŠã„ã¦ã€ãã®ã‚¹ãƒ¬ãƒƒãƒ‰ã®ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã¨ã‚¹ãƒ¬ãƒƒãƒ‰åã‚’å®Ÿè¡Œé–‹å§‹å‰ã«è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®`std::thread/std::jthread`ã«ã¯ã€ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã‚’è¨­å®šã™ã‚‹æ–¹æ³•ã‚‚ã‚¹ãƒ¬ãƒƒãƒ‰åã‚’è¨­å®šã™ã‚‹æ–¹æ³•ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä¸€æ–¹ã§ã€ã“ã®2ã¤ã®ã‚¯ãƒ©ã‚¹ãŒä½¿ç”¨ã—ã¦ã„ã‚‹å®Ÿè¡Œç’°å¢ƒã®ã‚¹ãƒ¬ãƒƒãƒ‰APIã§ã¯ã€åºƒãã“ã®2ã¤ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®šãŒå¯èƒ½ã¨ãªã£ã¦ã„ã¾ã™ã€‚

|ç’°å¢ƒ|ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã®è¨­å®š|ã‚¹ãƒ¬ãƒƒãƒ‰åã®è¨­å®š|
|---|---|---|
|Linux, QNX|`pthread_attr_setstacksize()`|`pthread_setname_np()`|
|Windows|`CreateThread()`|`SetThreadDescription()`|
|Darwin|`pthread_attr_setstacksize()`|`pthread_setname_np()`|
|Fuchsia||`zx_thread_create()`|
|Android|`pthread_attr_setstacksize()`|`JavaVMAttachArgs()`|
|FreeBSD, OpenBSD, NetBSD|`pthread_attr_setstacksize()`|`pthread_setname_np()`|
|RTEMS|`pthread_attr_setstacksize()`|`pthread_setname_np()`|
|FreeRTOS|`xTaskCreate()`|`xTaskCreate()`|
|VxWorks|`taskSpawn()`|`taskSpawn()`|
|eCos|`cyg_thread_create()`|`cyg_thread_create()`|
|Plan 9|`threadcreate()`|`threadsetname()`|
|Haiku||`spawn_thread()`|
|Keil RTX||`osThreadNew()`|
|WebAssembly|||

â€» ç©ºç™½ã¯ãªã—ã€ã‚¹ãƒ¬ãƒƒãƒ‰åã®è¨­å®šã¯ä¸€éƒ¨äº‹å¾Œçš„ã«ã—ã‹è¡Œãˆãªã„ã‚‚ã®ãŒã‚ã‚‹

ã¾ãŸã€ä»–ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚„C++ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¹ãƒ¬ãƒƒãƒ‰APIã«ãŠã„ã¦ã‚‚ã€ã“ã‚Œã‚‰ã«å¯¾å¿œã—ãŸæ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã‚‹å ´åˆãŒå¤šãã¿ã‚‰ã‚Œã¾ã™ã€‚

- ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã®è¨­å®š : Java, Rust, Python, C#, Haskell, D, Perl, Swift, Boost, Qt
- ã‚¹ãƒ¬ãƒƒãƒ‰åã®è¨­å®š : Rust, Python, D, C#, Java, Raku, Swift, Qt, Folly

ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã®è¨­å®šã¯ã€æ¬¡ã®ã‚ˆã†ãªå ´åˆã«å¿…è¦ã¨ãªã‚Šã¾ã™

- ç‰¹å®šã®ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç§»æ¤æ€§ã¨ä¿¡é ¼æ€§ã®ãŸã‚ã«ã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–“ã§ä¸€è²«ã—ãŸã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã™ã‚‹
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ˆã‚Šã‚‚å°ã•ã„ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã‚’ä½¿ç”¨ã™ã‚‹
    - Windows : 1MB, Unix 2MB
    - å¤šæ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’èµ·å‹•ã—ãŸã¨ãã«ãƒ¡ãƒ¢ãƒªæ¶ˆè²»ã‚’æŠ‘ãˆã‚‰ã‚Œã‚‹ï¼ˆä»®æƒ³ãƒ¡ãƒ¢ãƒªã®ãªã„ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã„ã¦ï¼‰
- ä¸€éƒ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã«å¤§ããªã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’è¨­å®šã—ã€ãã“ã‹ã‚‰èµ·å‹•ã•ã‚ŒãŸã‚¹ãƒ¬ãƒƒãƒ‰ã«ã‚‚ç¶™æ‰¿ã•ã›ã‚‹ã‚‚ã®ãŒã‚ã‚‹ã€‚ã“ã‚ŒãŒæœ›ã¾ã—ããªã„å ´åˆãŒã‚ã‚‹
- æœ‰åãªã‚²ãƒ¼ãƒ ã‚„å¤§è¦æ¨¡ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ˆã‚Šã‚‚å¤§ãã„ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã‚ã‚‹

ã‚¹ãƒ¬ãƒƒãƒ‰åã¯ãƒ‡ãƒãƒƒã‚¬ã‚’å§‹ã‚ã¨ã™ã‚‹å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã«ãŠã„ã¦æœ‰ç”¨ã§ã€ä¸»ã«ãƒ‡ãƒãƒƒã‚°ã«æ´»ç”¨ã§ãã¾ã™

- ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã«ãŠã‘ã‚‹åˆ©ç”¨
- å„ç¨®ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ€ãƒ³ãƒ—ã‚„å®Ÿè¡Œãƒˆãƒ¬ãƒ¼ã‚¹ãƒ„ãƒ¼ãƒ«
- ã‚¿ã‚¹ã‚¯/ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ‹ã‚¿
- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«/ãƒˆãƒ¬ãƒ¼ã‚¹/è¨ºæ–­ãƒ„ãƒ¼ãƒ«
- Windows Performance Analyzer, ETW tracing

ã“ã‚Œã‚‰ã®ã“ã¨ãŒæ¬ ã‘ã¦ã„ã‚‹äº‹ã«ã‚ˆã£ã¦ã€`std::thread`ã‚„`std::jthread`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ããšã€ã»ã¼åŒç­‰ã®ã‚¯ãƒ©ã‚¹ã‚’å†å®Ÿè£…ã—ãŸã‚Šã€åŸºåº•ã®APIã‚’ç›´æ¥ä½¿ç”¨ã—ãŸã‚Šã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€ç­†è€…ã®æ–¹ã¯ã€ã€Œã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã®ã‚µãƒãƒ¼ãƒˆãŒãªã„ãŸã‚ã«`std::thread`ã‚’ä½¿ã†ã“ã¨ãŒã§ããšã€`std::thread`ã¯èªå½™å‹ã¨ã—ã¦å¤±æ•—ã—ã¦ã„ã‚‹ã€ã¨ã„ã†è©±ã‚’ã‚²ãƒ¼ãƒ é–‹ç™ºè€…ã®äººã€…ã‹ã‚‰èã„ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ãã‚Œã‚‰ã®æ—¢å­˜ã®ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’æ¨™æº–åŒ–ã™ã‚‹ã“ã¨ã§ã€ç¾åœ¨`std::thread/std::jthread`ã‚’ä½¿ç”¨ã§ãã¦ã„ãªã„æ‰€ã§ä½¿ç”¨å¯èƒ½ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã“ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹APIã¯ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£æŒ‡å®šã‚¯ãƒ©ã‚¹ã‚’`std::thread_attribute`ã‹ã‚‰ç¶™æ‰¿ã•ã›ã¦å®šç¾©ã—ãŸä¸Šã§ã€ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’`std::thread`ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§å—ã‘å–ã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

```cpp
namespace std {
  // ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£æŒ‡å®šè­˜åˆ¥ç”¨åŸºåº•ã‚¯ãƒ©ã‚¹
  class thread_attribute {};

  // ã‚¹ãƒ¬ãƒƒãƒ‰åã‚’æŒ‡å®šã™ã‚‹ã‚¯ãƒ©ã‚¹
  class thread_name : thread_attribute {
  public:
    constexpr thread_name(std::string_view name) noexcept;
    constexpr thread_name(std::u8string_view name) noexcept;
  private:
    implementation-defined __name[implementation-defined]; // èª¬æ˜å°‚ç”¨
  };

  // ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã™ã‚‹ã‚¯ãƒ©ã‚¹
  class thread_stack_size : thread_attribute {
  public:
    constexpr thread_stack_size(std::size_t size) noexcept;
  private:
    constexpr std::size_t __size; // èª¬æ˜å°‚ç”¨
  };


  class thread {
    ...

    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆå…ƒã‹ã‚‰ã‚ã‚‹
    thread() noexcept;

    // å‡¦ç†ã¨ãã®å¼•æ•°ã‚’å—ã‘å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆå…ƒã‹ã‚‰ã‚ã‚‹
    template<class F, class... Args>
    explicit thread(F&& f, Args&&... args);

    // å‡¦ç†ã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£æŒ‡å®šã‚’å—ã‘å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆã“ã®ææ¡ˆã§è¿½åŠ 
    template<class F, class... Attrs>
      requires (sizeof...(Attrs) != 0) &&
               ((is_base_of_v<thread_attribute, Attrs>) && ...) &&
               ...
    explicit thread(F&& f, Attrs&&... attrs);

    ...
  };

  // jthreadã‚‚åŒæ§˜ï¼ˆç•¥

}
```

`std::thread_name/std::thread_stack_size`ãŒæ¸¡ã•ã‚ŒãŸè¨­å®šå€¤ã‚’ã©ã®ã‚ˆã†ã«ä¿æŒã—ã¦å–ã‚Šå‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ã‹ã¯å®Ÿè£…å®šç¾©ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚‚ã®ã‚’æ¬¡ã®ã‚ˆã†ã«ä½¿ç”¨ã—ã¦ã‚¹ãƒ¬ãƒƒãƒ‰ã«è¨­å®šã—ã¾ã™ã€‚

```cpp
void f();

int main() {
  // ã‚¹ãƒ¬ãƒƒãƒ‰åã¨ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã®æŒ‡å®š
  std::jthread thread(f, std::thread_name("Worker"),
                         std::thread_stack_size(512*1024));
  return 0;
}
```

æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒè¨­å®šå¯èƒ½ã§ãªã„å ´åˆï¼ˆä¾‹ãˆã°WASMç’°å¢ƒãªã©ï¼‰ã€å®Ÿè£…ã¯ã“ã®æŒ‡å®šã‚’ç„¡è¦–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£æŒ‡å®šã®æ–¹æ³•ã¯ã“ã®2ã¤ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä»¥å¤–ã«ã‚‚æ‹¡å¼µå¯èƒ½ã§ã€ä¾‹ãˆã°ã‚¹ãƒ¬ãƒƒãƒ‰ã®ã‚¢ãƒ•ã‚£ãƒ‹ãƒ†ã‚£ã‚„å„ªå…ˆåº¦ã‚’æŒ‡å®šå¯èƒ½ã¨ã™ã‚‹ã“ã¨ã‚‚å°†æ¥çš„ã«ã¯å¯èƒ½ãªã‚ˆã†ã«ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¨ã¯ã„ãˆã€ã“ã®ææ¡ˆã§ã¯ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚ºã¨ã‚¹ãƒ¬ãƒƒãƒ‰åã®2ã¤ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã¿ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

- [P2019 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/817)

### [P2164R6 views::enumerate](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2164r6.pdf)
### [P2264R4 Make assert() macro user friendly for C and C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2264r4.html)
### [P2477R3 Allow programmers to control coroutine elision](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2477r3.html)
### [P2511R2 Beyond operator(): NTTP callables in type-erased call wrappers](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2511r2.html)
### [P2517R1 Add a conditional noexcept specification to std::apply](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2517r1.html)
### [P2537R1 Relax va_start Requirements to Match C](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2537r1.html)
### [P2581R1 Specifying the Interoperability of Built Module Interface Files](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2581r1.pdf)
### [P2587R2 to_string or not to_string](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2587r2.html)
### [P2611R0 2022-07 Library Evolution Poll Outcomes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2611r0.html)

2022å¹´ã®7æœˆã«è¡Œã‚ã‚ŒãŸã€LEWGã§ã®å…¨ä½“æŠ•ç¥¨ã®çµæœã€‚

æ¬¡ã®ææ¡ˆãŒã€LWGã«è»¢é€ã•ã‚Œã‚‹ã“ã¨ãŒæ‰¿èªã•ã‚Œã¾ã—ãŸ

- C++23
    - [P0429R9 flat_map](https://wg21.link/P0429R9)
    - [P1222R4 flat_set](https://wg21.link/P1222R4)
    - [P0792R10 function_ref](https://wg21.link/P0792R10)
    - [P2505R4 Monadic Functions For expected](https://wg21.link/P2505R4)
    - [P2585R0 Improving Default Container Formatting](https://wg21.link/P2585R0)
    - [P2446R2 views::as_rvalue](https://wg21.link/P2446R2)
    - [P2278R4 cbegin Should Always Return A Constant Iterator](https://wg21.link/P2278R4)
    - [P2248R5 Enabling List-Initialization For Algorithms](https://wg21.link/P2248R5)
    - [P2539R1 Should The Output Of print To A Terminal Be Synchronized With The Underlying Stream?](https://wg21.link/P2539R1)
    - [P2551R2 Clarify Intent Of Individually Specializable Numeric Traits](https://wg21.link/P2551R2)
    - [P2599R2 index_type & size_type In mdspan](https://wg21.link/P2599R2)
    - [P2604R0 mdspan: Rename pointer, data, And contiguous](https://wg21.link/P2604R0)
    - [P2613R1 Add The Missing empty To mdspan](https://wg21.link/P2613R1)
- C++26
    - [P2338R2 Freestanding Library: Character Primitives And The C Library](https://wg21.link/P2338R2)
    - [P2407R1 Freestanding Library: Partial Classes](https://wg21.link/P2407R1)
    - [P2562R1 constexpr Stable Sorting](https://wg21.link/P2562R1)
    - [P2283R2 constexpr Specialized Memory Algorithms](https://wg21.link/P2283R2)
    - [P2542R2 views::concat](https://wg21.link/P2542R2)
    - [P2609R1 Relaxing Ranges Just A Smidge](https://wg21.link/P2609R1)

C++23å‘ã‘ã®ææ¡ˆã®ä¸€éƒ¨ã¯ã€7æœˆã®å…¨ä½“ä¼šè­°ã§C++23ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‰ãƒ©ãƒ•ãƒˆå…¥ã‚ŠãŒæ‰¿èªã•ã‚ŒãŸã‚‚ã®ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼ˆå…¨ä½“ä¼šè­°ã§ã¯ã“ã‚Œã«ã¤ã„ã¦LWGã®åº§é•·ãŒè‹¦è¨€ã‚’å‘ˆã—ã¦ã„ãŸã‚ˆã†ã§ã™ãŒãƒ»ãƒ»ãƒ»ï¼‰ã€‚

ã¾ãŸã€æŠ•ç¥¨ã«ã‚ãŸã£ã¦å¯„ã›ã‚‰ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P2620R1 Lifting artificial restriction on universal character names](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2620r1.pdf)
### [P2621R1 UB? In my Lexer?](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2621r1.pdf)
### [P2623R1 implicit constant initialization](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2623r1.html)
### [P2625R0 Slides: Life without operator() (P2511R1 presentation)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2625r0.pdf)

P2511ï¼ˆ`std::nontype`ï¼‰ã®è§£èª¬ã‚¹ãƒ©ã‚¤ãƒ‰ã€‚

P2511ã¯`std::function, std::move_only_function`ï¼ˆå°†æ¥çš„ã«ã¯`std::function_ref`ã«ã‚‚ï¼‰ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãªãç°¡æ˜“ãªãƒ¡ãƒ³ãƒãƒã‚¤ãƒ³ã‚¿ã‚µãƒãƒ¼ãƒˆã‚’å…¥ã‚Œã‚ˆã†ã¨ã™ã‚‹ææ¡ˆã§ã™ã€‚è©³ç´°ã¯ä»¥å‰ã®è¨˜äº‹å‚ç…§

- [P2511R0 Beyond `operator()`: NTTP callables in type-erased call wrappers - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/02/19/181101#P2511R0-Beyond-operator-NTTP-callables-in-type-erased-call-wrappers)
- [P2511R1 Beyond `operator()`: NTTP callables in type-erased call wrappers - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´03æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/02/19/181101#P2511R0-Beyond-operator-NTTP-callables-in-type-erased-call-wrappers)

ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã¯LEWGã®ãƒ¡ãƒ³ãƒã«å‘ã‘ã¦P2511ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚„åˆ©ç‚¹ã€ä½¿ç”¨æ„Ÿã«ã¤ã„ã¦èª¬æ˜ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

### [P2626R0 `charN_t` incremental adoption: Casting pointers of UTF character types](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2626r0.pdf)

äº’æ›æ€§ã®ã‚ã‚‹ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—è¡¨ç¾ã‚’æŒã¤ç•°ãªã‚‹å‹ã®é–“ã§ã®åˆæ³•çš„ãªãƒã‚¤ãƒ³ã‚¿ã‚­ãƒ£ã‚¹ãƒˆã‚’è¡Œã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã®ææ¡ˆã€‚

`char8_t, char16_t, char32_t`ï¼ˆä»¥é™ã€ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—å‹ï¼‰ãªã©ã®ç™»å ´å‰ã€C++ã§ã¯ä»»æ„ã®ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—ï¼ˆåˆ—ï¼‰ã‚’è¡¨ã™ã®ã«`char`ã‚’ä½¿ç”¨ã—ã¦ãƒã‚¤ãƒˆå˜ä½ã§ãã‚Œã‚‰ã‚’æ‰±ã†ã“ã¨ãŒã‚ˆãè¡Œã‚ã‚Œã¦ã„ã¾ã—ãŸã€‚ã—ã‹ã—ã€`char`ã¯ãã‚Œè‡ªèº«ãŒæ–‡å­—å‹ã§ã‚ã‚Šã€ã—ã°ã—ã°ãã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯UTF-8ã§ã¯ãªãã€æ•´æ•°å‹ã‚„ãƒã‚¤ãƒˆå‹ã¨åŒºåˆ¥ã•ã‚Œãšã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚`char`ã¯æ–‡å­—ã€ç‰¹ã«ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—ã‚’è¡¨ã™å‹ã¨ã—ã¦ã¯é©åˆ‡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ãã®ã‚ˆã†ãªèƒŒæ™¯ã‚‚ã‚ã£ã¦C++11ã§`char16_t, char32_t`ãŒã€C++20ã§`char8_t`ãŒå°å…¥ã•ã‚Œã€ã“ã‚Œã‚‰ã‚’ç”¨ã„ã¦å‹ã«ã‚ˆã£ã¦æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ã—ã‹ã—ã€C++20ã‚ã‚‹ã„ã¯C++11ä»¥å‰ã‹ã‚‰ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã¯å‰è¿°ã®`char`ã‚’ç”¨ã„ãŸãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒæ®‹ã£ã¦ãŠã‚Šã€ã¾ãŸ`wchar_t`ç­‰åˆ¥ã®æ–¹æ³•ã§ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—ï¼ˆåˆ—ï¼‰ã‚’è¡¨ç¾ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒå¤šæ•°å­˜åœ¨ã—ã¦ã„ã¾ã™ã€‚ãã‚Œã‚‰ã®æ–¹æ³•ã§è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—åˆ—ã¨ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—å‹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«ã‚ˆã‚‹ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—åˆ—ã¨ã®é–“ã§ã‚³ãƒ”ãƒ¼ã‚„æœªå®šç¾©å‹•ä½œã‚’ä¼´ã†ã“ã¨ãªãå¤‰æ›ã™ã‚‹æ–¹æ³•ãŒãªã„ã“ã¨ã‹ã‚‰ã€ãã‚Œã‚‰ã®ãƒ¬ã‚¬ã‚·ãƒ¼ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—å‹ã‚’ã‚¢ãƒ€ãƒ—ãƒˆã§ããšã€ãã‚Œã«ã‚ˆã£ã¦ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—å‹ã®ä½¿ç”¨ãŒå¦¨ã’ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—å‹ã¨æ—¢å­˜ã®`char`æ–‡å­—åˆ—ã‚„`wchar_t`æ–‡å­—åˆ—ãªã©ã¨ã®é–“ã§ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä»®å®šã—ãã‚Œã‚’ä¿æŒã—ãŸã¾ã¾å¤‰æ›ã™ã‚‹ãŸã‚ã®é–¢æ•°ã‚’æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãã®ã‚ˆã†ãªå•é¡Œã‚’è§£æ±ºã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã“ã§ææ¡ˆã•ã‚Œã¦ã„ã‚‹ã®ã¯ã€æ¬¡ã®2ã¤ã®é–¢æ•°ã§ã™

- `std::cast_as_utf_unchecked()` : `std::byte, char, wchar_t`ã‚ã‚‹ã„ã¯ã‚µã‚¤ã‚º`N`ã®ç¬¦å·ãªã—æ•´æ•°å‹ã®ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰ã€`charN_t`ã®ãƒã‚¤ãƒ³ã‚¿ã¸å¤‰æ›ã™ã‚‹
- `std::cast_utf_to<T>()` : `charN_t`ã®ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰`T`ã®ãƒã‚¤ãƒ³ã‚¿ã¸å¤‰æ›ã™ã‚‹
  - `T`ã¯`std::byte, char, wchar_t`ã‚ã‚‹ã„ã¯ã‚µã‚¤ã‚º`N`ã®ç¬¦å·ãªã—æ•´æ•°å‹
  - `std::cast_as_utf_unchecked()`ã®é€†å¤‰æ›

ã“ã®2ã¤ã®é–¢æ•°ã¯`std::start_lifetime_as_array()`ã‚’é©åˆ‡ã«ãã®æ–‡å­—åˆ—ã«å¯¾ã—ã¦é©ç”¨ã™ã‚‹ã®ã¨ä¼¼ãŸã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒã¡ã€ã‚½ãƒ¼ã‚¹é ˜åŸŸã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã‚’çµ‚äº†ã•ã›ã€æŒ‡å®šã•ã‚ŒãŸå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã‚’ãã®å€¤ã‚’ä¿ã£ãŸã¾ã¾é–‹å§‹ã•ã›ã¾ã™ã€‚ãŸã ã—ã€å˜ãªã‚‹`constexpr std::start_lifetime_as_array()`ã§ã¯ãªãã€é©åˆ‡ãªæ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚µãƒãƒ¼ãƒˆã®ãŸã‚ã«ã€è¿½åŠ ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚µãƒãƒ¼ãƒˆã‚’å¿…è¦ã¨ã—ã¾ã™ã€‚

æœ‰åŠ¹ãªå¤‰æ›ã®ä¾‹

||`char8_t`|`char16_t`|`char32_t`|
|---|:-:|:-:|:-:|
|`char`|âœ…|âŒ|âŒ|
|`unsigned char`|âœ…|âŒ|âŒ|
|`uit_least_16_t`|âŒ|âœ…|âŒ|
|`uit_least_32_t`|âŒ|âŒ|âœ…|
|`wchar_t`|â—ï¸|â—ï¸|â—ï¸|
|`std::byte`|âœ…|âŒ|âŒ|

è¡Œè¦ç´ ->åˆ—è¦ç´  : `std::cast_as_utf_unchecked()`
åˆ—è¦ç´ ->è¡Œè¦ç´  : `std::cast_utf_to<T>()`

è¡¨ä¸­ã®â—ï¸ã¯å®Ÿè£…å®šç¾©ã§ã‚ã‚‹ã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®é–¢æ•°ã¯ãã®å¤‰æ›ã«ã‚ãŸã£ã¦å®Ÿéš›ã«ãã®å¤‰æ›ãŒæœ‰åŠ¹ãªã®ã‹ã¨ã‹ã€æ–‡å­—ãŒãã¡ã‚“ã¨å¤‰æ›å…ˆã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«ãªã£ã¦ã„ã‚‹ã®ã‹ãªã©ã®ãƒã‚§ãƒƒã‚¯ã‚’ä¸€åˆ‡è¡Œã„ã¾ã›ã‚“ãŒã€ã“ã‚Œã‚‰ã®é–¢æ•°ã‚’ä½¿ç”¨ã—ãŸå¤‰æ›ã¯ãã®æ„å›³ã‚’ã‚³ãƒ¼ãƒ‰ã«åæ˜ ã•ã›ã‚‹æ„å‘³ã‚‚æŒã¡ã¾ã™ã€‚ä¾‹ãˆã°ã€`std::cast_as_utf_unchecked()`ã«ã‚ˆã£ã¦`char8_t`ã«å¤‰æ›ã™ã‚‹å ´åˆã€å¤‰æ›å¾Œã®æ–‡å­—åˆ—ã¯UTF-8ã®æ­£ã—ã„ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã§ã‚ã‚Šãã†ãªã£ã¦ã„ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ã“ã®ã‚ˆã†ã«ã€æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«ã¤ã„ã¦ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒã®æš—é»™çš„ãªä»®å®šã‚’ã‚³ãƒ¼ãƒ‰ä¸Šã§æ˜ç¢ºã«ã™ã‚‹å½¹å‰²ã‚’æ‹…ã£ã¦ã‚‚ã„ã¾ã™ã€‚

```cpp
// ç¾åœ¨ã‚ˆãè©¦ã¿ã‚‰ã‚Œã‚‹æ–¹æ³•
void before() {
  // å…¥åŠ›æ–‡å­—åˆ—ï¼ˆwchar_tã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’UTF-16ã¨ã™ã‚‹ï¼‰
  const wchar_t* str = L"Hello ğŸŒ";

  // å¤šãã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ: ill-formed
  const char16_t* u = static_cast<const char16_t*>(str);

  // çµŒé¨“10å¹´ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ: UB
  const char16_t* u = reinterpret_cast<const char16_t*>(str);

  // Cã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ: UB in C++
  const char16_t* u = (const char16_t*)(str);

  // rangesã®åˆ©ç”¨: O(n)ã‹ã‹ã‚‹ã€contiguous_rangeã§ãªããªã‚‹
  auto v = std::wstring_view(str) | std::views::transform(std::bit_cast<char16_t, wchar_t>);

  // åˆ¥ã®ãƒ¡ãƒ¢ãƒªã«ã‚³ãƒ”ãƒ¼: O(n)ã€å‹•çš„ç¢ºä¿
  auto v = std::wstring_view(str) | std::views::transform(std::bit_cast<char16_t, char16_t>) 
                                  | std::to<std::vector>;

  // launderã®åˆ©ç”¨: ã¾ã UB
  const char16_t* u = std::launder(reinterpret_cast<const char16_t*>(str));

  // ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ: constexprã§ã¯ãªã„
  const char16_t* u = std::start_lifetime_as_array(reinterpret_cast<const char16_t*>(str), std::char_traits<wchar_t>::length(str));
}

// ã“ã®ææ¡ˆ
void after() {
  // ã‚³ãƒ”ãƒ¼ãªã—ã€UBãªã—ã€constexprã€æ˜ç¢ºãªã›ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒã¡å®Ÿéš›ã«ã¯ä½•ã‚‚ã—ãªã„
  constexpr std::u16_string_view v = std::cast_as_utf_unchecked(L"Hello"sv);
}
```

åˆ©ä¾¿æ€§å‘ä¸Šã®ãŸã‚ã€`std::cast_as_utf_unchecked()`ã¨`std::cast_utf_to<T>()`ã«ã¯ãã‚Œãã‚Œã€`string_view`ã¨`span`ã‚’å—ã‘å–ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒç”¨æ„ã•ã‚Œã¾ã™ã€‚

- [P2590R0 Explicit lifetime management - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/06/11/191943#P2590R0-Explicit-lifetime-management)
- [P2626 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1289)

### [P2627R0 WG21 2022-07 Virtual Meeting Record of Discussion](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2627r0.pdf)

2022/07ã®å…¨ä½“ä¼šè­°ã®è­°äº‹éŒ²ã€‚

N4916ã®ã‚‚ã®ã‚ˆã‚Šã‚‚ã€èª°ãŒã©ã®ã‚ˆã†ãªç™ºè¨€ã‚’ã—ãŸã‹ãŒè©³ã—ãè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚

### [P2628R0 Extend barrier APIs with memory_order](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2628r0.html)

`std::barrier`ã®å„æ“ä½œã«ã€ãƒ¡ãƒ¢ãƒªã‚ªãƒ¼ãƒ€ãƒ¼ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

[`std::barrier`](https://cpprefjp.github.io/reference/barrier/barrier.html)ã¯C++20ã§è¿½åŠ ã•ã‚ŒãŸã€è¤‡æ•°ã‚¹ãƒ¬ãƒƒãƒ‰ã®é€²è¡Œç®¡ç†ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã®ã§ãã‚‹åŒæœŸãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã§ã™ã€‚ãã®å®Ÿä½“ã¯ã‚«ã‚¦ãƒ³ã‚¿ã§ã‚ã‚Šã€`.arrive()`ã«ã‚ˆã£ã¦ã‚«ã‚¦ãƒ³ã‚¿æ¸›ç®—ã‚’ã€`.wait()`ã«ã‚ˆã£ã¦ã‚«ã‚¦ãƒ³ã‚¿ãƒªã‚»ãƒƒãƒˆã¾ã§ã®å¾…æ©Ÿã‚’è¡Œã„ã¾ã™ã€‚ã»ã‹ã«ã‚‚ã€ãã‚Œã‚‰ã®è¤‡åˆæ“ä½œã§ã‚ã‚‹`.aarrive_and_wait()`ã€åŒæœŸã™ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰é€”ä¸­é›¢è„±ã™ã‚‹ãŸã‚ã®`.arrive_and_drop()`ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®`std::barrier`ã®APIã¯å…¨ã¦ãƒ¡ãƒ¢ãƒªã‚ªãƒ¼ãƒ€ãƒ¼ã‚’æŒ‡å®šã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€`.arrive()`ã‚ˆã‚Šã‚‚å‰ã«è¡Œã‚ã‚ŒãŸå…¨ã¦ã®ãƒ¡ãƒ¢ãƒªæ“ä½œã¯ã€`.wait()`ã«ã‚ˆã‚‹å¾…æ©Ÿè§£é™¤å¾Œã«å¯è¦–ã«ãªã‚‹ã“ã¨ãŒï¼ˆã™ã¹ã¦ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«æ¸¡ã£ã¦ï¼‰ä¿è¨¼ã•ã‚Œã¾ã™ã€‚

ã“ã®ä¿è¨¼ã¯ã‹ãªã‚Šå¼·ã„ã‚‚ã®ã§ã€å ´åˆã«ã‚ˆã£ã¦ã¯ã“ã®ä¿è¨¼ãŒæœ›ã¾ã—ããªã„å ´åˆãŒã‚ã‚Šã¾ã™

1. C++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å¤–éƒ¨ã¨ã‚„ã‚Šå–ã‚Šã‚’ã™ã‚‹å ´åˆ
    - ä¾‹ãˆã°ã€ãƒãƒªã‚¢ã«å‚åŠ ã™ã‚‹ã™ã¹ã¦ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒãã‚Œãã‚Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦èª­ã¿æ›¸ãã™ã‚‹æ™‚ã€`.arrive_and_wait(1, memory_order_relaxed)`ã«ã‚ˆã£ã¦ã™ã¹ã¦ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‰ã˜ãŸã“ã¨ã‚’åŒæœŸã™ã‚‹ã€‚
      - ã“ã®å ´åˆã€ãƒ¡ãƒ¢ãƒªã®å¯è¦–æ€§ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¯ãƒ­ãƒ¼ã‚ºã®å¯è¦–æ€§ï¼‰ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã£ã¦ç¢ºä¿ã•ã‚Œã‚‹
    - ä¾‹ãˆã°ã€ã™ã¹ã¦ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã¯`volatile`æ“ä½œã«ã‚ˆã£ã¦å®Ÿè¡Œç’°å¢ƒï¼ˆãƒã‚·ãƒ³ï¼‰ã®è¨­å®šã‚’è¡Œã£ã¦ã‹ã‚‰ã€ãã®ä¸­ã®1ã¤ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒç’°å¢ƒã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã•ã›ã‚‹ã‚ˆã†ãªå ´åˆã€‚ã“ã‚Œã¯ã€`memory_order_relaxed`ãª`.arrive()/.wait()`æ“ä½œã¨ã€`std::barrier`ã®å®Œäº†é–¢æ•°ã«ã‚ˆã£ã¦å®Ÿç¾ã§ãã‚‹ã€‚
      - ã“ã®å ´åˆã€`volatile`ãªæ›¸ãè¾¼ã¿ãŒç’°å¢ƒé–‹å§‹æ™‚ï¼ˆå¾…æ©Ÿè§£é™¤å¾Œï¼‰ã«å¯è¦–ã«ãªã£ã¦ã„ã‚Œã°ã‚ˆãã€ãã‚Œã¯`volatile`æ“ä½œã«ã‚ˆã£ã¦ä¿è¨¼ã•ã‚Œã‚‹ã€‚
2. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚§ãƒ³ã‚¹ï¼ˆ[P2535](https://wg21.link/P2535)ï¼‰ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ
    - ä¸€éƒ¨ã®ãƒ¡ãƒ¢ãƒªæ“ä½œã«ã¤ã„ã¦ã®ã¿å¯è¦–ã«ãªã‚Œã°ã‚ˆãã€ã™ã¹ã¦ã®ãƒ¡ãƒ¢ãƒªæ“ä½œã«ãã®ä¿è¨¼ã¯å¿…è¦ãªã„

ã“ã®ææ¡ˆã¯ã€ã“ã‚Œã‚‰ã®å ´åˆãªã©ã«ã€`std::barrier`ã‚’ç”¨ã„ãŸã‚ˆã‚ŠåŠ¹ç‡çš„ãªåŒæœŸã‚’å¯èƒ½ã¨ã™ã‚‹ãŸã‚ã«ã€`std::barrier`ã®APIãŒ`std::memory_order`ã‚’è¿½åŠ ã§å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«æ‹¡å¼µã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ä¸Šè¨˜2ã®ã‚±ãƒ¼ã‚¹ã®ã‚µãƒ³ãƒ—ãƒ«

<table>
<tr>
<th>ç¾åœ¨</th>
<th>ã“ã®ææ¡ˆ</th>
</tr>
<tr>
<td valign="top">

```cpp
// Thread 0:
x = 1;
atomic_object_fence(memory_order_release, x);
bar.arrive(); // release fence

// Thread 1
bar.arrive_and_wait(); // acquire fence
atomic_object_fence(memory_order_acquire, x);
assert(x == 1);
```

</td>
<td valign="top">

```cpp
// Thread 0:
x = 1;
atomic_object_fence(memory_order_release, x);
bar.arrive(1, memory_order_relaxed); // no fence

// Thread 1
bar.arrive_and_wait(memory_order_relaxed); // no fence
atomic_object_fence(memory_order_acquire, x);
assert(x == 1);
```

</pre>
</td>
</tr>
</table>

ç¾åœ¨ã®ä¾‹ã§ã¯ã€ã“ã®å ´åˆã®`atomic_object_fence`ã¯æ„å‘³ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆ`std::barrier`ãŒã‚ˆã‚Šå¼·ã„åŒæœŸã‚’ä¿è¨¼ã—ã¦ã„ã‚‹ãŸã‚ï¼‰ã€‚ã“ã®ææ¡ˆå¾Œã€`memory_order_relaxed`ã¨å…±ã«`std::barrier`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§`std::barrier`ã®ä¿è¨¼ãŒã»ã¼ãªããªã‚Šã€`atomic_object_fence`ã«ã‚ˆã£ã¦ç‰¹å®šã®å¤‰æ•°ã®ãƒ¡ãƒ¢ãƒªå¯è¦–æ€§ã®ã¿ãŒä¿è¨¼ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆãã‚Œã«ã‚ˆã£ã¦ã€åŒæœŸã®ã‚³ã‚¹ãƒˆä½æ¸›ãŒå¯èƒ½ã¨ãªã‚Šã†ã‚‹ï¼‰ã€‚

ã“ã®ææ¡ˆã®å†…å®¹ã¯`std::latch`ã‚’ã¯ã˜ã‚ã¨ã—ãŸä»–ã®åŒæœŸãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã«ã‚‚é©ç”¨å¯èƒ½ã§ã™ãŒã€ã“ã®ææ¡ˆã§ã¯ç¾åœ¨ã®ã¨ã“ã‚ã€`std::barrier`ã«ã®ã¿ç„¦ç‚¹ã‚’çµã£ã¦ã„ã¾ã™ã€‚

- [C++20 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ 1](https://github.com/onihusube/books/blob/master/cpp20_lib/document.md#latch%E3%81%A8barrier)
- [P2535R0 Message fences - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P2535R0-Message-fences)
- [P2628 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1291)

### [P2629R0 barrier token-less split arrive/wait](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2629r0.html)
### [P2630R0 Submdspan](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2630r0.html)
### [P2633R0 thread_local_inherit: Enhancing thread-local storage](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2633r0.html)
### [P2634R0 Allow qualifiers in constructor declarations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2634r0.html)
### [P2635R0 Enhancing the break statement](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2635r0.html)
