# ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´05æœˆï¼‰

æ–‡æ›¸ã®ä¸€è¦§

- [JTC1/SC22/WG21 - Papers 2022 mailing2022-06](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/#mailing2022-06)

å…¨éƒ¨ã§46æœ¬ã‚ã‚Šã¾ã™ã€‚

[:contents]


### [P0009R17 MDSPAN](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0009r17.html)

å¤šæ¬¡å…ƒé…åˆ—ã«å¯¾ã™ã‚‹`std::span`ã§ã‚ã‚‹ã€`mdspan`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0009R12 MDSPAN - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/06/13/165215#P0009R12-MDSPAN)
- [P0009R13 MDSPAN - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/11/13/193322#P0009R13-MDSPAN)
- [P0009R14 MDSPAN - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/12/11/220126#P0009R14-MDSPAN)
- [P0009R15 MDSPAN - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P0009R15-MDSPAN)
- [P0009R16 MDSPAN - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´03æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/04/02/175835#P0009R16-MDSPAN)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€LWGã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã¦ã®æ–‡è¨€ã®ä¿®æ­£ã€P2553ã¨P2554ã®å¤‰æ›´ã‚’ãƒãƒ¼ã‚¸ã—ãŸã“ã¨ã€`submdspan`ã‚’åˆ¥ã®ææ¡ˆã«åˆ†é›¢ã—ãŸã“ã¨ãªã©ã§ã™ã€‚

- [P2553R1 Make mdspan `size_type` controllable - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´03æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/04/02/175835#P2553R1-Make-mdspan-size_type-controllable)
- [P2554R0 C-Array Interoperability of MDSpan - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P2554R0-C-Array-Interoperability-of-MDSpan)
- [P0009 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/96)

### [P0429R9 A Standard `flat_map`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0429r9.pdf)

ã‚­ãƒ¼ã®æ¤œç´¢ã‚’`std::map`æ¯”ã§é«˜é€Ÿã«è¡Œãˆã‚‹é€£æƒ³ã‚³ãƒ³ãƒ†ãƒŠã€`flat_map`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0429R8 A Standard `flat_map` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/05/08/195618#P0429R8-A-Standard-flat_map)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯`flast_set`ï¼ˆP1222ï¼‰ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®é–¢é€£ã™ã‚‹éƒ¨åˆ†ã®æ–‡è¨€ä¿®æ­£ã‚’é©ç”¨ã—ãŸã“ã¨ã®ã‚ˆã†ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚’æŒã£ã¦LWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµ‚ãˆã¦ãŠã‚Šã€æ¬¡ã®å…¨ä½“ä¼šè­°ã§æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã‚‹äºˆå®šã§ã™ã€‚

- [P2569 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/101)

### [P0447R20 Introduction of `std::hive` to the standard library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0447r20.html)

è¦ç´ ãŒå‰Šé™¤ã•ã‚Œãªã„é™ã‚Šãã®ãƒ¡ãƒ¢ãƒªä½ç½®ãŒå®‰å®šãªã‚³ãƒ³ãƒ†ãƒŠã§ã‚ã‚‹`std::hive`ï¼ˆæ—§å`std::colony`ï¼‰ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0447R11 Introduction of std::colony to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/12/06/015108#P0447R11-Introduction-of-stdcolony-to-the-standard-library)
- [P0447R12 Introduction of std::colony to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/02/11/153333#P0447R12-Introduction-of-stdcolony-to-the-standard-library)
- [P0447R13 Introduction of std::colony to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P0447R13-Introduction-of-stdcolony-to-the-standard-library)
- [P0447R14 Introduction of std::colony to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/06/13/165215#P0447R14-Introduction-of-stdcolony-to-the-standard-library)
- [P0447R15 Introduction of std::hive to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´06æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/07/12/182757#P0447R15-Introduction-of-stdhive-to-the-standard-library)
- [P0447R16 Introduction of std::hive to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/10/03/193523#P0447R16-Introduction-of-stdhive-to-the-standard-library)
- [P0447R17 Introduction of std::hive to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/12/11/220126#P0447R17-Introduction-of-stdhive-to-the-standard-library)
- [P0447R18 Introduction of std::hive to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/02/19/181101#P0447R18-Introduction-of-stdhive-to-the-standard-library)
- [P0447R19 Introduction of std::hive to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P0447R19-Introduction-of-stdhive-to-the-standard-library)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€

- ã‚³ãƒ³ãƒ†ãƒŠã®`== != <=>`æ¼”ç®—å­å‰Šé™¤
- å‚ç…§å®Ÿè£…ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹äº’æ›æ€§ã«ã¤ã„ã¦è¿½è¨˜
- `sort()`ã®è¨ˆç®—é‡ã®è¦å®šã‚’å‰Šé™¤
- `range`ã‚’å—ã‘å–ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã®è¿½åŠ 
- `block_capacity_hard_limits()`ã®è¿½åŠ 
- FAQã®æ‹¡å……
- `memory()`ã®å‰Šé™¤
- `trim()`ã‚’`trim_capacity()`ã¸å¤‰æ›´
- ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºåˆ¶é™ã‚’å—ã‘å–ã‚‹é–¢æ•°ãŒãã®åˆ¶é™ã‚’æº€ãŸã›ãªã„å ´åˆã€ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã—ã¦ã„ãŸã®ã‚’æœªå®šç¾©å‹•ä½œã¸å¤‰æ›´
- `unique()`ã®è¿½åŠ 
- `erase()`ã«ã‚ˆã£ã¦ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹æ¡ä»¶ã®æ˜ç¢ºåŒ–
- `get_iterator()`ãŒ`const`ãƒã‚¤ãƒ³ã‚¿ã‚’å–ã‚‹ã‚ˆã†ã«å¤‰æ›´
- `advance/distance/next/prev`ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’å‰Šé™¤
- `hive_limits`ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’`constexpr`åŒ–
- `is_activeï¼ˆconst_iterator`
- æ™‚é–“è¨ˆç®—é‡ã®ä¿®æ­£
- `trim_capacity(n)`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã®è¿½åŠ 
- `hive_limit`ã‚’å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã§ã¯ãªãå€‹åˆ¥ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«åˆ†é›¢
- ã„ãã¤ã‹ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«ã‚ˆã‚‹æ–‡è¨€ä¿®æ­£

ãªã©ã§ã™ã€‚

- [P0447 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/328)

### [P0792R10 `function_ref`: a non-owning reference to a Callable](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0792r10.html)

*Callable*ã‚’æ‰€æœ‰ã—ãªã„`std::function`ã§ã‚ã‚‹`std::function_ref`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0792R6 function_ref: a non-owning reference to a Callable - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/02/19/181101#P0792R6-function_ref-a-non-owning-reference-to-a-Callable)
- [P0792R8 function_ref: a non-owning reference to a Callable - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P0792R8-function_ref-a-non-owning-reference-to-a-Callable)
- [P0792R9 function_ref: a non-owning reference to a Callable - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/06/11/191943#P0792R9-function_ref-a-non-owning-reference-to-a-Callable)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€`nontype_t`ï¼ˆ[P2472R3](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2472r3.html)ï¼‰ã‚’å—ã‘å–ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ ã—ãŸã“ã¨ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ç¾åœ¨ã€LEWGã‹ã‚‰LWGã¸é€²ã‚€ãŸã‚ã®æŠ•ç¥¨å¾…ã¡ã‚’ã—ã¦ã„ã¾ã™ã€‚

- [P2472R1 make_function_ref: A More Functional function_ref - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P2472R1-make-function_ref-more-functional)
- [P2511R0 Beyond operator(): NTTP callables in type-erased call wrappers - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/02/19/181101#P2511R0-Beyond-operator-NTTP-callables-in-type-erased-call-wrappers)
- [P0792 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/256)

### [P0957R8 Proxy: A Polymorphic Programming Library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0957r8.pdf)

é™çš„ãªå¤šæ…‹çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ãŸã‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã€"Proxy"ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P0957R5 Proxy: A Polymorphic Programming Library - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P0957R5-Proxy-A-Polymorphic-Programming-Library)
- [P0957R6 Proxy: A Polymorphic Programming Library - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´03æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/04/02/175835#P0957R6-Proxy-A-Polymorphic-Programming-Library)
- [P0957R7 Proxy: A Polymorphic Programming Library - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/05/08/195618#P0957R7-Proxy-A-Polymorphic-Programming-Library)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒã‚¯ãƒ­ã®è¿½åŠ ã€R5ã§ææ¡ˆã•ã‚Œã¦ã„ãŸï¼ˆR6ã§æ¶ˆã•ã‚ŒãŸï¼‰æ§‹æ–‡ã‚’CPOã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹å½¢ã§å¾©å¸°ã€å®Ÿè£…ã¸ã®ãƒªãƒ³ã‚¯è¿½åŠ ã€ãªã©ã§ã™ã€‚

æ®‹å¿µãªãŒã‚‰ã€ã“ã®ææ¡ˆã¯LEWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æ¨™æº–åŒ–ã®ãŸã‚ã«æ™‚é–“ã‚’ä½¿ã†åˆæ„ãŒå–ã‚Œãªã‹ã£ãŸãŸã‚ã€ã“ã‚Œä»¥ä¸Šæ¨™æº–åŒ–ã®ãŸã‚ã®ä½œæ¥­ã¯ã•ã‚Œã¾ã›ã‚“ã€‚

- [P0957 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/306)

### [P1018R16 C++ Language Evolution status ğŸ¦  pandemic edition ğŸ¦  2022/02â€“2022/06](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1018r16.html)

2022å¹´2æœˆã‹ã‚‰6æœˆã«ã‹ã‘ã¦ã®EWGæ´»å‹•å ±å‘Šæ›¸ã€‚

æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚ŒãŸææ¡ˆã¯ä»¥ä¸‹ã®ã‚‚ã®ã§ã™

- [P2513 char8_t Compatibility and Portability Fixes](https://wg21.link/P2513)
- [P2460 Relax requirements on wchar_t to match existing practices](https://wg21.link/P2460)
- [P1854 Conversion to literal encoding should not lead to loss of meaning](https://wg21.link/P1854)

ã©ã‚Œã‚‚EWGã§ã®æŠ•ç¥¨ã‚’ãƒ‘ã‚¹ã—ã¦CWGã«é€ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ãã®ã»ã‹ã«ã‚‚ã€ã„ãã¤ã‹ã®ã‚³ã‚¢è¨€èªã¸ã®Issueã«é–¢ã—ã¦ä½œæ¥­ã—ã¦ã„ãŸã‚ˆã†ã§ã™ã€‚

### [P1144R6 Object relocation in terms of move plus destroy](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1144r6.html)

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†é…ç½®ï¼ˆ*relocation*ï¼‰ã¨ã„ã†æ“ä½œã‚’å®šç¾©ã—ã€ãã‚Œã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’æ•´ãˆã‚‹ææ¡ˆã€‚

å†é…ç½®ï¼ˆ*relocation*ï¼‰ã¨ã¯ã€ãƒ ãƒ¼ãƒ–ã¨ç ´æ£„ã®è¤‡åˆæ“ä½œã®ã“ã¨ã§ã™ã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‹`T`ã¨ãƒã‚¤ãƒ³ã‚¿`src`ã¨`dst`ãŒã‚ã‚‹æ™‚ã€ã€Œ`T`ã‚’`src`ã‹ã‚‰`dst`ã¸å†é…ç½®ã™ã‚‹ã€ã¨ã¯`src`ã‹ã‚‰`dst`ã¸ãƒ ãƒ¼ãƒ–æ§‹ç¯‰ã—ãŸå¾Œã§`src`ã‚’ç ´æ£„ã™ã‚‹ã¨ã„ã†æ„å‘³ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã®å†é…ç½®ï¼ˆ*relocation*ï¼‰ã¨ã„ã†æ“ä½œã‚’ãƒ ãƒ¼ãƒ–ãƒ»ã‚³ãƒ”ãƒ¼ãƒ»ç ´æ£„ãƒ»swapãªã©ã®åŸºæœ¬æ“ä½œã®ãƒªã‚¹ãƒˆã«è¿½åŠ ã™ã‚‹ã¨ã¨ã‚‚ã«ã€å†é…ç½®ã®`noexcept`ã‚„ãƒˆãƒªãƒ“ã‚¢ãƒ«æ€§ã®æ¤œå‡ºã‚’è¡Œã†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãªã©ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€å†é…ç½®æ“ä½œã‚’C++ã®åŸºæœ¬æ“ä½œã¨ã—ã¦å…¨é¢ã‚µãƒãƒ¼ãƒˆã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

å†é…ç½®æ“ä½œã«ãŠã„ã¦é‡è¦–ã•ã‚Œã¦ã„ã‚‹ã®ã¯ã€*trivially relocatable*ã¨ã„ã†æ€§è³ªã§ã€ã“ã‚Œã¯å†é…ç½®ã®æ“ä½œãŒ`memcpy`ã¨åŒç­‰ã§ã‚ã‚‹ã“ã¨ã‚’è¨€ã£ã¦ã„ã¾ã™ã€‚ã»ã¨ã‚“ã©ã®å ´åˆå†é…ç½®å¯èƒ½ãªå‹ã¯*trivially relocatable*ã§ã‚ã‚Šã€ãã®ã‚ˆã†ãªå‹ã«ã¯ä¾‹ãˆã°ã€`std::unique_ptr<int>, std::vector<int>, std::string`ãªã©ãŒã‚ã‚Šã¾ã™ã€‚ä¸€æ–¹ã§ã€`std::list<int>`ã®ã‚ˆã†ã«å†é…ç½®å¯èƒ½ã§ã¯ç„¡ã„å‹ã‚‚ã‚ã‚Šã¾ã™ã€‚å†é…ç½®ä¸å¯èƒ½ãªå‹ã¨ã¯ã€ãã®å®Ÿè£…ãŒè‡ªèº«ã®ãƒã‚¤ãƒ³ã‚¿ï¼ˆ`this`ï¼‰ã«ä¾å­˜ã‚ã‚‹ã„ã¯ãã®ä¸å¤‰æ€§ã‚’ä»®å®šã—ã¦ã„ã‚‹ã‚ˆã†ãªå‹ã§ã™ã€‚

ã‚³ãƒ”ãƒ¼ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã‚’ãã®æ„å‘³è«–ã¨ç„¡é–¢ä¿‚ã«ã‚³ãƒ”ãƒ¼ã—ã€æ‰€æœ‰æ¨©ã‚’ç§»å‹•ã—ã¾ã›ã‚“ã€‚ãƒ ãƒ¼ãƒ–ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ”ãƒ¼ã«ãŠã„ã¦æ‰€æœ‰æ¨©ã‚’ç§»å‹•ã—ãªãŒã‚‰ã‚³ãƒ”ãƒ¼ã‚’è¡Œã„ã¾ã™ãŒã€ãƒ ãƒ¼ãƒ–å…ƒã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’ã‚±ã‚¢ã—ã¾ã›ã‚“ï¼ˆç„¡åŠ¹ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æ‰±ã†ï¼‰ã€‚å†é…ç½®ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã®ã‚³ãƒ”ãƒ¼ã‚’è¡Œã†ã¨å…±ã«å…ƒã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç ´æ£„ã—ã€ãã®æ“ä½œãŒè¤‡åˆã—ã¦ã„ã‚‹ã“ã¨ã§æ‰€æœ‰æ¨©ç§»å‹•ã®å•é¡Œã¨ãƒ ãƒ¼ãƒ–å…ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å•é¡Œã‚’å›é¿ã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€`memcpy`ã§æ‰€æœ‰æ¨©ã®ç§»å‹•ã¾ã§è¡Œã†ã“ã¨ãŒã§ãã€å†é…ç½®ã¨ã¯è¨€ã†ãªã‚Œã°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ãƒ¬ãƒãƒ¼ãƒˆã§ã™ã€‚

ã‚ã‚‹å‹ãŒ*trivially relocatable*ã§ã‚ã‚‹ã“ã¨ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒèªè­˜ã™ã‚‹ã“ã¨ã§ã€å†é…ç½®ãŒå¿…è¦ã¨ãªã‚‹å ´åˆã«ãƒ ãƒ¼ãƒ–ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å®Ÿè¡Œã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Šã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ãƒ ãƒ¼ãƒ–ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿åŠã³ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒè¤‡é›‘ã§ã‚ã‚‹ã»ã©åŠ¹æœãŒã‚ã‚Šã€ã“ã®ææ¡ˆã®å†…å®¹ã‚’clangã«å®Ÿè£…ã—ãŸã¨ã“ã‚`std::vecttor`ã®ä¸€éƒ¨ã®æ“ä½œãªã©ã§3å€ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸ŠãŒé”æˆã•ã‚ŒãŸã¨ã®ã“ã¨ã§ã™ã€‚

ã“ã®ææ¡ˆã§æ¨™æº–ã«è¿½åŠ ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã‚‚ã®ã¯ä»¥ä¸‹ã®ã‚‚ã®ã§ã™

- å†é…ç½®ï¼ˆ*relocation*ï¼‰ã¨ã„ã†æ“ä½œã®å®šç¾©
- `std::relocate(), std::relocate_at()`
    - å†é…ç½®æ“ä½œã‚’è¡Œã†é–¢æ•°
- `uninitialized_relocate(), uninitialized_relocate_n()`
    - æœªåˆæœŸåŒ–é ˜åŸŸã«å¯¾ã™ã‚‹å†é…ç½®æ“ä½œ
- *trivially relocatable*ã®å®šç¾©
- `[[trivially_relocatable]]`å±æ€§
    - å‹ã«ä»˜åŠ ã—ã¦ã€ãã®å‹ãŒ*trivially relocatable*ã§ã‚ã‚‹ã“ã¨ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ä¼ãˆã‚‹
    - `[[trivially_relocatable(expr)]]`ã®ã‚ˆã†ã«ã—ã¦ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ–‡è„ˆã§åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼ˆ`expr`ã¯`bool`å‹ã®å®šæ•°å¼ï¼‰
- å‹ç‰¹æ€§`std::is_relocatable, std::is_nothrow_relocatable, std::is_trivially_relocatable`
    - å†é…ç½®å¯èƒ½æ€§ã€ãã®`noexcept`/ãƒˆãƒªãƒ“ã‚¢ãƒ«æ€§ã®æ¤œå‡º
- `relocatable`ã‚³ãƒ³ã‚»ãƒ—ãƒˆ
    - å†é…ç½®å¯èƒ½ãªå‹ã®å®šç¾©

å†é…ç½®ã¨åŒç­‰ã®æ“ä½œã¯æ—¢ã«æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ãã“ãã“è¦³æ¸¬ã§ãã€ãã“ã§ã¯UBã‚’å›é¿ã™ã‚‹ãŸã‚ã«è¤‡é›‘ãªå®Ÿè£…ã‚’é¸æŠã—ã¦ã„ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã‚’æã­ã¦ã„ã¾ã™ã€‚ã“ã®ææ¡ˆã«ã‚ˆã£ã¦ã€ãã‚Œã‚‰ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã¯å®Ÿè£…ã®ç°¡ç•¥åŒ–ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹å‘ä¸Šã¨ã„ã†ãƒ¡ãƒªãƒƒãƒˆã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚ã¾ãŸã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®Ÿè£…ã«ãŠã„ã¦ã‚‚ã€å®Ÿè£…è€…ã«å†é…ç½®ã‚’æ´»ç”¨ã—ã¦å®Ÿè£…ã‚’æœ€é©åŒ–ã™ã‚‹ã¨ã„ã†é¸æŠè‚¢ã‚’ä¸ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- [Announcing "trivially relocatable](https://quuxplusone.github.io/blog/2018/07/18/announcing-trivially-relocatable/)
- [Object Relocation - facebook/folly](https://github.com/facebook/folly/blob/main/folly/docs/FBVector.md#object-relocation)
- [P1144 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/43)

### [P1222R4 A Standard flat_set](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1222r4.pdf)

ã‚­ãƒ¼ã®æ¤œç´¢ãŒ`std::set`æ¯”ã§é«˜é€Ÿã«è¡Œãˆã‚‹é€£æƒ³ã‚³ãƒ³ãƒ†ãƒŠã€`flat_set`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1222R3 A Standard `flat_set` - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/05/08/195618#P1222R3-A-Standard-flat_set)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€`flat_map`ï¼ˆP0429ï¼‰ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã‚ˆã‚‹æ–‡è¨€ä¿®æ­£ã®é–¢é€£ã™ã‚‹éƒ¨åˆ†ã®é©ç”¨ã¨ã€LWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘ã¦ã®æ–‡è¨€ä¿®æ­£ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚’æŒã£ã¦LWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµ‚ãˆã¦ãŠã‚Šã€æ¬¡ã®å…¨ä½“ä¼šè­°ã§æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã‚‹äºˆå®šã§ã™ã€‚

- [P1222 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/148)

### [P1223R5 `find_last`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1223r5.pdf)

æŒ‡å®šã•ã‚ŒãŸå€¤ã‚’ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®å¾Œã‚ã‹ã‚‰æ¢ç´¢ã™ã‚‹`find_last`ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ææ¡ˆã€‚

- [P1223R3 `find_last` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P1223R3-find_last)
- [P1223R4 `find_last` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/05/08/195618#P1223R4-find_last)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã®å¤‰æ›´ã¯ã‚ˆãåˆ†ã‹ã‚Šã¾ã›ã‚“ï¼ˆå¤šåˆ†ææ¡ˆã™ã‚‹æ–‡è¨€ä¿®æ­£ã®ã¿ã§ã™ï¼‰ã€‚

ã“ã®ææ¡ˆã¯ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚’æŒã£ã¦LWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµ‚ãˆã¦ãŠã‚Šã€æ¬¡ã®å…¨ä½“ä¼šè­°ã§æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã‚‹äºˆå®šã§ã™ã€‚

- [P0957 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/149)

### [P1642R10 Freestanding Library: Easy [utilities], [ranges], and [iterators]](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1642r10.html)

[[utility]](https://timsong-cpp.github.io/cppwp/n4861/#utilities)ã€`<ranges>`ã€`<iterator>`ã‹ã‚‰ä¸€éƒ¨ã®ã‚‚ã®ã‚’ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

å‰å›ã®è¨˜äº‹ã‚’å‚ç…§

- [P1642R3 Freestanding Library: Easy [utilities], [ranges], and [iterators] - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´6æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/07/05/003248#P1642R3--Freestanding-Library-Easy-utilities-ranges-and-iterators)
- [P1642R4 Freestanding Library: Easy [utilities], [ranges], and [iterators] - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´7æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/08/12/014639#P1642R4--Freestanding-Library-Easy-utilities-ranges-and-iterators)
- [P1642R5 Freestanding Library: Easy [utilities], [ranges], and [iterators] - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/01/17/005823#P1642R5-Freestanding-Library-Easy-utilities-ranges-and-iterators)
- [P1642R6 Freestanding Library: Easy [utilities], [ranges], and [iterators] - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´06æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/07/12/182757#P1642R6-Freestanding-Library-Easy-utilities-ranges-and-iterators)
- [P1642R7 Freestanding Library: Easy [utilities], [ranges], and [iterators] - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/11/13/193322#P1642R7-Freestanding-Library-Easy-utilities-ranges-and-iterators)
- [P1642R8 Freestanding Library: Easy [utilities], [ranges], and [iterators] - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/05/08/195618#P1642R8-Freestanding-Library-Easy-utilities-ranges-and-iterators)
- [P1642R9 Freestanding Library: Easy [utilities], [ranges], and [iterators] - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/06/11/191943#P1642R9-Freestanding-Library-Easy-utilities-ranges-and-iterators)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€`<algorithm>`ã®å‰Šé™¤ã€ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã¤ã„ã¦ã®æ–‡è¨€ã‚’è¿½åŠ ã€ã“ã®ææ¡ˆã§æ¤œè¨æ¸ˆã®å…¨ä½“ä¼šè­°ã§ã®æŠ•ç¥¨å¾…ã¡ææ¡ˆã®ãƒªã‚¹ãƒˆè¿½åŠ ã€ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯LWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµ‚ãˆã¦ã€æ¬¡ã®å…¨ä½“ä¼šè­°ã§æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã‚‹äºˆå®šã§ã™ã€‚

- [P1642 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/429)

### [P1673R9 A free function linear algebra interface based on the BLAS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1673r9.html)

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã€BLASã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸå¯†è¡Œåˆ—ã®ãŸã‚ã®ç·šå½¢ä»£æ•°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1673R3 A free function linear algebra interface based on the BLAS - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P1673R3-A-free-function-linear-algebra-interface-based-on-the-BLAS)
- [P1673R4 A free function linear algebra interface based on the BLAS - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´08æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/09/03/230045#P1673R4-A-free-function-linear-algebra-interface-based-on-the-BLAS)
- [P1673R5 A free function linear algebra interface based on the BLAS - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/11/13/193322#P1673R5-A-free-function-linear-algebra-interface-based-on-the-BLAS)
- [P1673R6 A free function linear algebra interface based on the BLAS - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/01/10/235544#P1673R6-A-free-function-linear-algebra-interface-based-on-the-BLAS)
- [P1673R7 A free function linear algebra interface based on the BLAS - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/05/08/195618#P1673R7-A-free-function-linear-algebra-interface-based-on-the-BLAS)
- [P1673R8 A free function linear algebra interface based on the BLAS - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/06/11/191943#P1673R8-A-free-function-linear-algebra-interface-based-on-the-BLAS)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- `std::mdspan`ã®æœ€æ–°ãƒªãƒ“ã‚¸ãƒ§ãƒ³ï¼ˆç‰¹ã«P2253ã®é©ç”¨ï¼‰ã®å¤‰æ›´ã‚’åæ˜ 
- ææ¡ˆã™ã‚‹æ–‡è¨€ã®ä¿®æ­£ã‚„æ”¹å–„
- `layout_transpose`ã®å¤‰æ›´
- `scaled`ã¨`conjugated`ã®å¤‰æ›´
- SG6/LEWGã®æ¨å¥¨ã«åŸºã¥ãå¤‰æ›´

ãªã©ã§ã™ã€‚

- [P1673 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/557)

### [P1689R5 Format for describing dependencies of source files](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1689r5.html)

C++ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è§£ããã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ãƒ„ãƒ¼ãƒ«ãŒå‡ºåŠ›ã™ã‚‹ä¾å­˜é–¢ä¿‚æƒ…å ±ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®šã‚ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1689R3 Format for describing dependencies of source files - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/01/17/005823#P1689R3-Format-for-describing-dependencies-of-source-files)
- [P1689R4 Format for describing dependencies of source files - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´07æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/07/12/182757#P1689R4-Format-for-describing-dependencies-of-source-files)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€åŒã˜ãƒ˜ãƒƒãƒ€ã‚’ç•°ãªã‚‹æ–¹æ³•ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ä¾‹ã®è¿½åŠ ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã‹ï¼ˆ`export`ã—ã¦ã„ã‚‹ã‹ï¼‰ã‚’è¡¨ã™`is-interface`ã‚­ãƒ¼ã®è¿½åŠ ãªã©ã§ã™ã€‚

- [P1689 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/466)

### [P1774R8 Portable assumptions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1774r8.pdf)

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚³ãƒ¼ãƒ‰ã®å†…å®¹ã«ã¤ã„ã¦ã®ä»®å®šã‚’ä¼ãˆã¦æœ€é©åŒ–ã‚’ä¿ƒé€²ã™ã‚‹ãŸã‚ã®`[[assume(expr)]]`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1774R4 Portable assumptions - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/12/11/220126#P1774R4-Portable-assumptions)
- [P1774R5 Portable assumptions - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´12æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/01/10/235544#P1774R4-Portable-assumptions)
- [P1774R6 Portable assumptions - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P1774R6-Portable-assumptions)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€ãƒ©ãƒ ãƒ€ã‚­ãƒ£ãƒ—ãƒãƒ£ã«é–¢ã™ã‚‹å•é¡Œã«ã¤ã„ã¦ã®CWG/EWGã®æŠ•ç¥¨ã¨è­°è«–ã‚’è¿½è¨˜ã—ãŸã“ã¨ã§ã™ã€‚

å‰å›ã‚‚å°‘ã—èª¬æ˜ã—ã¦ã„ã¾ã—ãŸãŒã€`[[assume(expr)]]`ã¯`expr`ã«ç¾ã‚Œã¦ã„ã‚‹åå‰ã‚’ODR-useã™ã‚‹ãŸã‚ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã‚„ãƒ©ãƒ ãƒ€ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚ã“ã‚Œã¯å®Ÿè£…ãŒ`[[assume(expr)]]`ã‚’ç„¡è¦–ï¼ˆæœªå®Ÿè£…ï¼‰ã™ã‚‹å ´åˆã‚‚åŒæ§˜ã§ã™ã€‚

ä¾‹ãˆã°ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã¨å®Ÿè¡Œæ™‚ã®ä¸¡æ–¹ã§ãã®å½±éŸ¿ã‚’è¦³æ¸¬ã§ãã¾ã™ã€‚

```cpp
constexpr auto f(int i) {
  return sizeof( [=] { [[assume(i == 0)]]; } );
}

struct X {
  char data[f(0)];
};
```

MSVC/GCC/clang/ICCã«ãŠã„ã¦ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã®`sizeof(X)`ã¯`[[assume(i == 0)]]`ãŒã‚ã‚‹å ´åˆã«`4`ã«ãªã‚Šã€ãªã„å ´åˆã¯`1`ã«ãªã‚Šã¾ã™ã€‚ã“ã®æŒ¯ã‚‹èˆã„ã¯ã“ã®ææ¡ˆã®æ„å›³ã—ãŸã¨ã“ã‚ã§ã‚ã‚Šã€EWG/CWGã®è­°è«–ã«ãŠã„ã¦åˆæ„ã•ã‚ŒãŸã“ã¨ã§ã™ã€‚

ã¨ã¯ã„ãˆã“ã®ä¾‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã‚ã‹ã‚‹ã‚ˆã†ã«ã€`[[assume]]`ã®ä½¿ç”¨ã«ã‚ˆã£ã¦ABIã®é™ã‹ãªå¤‰æ›´ãŒå¼•ãèµ·ã“ã•ã‚Œã‚‹ã®ã¯éå¸¸ã«ç¨€ã§ã‚ã‚Šã€ãã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã¯ï¼ˆã“ã®ã‚µãƒ³ãƒ—ãƒ«ã®ã‚ˆã†ã«ï¼‰éå¸¸ã«å¥‡å¦™ãª`[[assume]]`ã®ä½¿ã„æ–¹ã‚’ã—ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚ãã®ã‚ˆã†ãªå ´åˆã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ABIãŒãƒãƒ¼ã‚¿ãƒ–ãƒ«ã§ã‚ã‚‹ã“ã¨ã‚’ä»®å®šã—ãªã„ã¹ãã§ã™ã€‚

ã¾ãŸã€`[[assume]]`ãŒODR-useã‚’å¿…è¦ã¨ã™ã‚‹ã¨ã„ã†ã“ã¨ã¯ã€ãã“ã§ã¯å®£è¨€ã®ã¿ã§å®šç¾©ãŒãªã„é–¢æ•°ã‚’ä½¿ç”¨ã§ããªã„ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

- [P1774 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/529)

### [P1839R5 Accessing object representations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1839r5.pdf)

`reinterpret_cast<char*>`ã«ã‚ˆã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœªå®šç¾©å‹•ä½œã¨ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1839R3 Accessing Object Representations - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P1839R3-Accessing-Object-Representations)
- [P1839R4 Accessing Object Representations - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´03æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/04/02/175835#P1839R4-Accessing-Object-Representations)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€

- ææ¡ˆã®ç¯„å›²ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã®èª­ã¿å–ã‚Šã®ã¿ã‚’æ‰±ã†ã‚ˆã†ã«ã—ãŸï¼ˆæ›¸ãè¾¼ã¿ã«é–¢ã—ã¦ã¯è§¦ã‚Œãªã„ã‚ˆã†ã«ã—ãŸï¼‰
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾å†…ã§æš—é»™ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆãŒè¡Œã‚ã‚Œãªã„ã‚ˆã†ã«ã—ãŸ
- æ—¢çŸ¥ã®å•é¡Œç‚¹ã‚’è¿½è¨˜

ãªã©ã§ã™ã€‚

- [P1839 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/592)

### [P1967R7 `#embed` - a simple, scannable preprocessor-based resource acquisition method](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1967r7.html)

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ï¼ˆãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹æ™‚ï¼‰ã«ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚·ãƒ³ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–`#embed`ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P1967R3 `#embed` - a simple, scannable preprocessor-based resource acquisition method - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/05/14/214016#P1967R3-embed---a-simple-scannable-preprocessor-based-resource-acquisition-method)
- [P1967R4 `#embed` - a simple, scannable preprocessor-based resource acquisition method - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´06æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/07/12/182757#P1967R4-embed---a-simple-scannable-preprocessor-based-resource-acquisition-method)
- [P1967R5 `#embed` - a simple, scannable preprocessor-based resource acquisition method - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/05/08/195618#P1967R5-embed---a-simple-scannable-preprocessor-based-resource-acquisition-method)
- [P1967R6 `#embed` - a simple, scannable preprocessor-based resource acquisition method - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´05æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/06/11/191943#P1967R6-embed---a-simple-scannable-preprocessor-based-resource-acquisition-method)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ææ¡ˆã™ã‚‹æ–‡è¨€ã®æ”¹å–„
- `is_empty`ã‚’`if_empty`ã¸å¤‰æ›´
- `prefix/suffix/if_empty`ã‚’ææ¡ˆã¨ã—ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã—ãŸ
    - ã“ã‚Œã‚‰ã§è©°ã¾ã£ãŸæ™‚ã§ã‚‚ã€`#embed`å˜ä½“ã‚’å…ˆã«é€²ã‚ã‚‹ãŸã‚
- å±æ€§ã¸ã®å‚ç…§ã‚’å‰Šé™¤
- 2022å¹´6æœˆã®EWGãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã¤ã„ã¦è¿½è¨˜

ãªã©ã§ã™ã€‚

- [P1967 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/700)

### [P2167R2 Improved Proposed Wording for LWG 2114 (contextually convertible to bool)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2167r2.html)

*contextually convertible to bool*ã¨è¨€ã†è¦æ ¼ä¸Šã®è¨€è‘‰ã‚’ã€C++20ã§å®šç¾©ã•ã‚ŒãŸ`boolean-testable`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ç½®ãæ›ãˆã‚‹ææ¡ˆã€‚

- [P2167R0 : Improved Proposed Wording for LWG 2114 - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´5æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/06/01/001003#P2167R0--Improved-Proposed-Wording-for-LWG-2114)
- [P2167R1 Improved Proposed Wording for LWG 2114 (contextually convertible to bool) - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´7æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/08/14/213339#P2167R1-Improved-Proposed-Wording-for-LWG-2114-contextually-convertible-to-bool)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯

- ææ¡ˆã™ã‚‹æ–‡è¨€ã«ã¤ã„ã¦éƒ¨åˆ†éƒ¨åˆ†ã§4ã¤ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æç¤ºã—ã€ã©ã‚Œã‚’é¸æŠã™ã‚‹ã®ã‹ã®è³ªå•é …ç›®ã‚’è¿½åŠ 
- *Exotic Types*ï¼ˆæ¼”ç®—å­ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã®çµæœã€`pair`ã¨`tuple`ã«åŒ…ã‚“ã ã¨ãã«ãã‚Œãã‚Œã§æ¯”è¼ƒã®çµæœãŒå¤‰ã‚ã‚‹ã‚ˆã†ãªå‹ï¼‰ã«ã¤ã„ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ 

- [P2167 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/877)

### [P2278R4 `cbegin` should always return a constant iterator](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2278r4.html)

`std::ranges::cbegin/cend`ã‚’æ‹¡å¼µã—ã¦ã€å¸¸ã«`const_iterator`ã‚’è¿”ã™ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2278R0 cbegin should always return a constant iterator - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´01æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/02/11/153333#P2278R0-cbegin-should-always-return-a-constant-iterator)
- [P2278R1 cbegin should always return a constant iterator - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´09æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/10/03/193523#P2278R1-cbegin-should-always-return-a-constant-iterator)
- [P2278R2 cbegin should always return a constant iterator - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/12/11/220126#P2278R2-cbegin-should-always-return-a-constant-iterator)
- [P2278R3 cbegin should always return a constant iterator - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´04æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/05/08/195618#P2278R3-cbegin-should-always-return-a-constant-iterator)

ã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ã®å¤‰æ›´ã¯ã€ææ¡ˆã™ã‚‹æ–‡è¨€ã®æ”¹å–„ã¨`std::span<T>`ã«å¯¾ã™ã‚‹`views::as_const`ãŒ`std::span<const T>`ã‚’è¿”ã™ã‚ˆã†ã«ã—ãŸã“ã¨ãªã©ã§ã™ã€‚

ã“ã®ææ¡ˆã¯LWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµ‚ãˆã¦ãŠã‚Šã€æ¬¡ã®å…¨ä½“ä¼šè­°ã§æŠ•ç¥¨ã«ã‹ã‘ã‚‰ã‚Œã‚‹äºˆå®šã§ã™ã€‚

- [P2278 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/971)

### [P2490R3 Zero-overhead exception stacktraces](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2490r3.html)

[ä¾‹å¤–ã‹ã‚‰ã®ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®å–å¾—ã®ææ¡ˆ](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2370r0.html)ã«ã¤ã„ã¦ã€å•é¡Œç‚¹ã¨ãã®è§£æ±ºç­–ã«ã¤ã„ã¦ã®ææ¡ˆã€‚

ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2490R0 Zero-overhead exception stacktraces - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/12/11/220126#P2490R0-Zero-overhead-exception-stacktraces)

R1ã¨R2ã¯å…¬é–‹ã•ã‚Œã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚

R1ã®å¤‰æ›´ã¯ã€ææ¡ˆã™ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®1ã¤ã¨ã—ã¦`[[with_stacktrace]]`å±æ€§ã«ã‚ˆã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’è¿½åŠ ã—ãŸã“ã¨ã€å†ã‚¹ãƒ­ãƒ¼ã«é–¢ã™ã‚‹è­°è«–ã®è¿½è¨˜ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ãƒ»ã‚³ãƒ«ãƒ¼ãƒãƒ³ãƒ»ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã«é–¢ã™ã‚‹èª¬æ˜ã®è¿½è¨˜ãªã©ã§ã™ã€‚

R2ã®å¤‰æ›´ã¯ã€`[[with_stacktrace]]`å±æ€§ã‚’ã“ã®ææ¡ˆã®ãƒ¡ã‚¤ãƒ³ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦æ®ãˆãŸã“ã¨ã§ã™ã€‚

R3ï¼ˆã“ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ï¼‰ã§ã®å¤‰æ›´ã¯ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ˜ç¢ºã«ã—ãŸã“ã¨ã§ã™ã€‚

ç¾åœ¨ã®ã“ã®ææ¡ˆã®ãƒ¡ã‚¤ãƒ³ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€`catch`ãƒ–ãƒ­ãƒƒã‚¯ã«å¯¾ã™ã‚‹`[[with_stacktrace]]`å±æ€§ã®ä»˜åŠ ã«ã‚ˆã£ã¦ã€ãã®`catch`ãƒ–ãƒ­ãƒƒã‚¯ã§ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚’æ˜ç¤ºã™ã‚‹ã‚‚ã®ã§ã™ã€‚

```cpp
void f() noexcept(false);

int main() {
  try {
    f();
  } catch ([[with_stacktrace]] std::exception& e) {
    std::cout << e.what() << "\n" << std::stacktrace::from_current_exception() << std::endl;
  }
}
```

ã“ã®å±æ€§ã®æ„å‘³ã¯ã€ãã®`catch`ãƒ–ãƒ­ãƒƒã‚¯ã®ä¾‹å¤–ã¯é–¢é€£ã™ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ï¼ˆ*associated stacktrace*ï¼‰ã‚’æŒã£ã¦ãŠã‚Šã€ç›´è¿‘ã®ä¾‹å¤–`throw`åœ°ç‚¹ã‹ã‚‰ã“ã®è£œè¶³åœ°ç‚¹ã¾ã§ã®é–“ãã®ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚’ä¿æŒã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã«æŒ‡å®šã™ã‚‹ã‚‚ã®ã§ã™ã€‚`std::stacktrace::from_current_exception()`ã¯å‘¼ã³å‡ºã—æ™‚ç‚¹ã§å‡¦ç†ä¸­ã®ä¾‹å¤–ãŒé–¢é€£ã™ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ä¿æŒã—ã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’`std::stacktrace`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦è¿”ã—ã€ãªã„å ´åˆã¯æœªè¦å®šã®å€¤ã‚’è¿”ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã®æ©Ÿèƒ½ã¯å…¨ã¦ã®ABIã§å®Ÿè£…å¯èƒ½ã§ã¯ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ç¾åœ¨ã®ã¨ã“ã‚ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã«è¿‘ã—ã„æ©Ÿèƒ½ã§ã™ã€‚å±æ€§æ§‹æ–‡ã®ç„¡è¦–ã§ãã‚‹ã¨ã„ã†æ€§è³ªã¯ã€ã“ã®å±æ€§ã‚‚ã—ãã¯ãã®æ©Ÿèƒ½ã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„å ´åˆã¯ç„¡è¦–ã—ã¦ã‚‚è‰¯ã„ã¨ã„ã†å®Ÿè£…ã¸ã®è¦æ±‚ã¨ã—ã¦ã®ã“ã®æ©Ÿèƒ½ã®å´é¢ã¨ä¸€è‡´ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¬ ç‚¹ã¨ã—ã¦ã¯ã€å‡¦ç†ä¸­ã®ä¾‹å¤–ã«é–¢é€£ã™ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒãªã„å ´åˆã¯å®Ÿè¡Œæ™‚ã®å¤±æ•—ã¨ãªã‚‹ç‚¹ã§ã™ã€‚ãŸã ã—ã“ã®ã“ã¨ã¯ç¾åœ¨ã§ã‚‚[`std::current_exception()`](https://cpprefjp.github.io/reference/exception/current_exception.html)ã§èªã‚ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã‚ã‚Šã€ã‚µãƒãƒ¼ãƒˆã•ã‚Œãªã„ï¼ˆå±æ€§ãŒç„¡è¦–ã•ã‚ŒãŸï¼‰å ´åˆã«ã¯ãƒ¡ãƒªãƒƒãƒˆã§ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

- [P2490 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1146)

### [P2502R2 std::generator: Synchronous Coroutine Generator for Ranges](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2502r2.pdf)
### [P2505R3 Monadic Functions for std::expected](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2505r3.html)
### [P2505R4 Monadic Functions for std::expected](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2505r4.html)
### [P2513R3 char8_t Compatibility and Portability Fix](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2513r3.html)
### [P2551R2 Clarify intent of P1841 numeric traits](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2551r2.pdf)
### [P2562R1 constexpr Stable Sorting](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2562r1.pdf)
### [P2570R0 On side effects in contract annotations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2570r0.html)

ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆæ³¨é‡ˆã«æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶å¼ãŒå‰¯ä½œç”¨ã‚’æŒã¤å ´åˆã«ã©ã†ã™ã‚‹ã‹ã«ã¤ã„ã¦ã€è­°è«–ã‚’ã¾ã¨ã‚ãŸæ–‡æ›¸ã€‚

ã“ã®æ–‡æ›¸ã¯[P2182](https://wg21.link/p2182)ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹MVPã¨å‘¼ã°ã‚Œã‚‹ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®æœ€å°ã‚»ãƒƒãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆæ³¨é‡ˆã«æŒ‡å®šã•ã‚Œã¦ã„ã‚‹æ¡ä»¶å¼ãŒå‰¯ä½œç”¨ã‚’æŒã¤å ´åˆã«æ¨™æº–ã¨ã—ã¦ã©ã†è¦å®šã™ã‚‹ã‹ã®ç¾åœ¨ã®è­°è«–ã‚„æ–¹å‘æ€§ã«ã¤ã„ã¦ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

ã“ã®æ–‡æ›¸ã§æç¤ºã•ã‚Œã¦ã„ã‚‹å‰¯ä½œç”¨ã«å¯¾ã™ã‚‹é¸æŠè‚¢ã¯ä»¥ä¸‹ã®3ã¤ã§ã™

- æ¡ä»¶å¼ãŒå‰¯ä½œç”¨ã‚’æŒãŸãªã„ã“ã¨ã‚’è¨¼æ˜ã§ããªã„å ´åˆã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã¨ã™ã‚‹
- Cã®`assert`ãƒã‚¯ãƒ­ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹
    - ä¸€æ–¹ã®ãƒ¢ãƒ¼ãƒ‰ï¼ˆ*Eval and abort*ï¼‰ã§ã¯å‰¯ä½œç”¨ã‚’è©•ä¾¡ã—ã€ä¸€æ–¹ã®ãƒ¢ãƒ¼ãƒ‰ï¼ˆ*No eval*ï¼‰ã§ã¯è©•ä¾¡ã—ãªã„
- *Eval and abort*ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€æ¡ä»¶å¼ã‚’è¤‡æ•°å›è©•ä¾¡ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹
    - å‰¯ä½œç”¨ã®ä¿¡é ¼æ€§ã‚’ä½ä¸‹ã•ã›ã‚‹

*Eval and abort*ãƒ¢ãƒ¼ãƒ‰ã¯ã€å¥‘ç´„æ¡ä»¶ã‚’è©•ä¾¡ã—ç ´ã‚‰ã‚ŒãŸï¼ˆ`false`ã¨ãªã£ãŸï¼‰å ´åˆã«ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’çµ‚äº†ã•ã›ã‚‹å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ã§ã€*No eval*ãƒ¢ãƒ¼ãƒ‰ã¯å…¨ã¦ã®å¥‘ç´„æ¡ä»¶ã‚’ç„¡è¦–ã™ã‚‹å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚å¥‘ç´„é•åãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚„å¥‘ç´„é•åå¾Œã®ç¶šè¡Œãƒ¢ãƒ¼ãƒ‰ã¯ã€C++20ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®éš›ã«ç‚ä¸Šã—ãŸéƒ¨åˆ†ã§ã‚ã‚‹ã®ã§ã€MVPã«ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ç¾åœ¨ã®SG21ã®æ–¹å‘æ€§ã¨ã—ã¦ã¯ã€MVPã‚’ã¾ãšæ¨™æº–ã«å°å…¥ã—ã¦ã‹ã‚‰ãã“ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ãã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ãŸã‚ã€MVPã®éƒ¨åˆ†ï¼ˆã“ã®æ–‡æ›¸ã®ç¯„å›²ã‚‚å«ã‚ã¦ï¼‰ã¯å°†æ¥ã®æ‹¡å¼µã«ã¤ã„ã¦é–‹ã„ã¦ã„ã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€æ¬¡ã®ã‚ˆã†ãªæŒ‡é‡ãŒã‚ã‚Šã¾ã™

- ç‰©è­°ã‚’ã‹ã‚‚ã—ã¦ã„ã‚‹éƒ¨åˆ†ï¼ˆæ©Ÿèƒ½ï¼‰ã«ã¤ã„ã¦ä½•ã‚‰ã‹ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã¯é¿ã‘ã‚ˆã†ã¨ã—ã¦ã„ã‚‹
    - 2ã¤ã®å¯èƒ½ãªå°†æ¥ã®æ–¹å‘æ€§ãŒã‚ã‚‹å ´åˆã€ã©ã¡ã‚‰ã«å¯¾ã—ã¦ã‚‚ã‚ªãƒ¼ãƒ—ãƒ³ã§ã‚ã‚‹äº‹ã‚’ç›®æŒ‡ã™
- å®šç¾©ã—ãŸããªã„éƒ¨åˆ†ã«ã¤ã„ã¦ã¯ã€UB/IF-NDRã‚ˆã‚Šã‚‚ill-formedã«ã™ã‚‹
    - ãƒ—ãƒ­ã‚°ãƒ©ãƒã«å®Ÿè¡Œæ™‚ã®é©šãã‚’ä¸ãˆã‚‹ã“ã¨ã‚’å›é¿ã—ã€æ§‹æ–‡ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¯€ç´„ã™ã‚‹
- æœªè¦å®šã‚„å®Ÿè£…å®šç¾©ã¨ã—ã¦æŒ‡å®šã™ã‚‹ã‚ˆã‚Šã‚‚ã€UBã¨ã—ã¦å®šç¾©ã™ã‚‹
    - å°†æ¥çš„ã«ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–“ã§çµ±ä¸€ã•ã‚ŒãŸã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’æä¾›ã—ã€ãã®éƒ¨åˆ†ã‚’ill-formedã«ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠã

ãã—ã¦SG21ã¯ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯å®‰å…¨æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã§ã‚ã‚‹ã¨ã—ã¦æ©Ÿèƒ½ãã®ã‚‚ã®ã‚‚ã‚ˆã‚Šå®‰å…¨ãªã‚‚ã®ã«ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚ã¨ã¯ã„ãˆã€ã“ã®æ–‡æ›¸ã§æ‰±ã‚ã‚Œã¦ã„ã‚‹å‰¯ä½œç”¨ã‚’ã¯ã˜ã‚ã¨ã—ã¦C++ã®å±é™ºãªå´é¢ã‚’å¤šãå«ã‚“ã§ã„ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«ã¤ã„ã¦ã¯ä»–ã®C++ã®éƒ¨åˆ†ã¨ã¯ç•°ãªã‚‹åŠ¹ç‡æ€§ã¨å®‰å…¨æ€§ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã‚’å–ã‚‰ã–ã‚‹ã‚’å¾—ãªã„éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã§ã‚‚ã€å¥‘ç´„æ¡ä»¶ã«ã¤ã„ã¦C++ã®ä»–ã®ã¨ã“ã‚ã¨åŒæ§˜ã«æ‰±ã†ã€ãªã©ã®çµ±ä¸€æ€§ã®è¦æ±‚ã‚’é‡è¦–ã—ãªã„æ–¹é‡ã§ã™ã€‚

- [P2182R0 : Contract Support: Defining the Minimum Viable Feature Set - WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´6æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/07/05/003248#P2182R0--Contract-Support-Defining-the-Minimum-Viable-Feature-Set)

### [P2572R0 `std::format()` fill character allowances](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2572r0.html)

`std::format`ã«ãŠã„ã¦ã€æ–‡å­—åˆ—ã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆå·¦å¯„ã›ã€ä¸­å¤®å¯„ã›ã€å³å¯„ã›ï¼‰ã®éš›ã«ç©ºç™½ã‚’åŸ‹ã‚ã‚‹æ–‡å­—ã¨ã—ã¦ä½¿ç”¨å¯èƒ½ãªæ–‡å­—ã‚’åˆ¶é™ã™ã‚‹ææ¡ˆã€‚

`std::format`ã§ã¯ã€`> < ^`ã¨ãã®å¾Œã«æŒ‡å®šã™ã‚‹æ•´æ•°å€¤ã«ã‚ˆã£ã¦æ–‡å­—åˆ—ã®å¹…ã¨é…ç½®ã‚’èª¿æ•´ã§ãã¾ã™ã€‚

```cpp
#include <format>
#include <iostream>

int main() {
  std::cout << std::format("|{:>6}|\n", 23);  // å³å¯„ã›
  std::cout << std::format("|{:<6}|\n", 23);  // å·¦å¯„ã›
  std::cout << std::format("|{:^6}|\n", 23);  // ä¸­å¤®å¯„ã›
}
```
å‡ºåŠ›ä¾‹
```
|    23|
|23    |
|  23  |
```

ãã®éš›ã€ç©ºç™½ï¼ˆå³å¯„ã›ã®æ™‚ã®å·¦å´ãªã©ï¼‰ã‚’åŸ‹ã‚ã‚‹æ–‡å­—ã¨ã—ã¦ã¯ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¾ã™ãŒã€ãã®æ–‡å­—ï¼ˆä»¥é™ã€ã“ã‚Œã‚’ç©´åŸ‹ã‚æ–‡å­—ã¨å‘¼ã³ã¾ã™ï¼‰ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚å¤‰æ›´ã™ã‚‹ã«ã¯ã€å¯„ã›ã®æŒ‡å®šã®å‰ã«ä½¿ç”¨ã—ãŸã„æ–‡å­—ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```cpp
#include <format>
#include <iostream>

int main() {
  // ç©´åŸ‹ã‚ã¯*ã§è¡Œã†
  std::cout << std::format("|{:*>6}|\n", 23);  // å³å¯„ã›
  std::cout << std::format("|{:*<6}|\n", 23);  // å·¦å¯„ã›
  std::cout << std::format("|{:*^6}|\n", 23);  // ä¸­å¤®å¯„ã›
}
```
```
|****23|
|23****|
|**23**|
```

ã“ã®ç©´åŸ‹ã‚ã«ä½¿ç”¨å¯èƒ½ãªæ–‡å­—ã¨ã—ã¦ã¯`{`ã¨`}`ä»¥å¤–ã®ä»»æ„ã®æ–‡å­—ãŒæŒ‡å®šå¯èƒ½ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

```cpp
#include <format>
#include <iostream>

int main() {
  // ä¾‹ãˆã°çµµæ–‡å­—
  std::cout << std::format("|{:ğŸ¤”>6}|\n", 23);  // å³å¯„ã›
  std::cout << std::format("|{:ğŸ¤”<6}|\n", 23);  // å·¦å¯„ã›
  std::cout << std::format("|{:ğŸ¤”^6}|\n", 23);  // ä¸­å¤®å¯„ã›
}
```
```
|ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”23|
|23ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”|
|ğŸ¤”ğŸ¤”23ğŸ¤”ğŸ¤”|
```

ç¾åœ¨ã®`std::format`ã¯ã€ç‰¹å®šã®ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¯„å›²ã®æ–‡å­—ã‚’å¹…2ã€ãã‚Œä»¥å¤–ã®æ–‡å­—ã‚’å¹…1ã¨ã—ã¦æ–‡å­—å¹…ã‚’æ¨å®šã—ã¦ã“ã®ã‚ˆã†ãªæ–‡å­—ã®é…ç½®ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ç©´åŸ‹ã‚æ–‡å­—ã«ä¾‹ãˆã°ã‚¼ãƒ­å¹…æ–‡å­—ã‚„è² ã®å¹…ã‚’æŒã¤æ–‡å­—ã€3ä»¥ä¸Šã®å¹…ã‚’æŒã¤æ–‡å­—ï¼ˆã‚¢ãƒ©ãƒ“ã‚¢æ–‡å­—ãªã©ï¼‰ãªã©ã‚’æŒ‡å®šã™ã‚‹ã¨æ­£ã—ãé…ç½®ã§ããªããªã‚Šã¾ã™ã€‚ã¾ãŸã€æ–‡å­—ã®å¹…ã¯æ–‡å­—ç¨®ã ã‘ã§ãªããƒ•ã‚©ãƒ³ãƒˆã«ã‚ˆã£ã¦ã‚‚å¤‰åŒ–ã™ã‚‹ãŸã‚ã€ã“ã‚Œã‚’å³å¯†ã«æ¨å®šã™ã‚‹ã“ã¨ã¯ãŠãã‚‰ãä¸å¯èƒ½ã§ã™ã€‚

ãƒãƒ¼ã‚¿ãƒ–ãƒ«ãªå®Ÿè£…ã®ãŸã‚ã«ã¯ã€`std::format`ã¯ç©´åŸ‹ã‚ã«ä½¿ç”¨å¯èƒ½ãªæ–‡å­—ã‚’åˆ¶é™ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã“ã®æ–‡æ›¸ã¯ãã‚Œã‚’ææ¡ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚

åˆ¶é™ã«å½“ãŸã£ã¦ã¯ã¾ãšã€ã©ã®ã‚ˆã†ãªæ–‡å­—ã‚’ä½¿ç”¨å¯èƒ½ã¨ã™ã‚‹ã‹ã‚’æ±ºå®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ææ¡ˆã§ã¯æ¬¡ã®4ã¤ã‚’ä¸Šã’ã¦ã„ã¾ã™

1. ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ‹¡å¼µæ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿ï¼ˆextended grapheme cluster : EGCï¼‰ã®ä»»æ„ã®æ–‡å­—
2. [UAX15ã§å®šç¾©](https://unicode.org/reports/tr15/#Stream_Safe_Text_Format)ã•ã‚Œã¦ã„ã‚‹ã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚»ãƒ¼ãƒ•ãªãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ‹¡å¼µæ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿ã®ä»»æ„ã®æ–‡å­—
3. ä»»æ„ã®å˜ä¸€ã®UCSã‚¹ã‚«ãƒ©ãƒ¼å€¤
4. å˜ä¸€ã®ã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã€å˜ä¸€ã®UCSã‚¹ã‚«ãƒ©ãƒ¼å€¤

1ã¤ç›®ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»»æ„é•·ã®ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰æ§‹æˆã•ã‚Œã‚‹æ–‡å­—ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®å®Ÿè£…ãŒå¿…è¦ã¨ãªã‚Šã€ã“ã‚Œã¯å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿ï¼ˆç©´åŸ‹ã‚æ–‡å­—ã®ä¿å­˜ã®ãŸã‚ï¼‰ã¨EGCå¢ƒç•Œæ¤œå‡ºã®å®Ÿè£…ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

2ã¤ç›®ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã€1æ–‡å­—ã®ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆé•·ãŒæœ€å¤§32ã«åˆ¶é™ã•ã‚Œã‚‹ãŸã‚ã€å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿ã‚’å›é¿ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œä»¥å¤–ã¯1ã¤ã‚ã¨åŒã˜ã§ã™ã€‚

3ã¤ç›®ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã€1ã¤ç›®ã¨2ã¤ç›®ã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’ã™ã¹ã¦å›é¿ã—ã€ç©´åŸ‹ã‚æ–‡å­—ã‚’å˜ä¸€ã®`char32_t`ã®å€¤ã«æ ¼ç´ã§ãã¾ã™ã€‚ã¤ã¾ã‚Šã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã€1æ–‡å­—ï¼ˆEGCã®ä»»æ„ã®1æ–‡å­—ï¼‰ãŒè¤‡æ•°ã®æ–‡å­—ï¼ˆã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰ã‹ã‚‰æ§‹æˆã•ã‚Œã‚‹ã‚ˆã†ãªæ–‡å­—ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚

4ã¤ç›®ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã€ç©´åŸ‹ã‚æ–‡å­—ã®ä¿å­˜è¦ä»¶ã‚’å˜ä¸€ã®ã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆï¼ˆ`cahr` or `wchar_t`ï¼‰ã«ã¾ã§æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã€ãã‚Œä»¥å¤–ã¯3ã¨åŒæ§˜ã«ãªã‚Šã¾ã™ã€‚ã—ã‹ã—ã€å‰¯ä½œç”¨ã¨ã—ã¦è¨±å®¹ã•ã‚Œã‚‹ç©´åŸ‹ã‚æ–‡å­—ãŒã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦å¤‰åŒ–ã—ã¾ã™ï¼ˆä¾‹ãˆã°ã‚µãƒ­ã‚²ãƒ¼ãƒˆãºã‚¢ï¼‰ã€‚

æ¬¡ã«ã€ç©´åŸ‹ã‚æ–‡å­—ã«åˆ¶é™ç¯„å›²å¤–ã®æ–‡å­—ãŒä¸ãˆã‚‰ã‚ŒãŸå ´åˆã®æŒ¯ã‚‹èˆã„ã‚’æ±ºå®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ææ¡ˆã§ã¯

1. ç©´åŸ‹ã‚æ–‡å­—ã®å¹…ã‚’1ã¨ã—ã¦æ‰±ã£ã¦ç©´åŸ‹ã‚ã™ã‚‹
2. æŒ‡å®šã•ã‚ŒãŸå¹…ã‚’æº€ãŸã™ã‹ã¨è¶…ãˆã‚‹ã¾ã§ã€ç©´åŸ‹ã‚ã™ã‚‹ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒ«ï¼‰
3. æŒ‡å®šã•ã‚ŒãŸå¹…ã‚’è¶…ãˆãªã„ã‚ˆã†ã«ã€ç©´åŸ‹ã‚ã™ã‚‹ï¼ˆã‚¢ãƒ³ãƒ€ãƒ¼ãƒ•ã‚£ãƒ«ï¼‰
4. åˆ¥ã®ç©´åŸ‹ã‚æ–‡å­—ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹
     - æŒ‡å®šã•ã‚ŒãŸç©´åŸ‹ã‚æ–‡å­—ã‚’ä½¿ç”¨ã™ã‚‹ã¨æŒ‡å®šã•ã‚ŒãŸå¹…ã‚’è¶…ãˆã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹å ´åˆã«ã€åˆ¥ã®ç©´åŸ‹ã‚æ–‡å­—ã‚’ä½¿ç”¨ã™ã‚‹
5. æœªå®šç¾©ã€æœªè¦å®šã€å®Ÿè£…å®šç¾©
6. ã‚¨ãƒ©ãƒ¼
         - `format_error`ä¾‹å¤–ã‚’æŠ•ã’ã‚‹
7. æŒ‡å®šã•ã‚ŒãŸå¹…ã§é…ç½®ã§ããªã„å ´åˆã«ã®ã¿ã€ã‚¨ãƒ©ãƒ¼
         - `format_error`ä¾‹å¤–ã‚’æŠ•ã’ã‚‹

æ¬¡ã®è¡¨ã¯ã€ã“ã‚Œã‚‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã€`std::format(">{:ğŸ¤¡^4}<\n", 'X')`ãŒã©ã†ãªã‚‹ã‹ã‚’ç¤ºã—ãŸã‚‚ã®ã§ã™

|ã‚ªãƒ—ã‚·ãƒ§ãƒ³|çµæœ|
|---|---|
|å‚ç…§é…ç½®ï¼ˆ`-`ã‚’ä½¿ç”¨ï¼‰|`>-X--<`|
|æ–‡å­—å¹…1ã¨ã™ã‚‹|`>ğŸ¤¡XğŸ¤¡ğŸ¤¡<`|
|ã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒ«|`>ğŸ¤¡XğŸ¤¡<`|
|ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ•ã‚£ãƒ«|`>XğŸ¤¡<`|
|ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹ï¼‰|`> XğŸ¤¡<`|
|æœªå®šç¾©|???|
|ã‚¨ãƒ©ãƒ¼|N/A|

ã“ã‚Œã‚‰ã®ã“ã¨ã¨ã€æ—¢å­˜å®Ÿè£…ï¼ˆclang/gcc+{fmt}/MSVCï¼‰ã®æŒ¯ã‚‹èˆã„ã‚’å‚ç…§ã—ãŸã†ãˆã§ã€ã“ã®ææ¡ˆã§ã¯ã“ã®å•é¡Œã‚’æ¬¡ã®ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™

1. ç©´åŸ‹ã‚æ–‡å­—ã¯ã€å˜ä¸€ã®UCSã‚¹ã‚«ãƒ©ãƒ¼å€¤ã«åˆ¶é™ã™ã‚‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³3ï¼‰
      - åˆ¶é™ç¯„å›²å¤–ã®å€¤ãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆã¯ã‚¨ãƒ©ãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³6ï¼‰
      - ä»»æ„ã®EGCæ–‡å­—ã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸããªã£ãŸå ´åˆã€ABIç ´å£ŠãŒç”Ÿã˜ã‚‹
2. ç©´åŸ‹ã‚æ–‡å­—ã®æ¨å®šå¹…ã¯ã€å¸¸ã«1ã¨ã™ã‚‹
      - æ—¢å­˜å®Ÿè£…ãŒå…¨ã¦ãã†ãªã£ã¦ã„ãŸãŸã‚
3. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¼•æ•°ï¼ˆnotç©´åŸ‹ã‚æ–‡å­—ï¼‰ã®å¹…ãŒãã‚‚ãã‚‚æŒ‡å®šå¹…ã‚’è¶…ãˆã‚‹å ´åˆã€ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã®æŒ‡å®šã¯ç„¡è¦–ã•ã‚Œã‚‹ã“ã¨ã‚’æ˜ç¢ºåŒ–
4. æŒ‡å®šã•ã‚ŒãŸã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã‚’é”æˆã™ã‚‹ãŸã‚ã«ã€ç©´åŸ‹ã‚æ–‡å­—ãŒã©ã®ã‚ˆã†ã«æŒ¿å…¥ã•ã‚Œã‚‹ã‹ã‚’æ˜ç¢ºåŒ–

ã“ã‚Œã¯ã€{fmt}ãŠã‚ˆã³MSVCã®å®Ÿè£…ã‚’æ¨™æº–åŒ–ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã¾ãŸã€ã“ã®ã‚¨ãƒ©ãƒ¼ã¯`std::format`ã®å ´åˆã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

- [LWG Issue 3576. Clarifying fill character in `std::format`](https://cplusplus.github.io/LWG/issue3576)
- [LWG Issue 3639. Handling of fill character width is underspecified in `std::format`](https://cplusplus.github.io/LWG/issue3639)
- [ Unicodeã®grapheme cluster (æ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿) - hydroculã®ãƒ¡ãƒ¢](https://hydrocul.github.io/wiki/blog/2015/1025-unicode-grapheme-clusters.html)
- [UAX #15 : UNICODE NORMALIZATION FORMS](https://unicode.org/reports/tr15)
    - [Stream-Safe Text Format](https://unicode.org/reports/tr15/#Stream_Safe_Text_Format)
- [P2572 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1260)

### [P2575R0 2022-05 Library Evolution Poll Outcomes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2575r0.html)

2022å¹´ã®5æœˆã«è¡Œã‚ã‚ŒãŸã€LEWGã§ã®å…¨ä½“æŠ•ç¥¨ã®çµæœã€‚

æŠ•ç¥¨ã®å¯¾è±¡ã¨ãªã£ãŸææ¡ˆã¯ä»¥ä¸‹ã®ã‚‚ã®ã§ã€æŠ•ç¥¨ã«å½“ãŸã£ã¦å¯„ã›ã‚‰ã‚ŒãŸè³›å¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [P1885R10 Naming Text Encodings to Demystify Them](https://wg21.link/P1885R10)
- [P0792R8 function_ref](https://wg21.link/P0792R8)
- [P1223R3 find_last](https://wg21.link/P1223R3)
- [P1169R3 Static operator()](https://wg21.link/P1169R3)
- [P2553R1 Make mdspan size_type Controllable](https://wg21.link/P2553R1)
- [P2554R0 C-Array Interoperability Of mdspan](https://wg21.link/P2554R0)
- [P2540R0 Empty Product For Certain Views](https://wg21.link/P2540R0)
- [P2538R0 ADL-Proof projected](https://wg21.link/P2538R0)
- [P2520R0 move_iterator Should Be A Random Access Iterator](https://wg21.link/P2520R0)
- [P2499R0 string_view Range Constructor Should Be Explicit](https://wg21.link/P2499R0)
- [P2549R0 unexpected Should Have error As Member Accessor](https://wg21.link/P2549R0)
- [P2517R0 Add A Conditional noexcept Specification To apply](https://wg21.link/P2517R0)
- [P2300R5 std::execution](https://wg21.link/P2300R5)
    - C++26å‘ã‘
- [P1083R5 resource_adaptor](https://wg21.link/P1083R5)
    - C++26å‘ã‘
- [P1202R4 Asymmetric Fences](https://wg21.link/P1202R4)
    - Concurency TS v2å‘ã‘

çµæœçš„ã«ã€P1083R5ä»¥å¤–ã¯LWGã«è»¢é€ã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

### [P2582R1 Wording for class template argument deduction from inherited constructors](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2582r1.pdf)
### [P2590R1 Explicit lifetime management](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2590r1.pdf)
### [P2591R1 Concatenation of strings and string views](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2591r1.html)
### [P2594R0 Slides: Allow programmer to control and detect coroutine elision (P2477R2 Presentation))](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2594r0.pdf)

P2477ã®è§£èª¬ã‚¹ãƒ©ã‚¤ãƒ‰

P2477ã«é–¢ã—ã¦ã¯ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§ã€‚

- [P2477R0 Allow programmer to control and detect coroutine elision by static constexpr bool should_elide() and - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´10æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/11/13/193322#P2477R0-Allow-programmer-to-control-and-detect-coroutine-elision-by-static-constexpr-bool-should_elide-and)
- [P2477R2 Allow programmer to control and detect coroutine elision - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/12/11/220126#P2477R2-Allow-programmer-to-control-and-detect-coroutine-elision)


ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã¯ã€P2477ã®å†…å®¹ã‚’LEWGã®ãƒ¡ãƒ³ãƒã«ãƒ—ãƒ¬ã‚¼ãƒ³ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã€P2477ã®å‹•æ©Ÿã‚„ç›®çš„ã€ç¾çŠ¶åˆ†ã‹ã£ã¦ã„ã‚‹æ‡¸å¿µäº‹é …ãªã©ãŒã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

### [P2596R0 Improve `std::hive::reshape`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2596r0.html)

`std::hive`ã®å®¹é‡ãƒ¢ãƒ‡ãƒ«ã‚’å˜ç´”åŒ–ã™ã‚‹ææ¡ˆã€‚

`std::hive`ï¼ˆå…ƒ`std::colony`ï¼‰ã¯å¯å¤‰ã‚µã‚¤ã‚ºãƒ–ãƒ­ãƒƒã‚¯ã®é€£çµãƒªã‚¹ãƒˆã§ã™ã€‚è¦ç´ ã¯ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ç©ºãã‚¹ãƒšãƒ¼ã‚¹ã«æŒ¿å…¥ã•ã‚Œã€è¦ç´ ã‚’å‰Šé™¤ã—ã¦ã‚‚ãƒ–ãƒ­ãƒƒã‚¯ã¯è§£æ”¾ã•ã‚Œãšãã®ã‚¹ãƒšãƒ¼ã‚¹ã¯å†åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ­ãƒƒã‚¯å†…ã«ç©ºãã‚¹ãƒšãƒ¼ã‚¹ãŒãªããªã‚‹ã¨æ–°ã—ã„ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç¢ºä¿ã—ã¦åˆ©ç”¨ã—ã¾ã™ã€‚ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã¨ã„ã†ã®ã¯1ã¤ã®é…åˆ—ã®ã‚ˆã†ãªã‚‚ã®ã§ã€ãã®ã‚µã‚¤ã‚ºã¯å›ºå®šé•·ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒä¸€åº¦ç¢ºä¿ã•ã‚ŒãŸå¾Œã«ã‚µã‚¤ã‚ºãŒå¤‰æ›´ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®æ€§è³ªã«ã‚ˆã£ã¦ã€`std::hive`ã¯ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã‚’å¢—å¤§ã•ã›ãŸæ™‚ã§ã‚‚æ—¢å­˜è¦ç´ ã®ãƒ¡ãƒ¢ãƒªä½ç½®ã¯å®‰å®šã—ã¦ãŠã‚Šã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒç„¡åŠ¹ã«ãªã£ãŸã‚Šã—ã¾ã›ã‚“ã€‚

ç¾åœ¨ã®`std::hive`ã§ã¯ã€`std::hive_limits`ã¨ã„ã†ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹é€ ä½“ã«ã‚ˆã£ã¦`std::hive`ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºã®ä¸‹é™ã¨ä¸Šé™ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```cpp
// ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºã‚’[4, 5]ã§æŒ‡å®šã—ã¦æ§‹ç¯‰
std::hive<int> h({1,2,3,4,5,6}, std::hive_limits(4, 5));
               // [1 2 3 4 5] [6 _ _ _]
h.reserve(10); // [1 2 3 4 5] [6 _ _ _] [_ _ _ _]
```

ã“ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã®`[...]`ã¯`std::hive`ã®ãƒ–ãƒ­ãƒƒã‚¯ã¨è¦ç´ ãŒã©ã†ãªã£ã¦ã„ã‚‹ã‹ã‚’è¡¨ã—ãŸã‚‚ã®ã§ã€`_`ã¯æœªä½¿ç”¨é ˜åŸŸã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

ã•ã‚‰ã«ã€ã“ã®ã‚ˆã†ã«æ§‹ç¯‰ã—ãŸå¾Œã§`std::hive_limits`ã«ã‚ˆã£ã¦ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºã‚’èª¿æ•´ï¼ˆ*reshape*ï¼‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™

```cpp
// ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºã‚’[4, 5]ã§æŒ‡å®šã—ã¦æ§‹ç¯‰
std::hive<int> h({1,2,3,4,5,6}, std::hive_limits(4, 5));
               // [1 2 3 4 5] [6 _ _ _]
h.reserve(10); // [1 2 3 4 5] [6 _ _ _] [_ _ _ _]

// ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºã‚’[3, 4]ã¸èª¿æ•´
h.reshape(std::hive_limits(3, 4));
               // [6 1 2 3] [4 5 _ _]
```

ã“ã®æ™‚ã€æœ€åˆã«æŒ‡å®šã—ãŸãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºãŒ`.reshape()`å¾Œã«ä¸æ­£ï¼ˆæŒ‡å®šã•ã‚ŒãŸæœ€å°å€¤ã¨æœ€å¤§å€¤ã®ç¯„å›²å¤–ï¼‰ã«ãªã‚‹å ´åˆã€ãƒ–ãƒ­ãƒƒã‚¯ã¯ç¢ºä¿ã—ãªãŠã•ã‚Œè¦ç´ ã®å†é…ç½®ãŒè¡Œã‚ã‚Œã¾ã™ã€‚ã¾ãŸã€`.reserve()`ã—ãŸé ˜åŸŸã‚‚è§£æ”¾ã•ã‚Œã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãŸã‚ã€é€šå¸¸ã¯`.reshape()`ã—ã¦ã‹ã‚‰`.reserve()`ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚

ã“ã®`std::hive`ã®å®¹é‡ãƒ¢ãƒ‡ãƒ«ã«é–¢ã—ã¦ã€æ¬¡ã®ã‚ˆã†ãªå•é¡ŒãŒã‚ã‚Šã¾ã™

- ãƒ–ãƒ­ãƒƒã‚¯æœ€å¤§ã‚µã‚¤ã‚ºã¯å®Ÿéš›ã«ã¯æœ‰ç”¨ã§ã¯ãªã„
    - æœ€å°ã‚’æ°—ã«ã™ã‚‹ã“ã¨ã¯å¤šã„ãŒã€æœ€å¤§ã¯æ°—ã«ã—ãªã„
    - çµ„ã¿è¾¼ã¿ç’°å¢ƒãªã©ã§æœ€å¤§å®¹é‡ã‚’åˆ¶é™ã—ãŸã„å ´åˆã§ã‚‚ã€`std::hive_limits`ã®æŒ‡å®šã¯è¦ç´ æ•°ã§ã‚ã£ã¦ãƒã‚¤ãƒˆæ•°ã§ã¯ãªã„
        - ã¾ãŸã€ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºã‚’`n`ã¨ã—ãŸæ™‚ã€1ã¤ã®ãƒ–ãƒ­ãƒƒã‚¯ã®ãŸã‚ã«ç¢ºä¿ã™ã‚‹å®¹é‡ã¯`n * sizeof(T)`ã‚ˆã‚Šã‚‚å¤šããªã‚‹ã€‚ãã®ãŸã‚ã€æœ€å¤§å®¹é‡ã®åˆ¶é™ã«ã¯é©ã›ãªã„
- æœ€å¤§ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºã¯`O(n)`å‹•ä½œã®åŸå› ã¨ãªã‚‹
    - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ–ãƒ­ãƒƒã‚¯ã¯å…ˆé ­ã‹ã‚‰é †ã«ãƒŠãƒ³ãƒãƒªãƒ³ã‚°ã•ã‚Œã¦ãŠã‚Šã€å‰Šé™¤ã‚„è¿½åŠ ã®éš›ã«ã¯ç•ªå·ã‚’ä»˜ã‘ç›´ã™å¿…è¦ãŒã‚ã‚‹ã€‚ã“ã‚Œã«ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ–ãƒ­ãƒƒã‚¯æ•°ã‚’`n`ã¨ã—ã¦ï¼‰`O(n)`ã®æ™‚é–“ãŒã‹ã‹ã‚‹
    - ãã®ã‚ˆã†ãªæ“ä½œãŒãƒ«ãƒ¼ãƒ—å†…ã§è¡Œã‚ã‚Œã‚‹ã¨ã€ç›®ã«è¦‹ãˆãªã„`O(n^2)`ã®è¨ˆç®—é‡ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ã«ãªã‚‹
- ãƒ ãƒ¼ãƒ–æ™‚ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã¯ã€ã»ã¼é–“é•ã„ãªãç›´æ„Ÿçš„ã§ã¯ãªã„
    - `std::hive_limits`ã«ã‚ˆã‚‹ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºåˆ¶é™ã¯ãƒ ãƒ¼ãƒ–ã‚„ã‚³ãƒ”ãƒ¼ã«ã‚ˆã£ã¦ä¼æ’­ã™ã‚‹
    - ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºåˆ¶é™ã¯`std::hive`ã®å€¤ã®ä¸€éƒ¨ã§ã¯ãªã„ã¯ãš
- `.splice()`ãŒ`O(n)`ã¨ãªã‚Šã€ä¾‹å¤–ã‚’æŠ•ã’ã†ã‚‹
    - `h.splice(h2)`ã§ã¯`h`ã®åˆ¶é™ãŒå¤‰æ›´ã•ã‚Œãªã„ãŒã€`h2`ã«`h`ã®æœ€å¤§ã‚µã‚¤ã‚ºã‚ˆã‚Šã‚‚å¤§ããªãƒ–ãƒ­ãƒƒã‚¯ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã«å¤±æ•—ã—ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã“ã¨ã‚’æ„å‘³ã™ã‚‹
- `std::hive_limits`ã‚’å—ã‘å–ã‚‹ãŸã‚ã«ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®æ•°ã‚’å¢—å¤§ã•ã›ã¦ã„ã‚‹
    - ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã¨`std::hive_limits`ã‚’å—ã‘å–ã‚‹å—ã‘å–ã‚‰ãªã„ã«ã‚ˆã£ã¦ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®æ•°ãŒ4å€ã«ãªã‚‹
    - ç¾åœ¨ã®ææ¡ˆã§ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯18å€‹ã‚ã‚Šã€ã“ã®ææ¡ˆã«ã‚ˆã£ã¦7å€‹æ¸›ã‚‰ã›ã‚‹
- `std::hive_limits`ã¯ä¸å¿…è¦ãªæœªå®šç¾©å‹•ä½œã‚’å°å…¥ã™ã‚‹
    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦æŒ‡å®šã•ã‚ŒãŸåˆ¶é™ãŒã€å®Ÿè£…å®šç¾©ã®ãƒãƒ¼ãƒ‰ãƒªãƒŸãƒƒãƒˆã®ç¯„å›²å¤–ã«ã‚ã‚‹å ´åˆã¯æœªå®šç¾©å‹•ä½œã¨ã•ã‚Œã‚‹
    - ã“ã®ãƒãƒ¼ãƒ‰ãƒªãƒŸãƒƒãƒˆã¯é€šå¸¸ãã‚Œã»ã©å¤§ããªå€¤ã§ã¯ãªã„ãŸã‚ï¼ˆå‚ç…§å®Ÿè£…ã§ã¯255ï¼‰ã€ç”¨æ„ã«UBã‚’è¸ã¿ã†ã‚‹
    - ã¾ãŸã€`std::hive_limits`ã‚’å—ã‘å–ã‚‹APIã¯ã“ã‚Œã«è§¦ã‚Œã‚‹å ´åˆã«ä½•ãŒèµ·ã“ã‚‹ã‹ï¼ˆã‚ã‚‹ã„ã¯èµ·ã“ã‚‰ãªã„ã®ã‹ï¼‰ã‚’è¦å®šã—ãªã‘ã‚Œã°ãªã‚‰ãšã€ä»•æ§˜ã‚’è‚¥å¤§åŒ–ã•ã›ã‚‹

ã“ã®ææ¡ˆã¯ã€ã“ã‚Œã‚‰ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€`std::hive`ã‹ã‚‰ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºæŒ‡å®šã‚’å–ã‚Šé™¤ã„ã¦ã€åˆ¥ã®å®¹é‡ç®¡ç†ãƒ¢ãƒ‡ãƒ«ã‚’å°å…¥ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ææ¡ˆã§ã¯ã€`std::hive_limits`ã‚’ç„¡ãã—ã¦ã€ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºæŒ‡å®šãŒä¸€æ™‚çš„ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ãªã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ã“ã®ãƒ¢ãƒ‡ãƒ«ã¯ã€`std::vector`ã‚„`std::deque`ã«ãŠã„ã¦ãã®ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãŒä¸€æ™‚çš„ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã‚ã‚‹ã“ã¨ã¨åŒæ§˜ã§ã™ã€‚ä»–ã«ã€ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã‚„ã‚½ãƒ¼ãƒˆã®æœ‰ç„¡ãŒ`std::hive`ã®ä¸€æ™‚çš„ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è©²å½“ã—ã¦ã„ã¾ã™ã€‚

```cpp
std::hive<int> h = {1,2,3};
h.erase(h.begin());  // [_ 2 3]
h.sort();            // [_ 2 3]

// ã‚½ãƒ¼ãƒˆçŠ¶æ…‹ã¯ãã®å¾Œã®æ“ä½œã§ç¶­æŒã•ã‚Œãªã„
h.insert(4);         // [4 2 3], no longer sorted

h.reshape(4, 8);     // [4 2 3 _] [_ _ _ _]

// ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºåˆ¶é™ã¯ä¸€æ™‚çš„ï¼ˆã‚³ãƒ”ãƒ¼ã‚„ãƒ ãƒ¼ãƒ–ã§æ¨ç§»ã—ãªã„ï¼‰
auto h2 = h;         // [4 2 3], no longer capacious
```

ãã—ã¦ã€`.reshape()`ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯`bool reshape(size_t min, size_t n = 0)`ã®ã‚ˆã†ã«å¤‰æ›´ã•ã‚Œã¾ã™ã€‚`min`ã¯ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºã®ä¸‹é™ã§ã‚ã‚Šã€`n`ã¯ã“ã®æ“ä½œã®å¾Œã§ãƒ¡ãƒ¢ãƒªã‚’ç¢ºä¿ã™ã‚‹ã“ã¨ãªãæŒ¿å…¥å¯èƒ½ãªæœ€ä½è¦ç´ æ•°ã§ã™ã€‚æˆ»ã‚Šå€¤ã¯ã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒç„¡åŠ¹åŒ–ã•ã‚ŒãŸã‹å¦ã‹ã‚’ä¼ãˆã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

ã“ã®å¤‰æ›´ã«ã‚ˆã£ã¦ã€`std::hive`ã®æœ€å¤§ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºã®æŒ‡å®šã¯ç„¡ããªã‚Šã€å®Ÿè£…ãŒè¦ç´ ã®éš£æ¥æ€§ã‚’é«˜ã‚ã‚ˆã†ã¨ã™ã‚‹å ´åˆã«ãã‚Œã‚’åˆ¶é™ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒã€éš ã‚ŒãŸ`O(n)`è¨ˆç®—é‡ã®å•é¡Œã‚’å›é¿ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

- [P0447R11 Introduction of std::colony to the standard library - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2020å¹´11æœˆï¼‰](https://onihusube.hatenablog.com/entry/2020/12/06/015108#P0447R11-Introduction-of-stdcolony-to-the-standard-library)
- [P2596 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1256)

### [P2598R0 â€œChanging scope for lambda trailing-return-typeâ€ (P2036) should not be a DR](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2598r0.html)

[P2036](https://wg21.link/p2036)ã®å¤‰æ›´ã‚’DRã¨ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

P2036ã«ã¤ã„ã¦ã¯ä»¥å‰ã®è¨˜äº‹ã‚’å‚ç…§

- [P2036R1 Changing scope for lambda trailing-return-type - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2021å¹´1æœˆï¼‰](https://onihusube.hatenablog.com/entry/2021/02/11/153333#P2036R1-Changing-scope-for-lambda-trailing-return-type)

P2036ã®å†…å®¹ã¯æ¤œè¨æ®µéšã§ã¯å•é¡Œãªã„ã¨æ€ã‚ã‚Œã¦ã„ã¾ã—ãŸãŒã€å®Ÿéš›ã«clangã«ãŠã„ã¦å®Ÿè£…ã•ã‚ŒãŸã¨ã“ã‚æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å£Šã™ã“ã¨ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚ãã®å ±å‘Šã¨ã¨ã‚‚ã«ãã®ç·©å’Œç­–ã‚‚ææ¡ˆï¼ˆ[P2579](https://isocpp.org/files/papers/D2579R0.pdf)ï¼‰ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã¾ã æ¡æŠã•ã‚Œã¦ãŠã‚‰ãšã€é©ç”¨ã•ã‚ŒãŸã¨ã—ã¦ã‚‚æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ç ´å£Šã™ã‚‹å¯èƒ½æ€§ãŒã¾ã æ®‹ã£ã¦ã„ã¾ã™ã€‚

ãã‚Œã‚‰ã®å¤‰æ›´ã‚’DRã¨ã—ãŸå ´åˆã€å®Ÿè£…ã•ã‚ŒãŸã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§ã¯ç ´å£Šçš„å¤‰æ›´ãŒé™ã‹ã«å…¨ã¦ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆC++11ä»¥é™ï¼‰ã«å¯¾ã—ã¦é©ç”¨ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã‚ã‚‹ã„ã¯ã€å®Ÿè£…ã¯DRã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã¨ã—ãŸã‚Šå®Ÿè£…ã—ãªã„ã“ã¨ã‚’é¸æŠã™ã‚‹ã‹ã‚‚ã—ã‚Œãšã€ãã®å ´åˆã“ã®å¤‰æ›´ã¯C++ã‚³ãƒ¼ãƒ‰ã®ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£ã‚’æã­ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã§ã¯ã€ç ´å£Šçš„å¤‰æ›´ã‚’å›é¿ã—ãŸã„äººã‚‚æœ€æ–°ã®C++ã®å¤‰æ›´ã‚’ç©æ¥µåˆ©ç”¨ã—ãŸã„äººã®ã©ã¡ã‚‰ã‚‚å¹¸ã›ã«ãªã‚Šã¾ã›ã‚“ã€‚

ãã‚‚ãã‚‚ã€ã“ã®ã‚ˆã†ãªé™ã‹ãªæ„å‘³ã®å¤‰æ›´ã‚’è¡Œã†ã®ã¯è‰¯ã„ã“ã¨ã§ã¯ãªãã€ãã‚Œã‚’é¡åŠçš„ã«è¡Œã†ã‹ã‚‚ã—ã‚Œãªã„ã—ãã†ã§ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã€ã¨ã™ã‚‹ã®ã¯ã•ã‚‰ã«æ‚ªã„ã“ã¨ã§ã™ã€‚ã“ã®å¤‰æ›´ã«ã¤ã„ã¦çŸ¥ã‚‰ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã‚ã‚‹æ—¥çªç„¶æœ‰åŠ¹ã ã¨æ€ã£ã¦ã„ãŸã‚³ãƒ¼ãƒ‰ãŒå£Šã‚Œã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ãã€ä¿®æ­£ã™ã‚‹å¿…è¦æ€§ã«è¿«ã‚‰ã‚Œã¾ã™ã€‚DRã¨ã—ãªã„ã“ã¨ã§ï¼ˆC++23ã®ç ´å£Šçš„å¤‰æ›´ã¨ã™ã‚‹ã“ã¨ã§ï¼‰ã€å°‘ãªãã¨ã‚‚å•é¡Œã®å›é¿ã®ãŸã‚ã«è¨€èªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ãªã„ã¨ã„ã†é¸æŠè‚¢ãŒä¸ãˆã‚‰ã‚Œã¾ã™ã€‚DRã®å ´åˆã¯ãã®ã‚ˆã†ãªé¸æŠè‚¢ã¯ãªãã€ã™ãã«è¡Œå‹•ã‚’èµ·ã“ã•ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã‚‰ã®ç†ç”±ã«ã‚ˆã‚Šã“ã®ææ¡ˆã§ã¯ã€P2036ï¼ˆã¨é–¢é€£ã™ã‚‹å¤‰æ›´ï¼‰ã‚’DRã¨ã›ãšã«C++23ä»¥é™ã®ç ´å£Šçš„å¤‰æ›´ã¨ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

- [P2579 Mitigation strategies for P2036 â€Changing scope for lambda trailing-return-typeâ€](https://isocpp.org/files/papers/D2579R0.pdf)
- [P2598 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1263)

### [P2599R0 `mdspan::size_type` should be `index_type`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2599r0.pdf)

â†“

### [P2599R1 `mdspan::size_type` should be `index_type`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2599r1.pdf)

â†“

### [P2599R2 `index_type` & `size_type` in `mdspan`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2599r2.pdf)

`std::mdspan`ã®ãƒ¡ãƒ³ãƒå‹`size_type`ã‚’`index_type`ã«å¤‰æ›´ã™ã‚‹ææ¡ˆã€‚

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚³ãƒ³ãƒ†ãƒŠç­‰ã®`size_type`ã¯é€šå¸¸ç¬¦å·ãªã—æ•´æ•°å‹ï¼ˆ`std::size_t`ï¼‰ãŒä½¿ç”¨ã•ã‚Œã€ãã‚ŒãŒã»ã¼ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã«ãªã£ã¦ã„ã¾ã™ã€‚å½“åˆã®`std::mdspan`ã®`size_type`ã¯`std::size_t`ã§å›ºå®šã§ã‚ã£ãŸãŸã‚å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€[P2553](https://wg21.link/p2553)ï¼ˆæœªæ¡æŠï¼‰ã«ã‚ˆã£ã¦`size_type`ã‚’åˆ¶å¾¡å¯èƒ½ã¨ã™ã‚‹ã¨ã¨ã‚‚ã«ä»»æ„ã®æ•´æ•°å‹ã‚’ä½¿ç”¨å¯èƒ½ã¨ãªã‚‹ã‚ˆã†ã«ãªã‚‹ã¨åå‰ã¨å®Ÿæ…‹ãŒæ—¢å­˜ã®æ…£è¡Œã¨ä¸€è‡´ã—ãªããªã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã€ã“ã®ã‚ˆã†ãªç†ç”±ã‹ã‚‰`std::mdspan`ï¼ˆã¨`std::extents`ï¼‰ã®`size_type`ã®åå‰ã‚’`index_type`ã«å¤‰æ›´ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã•ã‚‰ã«ãã®ä¸Šã§ã€`std::mdspan::size_type`ã‚’`make_unsigned_t<index_type>`ã§å†å®šç¾©ã—ã€`std::mdspan::size()`ã¯ãã®å‹ã®å€¤ã‚’è¿”ã™ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚ææ¡ˆã—ã¦ã„ã¾ã™ï¼ˆã“ã‚Œã¯LEWGã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚ˆã†ã§ã™ï¼‰ã€‚

- [P2553R0 Make mdspan `size_type` controllable - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P2553R0-Make-mdspan-size_type-controllable)
- [P2553R1 Make mdspan `size_type` controllable - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´03æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/04/02/175835#P2553R1-Make-mdspan-size_type-controllable)
- [P2599 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1255)

### [P2600R0 A minimal ADL restriction to avoid ill-formed template instantiation](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2600r0.pdf)

ADLã®ãƒ«ãƒ¼ãƒ«ã‚’å°‘ã—åˆ¶é™ã™ã‚‹ã“ã¨ã§ã€æ„å›³ã—ãªã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã‚’é˜²æ­¢ã™ã‚‹ææ¡ˆã€‚

ADLã«ãŠã„ã¦ã¯ã€å¼•æ•°å‹ã‹ã‚‰é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æŠ½å‡ºã—ãã®åå‰ç©ºé–“ã‚’æ¢ç´¢å€™è£œã«åŠ ãˆã‚‹ã“ã¨ãŒè¡Œã‚ã‚Œã¾ã™ã€‚ãã®éš›ã€é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å«ã¾ã‚Œã‚‹ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯æš—é»™ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã‚‹ãŸã‚ã€æ„å›³ã—ãªã„ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

```cpp
struct Incomplete;

// Tã«ä¸å®Œå…¨å‹ã‚’æŒ‡å®šã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
template<typename T>
struct Wrap { T t; };

template<typename Unused>
struct Testable {
  explicit operator bool() const { return true; }
};

int main() {
  Testable<Incomplete> l;

  if (l)  // OK
    return 1;

  if(!(bool)l)  // OK
    return 0;

  if(!l)  // OK
    return 0;


  Testable<Wrap<Incomplete>> l2;
  
  if(l2) // OK
    return 1;
    
  if(!(bool)l2) // OK
    return 0;
    
  if(!l2) // ERROR
    return 0;
}
```

ä¸Šè¨˜ã®`!l, !l2`ã§ã¯`operator!`ã®æ¢ç´¢ãŒç™ºç”Ÿã—ã¦ãŠã‚Šã€ADLã«ã‚ˆã‚‹æ¢ç´¢ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ADLã§ã¯ã€ãã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹ã‹ã‚‰ã‚‚é–¢é€£åå‰ç©ºé–“ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ã€ãã®éš›ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãŒç™ºç”Ÿã—ã¾ã™ã€‚

`Testable<Incomplete>`ã¯è¿½åŠ ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€`Incomplete`å‹ã®å®Œå…¨æ€§ãŒå¿…è¦ã¨ãªã‚‹ä½¿ã‚ã‚Œæ–¹ã‚’ã—ã¦ã„ãªã„ãŸã‚ã‚¨ãƒ©ãƒ¼ã¯èµ·ãã¾ã›ã‚“ã€‚ä¸€æ–¹ã€`Testable<Wrap<Incomplete>>`ã§ã¯`Wrap<Incomplete>`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãŒç™ºç”Ÿã—ã€`Wrap<T>`ã§ã¯`T`ã®å®Œå…¨æ€§ãŒå¿…è¦ï¼ˆãƒ¡ãƒ³ãƒå¤‰æ•°ã¨ã—ã¦å®£è¨€ï¼‰ãªãŸã‚ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

ã™ãªã‚ã¡ã€ADLãŒã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‹ã«å¯¾ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã‚’å¼•ãèµ·ã“ã—ã€ãã®éš›ã«ãã®å®Œå…¨æ€§ãŒè¦æ±‚ã•ã‚Œã‚‹ã‹ã•ã‚Œãªã„ã‹ãŒç•°ãªã‚‹ã“ã¨ã€ã«ã‚ˆã£ã¦ã“ã®æŒ¯ã‚‹èˆã„ã®å¾®å¦™ãªå·®ãŒç”Ÿã˜ã¦ã„ã¾ã™ã€‚

å¼`!l`ã¯ADLãŒä¸å®Œå…¨å‹ã‚’ç„¡è¦–ã—ã¦ã„ã‚‹é–“ã¯well-formedã§ã™ãŒã€ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ã«å¾Œã‹ã‚‰å®šç¾©ã‚’è¿½åŠ ã™ã‚‹ã¨çµæœãŒå¤‰ã‚ã‚Šã¾ã™ã€‚

```cpp
struct Incomplete{
  friend bool operator!(Testable<Incomplete>) { return true; }
}
```

ODRé•åã«ã¤ãªãŒã‚Šã†ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãšã€è¦æ ¼ã¯ãªãœä¸å®Œå…¨å‹ã‚’ADLã®é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å«ã‚ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿã¾ãŸã€ã¾ã ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¦ã„ãªã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å¯¾ã—ã¦ã‚‚åŒã˜ã“ã¨ã‚’é©ç”¨ã—ã¦ã¯ã„ã‘ãªã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã“ã®ä¾‹ã¯æ£æ„çš„ã«è¦‹ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€`Testable`ã‚’ä¾‹ãˆã°`std::unique_ptr`ã«ã™ã‚‹ã¨ç¾å®Ÿçš„ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ãŠã„ã¦ã‚‚ã“ã®å•é¡Œã«å‡ºä¼šã„ã†ã‚‹ã“ã¨ãŒè¦‹ãˆã¦ãã¾ã™ã€‚

```cpp
class Incomplete;

using Data = std::array<Incomplete,ã€€3>;
using Ptr = std::unique_ptr<Data>;

void assert_nonnull(std::span<Ptr>ã€€x) {
  for (const Ptr& ptr : x ) {  // ERROR : 'std::array<_Tp,_Nm>::_M_elems'ã¯ä¸å®Œå…¨å‹
    assert(ptr);
  }
}
```

ã“ã“ã§ã¯ã€`begin(std::span<std::unique_ptr<std::array<Incomplete,ã€€3>>>)`ã®ã‚ˆã†ãªé–¢æ•°ã®æ¢ç´¢ã«ã‚ˆã£ã¦`std::array<Incomplete,ã€€3>`ãŒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã€`Incomplete`ã®å®Œå…¨æ€§ãŒè¦æ±‚ã•ã‚Œã‚‹ã“ã¨ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¦ã„ã¾ã™ã€‚

ã“ã‚Œã¨ä¼¼ãŸå•é¡Œã¯[P2538](https://wg21.link/p2538)ã§ã‚‚æèµ·ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã“ã§ã¯ã€ADLã«å¯¾ã™ã‚‹é˜²å£ã‚’è¨­ç½®ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã£ã¦ADLã«ã‚ˆã‚‹ä¸è¦ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã‚’é˜²æ­¢ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã®å•é¡Œã¯ã¾ãŸã€éãƒ¡ãƒ³ãƒ`operator[]`ã‚„ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰`?:`ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’ç ´å£Šçš„å¤‰æ›´ã«ã—ã¦ã—ã¾ã£ã¦ãŠã‚Šã€å°†æ¥ã®æ©Ÿèƒ½è¿½åŠ ãƒ»æ”¹å–„ã‚’å¦¨ã’ã¦ã„ã¾ã™ã€‚æ–°ã—ã„æ©Ÿèƒ½ãŒADLã«é–¢é€£ã™ã‚‹å ´åˆã€å¸¸ã«ã“ã®å•é¡Œã‚’è€ƒæ…®ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã§ã¯ã€ADLã«ãŠã‘ã‚‹ã“ã®ã‚ˆã†ãªæ„å›³ã—ãªã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ã“ã‚Œã‚‰ã®å•é¡Œã‚’è§£æ±ºã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€P2538ã¯ä¸è¦ã¨ãªã‚Šã€å°†æ¥ã®æ©Ÿèƒ½æ‹¡å¼µã®éš›ã‚‚ã“ã®ã‚Œã‚‰ã®å•é¡Œã«ã‚ˆã‚‹ç ´å£Šçš„å¤‰æ›´ã‚’å–ã‚Šé™¤ãã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ADLã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã¯[[temp.inst/2]](https://eel.is/c++draft/temp.inst#2.sentence-1)ã®ã€Œã‚¯ãƒ©ã‚¹å‹ã®å®Œå…¨æ€§ãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹æ™‚ã€ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯æš—é»™ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã‚‹ã€ã¨ã„ã†è¦å®šã«ã‚ˆã‚‹ã‚‚ã®ã®ã®ã‚ˆã†ã§ã™ã€‚åŸºæœ¬çš„ã«ã‚¯ãƒ©ã‚¹å‹ã®å®Œå…¨æ€§ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã¾ã›ã‚“ãŒã€ã‚ã‚‹åå‰ï¼ˆã“ã“ã§ã¯é–¢æ•°åï¼‰ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã«é–¢ã™ã‚‹çŸ¥è­˜ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚ãã®ãŸã‚ã€ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãŒå¿…è¦ã¨ãªã‚‹ã‹ã©ã†ã‹ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ãŸå¾Œã§ã—ã‹åˆ¤æ–­ã§ããšï¼ˆ*hidden friends*ã®ã‚ˆã†ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ã¾ã§å­˜åœ¨ãŒç¢ºå®šã—ãªã„åå‰ãŒè€ƒãˆã‚‰ã‚Œã‚‹ãŸã‚ï¼‰ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã‚’é¿ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

```cpp
template<typenameT>
struct A {
  friend void f(const A&);  // ä¾å­˜åã§ã‚ã‚Šã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãŒå¿…è¦
};

void g(const A<int>& x){
  f(x);
}
```

ã—ãŸãŒã£ã¦ã€å°‘ãªãã¨ã‚‚ADLã®ãƒˆãƒªã‚¬ãƒ¼ã¨ãªã£ãŸç›´æ¥ã®å¼•æ•°å‹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã¯å¿…è¦ã§ã™ã€‚ãŸã ã—ã€ã“ã®å ´åˆã§ã‚‚`A`ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`T`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã¾ã§ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚

ADLã®é–¢é€£åå‰ç©ºé–“ã«ã¯ã‚¯ãƒ©ã‚¹å‹ã®åŸºåº•ã‚¯ãƒ©ã‚¹ãŒå«ã¾ã‚Œã€åŸºåº•ã‚¯ãƒ©ã‚¹ã‚’çŸ¥ã‚‹ãŸã‚ã«ã¯ãã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚ä»®ã«ADLã«ãŠã„ã¦ç›´æ¥ã®å¼•æ•°å‹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ãªã„ã‚ˆã†ã«ã—ãŸã¨ã™ã‚‹ã¨ã€ãã®æ™‚ç‚¹ã§ã®ãã®å‹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã®æœ‰ç„¡ã«ã‚ˆã£ã¦åŒã˜ã‚³ãƒ¼ãƒ‰ã®æŒ¯ã‚‹èˆã„ãŒå¤‰ã‚ã‚Šã¾ã™

```cpp
namespace A {
  class B{};
  void f(B*);
}

void f(void*);

template<class T>
class C : public A::B {};

// C<int>ãŒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã‚‹å‰ã«å‘¼ã°ã‚ŒãŸã¨ã™ã‚‹ã¨
void g(C<int>* p){
  f(p); // ::f(void*)ãŒå‘¼ã°ã‚Œã‚‹ã€C<int>ã¯ã¾ã ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¦ã„ãªã„

  A::B* other_ptr = p;  // C<int>ãŒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã‚‹
  
  f(p); // A::f(B*)ãŒå‘¼ã°ã‚Œã‚‹ã€
}
```

ã“ã®ã“ã¨ã¯ã€ç¾åœ¨ã®ä¸å®Œå…¨å‹ã®æŒ¯ã‚‹èˆã„ã«ã‚ˆãä¼¼ã¦ã„ã¾ã™ã€‚

```cpp
// ä¸å®Œå…¨å‹
class I;

void g0(I* p) { 
  f(p); // ::f(void*)ãŒå‘¼ã°ã‚Œã‚‹
}

// Iã®å®šç¾©
class I : public A::B {};

void g1(I* p) {
  f(p); // A::f(B*)ãŒå‘¼ã°ã‚Œã‚‹
}
```

ãŸã ã—ä¸å®Œå…¨å‹ã«ãŠã„ã¦ã¯ãªãœãã®æŒ¯ã‚‹èˆã„ã®é•ã„ãŒèµ·ã“ã‚‹ã®ã‹ã¯æ˜ç¢ºï¼ˆ1ã¤ç›®ã®æ™‚ç‚¹ã§`I`ã¯ã¾ã `A::B`ã‚’ç¶™æ‰¿ã—ã¦ã„ãªã„ï¼‰ã§ã‚ã‚Šã€ã‚„ã¯ã‚Šç›´æ¥ã®å¼•æ•°å‹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã¯å¿…è¦ã§ã™ã€‚

ã“ã‚Œã‚‰ã®ã“ã¨ã‹ã‚‰ã€ã“ã®ææ¡ˆã«ã‚ˆã‚‹è§£æ±ºç­–ã¯ã€ADLã®é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å†…ã«ã‚ã‚‹ã¾ã ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¦ã„ãªã„ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€ãã‚ŒãŒç›´æ¥ã®å¼•æ•°å‹ã¨ãªã£ã¦ã„ã‚‹å ´åˆï¼ˆADLã®ãƒˆãƒªã‚¬ãƒ¼ã¨ãªã£ã¦ã„ã‚‹å‹ï¼‰ã‚’é™¤ã„ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œãªã„ã€ã¨ã„ã†ã‚ˆã†ã«ADLã®æŒ¯ã‚‹èˆã„ã‚’å¤‰æ›´ã™ã‚‹äº‹ã§ã™ã€‚ã™ãªã‚ã¡ã€ADLãŒè¡Œã‚ã‚Œã‚‹éš›ã¯ãã®æ™‚ç‚¹ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¦ã„ãªã„ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ç¾åœ¨ã®ä¸å®Œå…¨å‹ã¨åŒæ§˜ã«æ‰±ã‚ã‚Œã‚‹ï¼ˆç„¡è¦–ã•ã‚Œã‚‹ï¼‰ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã®å¤‰æ›´ã®å•é¡Œç‚¹ã¯ãƒã‚¤ãƒ³ã‚¿/å‚ç…§ã‹ã‚‰ã®ADLã«ãŠã„ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–æ¸ˆã¿ã‹å¦ã‹ã§ADLã®æŒ¯ã‚‹èˆã„ãŒå¤‰æ›ã™ã‚‹ã“ã¨ã§ã™ã€‚ãã—ã¦ã“ã®å¤‰æ›´ã¯ã€æ¬¡ã®å ´åˆã«æ—¢å­˜ã®æŒ¯ã‚‹èˆã„ã‚’å£Šã—ã¾ã™

- ã¾ã ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¦ã„ãªã„ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç‰¹æ®ŠåŒ–`X<Y>`ã«ã‚ˆã£ã¦ADLãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¦ã„ã¦ã€åå‰æ¢ç´¢ã§`X<Y>`ã®*hidden friends*ã‚’è¦‹ã¤ã‘ãŸã„é–¢æ•°ã¾ãŸã¯æ¼”ç®—å­ã®å‘¼ã³å‡ºã—
- `std::reference_wrapper<X<Y>>`ã®ã‚ˆã†ã«ãƒ©ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã«å¯¾ã™ã‚‹ADL

2ã¤ç›®ã¯æ¬¡ã®ã‚ˆã†ãªå ´åˆã«èµ·ã“ã‚Šã¾ã™ï¼ˆã“ã®ææ¡ˆãŒæ¡æŠã•ã‚ŒãŸã¨ã—ã¦

```cpp
template<typename T>
struct X {
  T data;
  friend aut ooperator<=>(const X&, const X&) = default;
};

//static_assert(std::totally_ordered<X<int>>);
// â†‘ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’è§£é™¤ã—ãªã„å ´åˆã€â†“ã¯å¤±æ•—ã™ã‚‹
static_assert(std::totally_ordered<std::reference_wrapper<X<int>>>);
```

[`std::totally_ordered`](https://cpprefjp.github.io/reference/concepts/totally_ordered.html)å†…éƒ¨ã§ã¯ã€`std::reference_wrapper<X<int>>`ã®å€¤`a, b`ã«å¯¾ã—ã¦`a < b`ã®å‘¼ã³å‡ºã—ãŒå¯èƒ½ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãŠã‚Šã€ãã“ã§ADLãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚

ã“ã®å ´åˆã€`operator<`ã®ç›´æ¥ã®å¼•æ•°å‹ã¯`std::reference_wrapper<X<int>>`ã§ã‚ã‚Šã€ï¼ˆã“ã®ææ¡ˆã®æ¡æŠå¾Œã¯ï¼‰`std::reference_wrapper<X<int>>`ãã®ã‚‚ã®ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¾ã™ãŒã€ãã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹`X<int>`ã¯é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ã¯ã‚ã‚‹ã‚‚ã®ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œãšã€`X`ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹*hidden friends*ãª`<=>`æ¼”ç®—å­ã‚’ç™ºè¦‹ã§ãã¾ã›ã‚“ã€‚ãªãŠã€ç¾åœ¨ã¯ã“ã®å ´åˆã§ã‚‚`X<int>`ãŒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã‚‹ãŸã‚å•é¡Œã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã¯æ·±åˆ»ãªç ´å£Šçš„å¤‰æ›´ã¨ãªã‚Šã¾ã™ãŒã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯ç¾åœ¨ã“ã‚ŒãŒå•é¡Œã«ãªã‚‹ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ãªãã€å•é¡Œã«ãªã‚‹å‹ã«å¯¾ã—ã¦ã‚‚ã“ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã¯ç¨€ã§ã‚ã‚Šã€`std::reference_wrapper`ã®é€šå¸¸ã®ä½¿ç”¨æ™‚ã«ã¯è‡ªå‹•çš„ã«unwrapã•ã‚Œã‚‹ãŸã‚å•é¡Œã«ãªã‚‰ãªã„ã€ã¨ææ¡ˆã§ã¯ä¸»å¼µã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸææ¡ˆã«ã‚ˆã‚Œã°ã€ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒã¨ãªã£ã¦ã„ã‚‹ADLã‚’ä»‹ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã¯å®Ÿã¯é•·ã„é–“å®Ÿè£…ã•ã‚Œã¦ã„ãªã‹ã£ãŸã‚ˆã†ã§ã€ã“ã®ææ¡ˆã®å†…å®¹ã¯ã‚ã‚‹æ™‚æœŸä»¥å‰ã®ã‚³ãƒ¼ãƒ‰ã«ã¯å½±éŸ¿ã‚’ä¸ãˆãªã„ã¨ã®äº‹ã§ã™ã€‚

- [P2538R0 ADL-proof `std::projected` - ï¼»C++ï¼½WG21æœˆæ¬¡ææ¡ˆæ–‡æ›¸ã‚’çœºã‚ã‚‹ï¼ˆ2022å¹´02æœˆï¼‰](https://onihusube.hatenablog.com/entry/2022/03/19/224729#P2538R0-ADL-proof-stdprojected)
- [P2600 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1264)

### [P2601R0 To make redundant empty angle brackets optional for class template argument lists](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2601r0.html)

ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨æ™‚ã«ã€ä¸è¦ãª`<>`ã‚’çœç•¥å¯èƒ½ã«ã™ã‚‹ææ¡ˆã€‚

ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®£è¨€ã§ã¯ã€ãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç ´å£Šã™ã‚‹ã“ã¨ãªããƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ä»˜ãã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ã‹ã—ã€ãã®æ–¹æ³•ã¯å°‘ãªãã¨ã‚‚1ã¤ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ—¢ã«ã‚ã‚‹å ´åˆã«ã®ã¿è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹æ§‹æ–‡ã§ã¯ã»ã¨ã‚“ã©ã®å ´åˆã«`<>`ã‚’å¿…è¦ã¨ã™ã‚‹ãŸã‚ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å…¨ã¦ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã‚’è¨­å®šã—ãŸã¨ã—ã¦ã‚‚éãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãªã‚¯ãƒ©ã‚¹ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ã§ããªã„ãŸã‚ã§ã™ã€‚

ä¸€æ–¹ã§ã€C++17ä»¥é™ã¯CTADã«ã‚ˆã£ã¦å¤‰æ•°å®£è¨€ã«ãŠã„ã¦ãã®åˆ¶é™ãŒãªããªã‚Šã€`<>`ã‚’çœç•¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€ãã‚Œä»¥å¤–ã®éƒ¨åˆ†ã§ã¯ä¾ç„¶ã¨ã—ã¦`<>`ãŒå¿…è¦ã§ã™ã€‚

```cpp
template <typename T = int>
class C {};

C c;                      // OK  (1)
extern C x;               // error: need C<>
C *p;                     // error: need C<>
C a[2];                   // error: need C<>
C &r = c;                 // error: need C<>
struct S { C c; };        // error: need C<>
struct D : C {};          // error: need C<>
std::vector<C> v;         // error: need C<>
void foo(C c);            // error: need C<>
```

ã“ã®ææ¡ˆã¯ã€ã“ã®åˆ¶é™ã‚’å–ã‚Šæ‰•ã†ã“ã¨ã§éãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¯ãƒ©ã‚¹ã‹ã‚‰ã‚¯ãƒ©ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¸ã®éç ´å£Šçš„ãªæ›¸ãæ›ãˆã‚’å¯èƒ½ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®å¤‰æ›´ã¯ç¾åœ¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã¨ãªã£ã¦ã„ã‚‹ã‚‚ã®ã‚’è¨±å¯ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ãŸã‚ç ´å£Šçš„ã§ã¯ãªãã€ã‚ã‚‹åå‰ã¯ã‚¯ãƒ©ã‚¹ã‚„é–¢æ•°ãªã©ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ç¨®åˆ¥ã§å…±æœ‰ã§ããªã„ï¼ˆåå‰ã¯ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§ä¸€æ„ã§ã‚ã‚‹ï¼‰ãŸã‚ä¸Šè¨˜ã®ä¾‹ã¯æ›–æ˜§ã«ã‚‚ãªã‚Šã¾ã›ã‚“ã€‚

- [P2601 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1265)

### [P2602R0 Poison Pills are Too Toxic](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2602r0.html)

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ã€Poison Pillã¨å‘¼ã°ã‚Œã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã™ã‚‹ææ¡ˆã€‚

Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¨ã¯ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆCPOï¼‰ã®å®Ÿè£…ã«ãŠã„ã¦ä½¿ç”¨ã•ã‚Œã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã€`std`åå‰ç©ºé–“ã«ã‚ã‚‹åŒåã®é–¢æ•°ã‚’å‘¼ã³å‡ºã•ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

```cpp
namespace std::ranges {

  namespace impl {

    // Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰
    // std::begin()ã‚’ï¼ˆåå‰æ¢ç´¢çš„ãªæ„å‘³ã§ï¼‰æ¯’æ®ºã™ã‚‹
    void begin(auto&) = delete;
    void begin(const auto&) = delete;

    // ranges::begin CPOã®å®Ÿä½“
    // åˆ¶ç´„ç­‰ã¯çœç•¥
    struct begin_fn {

      // ADLã§begin()ã‚’å‘¼ã³å‡ºã™
      auto operator()(auto&& range) const {
        return begin(range);  // ã“ã“ã§ã¯std::begin()ãŒè¦‹ã¤ã‹ã‚‰ãªã„
      }

    };
  }

  inline namespace cpo {
    // ranges::begin CPO
    inline constexpr impl::begin_fn begin;
  }
}
```

ã“ã®ä¾‹ã¯`std::ranges::begin`CPOã®åŠ¹æœã®1ã¤ï¼ˆADLã«ã‚ˆã‚‹éãƒ¡ãƒ³ãƒé–¢æ•°ã®æ¢ç´¢ï¼‰ã®ç°¡ç•¥åŒ–ã•ã‚ŒãŸå®Ÿè£…ä¾‹ã§ã™ã€‚`std::ranges::begin`ã®éãƒ¡ãƒ³ãƒé–¢æ•°æ¢ç´¢ã§ã¯ADLã«ã‚ˆã£ã¦æ¢ç´¢ãŒè¡Œã‚ã‚Œã¾ã™ãŒã€`std::ranges::begin`è‡ªä½“ãŒ`std`åå‰ç©ºé–“ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚éä¿®é£¾åæ¢ç´¢ï¼ˆADLã®1ã¤å‰ã®æ¢ç´¢ï¼‰ã«ãŠã„ã¦`std::begin()`ãŒè¦‹ã¤ã‹ã£ã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã®é–¢æ•°ã¯C++20ä»¥å‰ã®å¤ã„ã‚‚ã®ã§ã‚ã‚Šã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã‚ˆã‚‹ãƒã‚§ãƒƒã‚¯ãªã©ã¯ãªãä½¿ç”¨ã™ã‚‹å€™è£œã¨ã—ã¦é©åˆ‡ã§ã¯ãªã„ãŸã‚ã€`std::ranges::begin`ã§ã¯ã“ã‚Œã‚’å‘¼ã³å‡ºã•ãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ã“ã¨ã¯æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ã‚‹ã»ã¨ã‚“ã©ã®CPOã«å½“ã¦ã¯ã¾ã‚Šã€åŒæ§˜ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒå¤šç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã§ã€ã“ã®Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯CPOã«ã‚¢ãƒ€ãƒ—ãƒˆã—ãŸã„å‹ã«å¯¾ã—ã¦ä¸è¦ãªå½±éŸ¿ã‚’åŠã¼ã—ã¦ã„ã¾ã™ã€‚

```cpp
struct A {
  friend auto begin(A const&) -> int const*;
  friend auto end(A const&)   -> int const*;
};

struct B {
  friend auto begin(B&) -> int*;
  friend auto end(B&) -> int*;
};
```

ã“ã®2ã¤ã®å‹ã¯ã©ã¡ã‚‰ã‚‚[`ranges`](https://cpprefjp.github.io/reference/ranges/range.html)ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’æº€ãŸã™ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€`B, const A`ã¯`range`ã§ã™ãŒã€`A`ã¯`range`ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã¯ã€Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒæ‹…ã£ã¦ã„ã‚‹ï¼ˆã„ãŸï¼‰ã‚‚ã†ä¸€ã¤ã®å½¹ç›®ã§ã‚ã‚‹å³è¾ºå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿å–å¾—ç¦æ­¢ã¨ã„ã†åŠ¹æœã®åæ®‹ã®æ‚ªå½±éŸ¿ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚

å½“åˆã®`range`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã§ã¯å³è¾ºå€¤ã¯å®Œå…¨ã«ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€`std::string_view`ã®ã‚ˆã†ã«ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿå­˜æœŸé–“ã¨ãã“ã‹ã‚‰å–å¾—ã§ãã‚‹ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®æœ‰åŠ¹æ€§ãŒç„¡é–¢ä¿‚ã§ã‚ã‚‹ã‚ˆã†ãªå‹ã¯å³è¾ºå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã‚‚å•é¡Œãªã„ãŸã‚ã€ãã®ã‚ˆã†ãªå‹ã®å³è¾ºå€¤ã‚‚`range`ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’æº€ãŸã™ã‚ˆã†ã«ã—ãŸã„ã¨ã„ã†è¦æœ›ãŒä¸ŠãŒã‚Šã¾ã—ãŸã€‚

å½“åˆã®Rangeãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ã€ãã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãŸã‚ã«Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ï¼ˆ`begin(auto&&) = delete;`ï¼‰ã‚’æ´»ç”¨ã—ã¾ã—ãŸã€‚`begin(A{})`ã®ã‚ˆã†ã«å‘¼ã‚“ã æ™‚ã€Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒADLã«ã‚ˆã‚‹å€™è£œã‚ˆã‚Šã‚‚å„ªå…ˆã•ã‚Œã‚‹ãŸã‚`const`å‚ç…§ã‚’å–ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã ã‘ã§ã¯å³è¾ºå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’å–å¾—ã§ããªãã—ã¦ã„ã¾ã™ã€‚å³è¾ºå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦`begin`ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯ã€`begin(A&&)`ã‹`begin(A)`ã®ã‚ˆã†ãªã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ãã‚Œã‚’æ˜ç¤ºã—ã¾ã™ã€‚

å½“åˆã®Rangeãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯å³è¾ºå€¤`range`ã‚’ã“ã®ã‚ˆã†ã«éå¸¸ã«é«˜åº¦ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã«ã‚ˆã£ã¦ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã—ãŸãŒã“ã‚Œã«ã¯å•é¡ŒãŒå¤šãã€ã“ã‚Œã¯å¾Œã«[`enable_borrowed_range`](https://cpprefjp.github.io/reference/ranges/enable_borrowed_range.html)å¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã‚ˆã‚‹ã‚ˆã‚Šæ˜ç¢ºã‹ã¤ã‚ã‹ã‚Šã‚„ã™ã„ã‚ªãƒ—ãƒˆã‚¤ãƒ³æ–¹æ³•ã«ç½®ãæ›ãˆã‚‰ã‚Œã€ç¾åœ¨ã«è‡³ã£ã¦ã„ã¾ã™ã€‚ç¾åœ¨ã®`std::ranges::begin`ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹CPOã§ã¯ã€`enable_borrowed_range`ãªå‹`R`ã«å¯¾ã—ã¦å³è¾ºå€¤ã®å…¥åŠ›ã‚’å·¦è¾ºå€¤ã«å®Ÿä½“åŒ–ã—ãŸä¸Šã§ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã‚’è¡Œã†ï¼ˆå…¥åŠ›ã¯å¸¸ã«å·¦è¾ºå€¤ã¨ã—ã¦æ‰±ã†ï¼‰ã“ã¨ã§è¦æ ¼ã®è¡¨ç¾ã¨å®Ÿè£…ã‚’ç°¡ç´ åŒ–ã—ã¦ã„ã¾ã™ï¼ˆè¦æ ¼ã§ã¯ã“ã®ã“ã¨ã‚’*reified object*ã¨ã„ã†ç”¨èªã§è¡¨ç¾ã—ã¦ã„ã¾ã™ï¼‰ã€‚

ãã®ãŸã‚ã€ç¾åœ¨ã®Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã«ã¯æœ€åˆã«ç´¹ä»‹ã—ãŸ`std`åå‰ç©ºé–“ã®åŒåé–¢æ•°ã®æ¯’æ®ºä»¥å¤–ã®å½¹å‰²ã¯ã‚‚ã¯ã‚„ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãŸã€ãã®å¤‰æ›´ã«ã‚ˆã£ã¦ã€`std::ranges::begin`ã®è¡Œã†ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã§ã¯å³è¾ºå€¤ã‚’ç›´æ¥æ‰±ã†ã“ã¨ãŒãªããªã£ãŸãŸã‚`begin(auto&&)`ã¨ã„ã†å®£è¨€ã§ã¯Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒæ„å›³é€šã‚Šã«æ©Ÿèƒ½ã—ãªããªã‚Šã€ç¾åœ¨ã®`auto&`ã¨`const auto&`ã®2ã¤ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

ã“ã“ã§ã€å…ˆã»ã©ã®ä¾‹ã«æˆ»ã‚Šã¾ã™ã€‚

```cpp
struct A {
  friend auto begin(A const&) -> int const*;
  friend auto end(A const&)   -> int const*;
};

struct B {
  friend auto begin(B&) -> int*;
  friend auto end(B&) -> int*;
};
```

`A`ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã™ã‚‹`std::ranges::begin`ã¯ADLã«ã‚ˆã£ã¦`A`ã®*Hidden frineds* `begin()`ã‚’è¦‹ã¤ã‘ã¦ãã‚Œã‚‹ã¯ãšã§ã€ãã“ã§ã¯2ã¤ã®Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’å«ã‚ãŸã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºãŒè¡Œã‚ã‚Œã¾ã™ã€‚å‰è¿°ã®ã‚ˆã†ã«ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã¯å®Ÿéš›ã®å¼•æ•°å‹ã®å€¤ã‚«ãƒ†ã‚´ãƒªã«é–¢ã‚ã‚‰ãš`A`ã®å·¦è¾ºå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ`A&`ï¼‰ã«å¯¾ã—ã¦è¡Œã‚ã‚Œã€ãã‚Œã«å¯¾ã—ã¦ã¯`begin(const A&)`ã‚ˆã‚Šã‚‚`begin(auto&)`ã®å®£è¨€ã®æ–¹ãŒå„ªå…ˆé †ä½ãŒé«˜ããªã‚Šã¾ã™ã€‚ãã—ã¦ãã‚Œã¯`delete`ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ç´ ã®å‹`A`ã«å¯¾ã™ã‚‹`range<A>`ã¯`false`ã«ãªã‚Šã¾ã™ã€‚ã—ã‹ã—ã€`range<const A>`ã ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è§£æ±ºã¯`const A&`ã«å¯¾ã—ã¦è¡Œã‚ã‚Œã‚‹ãŸã‚ã€å®šç¾©ã•ã‚Œã¦ã„ã‚‹`begin()`ãŒPoison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚ˆã‚Šã‚‚å„ªå…ˆé †ä½ãŒé«˜ããªã‚Šã€`range<const A>`ã¯`true`ã¨ãªã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã¯å®Œå…¨ã«åˆæ³•ã‹ã¤åˆç†çš„ã§ã‚ã‚Šã€Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯ãã‚Œã‚’å¦¨ã’ã¦ã„ã¾ã™ã€‚Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã™ã‚‹ã¨ã“ã®å•é¡Œã‚’è§£æ¶ˆã§ãã¾ã™ãŒã€Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã«ã¯ã¾ã å½¹å‰²ãŒæ®‹ã£ã¦ã¾ã™ã€‚

ã—ã‹ã—ã‚ˆãè€ƒãˆã¦ã¿ã‚‹ã¨ã€`std::begin(r)`ã¯`r`ãŒãƒ¡ãƒ³ãƒ`begin()`ã‚’æŒã£ã¦ã„ãŸã‚‰ãã‚Œã‚’å‘¼ã³å‡ºã—ã¦ãã‚Œã‚‹ã®ã§ã€å°‘ãªãã¨ã‚‚æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚‚ã®ã«ã¤ã„ã¦ãã‚ŒãŒå‘¼ã³å‡ºã•ã‚Œã¦å›°ã‚‹ç†ç”±ã¯ãªãã€`borrowed_range`ã§ã‚ã‚‹ã‹å¦ã‹ã¯ã™ã§ã«å¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã‚ˆã£ã¦å¼åˆ¥ã•ã‚Œã‚‹ãŸã‚ã€Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã®æœ‰ç”¨ãªå½¹å‰²ã¯å®Ÿã¯ã‚‚ã†ã‚ã‚Šã¾ã›ã‚“ã€‚

å®Ÿã®ã¨ã“ã‚ã€Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã®æ®‹ã£ãŸ1ã¤ã®å½¹å‰²ãŒæœ‰ç”¨ãªã®ã¯`std::ranges::swap`ã®ã‚ˆã†ãªCPOã«ãŠã„ã¦ã§ã™ã€‚`std::swap()`ã¯ç„¡åˆ¶ç´„ã§ã‚ã‚Šã€ã“ã‚Œã‚’å‘¼ã³å‡ºã™ã¨`swap`æ“ä½œã‚’å®šç¾©ã—ãªã„ä»»æ„ã®å‹ã«å¯¾ã—ã¦`swap(a, b)`ã®å‘¼ã³å‡ºã—ãŒã§ãã¦ã—ã¾ã†ãŸã‚`std::swap()`ã¯ä½¿ç”¨ã—ãŸããªã„ã®ã§ã™ã€‚ã“ã®ã“ã¨ã¯ç‰¹ã«ã€`std::swappable`ã‚³ãƒ³ã‚»ãƒ—ãƒˆãŒ`std::ranges::swap`ã‚’ç”¨ã„ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®æœ‰ç”¨æ€§ã«ç›´çµã—ã¾ã™ï¼ˆ`std`åå‰ç©ºé–“ã®ã‚‚ã®ã«å¯¾ã—ã¦ã¯ç„¡æ¡ä»¶ã§`std::swappable`ãŒ`true`ã«ãªã‚Šã†ã‚‹ï¼‰ã€‚

ãŸã ã“ã¡ã‚‰ã‚‚ã€C++17ä»¥é™ã¯ãã¡ã‚“ã¨åˆ¶ç´„ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒè¦å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ç¾åœ¨Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã¯å®Ÿã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚

å”¯ä¸€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒå¿…è¦ãªã®ã¯ã€[`std::ranges::iter_swap`](https://cpprefjp.github.io/reference/iterator/iter_swap.html)ã ã‘ã§ã™ã€‚ã“ã‚Œã¯[`std::iter_swap()`](https://cpprefjp.github.io/reference/algorithm/iter_swap.html)ã«ã¤ã„ã¦`std::swap()`ã¨åŒæ§˜ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ãŒã€C++20ã§ã‚‚`std::iter_swap()`ã¯ç„¡åˆ¶ç´„ã§ã‚ã‚‹ãŸã‚ã€ADLã§`iter_swap()`ã‚’æ¢ã—ã«è¡Œãéš›ã¯Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ã€‚

ã“ã‚Œã‚‰ã®ã“ã¨ã‹ã‚‰ã€ã“ã®ææ¡ˆã§ã¯`std::ranges::iter_swap`ä»¥å¤–ã®ã™ã¹ã¦ã®CPOã®å®šç¾©ã‹ã‚‰ã€Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã‚’å–ã‚Šé™¤ãã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€CPOãŒè‡ªåˆ†è‡ªèº«ã‚’ç™ºè¦‹ã—ãªã„ãŸã‚ã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«åå‰ç©ºé–“ã§ä¸å¿…è¦ãªæ¢ç´¢ã‚’è¡Œã‚ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€CPOãŒéãƒ¡ãƒ³ãƒé–¢æ•°ã‚’æ¢ç´¢ã™ã‚‹éš›ã¯ADLã«ã‚ˆã£ã¦æ¢ç´¢ã•ã‚Œã‚‹ï¼ˆéä¿®é£¾åæ¢ç´¢ãŒãŠã“ãªã‚ã‚Œãªã„ï¼‰ã“ã¨ãŒç¢ºå®Ÿã«ãªã‚‹ã‚ˆã†ã«è¿½è¨˜ã—ã¾ã™ã€‚

ã“ã®å®Ÿè£…ã¯å˜ã«ã€æ—¢å­˜ã®Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒå¼•æ•°ç„¡ã—ã®å®£è¨€ã«ãªã‚‹ã ã‘ã§ã™ã€‚ä¾‹ãˆã°`std::ranges::begin`ãªã‚‰ã€`void begin() = delete;`ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```cpp
namespace std::ranges {

  namespace impl {

    // ç¾åœ¨ã®Poison Pillã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰
    //void begin(auto&) = delete;
    //void begin(const auto&) = delete;

    // ã“ã®ææ¡ˆã®å®Ÿè£…ä¾‹
    void begin() = delete;

    struct begin_fn {

      auto operator()(auto&& range) const {
        return begin(range);
      }

    };
  }
}
```

ãã—ã¦ã€ã“ã®ã“ã¨ã¯ã™ã§ã«GCC(libstdc++)ã¨MSVC(MSVC STL)ã§å®Ÿè£…æ¸ˆã¿ã§ã™ã€‚

- ["Poison-pill" overload for CPO - yohhoyã®æ—¥è¨˜](https://yohhoy.hatenadiary.jp/entry/20210126/p1)
- [P2602 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1266)

### [P2603R0 member function pointer to function pointer](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2603r0.html)

ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰ã€åŸºåº•ã‚¯ãƒ©ã‚¹ã®é–¢æ•°ã‚’æ˜ç¤ºçš„ã«å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

C++ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ç¢ºå®šã™ã‚‹å ´åˆã«ã®ã¿ã€æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã‹ã‚‰åŸºåº•ã‚¯ãƒ©ã‚¹ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ä¸€æ–¹ã€å®Ÿè¡Œæ™‚ã«å‘¼ã³å‡ºã—å…ˆãŒç¢ºå®šã—ã†ã‚‹å ´åˆã«ã¯å¸¸ã«æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®ãƒ¡ãƒ³ãƒé–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚ã©ã†ã„ã†ã“ã¨ã§ã—ã‚‡ã†ã‹ï¼Ÿ

```cpp
#include <iostream>

class Base { 
public:
  virtual void some_virtual_function() {
    std::cout << "call Base::some_virtual_function()\n";
  }

  virtual void some_virtual_function() const { 
    std::cout << "call Base::some_virtual_function() const\n";
  }
};

class Derived : public Base {
public:
  void some_virtual_function() override { 
    std::cout << "call Derived::some_virtual_function()\n";
  }

  void some_virtual_function() const override {
    std::cout << "call Derived::some_virtual_function() const\n";
  }
};


int main() {
  Derived derived;
  Derived* pderived = &derived;
  Derived& rderived = derived;

  // æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ãƒ¡ãƒ³ãƒé–¢æ•°ã®å‘¼ã³å‡ºã—
  derived.some_virtual_function();
  pderived->some_virtual_function();
  rderived.some_virtual_function();

  std::cout << "\n";

  // åŸºåº•ã‚¯ãƒ©ã‚¹ãƒ¡ãƒ³ãƒé–¢æ•°ã®å‘¼ã³å‡ºã—
  derived.Base::some_virtual_function();
  pderived->Base::some_virtual_function();
  rderived.Base::some_virtual_function();
  
  std::cout << "\n";

  // ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®å–å¾—
  void (Base::*bmfp)() = &Base::some_virtual_function;
  void (Derived::*dmfp)() = &Derived::some_virtual_function;
  void (Derived::*dmfpc)() const = static_cast<void (Derived::*)() const>(&Derived::some_virtual_function);
  
  // ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰ã®å‘¼ã³å‡ºã—
  (derived.*bmfp)();
  (derived.*dmfp)();
  (derived.*dmfpc)();
}
```

å®Ÿè¡Œä¾‹ï¼ˆ[[Wandbox]ä¸‰ã¸( ã¸Õà¨Š Õ)ã¸ ï¾Šï½¯ï¾Šï½¯](https://wandbox.org/permlink/Ydh4LHqCfXKdqjFA)ï¼‰

```
call Derived::some_virtual_function()
call Derived::some_virtual_function()
call Derived::some_virtual_function()

call Base::some_virtual_function()
call Base::some_virtual_function()
call Base::some_virtual_function()

call Derived::some_virtual_function()
call Derived::some_virtual_function()
call Derived::some_virtual_function() const
```

ï¼ˆãƒ¡ãƒ³ãƒï¼‰é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã§ã¯å®Ÿè¡Œæ™‚ã«å‘¼ã³å‡ºã—å…ˆãŒç¢ºå®šã™ã‚‹ãŸã‚ã€ä»®æƒ³é–¢æ•°ã®ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿å‘¼ã³å‡ºã—ã¯å¸¸ã«ä½¿ç”¨ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éš›æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®ã‚‚ã®ãŒå‘¼ã°ã‚Œã¾ã™ã€‚ç‰¹ã«å•é¡Œã¨ãªã‚‹ã®ã¯ã“ã®éƒ¨åˆ†ã§ã™

```cpp
int main() {
  Derived derived;

  // åŸºåº•ã‚¯ãƒ©ã‚¹ã®ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’å–å¾—
  void (Base::*bmfp)() = &Base::some_virtual_function;
  
  // æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§åŸºåº•ã‚¯ãƒ©ã‚¹ã®ãƒ¡ãƒ³ãƒãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰å‘¼ã³å‡ºã—
  (derived.*bmfp)();  // æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®é–¢æ•°ãŒå‘¼ã°ã‚Œã‚‹
}
```

ã“ã‚Œã¯åŸºåº•ã‚¯ãƒ©ã‚¹ã®ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰å‘¼ã³å‡ºã—ã¦ã‚‚åŒæ§˜ã«ãªã‚Šã¾ã™ã€‚

```cpp
void call(Base* base) {
  void (Base::*bmfp)() = &Base::some_virtual_function;
  (base->*bmfp)();
}

int main() {
  Derived derived;

  call(&derived); // æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®é–¢æ•°ãŒå‘¼ã°ã‚Œã‚‹
}
```

- [[Wandbox]ä¸‰ã¸( ã¸Õà¨Š Õ)ã¸ ï¾Šï½¯ï¾Šï½¯](https://wandbox.org/permlink/zBpVMJHkT6EAXB9l)

ã“ã‚Œã¯ä»®æƒ³é–¢æ•°ã®æ€§è³ªã‚’è€ƒãˆã‚‹ã¨å½“ç„¶ã®æŒ¯ã‚‹èˆã„ã§ã‚ã‚Šã€ã“ã®æŒ¯ã‚‹èˆã„ãã®ã‚‚ã®ã«å•é¡ŒãŒã‚ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å•é¡Œãªã®ã¯ã€ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’ä»‹ã—ã¦æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰åŸºåº•ã‚¯ãƒ©ã‚¹ã®ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’æ˜ç¤ºçš„ã«å‘¼ã³å‡ºã™ã“ã¨ãŒã§ããªã„ã¨ã„ã†ç‚¹ã§ã€ã“ã‚Œã¯`function_ref`ã‚„`nontype`ã§å•é¡Œã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```cpp
auto make_fr(Base* base) {
  // åŸºåº•ã‚¯ãƒ©ã‚¹ã®é–¢æ•°ã‚’å‘¼ã¶æ„å›³ã®function_refã‚’ä½œæˆ
  // ã“ã®é–¢æ•°å˜ä½“ã§è¦‹ã‚‹ã¨å¼•æ•°å‹ã‚‚å«ã‚ã¦å•é¡Œãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹
  function_ref<void()> fr = {nontype<&Base::some_virtual_function>, base};

  return fr;
}

int main() {
  Derived derived;

  // æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã™
  auto fr = make_fr(&derived);

  fr(); // æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®é–¢æ•°ãŒå‘¼ã°ã‚Œã‚‹
}
```

ã“ã®ææ¡ˆã¯ã“ã®äº‹ã‚’è§£æ±ºã™ã¹ãã€ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¨æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰æ˜ç¤ºçš„ã«åŸºåº•ã‚¯ãƒ©ã‚¹ã®ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ææ¡ˆã•ã‚Œã¦ã„ã‚‹è§£æ±ºç­–ã¯ã€`member_function_pointer_to_free_function_pointer()`ã®æ§˜ãªé–¢æ•°ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã§ã€ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’ç¬¬ä¸€å¼•æ•°ã‚’æ˜ç¤ºã—ãŸé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã¸å¤‰æ›ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã™ã€‚

```cpp
int main() {
  Derived derived;

  void (*bfp)(Base&) = member_function_pointer_to_free_function_pointer(&Base::some_virtual_function);
  void (*dfp)(Derived&) = member_function_pointer_to_free_function_pointer(&Derived::some_virtual_function);
  void (*dfpc)(const Derived&) = member_function_pointer_to_free_function_pointer(static_cast<void (Derived::*)() const>(&Derived::some_virtual_function));
  void (*ddtfp)(Derived) = member_function_pointer_to_free_function_pointer(&Derived::some_deducing_this_member_function);
}
```

ã“ã‚Œã«ã‚ˆã£ã¦ã€æ—¢å­˜ã®æŒ¯ã‚‹èˆã„ã«ä¸€åˆ‡å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ãªãã€ä¸Šè¨˜ã®å•é¡Œã‚’è§£æ±ºã§ãã¾ã™ã€‚

`member_function_pointer_to_free_function_pointer()`ã¯`consteval`é–¢æ•°ã®ã‚ˆã†ãªã‚‚ã®ã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‹ã‚‰ãã®ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’æŒ‡ã™ãƒ•ãƒªãƒ¼é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ãã®ã‚‚ã®ã‹ã€ã‚‚ã—ãã¯ãã®ã‚¯ãƒ©ã‚¹å‹ã®å‚ç…§ã‚’ç¬¬ä¸€å¼•æ•°ã«å–ã‚‹ã‚ˆã†ã«ã—ãŸä½•ã‹ï¼ˆã‚µãƒ³ã‚¯ï¼‰ã‚’å–å¾—ã—ã¾ã™ã€‚

ã“ã®ææ¡ˆã¯æ¬¡ã®ã‚ˆã†ãªãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™

- æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã€åŸºåº•ã‚¯ãƒ©ã‚¹ã®ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’ç”¨ã„ã¦åŸºåº•ã‚¯ãƒ©ã‚¹ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã€ã¨ã„ã†é¸æŠè‚¢ã‚’è¿½åŠ ã™ã‚‹
- ãƒ¡ãƒ³ãƒé–¢æ•°ãŒDeducing thisã‚’ç”¨ã„ã¦è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‹ã«é–¢ä¿‚ãªããƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’æ‰±ãˆã‚‹
- åˆæœŸåŒ–ã«ä½¿ç”¨ã™ã‚‹ãƒ¡ãƒ³ãƒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã«ã‚ˆã£ã¦å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’ç¢ºå®Ÿã«é¸æŠã§ãã€C++ã®ä»–ã®éƒ¨åˆ†ã‚„æ‰‹æ³•ã¨ä¸€è²«ã™ã‚‹

é–¢æ•°åã¨ã‹ãã®æŒ¯ã‚‹èˆã„ã®è©³ç´°ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–¢æ•°ã¨ã—ã¦è¿½åŠ ã™ã‚‹ã®ã‹ãªã©ã®éƒ¨åˆ†ã¯ã¾ã ç¢ºå®šã—ã¦ãŠã‚‰ãšã€ä»Šå¾Œè©°ã‚ã¦ã„ãäºˆå®šã®ã‚ˆã†ã§ã™ã€‚

ãªãŠã“ã®æ©Ÿèƒ½ã¯ã™ã§ã«ã€GCCã§ç‹¬è‡ªæ‹¡å¼µã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

- [7.6 Extracting the Function Pointer from a Bound Pointer to Member Function](https://gcc.gnu.org/onlinedocs/gcc/Bound-member-functions.html)
- [P2603 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1267)

### [P2604R0 MDSPAN: rename pointer and contiguous](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2604r0.html)

`mdspan`ã®ä¸€éƒ¨ã®ãƒ¡ãƒ³ãƒã®åå‰ã‚’å¤‰æ›´ã™ã‚‹ææ¡ˆã€‚

ææ¡ˆã—ã¦ã„ã‚‹ã®ã¯ä»¥ä¸‹ã®ã‚‚ã®ã§ã™

- `mdspan::pointer`
- `mdspan::data()`
- `mdspan::contiguous`

`mdspan`ã®`pointer`å‹ã¯ãã®ã‚¢ã‚¯ã‚»ã‚µãƒãƒªã‚·ãƒ¼ã‚¯ãƒ©ã‚¹ã«åˆ¥ã«æ±‚ã‚ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ä¸€ç·’ã«æ¸¡ã™éš›ã®ã€ãã®å¼•æ•°å‹ã§ã—ã‹ã‚ã‚Šã¾ã›ã‚“ï¼ˆè¦ç´ å‹ã®ãƒã‚¤ãƒ³ã‚¿å‹ã‚’è¡¨ã™ã‚‚ã®ã§ã¯ãªã„ï¼‰ã€‚å¾“ã£ã¦ã€ãã®è¦ä»¶ã¯ç·©ãã€æ¨™æº–ã‚³ãƒ³ãƒ†ãƒŠã«ãŠã‘ã‚‹`pointer`å‹ã¨ã¯å½¹å‰²ãŒå¤§ããç•°ãªã£ã¦ã„ã¾ã™ã€‚

ãã®ãŸã‚ã€ãã®é•ã„ã‚’æ˜ç¢ºã«ã™ã‚‹ãŸã‚ã«`mdspan::pointer`ã‚’`data_handle_type`ã«ãƒªãƒãƒ¼ãƒ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€`mdspan::data()`ã‚‚åŒæ§˜ã«`mdspan`ã®å‚ç…§ã™ã‚‹é ˜åŸŸã¸ã®ãƒã‚¤ãƒ³ã‚¿ã§ã¯ã‚ã‚‹ã‚‚ã®ã®ã€ãã®è¦ç´ å‹ã‚„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸã‚‚ã®ã§ã¯ãªã„ãŸã‚ã€`data_handle()`ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚

`mdspan::contiguous`ã¨ã¯ã€ä¸ãˆã‚‰ã‚ŒãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¯„å›²`[0, map.required_span_size())`ã®å…¨ã¦ã®å€¤ã«å¯¾ã—ã¦æ­£ã—ã„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ã‚’è¡¨ã™ãƒ¡ãƒ³ãƒå‹ã§ã™ã€‚ä¾‹ãˆã°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¯„å›²ãŒ`[0, 10)`ã§ã‚ã‚‹ã¨ãã€0~9ã¾ã§ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å€¤ã‚’`mdspan`ã«ä¸ãˆã‚‹ã¨ãã®å‚ç…§é ˜åŸŸã®ã©ã“ã‹ã‚’æŒ‡ã™ï¼ˆä¸æ­£ã«ãªã‚‰ãªã„ï¼‰ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å€¤ã¸å¤‰æ›ã•ã‚Œã€è¦ç´ ã‚’å¼•ãå½“ã¦ã‚‹ã“ã¨ãŒã§ãã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

ãŸã ã—ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã‚¯ãƒ©ã‚¹ã¯ã‚«ã‚¹ã‚¿ãƒ å¯èƒ½ã§ã‚ã‚Šã€ãã‚Œã«ã‚ˆã£ã¦ã¯å¿…ãšã—ã‚‚ç·šå½¢ãªé †åºã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå¤‰æ›ã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€`{0, 1, 2, 3, 4}`ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯`{4, 1, 3, 0, 2}`ã«ãƒãƒƒãƒ—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯`mdspan`çš„ã«ã¯ã¾ã `contiguous`ã§ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœŸå¾…ã«ã¯æ²¿ã£ã¦ã„ã¾ã›ã‚“ã€‚

ãã®ãŸã‚ã€`mdspan::contiguous`ã‚’`exhaustive`ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ï¼ˆå¤‰æ›å¾Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯éš£æ¥ã—ã¦ã„ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã‘ã©ã€å…¥åŠ›ã«å¯¾ã—ã¦ã¯æŠœã‘ãŒç„¡ã„ï¼‰ã€‚

- [P2604 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1258)

### [P2605R0 SG16: Unicode meeting summaries 2022-01-12 through 2022-06-08](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2605r0.html)
### [P2607R0 Let alignas specify minimum alignment](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2607r0.html)

`alignas`ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã‚ˆã‚Šã‚‚å¼±ã„ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆæŒ‡å®šãŒã•ã‚ŒãŸå ´åˆã«ã‚¨ãƒ©ãƒ¼ã¨ã›ãšç„¡è¦–ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®`alignas`ã§ã¯ã€ãã®å‹ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆæŒ‡å®šã‚ˆã‚Šã‚‚å¼±ã„ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```cpp
alignas(1) int i; // ngï¼ˆãŠãã‚‰ããƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã¯4ãƒã‚¤ãƒˆ

struct alignas(1) S {
  int i;
};  // ngï¼ˆãŠãã‚‰ããƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã¯4ãƒã‚¤ãƒˆ
```

ã“ã‚Œã«ã‚ˆã£ã¦ã€ã‚ã‚‹å‹ã«æŒ‡å®šã—ãŸã„æœ€å°ã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆæŒ‡å®šã‚’ç§»æ¤å¯èƒ½ãªæ–¹æ³•ã§æŒ‡å®šã™ã‚‹ã“ã¨ãŒå›°é›£ã«ãªã£ã¦ã„ã¾ã™ã€‚ãã®ã‚ˆã†ãªå ´åˆã€`n`ã‚’æŒ‡å®šã—ãŸã„æœ€å°ã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã€`d`ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã¨ã™ã‚‹ã¨ã€æŒ‡å®šã—ãŸã„ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã¯`max(n, d)`ã®å€¤ã§ã™ã€‚ä¾‹ãˆã°ã€æœ€å°8ãƒã‚¤ãƒˆã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã‚’æŒ‡å®šã—ãŸã„å ´åˆã«å®Ÿè£…ãŒ16ãƒã‚¤ãƒˆã§ã‚¢ãƒ©ã‚¤ãƒ³ã—ã¦ã„ãŸã¨ã—ã¦ã‚‚ã€ãã‚Œã¯æ„å›³é€šã‚Šãªã®ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

å‹ã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆå€¤ï¼ˆ`d`ï¼‰ã¯`alignof`ã«ã‚ˆã£ã¦å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ãã®ãŸã‚ã«ã¯ã¾ãšå‹ã‚’å®šç¾©ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ã€å‹ã®å®šç¾©å¾Œã«`alignas`ã§ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã‚’å¤‰æ›´ã§ããªã„ãŸã‚ã€ç¾åœ¨ã®ä»•æ§˜ã§ã¯æœ€å°ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã®æŒ‡å®šã‚’`alignas(max(n, d))`ã®ã‚ˆã†ãªå½¢ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ã“ã®ææ¡ˆã¯ã“ã‚Œã‚’ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€`alignas`ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã‚ˆã‚Šã‚‚å¼±ã„ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆæŒ‡å®šãŒã•ã‚ŒãŸå ´åˆã¯`alignas`ãŒåŠ¹æœã‚’æŒãŸãªã„ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

```cpp
alignas(1) int i; // okã€alignasã¯ç„¡è¦–ã•ã‚Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆãŒä½¿ç”¨ã•ã‚Œã‚‹

struct alignas(1) S {
  int i;
};  // ngã€alignasã¯ç„¡è¦–ã•ã‚Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆãŒä½¿ç”¨ã•ã‚Œã‚‹
```

ã“ã®ã“ã¨ã¯ã™ã§ã«GCCãŒå®Ÿè£…ã—ã¦ãŠã‚Šã€GCCã¯ã¾ã•ã«ã“ã®æŒ¯ã‚‹èˆã„ã‚’ã—ã¾ã™ã€‚

- [C++11 alignas - cpprefjp](https://cpprefjp.github.io/lang/cpp11/alignas.html)
- [P2607 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1269)

### [P2608R0 Allow multiple init-statements](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2608r0.html)

é€šå¸¸ã®`for`æ–‡ã§ã€å¤‰æ•°åˆæœŸåŒ–ã‚’è¤‡æ•°æ›¸ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®érange-based `for`ã§ã¯ã€å¤‰æ•°åˆæœŸåŒ–ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®éƒ¨åˆ†ã§ç•°ãªã‚‹å‹ã®è¤‡æ•°ã®åˆæœŸåŒ–ã‚’è¡Œã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

```cpp
int main() {
  // ã“ã‚Œã¯ã§ãã‚‹
  for (int i = 0, j = 0; i < 10; ++i) {
    ...
  }

  // ã“ã‚Œã¯ã§ããªã„
  for (int i = 0, double v = 0.0; i < 10; ++i) {
    ...
  }
}
```

ã“ã®å ´åˆã«ã€è¤‡æ•°ã®åˆæœŸåŒ–ã‚’ã‹ã‘ã‚‹ã‚ˆã†ã«ã—ãŸã¨ã—ã¦ã‚‚æ§‹æ–‡ä¸Šã®æ›–æ˜§ã•ã¯ç”Ÿã˜ãªã„ãŸã‚ã€ã“ã‚Œã‚’è¨±å¯ã—ã‚ˆã†ã¨ã™ã‚‹ææ¡ˆã§ã™ã€‚

ãªãŠã€ã“ã‚Œã¨åŒã˜æ§‹æ–‡ã¯ç¾åœ¨`if, switch`ã¨range-based `for`ã§ã‚‚ä½¿ç”¨ã•ã‚Œã¦ãŠã‚Šã€ã“ã®ææ¡ˆã®å†…å®¹ã¯ãã¡ã‚‰ã«ã‚‚åŠã‚“ã§ã„ã¾ã™ã€‚

- [P2608 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1270)

### [P2609R0 Relaxing Ranges Just A Smidge](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2609r0.html)

å°„å½±ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã‚’å–ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã¤ã„ã¦ã€ãã®åˆ¶ç´„ã‚’ç·©å’Œã™ã‚‹ææ¡ˆã€‚

å°„å½±ã‚’å–ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã¯ã€æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒå‹•ãã‚ˆã†ã«åˆ¶ç´„ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

```cpp
iter_value_t<It> x = *it;
f(proj(x));
```

ã—ã‹ã—å®Ÿéš›ã«ã¯ã€æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒå‹•ãã‚ˆã†ãªåˆ¶ç´„ã«ãªã£ã¦ã„ã¾ã™

```cpp
iter_value_t<projected<I,Proj>> u = proj(*it);
f(u);
```

ã“ã‚Œã¯1ã¤ç›®ã®ã‚³ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã‚ˆã‚Šã‚‚å¼·ã„åˆ¶ç´„ã§ã‚ã‚Šã€å°„å½±ã®çµæœã«å¯¾ã—ã¦ã‚³ãƒ”ãƒ¼å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’è¿½åŠ ã§æ±‚ã‚ã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã¯ã€ã“ã®ã‚ˆã†ãªåˆ¶ç´„ã‚’é–“æ¥å‘¼ã³å‡ºã—ã«é–¢ã™ã‚‹ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨å°„å½±ã®åˆæˆã«ã‚ˆã£ã¦åˆ¶ç´„ã‚’è¡Œãªã£ã¦ã„ã‚‹ãŸã‚ã«èµ·ãã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€[`std::ranges::for_each`](https://cpprefjp.github.io/reference/algorithm/ranges_for_each.html)ã®åˆ¶ç´„ã«ã‚ã‚‹[`std::indirect_unary_invocable<std::projected<I,P>>`](https://cpprefjp.github.io/reference/iterator/indirectly_unary_invocable.html)ãŒãã‚Œã«ã‚ãŸã‚Šã¾ã™ã€‚

[`std::projected<I,P>`](https://cpprefjp.github.io/reference/iterator/projected.html)ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿å‹`I`ã®é–“æ¥å‚ç…§çµæœï¼ˆ`*i`ï¼‰ã‚’å°„å½±`P`ã«é€šã—ãŸçµæœã‚’ï¼ˆã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿likeãªå‹ã¨ã—ã¦ï¼‰è¿”ã—ã¾ã™ã€‚ãã®å‹ã‚’`Prj`ã¨ã—ã¦ã€`indirect_unary_invocable<Pred, Prj>`ã¯`Prj`ã®é–“æ¥å‚ç…§çµæœï¼ˆ`*prj`ï¼‰ã‚’è¿°èªï¼ˆ`Pred`ï¼‰ã«æ¸¡ã—ã¦å‘¼ã³å‡ºã—å¯èƒ½ã‹ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¾ã™ã€‚

ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å†…ã§è¿°èªã¯ã€å…¥åŠ›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®è¦ç´ ã¸ã®å‚ç…§ã‚’æ¸¡ã—ã¦å‘¼ã°ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Œã°ã€ãã‚Œã‚’ã‚³ãƒ”ãƒ¼ã—ãŸå€¤ã‚’æ¸¡ã—ã¦å‘¼ã°ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã€`std::ranges::unique_copy`ã®ã‚ˆã†ã«ä¸¡æ–¹ã‚’è¡Œã†ã‚‚ã®ã‚‚ã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€`indirectly_unary_invocable`ï¼ˆãªã©ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆï¼‰ã§ã¯ã€ãã®ä¸¡æ–¹ã®å‘¼ã³å‡ºã—åŠã³å…±é€šå‚ç…§ï¼ˆ*common reference*ï¼‰ã«æŸç¸›ã—ã¦ã‹ã‚‰å‘¼ã³å‡ºã—ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹åˆ¶ç´„å¼ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

```cpp
template< class F, class I >
  concept indirectly_unary_invocable =
    indirectly_readable<I> &&
    copy_constructible<F> &&
    invocable<F&, iter_value_t<I>&> &&            // ã‚³ãƒ”ãƒ¼ã—ãŸå€¤ã¸ã®å‚ç…§ã‚’æ¸¡ã—ã¦å‘¼ã³å‡ºã—å¯èƒ½
    invocable<F&, iter_reference_t<I>> &&         // *iã‚’ç›´ã§æ¸¡ã—ã¦å‘¼ã³å‡ºã—å¯èƒ½
    invocable<F&, iter_common_reference_t<I>> &&  // common referenceã«æŸç¸›ã—ãŸå€¤ã‚’æ¸¡ã—ã¦å‘¼ã³å‡ºã—å¯èƒ½
    common_reference_with<
      invoke_result_t<F&, iter_value_t<I>&>,
      invoke_result_t<F&, iter_reference_t<I>>>;
```

å°„å½±ã¯é–¢æ•°ã‚¢ãƒ€ãƒ—ã‚¿ã§ã‚ã‚Šã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä¸»ãŸã‚‹æŒ¯ã‚‹èˆã„ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã‚‚ã®ã§ã¯ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿°èªã¨å°„å½±ã‚’äº‹å‰ã«é–¢æ•°åˆæˆã—ãŸã‚‚ã®ã‚’è¿°èªã¨ã—ã¦æ¸¡ã—ãŸã¨ã—ã¦ã‚‚åˆ†ã‘ã¦æ¸¡ã•ã‚ŒãŸæ™‚ã¨åŒã˜æŒ¯ã‚‹èˆã„ã‚’ã™ã‚‹ã¯ãšã§ã™ã€‚å®Ÿéš›ãã®ã‚ˆã†ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€ç¾åœ¨ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨å°„å½±åŠã³è¿°èªã«èª²ã›ã‚‰ã‚ŒãŸåˆ¶ç´„ã¯ãã®ã“ã¨ã‚’æ­£ã—ãè¡¨ç¾ã§ãã¦ã„ã¾ã›ã‚“ã€‚ã“ã®`indirectly_unary_invocable`ã®ä¸­ã®ã€`iter_value_t`ã«ã‚ˆã‚‹å‘¼ã³å‡ºã—ã«é–¢ã™ã‚‹åˆ¶ç´„å¼ãŒå•é¡Œã‚’èµ·ã“ã—ã¦ã„ã¾ã™ã€‚

```cpp
// å•é¡Œã®ã‚ã‚‹åˆ¶ç´„
invocable<F&, iter_value_t<projected<I, Proj>>&>

// projectedã¨iter_value_tã‚’å±•é–‹
invocable<F&, remove_cvref_t<invoke_result_t<Proj&, iter_reference_t<I>>&>
```

ã“ã®åˆ¶ç´„ã¯`f(proj(*it))`ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’åˆ¶ç´„ã—ã¦ã¯ã„ã¾ã™ãŒã€ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®è¦ç´ ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã‹ã‚‰æ¸¡ã™å ´åˆã¯æ¬¡ã®ã‚ˆã†ãªé•ã„ãŒã‚ã‚Šã¾ã™

```cpp
// æœ‰åŠ¹ã«ã—ãŸã„ã‚³ãƒ¼ãƒ‰
iter_value_t<It> x = *it;
f(proj(x));

// å®Ÿéš›ã«æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰
iter_value_t<projected<I,Proj>> u = proj(*it);
f(u);
```

`invocable<F&, iter_value_t<projected<I, Proj>>&>`ã‚’ã‚ˆãè¦‹ã¦ã¿ã‚‹ã¨ã€ã“ã‚Œã¯æ¬¡ã®ã‚ˆã†ãªåˆ¶ç´„ã«ãªã£ã¦ã„ã¾ã™

```cpp
using T = invoke_result_t<Proj&, iter_reference_t<I>;
// decltype(proj(*it)) ï¼ˆå°„å½±çµæœã®å‹

using U = remove_cvref_t<T>&;
// auto u = proj(*it) ã«å¯¾ã™ã‚‹ decltype((u)) ï¼ˆå°„å½±çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ãŸå·¦è¾ºå€¤

invocable<F&, U>;
// requires(F& f, U u) { f(u) } ï¼ˆå°„å½±çµæœã‚’decay-copyã—ãŸå·¦è¾ºå€¤ã§å‘¼ã³å‡ºã—å¯èƒ½ã‹ã‚’åˆ¶ç´„ã—ã¦ã„ã‚‹
```

ã™ãªã‚ã¡ã€æœ€åˆã«ï¼ˆå°„å½±ã™ã‚‹å‰ã«ï¼‰ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®è¦ç´ ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã‹ã‚‰ãã‚Œã‚’å°„å½±ã¨è¿°èªã«ã‹ã‘ãŸã„ã¯ãšãªã®ã«ã€`std::indirect_unary_invocable<std::projected<I,P>>`ã¨ã„ã†åˆ¶ç´„ã«ã¯å°„å½±å¾Œã®å€¤ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã‚Œã‚’è¿°èªã«ã‹ã‘ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¨±å¯ã™ã‚‹åˆ¶ç´„ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®è¦ç´ ã®ã‚³ãƒ”ãƒ¼ã®å¿…è¦æ€§ã¯ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ã®ã§ï¼ˆä»Šã¯ãã®ã‚ˆã†ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ãŠã‘ã‚‹åˆ¶ç´„ã‚’è¦‹ã¦ã„ã‚‹ãŸã‚ï¼‰ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿è¦ç´ å‹ã®ã‚³ãƒ”ãƒ¼å¯èƒ½æ€§ã¯ã“ã“ã§ã®å‰æã§ã‚ã‚Šã€ãã®ã‚ˆã†ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ãŠã„ã¦ã“ã®åˆ¶ç´„ã¯å°„å½±çµæœå‹ã«å¯¾ã—ã¦ã‚‚ã‚³ãƒ”ãƒ¼å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’è¿½åŠ ã§æ±‚ã‚ã¦ã„ã‚‹éå‰°ãªåˆ¶ç´„ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã“ã®ã“ã¨ã«ã‚ˆã£ã¦å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¼ãƒ‰ã¯ã»ã¼ç„¡ã„ã¨æ€ã‚ã‚Œã¾ã™ãŒã€å°„å½±ã®çµæœãŒãƒ ãƒ¼ãƒ–ã‚ªãƒ³ãƒªãƒ¼å‹ã‚’è¿”ã™å ´åˆã¯å•é¡Œã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™

```cpp
std::ranges::for_each(
  std::views::iota(0, 5),
  // è¿°èªã€unique_ptrã‚’å€¤ã§å—ã‘å–ã‚‹
  // å·¦è¾ºå€¤ï¼ˆstd::unique_ptr<int>&ï¼‰ã§ã¯å‘¼ã¹ãªã„
  [](std::unique_ptr<int> v){
    std::cout << *v << std::endl;
  },
  // å°„å½±ã€unique_ptrã‚’è¿”ã™
  [](int v){
    return std::make_unique<int>(v);
  });
```

ã“ã®ææ¡ˆã¯ã€ã“ã‚Œã‚‰ã®åˆ¶ç´„ã«ã¤ã„ã¦æœ¬æ¥ã®æ„å›³ã¨ä¸€è‡´ã™ã‚‹ã‚ˆã†ã«é–“æ¥å‘¼ã³å‡ºã—ç³»ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’ä¿®æ­£ï¼ˆç·©å’Œï¼‰ã—ã‚ˆã†ã¨ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã¾ãšã€`std::projected`ã®çµæœã¨ç´ ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã¨ã§ãã®å€¤å‹ã®å–å¾—æ–¹æ³•ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å‹ç‰¹æ€§`std::indirect_value_t`ã‚’å°å…¥ã—ã¾ã™

```cpp
template<indirectly_readable I>
using indirect_value_t = ...;
```

`indirect_value_t<T>`ã¯ã€`T`ã®åå‰ãŒ`projected<I, Proj>`ã§ã‚ã‚‹æ™‚ã¯`invoke_result_t<Proj&, iter_value_t<I> &>`ã¨ãªã‚Šã€ãã‚Œä»¥å¤–ã®å ´åˆã¯`iter_value_t<T>&`ã¨ãªã‚Šã¾ã™ã€‚

```cpp
// å°„å½±çµæœå‹ï¼ˆprojectedï¼‰ã«å¯¾ã—ã¦ã¯ã“ã†ãªã‚‹
template<indirectly_readable I>
using indirect_value_t = invoke_result_t<Proj&, iter_value_t<I>&>;

// ãã‚Œä»¥å¤–ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿å‹ã«å¯¾ã—ã¦ã¯ã“ã†ãªã‚‹
template<indirectly_readable I>
using indirect_value_t = iter_value_t<T>&;
```

ã“ã‚Œã‚’ç”¨ã„ã¦é–“æ¥å‚ç…§ã‚’ä»‹ã—ãŸå‘¼ã³å‡ºã—ã‚’åˆ¶ç´„ã™ã‚‹ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’ä¿®æ­£ã—ã¾ã™ã€‚ä¾‹ãˆã°`std::indirect_unary_invocable`ã ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

```cpp
template< class F, class I >
  concept indirectly_unary_invocable =
    indirectly_readable<I> &&
    copy_constructible<F> &&
    invocable<F&, indirect_value_t<I>&> &&  // ğŸ‘ˆ
    invocable<F&, iter_reference_t<I>> &&
    invocable<F&, iter_common_reference_t<I>> &&
    common_reference_with<
      invoke_result_t<F&, indirect_value_t<I>&>,  // ğŸ‘ˆ
      invoke_result_t<F&, iter_reference_t<I>>>;
```

ã“ã‚Œã«ã‚ˆã£ã¦å¤‰ã‚ã£ãŸã“ã¨ã¯

```cpp
invocable<F&, indirect_value_t<I>&>

// indirect_value_tã‚’å±•é–‹
invocable<F&, invoke_result_t<Proj&, iter_value_t<I>&>>
```

ã“ã‚Œã‚’ã‚ˆãè¦‹ã¦ã¿ã‚‹ã¨

```cpp
using T = iter_value_t<I>&;
// auto c = *it; ã«å¯¾ã™ã‚‹ decltype((c)) ï¼ˆã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®è¦ç´ ã‚’ã‚³ãƒ”ãƒ¼ã—ãŸå·¦è¾ºå€¤

using U = invoke_result_t<Proj&, U>;
// decltype(proj(c)) ï¼ˆã‚³ãƒ”ãƒ¼ã—ãŸè¦ç´ ã®å·¦è¾ºå€¤ã«ã‚ˆã‚‹å°„å½±çµæœã®å‹

invocable<F&, U>;
// requires(F& f, U u) { f(u) } ï¼ˆå°„å½±çµæœã‚’ç›´æ¥æ¸¡ã—ã¦å‘¼ã³å‡ºã—å¯èƒ½ã‹ã‚’åˆ¶ç´„ã—ã¦ã„ã‚‹   
```

ã¤ã¾ã‚Šã“ã®å¤‰æ›´ã«ã‚ˆã£ã¦ã€`auto c = *it;`ã®ã‚ˆã†ã«ã‚³ãƒ”ãƒ¼ã—ã¦ãŠã„ãŸè¦ç´ ã«ã‚ˆã£ã¦`f(proj(c))`ã®ã‚ˆã†ãªå‘¼ã³å‡ºã—ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’åˆ¶ç´„ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€ã“ã‚Œã¯å…ƒã®ï¼ˆç¾åœ¨ã®ï¼‰åˆ¶ç´„ã‚’ç·©å’Œã™ã‚‹ã¨ã¨ã‚‚ã«æœ¬æ¥ã®æ„å›³ã‚’æ­£ã—ãè¡¨ç¾ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ã“ã¨ã¯æ—¢ã«GCC(libstdc++)åŠã³Range-v3ã«ã¦å®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€ç‰¹ã«å•é¡ŒãŒèµ·ãã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

- [P2609 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1271)

ã“ã®éƒ¨åˆ†ã®9å‰²ã¯ä»¥ä¸‹ã®æ–¹ã®ã”å”åŠ›ã«ã‚ˆã£ã¦æˆã‚Šç«‹ã£ã¦ã„ã¾ã™

- [@acd1034 ã•ã‚“](https://twitter.com/acd1034/status/1543975483343523840)

### [P2613R0 Add the missing `empty` to `mdspan`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2613r0.html)

`std::mdspan`ã«`empty()`ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ææ¡ˆã€‚

ç¾åœ¨ã®ææ¡ˆä¸­ã®`std::mdspan`ã¯`.size()`ã¯ã‚ã£ã¦ã‚‚`.empty()`ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’æŒã£ã¦ã„ã¾ã›ã‚“ã€‚ä¸€æ–¹ã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®éå›ºå®šã‚µã‚¤ã‚ºã‚³ãƒ³ãƒ†ãƒŠã‚„`std::span`ã¯ä¸¡æ–¹ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚ã“ã®ã“ã¨ã¯ã€ãã‚Œã‚‰ã¨`std::mdspan`ã¨ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä¸€è²«æ€§ã‚’æã­ã¦ã„ã‚‹ãŸã‚ã€`std::mdspan`ã«`empty()`ãƒ¡ãƒ³ãƒé–¢æ•°ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã™ã‚‹ææ¡ˆã§ã™ã€‚

ã¾ãŸã€`std::mdspan`ã«`.empty()`ã¯`size() = 0`ã‚ˆã‚Šã‚‚æœ€é©åŒ–ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚ä¾‹ãˆã°ã€`.size()`ã¯`mdspan`ã®ãã®æ™‚ç‚¹ã®å…¨ã¦ã®æ¬¡å…ƒã®è¦ç´ æ•°ï¼ˆã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ãƒˆï¼‰ã‚’ä¹—ç®—ã—ãŸå€¤ã‚’è¿”ã—ã¾ã™ãŒã€`.empty()`ã¯å…¨ã¦ã®æ¬¡å…ƒã®è¦ç´ æ•°ãŒ0ã‚ˆã‚Šå¤§ãã„ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã ã‘ã§ã€ã“ã‚Œã¯ä¹—ç®—ã‚ˆã‚Šã‚‚é«˜é€Ÿã§ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ææ¡ˆã¯ã™ã§ã«LEWGã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãƒ‘ã‚¹ã—ã¦ã€`std::mdspan`ã«ç›´æ¥é©ç”¨ã™ã‚‹ãŸã‚ã®LEWGå…¨ä½“æŠ•ç¥¨å¾…ã¡ã‚’ã—ã¦ã„ã¾ã™ã€‚

- [P2613 é€²è¡ŒçŠ¶æ³](https://github.com/cplusplus/papers/issues/1272)
